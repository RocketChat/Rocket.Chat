{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/home/weslley/Documents/projects/Rocket.Chat/ee/app/license/server/maxSeatsBanners.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.linux.x86_64"},"sourceFileName":"ee/app/license/server/maxSeatsBanners.ts","filename":"/home/weslley/Documents/projects/Rocket.Chat/ee/app/license/server/maxSeatsBanners.ts","inputSourceMap":{"version":3,"file":"ee/app/license/server/maxSeatsBanners.ts","sourceRoot":"","sources":["ee/app/license/server/maxSeatsBanners.ts"],"names":[],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { BlockType } from '@rocket.chat/apps-engine/definition/uikit/blocks/Blocks';\nimport { TextObjectType } from '@rocket.chat/apps-engine/definition/uikit/blocks/Objects';\nimport { TAPi18n } from 'meteor/rocketchat:tap-i18n';\n\nimport { IBanner, BannerPlatform } from '../../../../definition/IBanner';\nimport { Banner } from '../../../../server/sdk';\n\nconst WARNING_BANNER_ID = 'closeToSeatsLimit';\nconst DANGER_BANNER_ID = 'reachedSeatsLimit';\n\nconst makeWarningBanner = (seats: number): IBanner => ({\n\t_id: WARNING_BANNER_ID,\n\tplatform: [BannerPlatform.Web],\n\troles: ['admin'],\n\tview: {\n\t\ticon: 'warning',\n\t\tvariant: 'warning',\n\t\tviewId: '',\n\t\tappId: 'banner-core',\n\t\tblocks: [\n\t\t\t{\n\t\t\t\ttype: BlockType.SECTION,\n\t\t\t\tblockId: 'attention',\n\t\t\t\ttext: {\n\t\t\t\t\ttype: TextObjectType.MARKDOWN,\n\t\t\t\t\ttext: TAPi18n.__('Close_to_seat_limit_banner_warning', {\n\t\t\t\t\t\tseats,\n\t\t\t\t\t\turl: Meteor.absoluteUrl('/requestSeats'),\n\t\t\t\t\t}),\n\t\t\t\t\temoji: false,\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t},\n\tcreatedBy: {\n\t\t_id: 'rocket.cat',\n\t\tusername: 'rocket.cat',\n\t},\n\texpireAt: new Date(8640000000000000),\n\tstartAt: new Date(),\n\tcreatedAt: new Date(),\n\t_updatedAt: new Date(),\n\tactive: false,\n});\n\nconst makeDangerBanner = (): IBanner => ({\n\t_id: DANGER_BANNER_ID,\n\tplatform: [BannerPlatform.Web],\n\troles: ['admin'],\n\tview: {\n\t\ticon: 'ban',\n\t\tvariant: 'danger',\n\t\tviewId: '',\n\t\tappId: 'banner-core',\n\t\tblocks: [\n\t\t\t{\n\t\t\t\ttype: BlockType.SECTION,\n\t\t\t\tblockId: 'attention',\n\t\t\t\ttext: {\n\t\t\t\t\ttype: TextObjectType.MARKDOWN,\n\t\t\t\t\ttext: TAPi18n.__('Reached_seat_limit_banner_warning', {\n\t\t\t\t\t\turl: Meteor.absoluteUrl('/requestSeats'),\n\t\t\t\t\t}),\n\t\t\t\t\temoji: false,\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t},\n\tcreatedBy: {\n\t\t_id: 'rocket.cat',\n\t\tusername: 'rocket.cat',\n\t},\n\texpireAt: new Date(8640000000000000),\n\tstartAt: new Date(),\n\tcreatedAt: new Date(),\n\t_updatedAt: new Date(),\n\tactive: false,\n});\n\nexport const createSeatsLimitBanners = async (): Promise<void> => {\n\tconst [warning, danger] = await Promise.all([Banner.getById(WARNING_BANNER_ID), Banner.getById(DANGER_BANNER_ID)]);\n\tif (!warning) {\n\t\tBanner.create(makeWarningBanner(0));\n\t}\n\tif (!danger) {\n\t\tBanner.create(makeDangerBanner());\n\t}\n};\n\nexport const enableDangerBanner = (): void => {\n\tBanner.enable(DANGER_BANNER_ID, makeDangerBanner());\n};\n\nexport const disableDangerBannerDiscardingDismissal = async (): Promise<void> => {\n\tconst banner = await Banner.getById(DANGER_BANNER_ID);\n\tif (banner?.active) {\n\t\tBanner.disable(DANGER_BANNER_ID);\n\t\tBanner.discardDismissal(DANGER_BANNER_ID);\n\t}\n};\n\nexport const enableWarningBanner = (seatsLeft: number): void => {\n\tBanner.enable(WARNING_BANNER_ID, makeWarningBanner(seatsLeft));\n};\n\nexport const disableWarningBannerDiscardingDismissal = async (): Promise<void> => {\n\tconst banner = await Banner.getById(WARNING_BANNER_ID);\n\tif (banner?.active) {\n\t\tBanner.disable(WARNING_BANNER_ID);\n\t\tBanner.discardDismissal(WARNING_BANNER_ID);\n\t}\n};\n"]},"targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/home/weslley/Documents/projects/Rocket.Chat","root":"/home/weslley/Documents/projects/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/home/weslley/Documents/projects/Rocket.Chat/ee/app/license/server/maxSeatsBanners.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"ee/app/license/server/maxSeatsBanners.ts"}},"code":"module.export({\n  createSeatsLimitBanners: () => createSeatsLimitBanners,\n  enableDangerBanner: () => enableDangerBanner,\n  disableDangerBannerDiscardingDismissal: () => disableDangerBannerDiscardingDismissal,\n  enableWarningBanner: () => enableWarningBanner,\n  disableWarningBannerDiscardingDismissal: () => disableWarningBannerDiscardingDismissal\n});\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet BlockType;\nmodule.link(\"@rocket.chat/apps-engine/definition/uikit/blocks/Blocks\", {\n  BlockType(v) {\n    BlockType = v;\n  }\n\n}, 1);\nlet TextObjectType;\nmodule.link(\"@rocket.chat/apps-engine/definition/uikit/blocks/Objects\", {\n  TextObjectType(v) {\n    TextObjectType = v;\n  }\n\n}, 2);\nlet TAPi18n;\nmodule.link(\"meteor/rocketchat:tap-i18n\", {\n  TAPi18n(v) {\n    TAPi18n = v;\n  }\n\n}, 3);\nlet BannerPlatform;\nmodule.link(\"../../../../definition/IBanner\", {\n  BannerPlatform(v) {\n    BannerPlatform = v;\n  }\n\n}, 4);\nlet Banner;\nmodule.link(\"../../../../server/sdk\", {\n  Banner(v) {\n    Banner = v;\n  }\n\n}, 5);\nconst WARNING_BANNER_ID = 'closeToSeatsLimit';\nconst DANGER_BANNER_ID = 'reachedSeatsLimit';\n\nconst makeWarningBanner = seats => ({\n  _id: WARNING_BANNER_ID,\n  platform: [BannerPlatform.Web],\n  roles: ['admin'],\n  view: {\n    icon: 'warning',\n    variant: 'warning',\n    viewId: '',\n    appId: 'banner-core',\n    blocks: [{\n      type: BlockType.SECTION,\n      blockId: 'attention',\n      text: {\n        type: TextObjectType.MARKDOWN,\n        text: TAPi18n.__('Close_to_seat_limit_banner_warning', {\n          seats,\n          url: Meteor.absoluteUrl('/requestSeats')\n        }),\n        emoji: false\n      }\n    }]\n  },\n  createdBy: {\n    _id: 'rocket.cat',\n    username: 'rocket.cat'\n  },\n  expireAt: new Date(8640000000000000),\n  startAt: new Date(),\n  createdAt: new Date(),\n  _updatedAt: new Date(),\n  active: false\n});\n\nconst makeDangerBanner = () => ({\n  _id: DANGER_BANNER_ID,\n  platform: [BannerPlatform.Web],\n  roles: ['admin'],\n  view: {\n    icon: 'ban',\n    variant: 'danger',\n    viewId: '',\n    appId: 'banner-core',\n    blocks: [{\n      type: BlockType.SECTION,\n      blockId: 'attention',\n      text: {\n        type: TextObjectType.MARKDOWN,\n        text: TAPi18n.__('Reached_seat_limit_banner_warning', {\n          url: Meteor.absoluteUrl('/requestSeats')\n        }),\n        emoji: false\n      }\n    }]\n  },\n  createdBy: {\n    _id: 'rocket.cat',\n    username: 'rocket.cat'\n  },\n  expireAt: new Date(8640000000000000),\n  startAt: new Date(),\n  createdAt: new Date(),\n  _updatedAt: new Date(),\n  active: false\n});\n\nconst createSeatsLimitBanners = () => Promise.asyncApply(() => {\n  const [warning, danger] = Promise.await(Promise.all([Banner.getById(WARNING_BANNER_ID), Banner.getById(DANGER_BANNER_ID)]));\n\n  if (!warning) {\n    Banner.create(makeWarningBanner(0));\n  }\n\n  if (!danger) {\n    Banner.create(makeDangerBanner());\n  }\n});\n\nconst enableDangerBanner = () => {\n  Banner.enable(DANGER_BANNER_ID, makeDangerBanner());\n};\n\nconst disableDangerBannerDiscardingDismissal = () => Promise.asyncApply(() => {\n  const banner = Promise.await(Banner.getById(DANGER_BANNER_ID));\n\n  if (banner !== null && banner !== void 0 && banner.active) {\n    Banner.disable(DANGER_BANNER_ID);\n    Banner.discardDismissal(DANGER_BANNER_ID);\n  }\n});\n\nconst enableWarningBanner = seatsLeft => {\n  Banner.enable(WARNING_BANNER_ID, makeWarningBanner(seatsLeft));\n};\n\nconst disableWarningBannerDiscardingDismissal = () => Promise.asyncApply(() => {\n  const banner = Promise.await(Banner.getById(WARNING_BANNER_ID));\n\n  if (banner !== null && banner !== void 0 && banner.active) {\n    Banner.disable(WARNING_BANNER_ID);\n    Banner.discardDismissal(WARNING_BANNER_ID);\n  }\n});","map":{"version":3,"sources":["ee/app/license/server/maxSeatsBanners.ts"],"names":[],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { BlockType } from '@rocket.chat/apps-engine/definition/uikit/blocks/Blocks';\nimport { TextObjectType } from '@rocket.chat/apps-engine/definition/uikit/blocks/Objects';\nimport { TAPi18n } from 'meteor/rocketchat:tap-i18n';\n\nimport { IBanner, BannerPlatform } from '../../../../definition/IBanner';\nimport { Banner } from '../../../../server/sdk';\n\nconst WARNING_BANNER_ID = 'closeToSeatsLimit';\nconst DANGER_BANNER_ID = 'reachedSeatsLimit';\n\nconst makeWarningBanner = (seats: number): IBanner => ({\n\t_id: WARNING_BANNER_ID,\n\tplatform: [BannerPlatform.Web],\n\troles: ['admin'],\n\tview: {\n\t\ticon: 'warning',\n\t\tvariant: 'warning',\n\t\tviewId: '',\n\t\tappId: 'banner-core',\n\t\tblocks: [\n\t\t\t{\n\t\t\t\ttype: BlockType.SECTION,\n\t\t\t\tblockId: 'attention',\n\t\t\t\ttext: {\n\t\t\t\t\ttype: TextObjectType.MARKDOWN,\n\t\t\t\t\ttext: TAPi18n.__('Close_to_seat_limit_banner_warning', {\n\t\t\t\t\t\tseats,\n\t\t\t\t\t\turl: Meteor.absoluteUrl('/requestSeats'),\n\t\t\t\t\t}),\n\t\t\t\t\temoji: false,\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t},\n\tcreatedBy: {\n\t\t_id: 'rocket.cat',\n\t\tusername: 'rocket.cat',\n\t},\n\texpireAt: new Date(8640000000000000),\n\tstartAt: new Date(),\n\tcreatedAt: new Date(),\n\t_updatedAt: new Date(),\n\tactive: false,\n});\n\nconst makeDangerBanner = (): IBanner => ({\n\t_id: DANGER_BANNER_ID,\n\tplatform: [BannerPlatform.Web],\n\troles: ['admin'],\n\tview: {\n\t\ticon: 'ban',\n\t\tvariant: 'danger',\n\t\tviewId: '',\n\t\tappId: 'banner-core',\n\t\tblocks: [\n\t\t\t{\n\t\t\t\ttype: BlockType.SECTION,\n\t\t\t\tblockId: 'attention',\n\t\t\t\ttext: {\n\t\t\t\t\ttype: TextObjectType.MARKDOWN,\n\t\t\t\t\ttext: TAPi18n.__('Reached_seat_limit_banner_warning', {\n\t\t\t\t\t\turl: Meteor.absoluteUrl('/requestSeats'),\n\t\t\t\t\t}),\n\t\t\t\t\temoji: false,\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t},\n\tcreatedBy: {\n\t\t_id: 'rocket.cat',\n\t\tusername: 'rocket.cat',\n\t},\n\texpireAt: new Date(8640000000000000),\n\tstartAt: new Date(),\n\tcreatedAt: new Date(),\n\t_updatedAt: new Date(),\n\tactive: false,\n});\n\nexport const createSeatsLimitBanners = async (): Promise<void> => {\n\tconst [warning, danger] = await Promise.all([Banner.getById(WARNING_BANNER_ID), Banner.getById(DANGER_BANNER_ID)]);\n\tif (!warning) {\n\t\tBanner.create(makeWarningBanner(0));\n\t}\n\tif (!danger) {\n\t\tBanner.create(makeDangerBanner());\n\t}\n};\n\nexport const enableDangerBanner = (): void => {\n\tBanner.enable(DANGER_BANNER_ID, makeDangerBanner());\n};\n\nexport const disableDangerBannerDiscardingDismissal = async (): Promise<void> => {\n\tconst banner = await Banner.getById(DANGER_BANNER_ID);\n\tif (banner?.active) {\n\t\tBanner.disable(DANGER_BANNER_ID);\n\t\tBanner.discardDismissal(DANGER_BANNER_ID);\n\t}\n};\n\nexport const enableWarningBanner = (seatsLeft: number): void => {\n\tBanner.enable(WARNING_BANNER_ID, makeWarningBanner(seatsLeft));\n};\n\nexport const disableWarningBannerDiscardingDismissal = async (): Promise<void> => {\n\tconst banner = await Banner.getById(WARNING_BANNER_ID);\n\tif (banner?.active) {\n\t\tBanner.disable(WARNING_BANNER_ID);\n\t\tBanner.discardDismissal(WARNING_BANNER_ID);\n\t}\n};\n"],"sourceRoot":""},"sourceType":"module","hash":"dedef54b37ab651a71cbb377705107be34c3f378"}
