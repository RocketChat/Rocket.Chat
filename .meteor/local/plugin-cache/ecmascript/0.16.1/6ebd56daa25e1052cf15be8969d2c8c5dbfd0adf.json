{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/minimongo/matcher.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"packages/minimongo/matcher.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/minimongo/matcher.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/minimongo/matcher.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/minimongo/matcher.js"}},"code":"var _Package$mongoDecima;\n\nmodule.export({\n  \"default\": function () {\n    return Matcher;\n  }\n});\nvar LocalCollection;\nmodule.link(\"./local_collection.js\", {\n  \"default\": function (v) {\n    LocalCollection = v;\n  }\n}, 0);\nvar compileDocumentSelector, hasOwn, nothingMatcher;\nmodule.link(\"./common.js\", {\n  compileDocumentSelector: function (v) {\n    compileDocumentSelector = v;\n  },\n  hasOwn: function (v) {\n    hasOwn = v;\n  },\n  nothingMatcher: function (v) {\n    nothingMatcher = v;\n  }\n}, 1);\n\nvar Decimal = ((_Package$mongoDecima = Package['mongo-decimal']) === null || _Package$mongoDecima === void 0 ? void 0 : _Package$mongoDecima.Decimal) || function () {\n  function DecimalStub() {}\n\n  return DecimalStub;\n}(); // The minimongo selector compiler!\n// Terminology:\n//  - a 'selector' is the EJSON object representing a selector\n//  - a 'matcher' is its compiled form (whether a full Minimongo.Matcher\n//    object or one of the component lambdas that matches parts of it)\n//  - a 'result object' is an object with a 'result' field and maybe\n//    distance and arrayIndices.\n//  - a 'branched value' is an object with a 'value' field and maybe\n//    'dontIterate' and 'arrayIndices'.\n//  - a 'document' is a top-level object that can be stored in a collection.\n//  - a 'lookup function' is a function that takes in a document and returns\n//    an array of 'branched values'.\n//  - a 'branched matcher' maps from an array of branched values to a result\n//    object.\n//  - an 'element matcher' maps from a single value to a bool.\n// Main entry point.\n//   var matcher = new Minimongo.Matcher({a: {$gt: 5}});\n//   if (matcher.documentMatches({a: 7})) ...\n\n\nvar Matcher = /*#__PURE__*/function () {\n  function Matcher(selector, isUpdate) {\n    // A set (object mapping string -> *) of all of the document paths looked\n    // at by the selector. Also includes the empty string if it may look at any\n    // path (eg, $where).\n    this._paths = {}; // Set to true if compilation finds a $near.\n\n    this._hasGeoQuery = false; // Set to true if compilation finds a $where.\n\n    this._hasWhere = false; // Set to false if compilation finds anything other than a simple equality\n    // or one or more of '$gt', '$gte', '$lt', '$lte', '$ne', '$in', '$nin' used\n    // with scalars as operands.\n\n    this._isSimple = true; // Set to a dummy document which always matches this Matcher. Or set to null\n    // if such document is too hard to find.\n\n    this._matchingDocument = undefined; // A clone of the original selector. It may just be a function if the user\n    // passed in a function; otherwise is definitely an object (eg, IDs are\n    // translated into {_id: ID} first. Used by canBecomeTrueByModifier and\n    // Sorter._useWithMatcher.\n\n    this._selector = null;\n    this._docMatcher = this._compileSelector(selector); // Set to true if selection is done for an update operation\n    // Default is false\n    // Used for $near array update (issue #3599)\n\n    this._isUpdate = isUpdate;\n  }\n\n  var _proto = Matcher.prototype;\n\n  _proto.documentMatches = function () {\n    function documentMatches(doc) {\n      if (doc !== Object(doc)) {\n        throw Error('documentMatches needs a document');\n      }\n\n      return this._docMatcher(doc);\n    }\n\n    return documentMatches;\n  }();\n\n  _proto.hasGeoQuery = function () {\n    function hasGeoQuery() {\n      return this._hasGeoQuery;\n    }\n\n    return hasGeoQuery;\n  }();\n\n  _proto.hasWhere = function () {\n    function hasWhere() {\n      return this._hasWhere;\n    }\n\n    return hasWhere;\n  }();\n\n  _proto.isSimple = function () {\n    function isSimple() {\n      return this._isSimple;\n    }\n\n    return isSimple;\n  }() // Given a selector, return a function that takes one argument, a\n  // document. It returns a result object.\n  ;\n\n  _proto._compileSelector = function () {\n    function _compileSelector(selector) {\n      // you can pass a literal function instead of a selector\n      if (selector instanceof Function) {\n        this._isSimple = false;\n        this._selector = selector;\n\n        this._recordPathUsed('');\n\n        return function (doc) {\n          return {\n            result: !!selector.call(doc)\n          };\n        };\n      } // shorthand -- scalar _id\n\n\n      if (LocalCollection._selectorIsId(selector)) {\n        this._selector = {\n          _id: selector\n        };\n\n        this._recordPathUsed('_id');\n\n        return function (doc) {\n          return {\n            result: EJSON.equals(doc._id, selector)\n          };\n        };\n      } // protect against dangerous selectors.  falsey and {_id: falsey} are both\n      // likely programmer error, and not what you want, particularly for\n      // destructive operations.\n\n\n      if (!selector || hasOwn.call(selector, '_id') && !selector._id) {\n        this._isSimple = false;\n        return nothingMatcher;\n      } // Top level can't be an array or true or binary.\n\n\n      if (Array.isArray(selector) || EJSON.isBinary(selector) || typeof selector === 'boolean') {\n        throw new Error(\"Invalid selector: \" + selector);\n      }\n\n      this._selector = EJSON.clone(selector);\n      return compileDocumentSelector(selector, this, {\n        isRoot: true\n      });\n    }\n\n    return _compileSelector;\n  }() // Returns a list of key paths the given selector is looking for. It includes\n  // the empty string if there is a $where.\n  ;\n\n  _proto._getPaths = function () {\n    function _getPaths() {\n      return Object.keys(this._paths);\n    }\n\n    return _getPaths;\n  }();\n\n  _proto._recordPathUsed = function () {\n    function _recordPathUsed(path) {\n      this._paths[path] = true;\n    }\n\n    return _recordPathUsed;\n  }();\n\n  return Matcher;\n}();\n\n// helpers used by compiled selector code\nLocalCollection._f = {\n  // XXX for _all and _in, consider building 'inquery' at compile time..\n  _type: function (v) {\n    if (typeof v === 'number') {\n      return 1;\n    }\n\n    if (typeof v === 'string') {\n      return 2;\n    }\n\n    if (typeof v === 'boolean') {\n      return 8;\n    }\n\n    if (Array.isArray(v)) {\n      return 4;\n    }\n\n    if (v === null) {\n      return 10;\n    } // note that typeof(/x/) === \"object\"\n\n\n    if (v instanceof RegExp) {\n      return 11;\n    }\n\n    if (typeof v === 'function') {\n      return 13;\n    }\n\n    if (v instanceof Date) {\n      return 9;\n    }\n\n    if (EJSON.isBinary(v)) {\n      return 5;\n    }\n\n    if (v instanceof MongoID.ObjectID) {\n      return 7;\n    }\n\n    if (v instanceof Decimal) {\n      return 1;\n    } // object\n\n\n    return 3; // XXX support some/all of these:\n    // 14, symbol\n    // 15, javascript code with scope\n    // 16, 18: 32-bit/64-bit integer\n    // 17, timestamp\n    // 255, minkey\n    // 127, maxkey\n  },\n  // deep equality test: use for literal document and array matches\n  _equal: function (a, b) {\n    return EJSON.equals(a, b, {\n      keyOrderSensitive: true\n    });\n  },\n  // maps a type code to a value that can be used to sort values of different\n  // types\n  _typeorder: function (t) {\n    // http://www.mongodb.org/display/DOCS/What+is+the+Compare+Order+for+BSON+Types\n    // XXX what is the correct sort position for Javascript code?\n    // ('100' in the matrix below)\n    // XXX minkey/maxkey\n    return [-1, // (not a type)\n    1, // number\n    2, // string\n    3, // object\n    4, // array\n    5, // binary\n    -1, // deprecated\n    6, // ObjectID\n    7, // bool\n    8, // Date\n    0, // null\n    9, // RegExp\n    -1, // deprecated\n    100, // JS code\n    2, // deprecated (symbol)\n    100, // JS code\n    1, // 32-bit int\n    8, // Mongo timestamp\n    1 // 64-bit int\n    ][t];\n  },\n  // compare two values of unknown type according to BSON ordering\n  // semantics. (as an extension, consider 'undefined' to be less than\n  // any other value.) return negative if a is less, positive if b is\n  // less, or 0 if equal\n  _cmp: function (a, b) {\n    if (a === undefined) {\n      return b === undefined ? 0 : -1;\n    }\n\n    if (b === undefined) {\n      return 1;\n    }\n\n    var ta = LocalCollection._f._type(a);\n\n    var tb = LocalCollection._f._type(b);\n\n    var oa = LocalCollection._f._typeorder(ta);\n\n    var ob = LocalCollection._f._typeorder(tb);\n\n    if (oa !== ob) {\n      return oa < ob ? -1 : 1;\n    } // XXX need to implement this if we implement Symbol or integers, or\n    // Timestamp\n\n\n    if (ta !== tb) {\n      throw Error('Missing type coercion logic in _cmp');\n    }\n\n    if (ta === 7) {\n      // ObjectID\n      // Convert to string.\n      ta = tb = 2;\n      a = a.toHexString();\n      b = b.toHexString();\n    }\n\n    if (ta === 9) {\n      // Date\n      // Convert to millis.\n      ta = tb = 1;\n      a = a.getTime();\n      b = b.getTime();\n    }\n\n    if (ta === 1) {\n      // double\n      if (a instanceof Decimal) {\n        return a.minus(b).toNumber();\n      } else {\n        return a - b;\n      }\n    }\n\n    if (tb === 2) // string\n      return a < b ? -1 : a === b ? 0 : 1;\n\n    if (ta === 3) {\n      // Object\n      // this could be much more efficient in the expected case ...\n      var toArray = function (object) {\n        var result = [];\n        Object.keys(object).forEach(function (key) {\n          result.push(key, object[key]);\n        });\n        return result;\n      };\n\n      return LocalCollection._f._cmp(toArray(a), toArray(b));\n    }\n\n    if (ta === 4) {\n      // Array\n      for (var i = 0;; i++) {\n        if (i === a.length) {\n          return i === b.length ? 0 : -1;\n        }\n\n        if (i === b.length) {\n          return 1;\n        }\n\n        var s = LocalCollection._f._cmp(a[i], b[i]);\n\n        if (s !== 0) {\n          return s;\n        }\n      }\n    }\n\n    if (ta === 5) {\n      // binary\n      // Surprisingly, a small binary blob is always less than a large one in\n      // Mongo.\n      if (a.length !== b.length) {\n        return a.length - b.length;\n      }\n\n      for (var _i = 0; _i < a.length; _i++) {\n        if (a[_i] < b[_i]) {\n          return -1;\n        }\n\n        if (a[_i] > b[_i]) {\n          return 1;\n        }\n      }\n\n      return 0;\n    }\n\n    if (ta === 8) {\n      // boolean\n      if (a) {\n        return b ? 0 : 1;\n      }\n\n      return b ? -1 : 0;\n    }\n\n    if (ta === 10) // null\n      return 0;\n    if (ta === 11) // regexp\n      throw Error('Sorting not supported on regular expression'); // XXX\n    // 13: javascript code\n    // 14: symbol\n    // 15: javascript code with scope\n    // 16: 32-bit integer\n    // 17: timestamp\n    // 18: 64-bit integer\n    // 255: minkey\n    // 127: maxkey\n\n    if (ta === 13) // javascript code\n      throw Error('Sorting not supported on Javascript code'); // XXX\n\n    throw Error('Unknown type to sort');\n  }\n};","map":{"version":3,"sources":["packages/minimongo/matcher.js"],"names":["module","export","Matcher","LocalCollection","link","v","compileDocumentSelector","hasOwn","nothingMatcher","Decimal","Package","selector","isUpdate","_paths","_hasGeoQuery","_hasWhere","_isSimple","_matchingDocument","undefined","_selector","_docMatcher","_compileSelector","_isUpdate","documentMatches","doc","Object","Error","hasGeoQuery","hasWhere","isSimple","Function","_recordPathUsed","result","call","_selectorIsId","_id","EJSON","equals","Array","isArray","isBinary","clone","isRoot","_getPaths","keys","path","_f","_type","RegExp","Date","MongoID","ObjectID","_equal","a","b","keyOrderSensitive","_typeorder","t","_cmp","ta","tb","oa","ob","toHexString","getTime","minus","toNumber","toArray","object","forEach","key","push","i","length","s"],"mappings":"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","sourcesContent":["import LocalCollection from './local_collection.js';\nimport {\n  compileDocumentSelector,\n  hasOwn,\n  nothingMatcher,\n} from './common.js';\n\nconst Decimal = Package['mongo-decimal']?.Decimal || class DecimalStub {}\n\n// The minimongo selector compiler!\n\n// Terminology:\n//  - a 'selector' is the EJSON object representing a selector\n//  - a 'matcher' is its compiled form (whether a full Minimongo.Matcher\n//    object or one of the component lambdas that matches parts of it)\n//  - a 'result object' is an object with a 'result' field and maybe\n//    distance and arrayIndices.\n//  - a 'branched value' is an object with a 'value' field and maybe\n//    'dontIterate' and 'arrayIndices'.\n//  - a 'document' is a top-level object that can be stored in a collection.\n//  - a 'lookup function' is a function that takes in a document and returns\n//    an array of 'branched values'.\n//  - a 'branched matcher' maps from an array of branched values to a result\n//    object.\n//  - an 'element matcher' maps from a single value to a bool.\n\n// Main entry point.\n//   var matcher = new Minimongo.Matcher({a: {$gt: 5}});\n//   if (matcher.documentMatches({a: 7})) ...\nexport default class Matcher {\n  constructor(selector, isUpdate) {\n    // A set (object mapping string -> *) of all of the document paths looked\n    // at by the selector. Also includes the empty string if it may look at any\n    // path (eg, $where).\n    this._paths = {};\n    // Set to true if compilation finds a $near.\n    this._hasGeoQuery = false;\n    // Set to true if compilation finds a $where.\n    this._hasWhere = false;\n    // Set to false if compilation finds anything other than a simple equality\n    // or one or more of '$gt', '$gte', '$lt', '$lte', '$ne', '$in', '$nin' used\n    // with scalars as operands.\n    this._isSimple = true;\n    // Set to a dummy document which always matches this Matcher. Or set to null\n    // if such document is too hard to find.\n    this._matchingDocument = undefined;\n    // A clone of the original selector. It may just be a function if the user\n    // passed in a function; otherwise is definitely an object (eg, IDs are\n    // translated into {_id: ID} first. Used by canBecomeTrueByModifier and\n    // Sorter._useWithMatcher.\n    this._selector = null;\n    this._docMatcher = this._compileSelector(selector);\n    // Set to true if selection is done for an update operation\n    // Default is false\n    // Used for $near array update (issue #3599)\n    this._isUpdate = isUpdate;\n  }\n\n  documentMatches(doc) {\n    if (doc !== Object(doc)) {\n      throw Error('documentMatches needs a document');\n    }\n\n    return this._docMatcher(doc);\n  }\n\n  hasGeoQuery() {\n    return this._hasGeoQuery;\n  }\n\n  hasWhere() {\n    return this._hasWhere;\n  }\n\n  isSimple() {\n    return this._isSimple;\n  }\n\n  // Given a selector, return a function that takes one argument, a\n  // document. It returns a result object.\n  _compileSelector(selector) {\n    // you can pass a literal function instead of a selector\n    if (selector instanceof Function) {\n      this._isSimple = false;\n      this._selector = selector;\n      this._recordPathUsed('');\n\n      return doc => ({result: !!selector.call(doc)});\n    }\n\n    // shorthand -- scalar _id\n    if (LocalCollection._selectorIsId(selector)) {\n      this._selector = {_id: selector};\n      this._recordPathUsed('_id');\n\n      return doc => ({result: EJSON.equals(doc._id, selector)});\n    }\n\n    // protect against dangerous selectors.  falsey and {_id: falsey} are both\n    // likely programmer error, and not what you want, particularly for\n    // destructive operations.\n    if (!selector || hasOwn.call(selector, '_id') && !selector._id) {\n      this._isSimple = false;\n      return nothingMatcher;\n    }\n\n    // Top level can't be an array or true or binary.\n    if (Array.isArray(selector) ||\n        EJSON.isBinary(selector) ||\n        typeof selector === 'boolean') {\n      throw new Error(`Invalid selector: ${selector}`);\n    }\n\n    this._selector = EJSON.clone(selector);\n\n    return compileDocumentSelector(selector, this, {isRoot: true});\n  }\n\n  // Returns a list of key paths the given selector is looking for. It includes\n  // the empty string if there is a $where.\n  _getPaths() {\n    return Object.keys(this._paths);\n  }\n\n  _recordPathUsed(path) {\n    this._paths[path] = true;\n  }\n}\n\n// helpers used by compiled selector code\nLocalCollection._f = {\n  // XXX for _all and _in, consider building 'inquery' at compile time..\n  _type(v) {\n    if (typeof v === 'number') {\n      return 1;\n    }\n\n    if (typeof v === 'string') {\n      return 2;\n    }\n\n    if (typeof v === 'boolean') {\n      return 8;\n    }\n\n    if (Array.isArray(v)) {\n      return 4;\n    }\n\n    if (v === null) {\n      return 10;\n    }\n\n    // note that typeof(/x/) === \"object\"\n    if (v instanceof RegExp) {\n      return 11;\n    }\n\n    if (typeof v === 'function') {\n      return 13;\n    }\n\n    if (v instanceof Date) {\n      return 9;\n    }\n\n    if (EJSON.isBinary(v)) {\n      return 5;\n    }\n\n    if (v instanceof MongoID.ObjectID) {\n      return 7;\n    }\n\n    if (v instanceof Decimal) {\n      return 1;\n    }\n\n    // object\n    return 3;\n\n    // XXX support some/all of these:\n    // 14, symbol\n    // 15, javascript code with scope\n    // 16, 18: 32-bit/64-bit integer\n    // 17, timestamp\n    // 255, minkey\n    // 127, maxkey\n  },\n\n  // deep equality test: use for literal document and array matches\n  _equal(a, b) {\n    return EJSON.equals(a, b, {keyOrderSensitive: true});\n  },\n\n  // maps a type code to a value that can be used to sort values of different\n  // types\n  _typeorder(t) {\n    // http://www.mongodb.org/display/DOCS/What+is+the+Compare+Order+for+BSON+Types\n    // XXX what is the correct sort position for Javascript code?\n    // ('100' in the matrix below)\n    // XXX minkey/maxkey\n    return [\n      -1,  // (not a type)\n      1,   // number\n      2,   // string\n      3,   // object\n      4,   // array\n      5,   // binary\n      -1,  // deprecated\n      6,   // ObjectID\n      7,   // bool\n      8,   // Date\n      0,   // null\n      9,   // RegExp\n      -1,  // deprecated\n      100, // JS code\n      2,   // deprecated (symbol)\n      100, // JS code\n      1,   // 32-bit int\n      8,   // Mongo timestamp\n      1    // 64-bit int\n    ][t];\n  },\n\n  // compare two values of unknown type according to BSON ordering\n  // semantics. (as an extension, consider 'undefined' to be less than\n  // any other value.) return negative if a is less, positive if b is\n  // less, or 0 if equal\n  _cmp(a, b) {\n    if (a === undefined) {\n      return b === undefined ? 0 : -1;\n    }\n\n    if (b === undefined) {\n      return 1;\n    }\n\n    let ta = LocalCollection._f._type(a);\n    let tb = LocalCollection._f._type(b);\n\n    const oa = LocalCollection._f._typeorder(ta);\n    const ob = LocalCollection._f._typeorder(tb);\n\n    if (oa !== ob) {\n      return oa < ob ? -1 : 1;\n    }\n\n    // XXX need to implement this if we implement Symbol or integers, or\n    // Timestamp\n    if (ta !== tb) {\n      throw Error('Missing type coercion logic in _cmp');\n    }\n\n    if (ta === 7) { // ObjectID\n      // Convert to string.\n      ta = tb = 2;\n      a = a.toHexString();\n      b = b.toHexString();\n    }\n\n    if (ta === 9) { // Date\n      // Convert to millis.\n      ta = tb = 1;\n      a = a.getTime();\n      b = b.getTime();\n    }\n\n    if (ta === 1) { // double\n      if (a instanceof Decimal) {\n        return a.minus(b).toNumber();\n      } else {\n        return a - b;\n      }\n    }\n\n    if (tb === 2) // string\n      return a < b ? -1 : a === b ? 0 : 1;\n\n    if (ta === 3) { // Object\n      // this could be much more efficient in the expected case ...\n      const toArray = object => {\n        const result = [];\n\n        Object.keys(object).forEach(key => {\n          result.push(key, object[key]);\n        });\n\n        return result;\n      };\n\n      return LocalCollection._f._cmp(toArray(a), toArray(b));\n    }\n\n    if (ta === 4) { // Array\n      for (let i = 0; ; i++) {\n        if (i === a.length) {\n          return i === b.length ? 0 : -1;\n        }\n\n        if (i === b.length) {\n          return 1;\n        }\n\n        const s = LocalCollection._f._cmp(a[i], b[i]);\n        if (s !== 0) {\n          return s;\n        }\n      }\n    }\n\n    if (ta === 5) { // binary\n      // Surprisingly, a small binary blob is always less than a large one in\n      // Mongo.\n      if (a.length !== b.length) {\n        return a.length - b.length;\n      }\n\n      for (let i = 0; i < a.length; i++) {\n        if (a[i] < b[i]) {\n          return -1;\n        }\n\n        if (a[i] > b[i]) {\n          return 1;\n        }\n      }\n\n      return 0;\n    }\n\n    if (ta === 8) { // boolean\n      if (a) {\n        return b ? 0 : 1;\n      }\n\n      return b ? -1 : 0;\n    }\n\n    if (ta === 10) // null\n      return 0;\n\n    if (ta === 11) // regexp\n      throw Error('Sorting not supported on regular expression'); // XXX\n\n    // 13: javascript code\n    // 14: symbol\n    // 15: javascript code with scope\n    // 16: 32-bit integer\n    // 17: timestamp\n    // 18: 64-bit integer\n    // 255: minkey\n    // 127: maxkey\n    if (ta === 13) // javascript code\n      throw Error('Sorting not supported on Javascript code'); // XXX\n\n    throw Error('Unknown type to sort');\n  },\n};\n"]},"sourceType":"module","hash":"6ebd56daa25e1052cf15be8969d2c8c5dbfd0adf"}
