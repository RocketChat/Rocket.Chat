{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/blaze/attrs.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"packages/blaze/attrs.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/blaze/attrs.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/blaze/attrs.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/blaze/attrs.js"}},"code":"let has;\nmodule.link(\"lodash.has\", {\n  default(v) {\n    has = v;\n  }\n\n}, 0);\nvar jsUrlsAllowed = false;\n\nBlaze._allowJavascriptUrls = function () {\n  jsUrlsAllowed = true;\n};\n\nBlaze._javascriptUrlsAllowed = function () {\n  return jsUrlsAllowed;\n}; // An AttributeHandler object is responsible for updating a particular attribute\n// of a particular element.  AttributeHandler subclasses implement\n// browser-specific logic for dealing with particular attributes across\n// different browsers.\n//\n// To define a new type of AttributeHandler, use\n// `var FooHandler = AttributeHandler.extend({ update: function ... })`\n// where the `update` function takes arguments `(element, oldValue, value)`.\n// The `element` argument is always the same between calls to `update` on\n// the same instance.  `oldValue` and `value` are each either `null` or\n// a Unicode string of the type that might be passed to the value argument\n// of `setAttribute` (i.e. not an HTML string with character references).\n// When an AttributeHandler is installed, an initial call to `update` is\n// always made with `oldValue = null`.  The `update` method can access\n// `this.name` if the AttributeHandler class is a generic one that applies\n// to multiple attribute names.\n//\n// AttributeHandlers can store custom properties on `this`, as long as they\n// don't use the names `element`, `name`, `value`, and `oldValue`.\n//\n// AttributeHandlers can't influence how attributes appear in rendered HTML,\n// only how they are updated after materialization as DOM.\n\n\nAttributeHandler = function (name, value) {\n  this.name = name;\n  this.value = value;\n};\n\nBlaze._AttributeHandler = AttributeHandler;\n\nAttributeHandler.prototype.update = function (element, oldValue, value) {\n  if (value === null) {\n    if (oldValue !== null) element.removeAttribute(this.name);\n  } else {\n    element.setAttribute(this.name, value);\n  }\n};\n\nAttributeHandler.extend = function (options) {\n  var curType = this;\n\n  var subType = function\n    /*arguments*/\n  AttributeHandlerSubtype() {\n    AttributeHandler.apply(this, arguments);\n  };\n\n  subType.prototype = new curType();\n  subType.extend = curType.extend;\n\n  if (options) {\n    Object.assign(subType.prototype, options);\n  }\n\n  return subType;\n}; /// Apply the diff between the attributes of \"oldValue\" and \"value\" to \"element.\"\n//\n// Each subclass must implement a parseValue method which takes a string\n// as an input and returns an ordered dict of attributes. The keys of the dict\n// are unique identifiers (ie. css properties in the case of styles), and the\n// values are the entire attribute which will be injected into the element.\n//\n// Extended below to support classes, SVG elements and styles.\n\n\nBlaze._DiffingAttributeHandler = AttributeHandler.extend({\n  update: function (element, oldValue, value) {\n    if (!this.getCurrentValue || !this.setValue || !this.parseValue || !this.joinValues) throw new Error(\"Missing methods in subclass of 'DiffingAttributeHandler'\");\n    var oldAttrsMap = oldValue ? this.parseValue(oldValue) : new OrderedDict();\n    var attrsMap = value ? this.parseValue(value) : new OrderedDict(); // the current attributes on the element, which we will mutate.\n\n    var currentAttrString = this.getCurrentValue(element);\n    var currentAttrsMap = currentAttrString ? this.parseValue(currentAttrString) : new OrderedDict(); // Any outside changes to attributes we add at the end.\n\n    currentAttrsMap.forEach(function (value, key, i) {\n      // If the key already exists, we do not use the current value, but the new value.\n      if (attrsMap.has(key)) {\n        return;\n      } // Key does not already exist, but it existed before. Which means it was explicitly\n      // removed, so we do not add it.\n\n\n      if (oldAttrsMap.has(key)) {\n        return;\n      }\n\n      attrsMap.append(key, value);\n    });\n    var values = [];\n    attrsMap.forEach(function (value, key, i) {\n      values.push(value);\n    });\n    this.setValue(element, this.joinValues(values));\n  }\n});\n\nvar ClassHandler = Blaze._DiffingAttributeHandler.extend({\n  // @param rawValue {String}\n  getCurrentValue: function (element) {\n    return element.className;\n  },\n  setValue: function (element, className) {\n    element.className = className;\n  },\n  parseValue: function (attrString) {\n    var tokens = new OrderedDict();\n    attrString.split(' ').forEach(function (token) {\n      if (token) {\n        // Ordered dict requires unique keys.\n        if (!tokens.has(token)) {\n          tokens.append(token, token);\n        }\n      }\n    });\n    return tokens;\n  },\n  joinValues: function (values) {\n    return values.join(' ');\n  }\n});\n\nvar SVGClassHandler = ClassHandler.extend({\n  getCurrentValue: function (element) {\n    return element.className.baseVal;\n  },\n  setValue: function (element, className) {\n    element.setAttribute('class', className);\n  }\n});\n\nvar StyleHandler = Blaze._DiffingAttributeHandler.extend({\n  getCurrentValue: function (element) {\n    return element.getAttribute('style');\n  },\n  setValue: function (element, style) {\n    if (style === '') {\n      element.removeAttribute('style');\n    } else {\n      element.setAttribute('style', style);\n    }\n  },\n  // Parse a string to produce a map from property to attribute string.\n  //\n  // Example:\n  // \"color:red; foo:12px\" produces a token {color: \"color:red\", foo:\"foo:12px\"}\n  parseValue: function (attrString) {\n    var tokens = new OrderedDict(); // Regex for parsing a css attribute declaration, taken from css-parse:\n    // https://github.com/reworkcss/css-parse/blob/7cef3658d0bba872cde05a85339034b187cb3397/index.js#L219\n\n    var regex = /(\\*?[-#\\/\\*\\\\\\w]+(?:\\[[0-9a-z_-]+\\])?)\\s*:\\s*(?:\\'(?:\\\\\\'|.)*?\\'|\"(?:\\\\\"|.)*?\"|\\([^\\)]*?\\)|[^};])+[;\\s]*/g;\n    var match = regex.exec(attrString);\n\n    while (match) {\n      // match[0] = entire matching string\n      // match[1] = css property\n      // Prefix the token to prevent conflicts with existing properties.\n      // We use the last value for the same key.\n      if (tokens.has(match[1])) {\n        tokens.remove(match[1]);\n      }\n\n      tokens.append(match[1], match[0].trim());\n      match = regex.exec(attrString);\n    }\n\n    return tokens;\n  },\n  joinValues: function (values) {\n    // TODO: Assure that there is always ; between values. But what is an example where it breaks?\n    return values.join(' ');\n  }\n});\n\nvar BooleanHandler = AttributeHandler.extend({\n  update: function (element, oldValue, value) {\n    var name = this.name;\n\n    if (value == null) {\n      if (oldValue != null) element[name] = false;\n    } else {\n      element[name] = true;\n    }\n  }\n});\nvar DOMPropertyHandler = AttributeHandler.extend({\n  update: function (element, oldValue, value) {\n    var name = this.name;\n    if (value !== element[name]) element[name] = value;\n  }\n}); // attributes of the type 'xlink:something' should be set using\n// the correct namespace in order to work\n\nvar XlinkHandler = AttributeHandler.extend({\n  update: function (element, oldValue, value) {\n    var NS = 'http://www.w3.org/1999/xlink';\n\n    if (value === null) {\n      if (oldValue !== null) element.removeAttributeNS(NS, this.name);\n    } else {\n      element.setAttributeNS(NS, this.name, this.value);\n    }\n  }\n}); // cross-browser version of `instanceof SVGElement`\n\nvar isSVGElement = function (elem) {\n  return 'ownerSVGElement' in elem;\n};\n\nvar isUrlAttribute = function (tagName, attrName) {\n  // Compiled from http://www.w3.org/TR/REC-html40/index/attributes.html\n  // and\n  // http://www.w3.org/html/wg/drafts/html/master/index.html#attributes-1\n  var urlAttrs = {\n    FORM: ['action'],\n    BODY: ['background'],\n    BLOCKQUOTE: ['cite'],\n    Q: ['cite'],\n    DEL: ['cite'],\n    INS: ['cite'],\n    OBJECT: ['classid', 'codebase', 'data', 'usemap'],\n    APPLET: ['codebase'],\n    A: ['href'],\n    AREA: ['href'],\n    LINK: ['href'],\n    BASE: ['href'],\n    IMG: ['longdesc', 'src', 'usemap'],\n    FRAME: ['longdesc', 'src'],\n    IFRAME: ['longdesc', 'src'],\n    HEAD: ['profile'],\n    SCRIPT: ['src'],\n    INPUT: ['src', 'usemap', 'formaction'],\n    BUTTON: ['formaction'],\n    BASE: ['href'],\n    MENUITEM: ['icon'],\n    HTML: ['manifest'],\n    VIDEO: ['poster']\n  };\n\n  if (attrName === 'itemid') {\n    return true;\n  }\n\n  var urlAttrNames = urlAttrs[tagName] || [];\n  return urlAttrNames.includes(attrName);\n}; // To get the protocol for a URL, we let the browser normalize it for\n// us, by setting it as the href for an anchor tag and then reading out\n// the 'protocol' property.\n\n\nif (Meteor.isClient) {\n  var anchorForNormalization = document.createElement('A');\n}\n\nvar getUrlProtocol = function (url) {\n  if (Meteor.isClient) {\n    anchorForNormalization.href = url;\n    return (anchorForNormalization.protocol || \"\").toLowerCase();\n  } else {\n    throw new Error('getUrlProtocol not implemented on the server');\n  }\n}; // UrlHandler is an attribute handler for all HTML attributes that take\n// URL values. It disallows javascript: URLs, unless\n// Blaze._allowJavascriptUrls() has been called. To detect javascript:\n// urls, we set the attribute on a dummy anchor element and then read\n// out the 'protocol' property of the attribute.\n\n\nvar origUpdate = AttributeHandler.prototype.update;\nvar UrlHandler = AttributeHandler.extend({\n  update: function (element, oldValue, value) {\n    var self = this;\n    var args = arguments;\n\n    if (Blaze._javascriptUrlsAllowed()) {\n      origUpdate.apply(self, args);\n    } else {\n      var isJavascriptProtocol = getUrlProtocol(value) === \"javascript:\";\n      var isVBScriptProtocol = getUrlProtocol(value) === \"vbscript:\";\n\n      if (isJavascriptProtocol || isVBScriptProtocol) {\n        Blaze._warn(\"URLs that use the 'javascript:' or 'vbscript:' protocol are not \" + \"allowed in URL attribute values. \" + \"Call Blaze._allowJavascriptUrls() \" + \"to enable them.\");\n\n        origUpdate.apply(self, [element, oldValue, null]);\n      } else {\n        origUpdate.apply(self, args);\n      }\n    }\n  }\n}); // XXX make it possible for users to register attribute handlers!\n\nBlaze._makeAttributeHandler = function (elem, name, value) {\n  // generally, use setAttribute but certain attributes need to be set\n  // by directly setting a JavaScript property on the DOM element.\n  if (name === 'class') {\n    if (isSVGElement(elem)) {\n      return new SVGClassHandler(name, value);\n    } else {\n      return new ClassHandler(name, value);\n    }\n  } else if (name === 'style') {\n    return new StyleHandler(name, value);\n  } else if (elem.tagName === 'OPTION' && name === 'selected' || elem.tagName === 'INPUT' && name === 'checked' || elem.tagName === 'VIDEO' && name === 'muted') {\n    return new BooleanHandler(name, value);\n  } else if ((elem.tagName === 'TEXTAREA' || elem.tagName === 'INPUT') && name === 'value') {\n    // internally, TEXTAREAs tracks their value in the 'value'\n    // attribute just like INPUTs.\n    return new DOMPropertyHandler(name, value);\n  } else if (name.substring(0, 6) === 'xlink:') {\n    return new XlinkHandler(name.substring(6), value);\n  } else if (isUrlAttribute(elem.tagName, name)) {\n    return new UrlHandler(name, value);\n  } else {\n    return new AttributeHandler(name, value);\n  } // XXX will need one for 'style' on IE, though modern browsers\n  // seem to handle setAttribute ok.\n\n};\n\nElementAttributesUpdater = function (elem) {\n  this.elem = elem;\n  this.handlers = {};\n}; // Update attributes on `elem` to the dictionary `attrs`, whose\n// values are strings.\n\n\nElementAttributesUpdater.prototype.update = function (newAttrs) {\n  var elem = this.elem;\n  var handlers = this.handlers;\n\n  for (var k in handlers) {\n    if (!has(newAttrs, k)) {\n      // remove attributes (and handlers) for attribute names\n      // that don't exist as keys of `newAttrs` and so won't\n      // be visited when traversing it.  (Attributes that\n      // exist in the `newAttrs` object but are `null`\n      // are handled later.)\n      var handler = handlers[k];\n      var oldValue = handler.value;\n      handler.value = null;\n      handler.update(elem, oldValue, null);\n      delete handlers[k];\n    }\n  }\n\n  for (var k in newAttrs) {\n    var handler = null;\n    var oldValue = null;\n    var value = newAttrs[k];\n\n    if (!has(handlers, k)) {\n      if (value !== null) {\n        // make new handler\n        handler = Blaze._makeAttributeHandler(elem, k, value);\n        handlers[k] = handler;\n      }\n    } else {\n      handler = handlers[k];\n      oldValue = handler.value;\n    }\n\n    if (oldValue !== value) {\n      handler.value = value;\n      handler.update(elem, oldValue, value);\n      if (value === null) delete handlers[k];\n    }\n  }\n};","map":{"version":3,"sources":["packages/blaze/attrs.js"],"names":["has","module","link","default","v","jsUrlsAllowed","Blaze","_allowJavascriptUrls","_javascriptUrlsAllowed","AttributeHandler","name","value","_AttributeHandler","prototype","update","element","oldValue","removeAttribute","setAttribute","extend","options","curType","subType","AttributeHandlerSubtype","apply","arguments","Object","assign","_DiffingAttributeHandler","getCurrentValue","setValue","parseValue","joinValues","Error","oldAttrsMap","OrderedDict","attrsMap","currentAttrString","currentAttrsMap","forEach","key","i","append","values","push","ClassHandler","className","attrString","tokens","split","token","join","SVGClassHandler","baseVal","StyleHandler","getAttribute","style","regex","match","exec","remove","trim","BooleanHandler","DOMPropertyHandler","XlinkHandler","NS","removeAttributeNS","setAttributeNS","isSVGElement","elem","isUrlAttribute","tagName","attrName","urlAttrs","FORM","BODY","BLOCKQUOTE","Q","DEL","INS","OBJECT","APPLET","A","AREA","LINK","BASE","IMG","FRAME","IFRAME","HEAD","SCRIPT","INPUT","BUTTON","MENUITEM","HTML","VIDEO","urlAttrNames","includes","Meteor","isClient","anchorForNormalization","document","createElement","getUrlProtocol","url","href","protocol","toLowerCase","origUpdate","UrlHandler","self","args","isJavascriptProtocol","isVBScriptProtocol","_warn","_makeAttributeHandler","substring","ElementAttributesUpdater","handlers","newAttrs","k","handler"],"mappings":"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","sourcesContent":["import has from 'lodash.has';\n\nvar jsUrlsAllowed = false;\nBlaze._allowJavascriptUrls = function () {\n  jsUrlsAllowed = true;\n};\nBlaze._javascriptUrlsAllowed = function () {\n  return jsUrlsAllowed;\n};\n\n// An AttributeHandler object is responsible for updating a particular attribute\n// of a particular element.  AttributeHandler subclasses implement\n// browser-specific logic for dealing with particular attributes across\n// different browsers.\n//\n// To define a new type of AttributeHandler, use\n// `var FooHandler = AttributeHandler.extend({ update: function ... })`\n// where the `update` function takes arguments `(element, oldValue, value)`.\n// The `element` argument is always the same between calls to `update` on\n// the same instance.  `oldValue` and `value` are each either `null` or\n// a Unicode string of the type that might be passed to the value argument\n// of `setAttribute` (i.e. not an HTML string with character references).\n// When an AttributeHandler is installed, an initial call to `update` is\n// always made with `oldValue = null`.  The `update` method can access\n// `this.name` if the AttributeHandler class is a generic one that applies\n// to multiple attribute names.\n//\n// AttributeHandlers can store custom properties on `this`, as long as they\n// don't use the names `element`, `name`, `value`, and `oldValue`.\n//\n// AttributeHandlers can't influence how attributes appear in rendered HTML,\n// only how they are updated after materialization as DOM.\n\nAttributeHandler = function (name, value) {\n  this.name = name;\n  this.value = value;\n};\nBlaze._AttributeHandler = AttributeHandler;\n\nAttributeHandler.prototype.update = function (element, oldValue, value) {\n  if (value === null) {\n    if (oldValue !== null)\n      element.removeAttribute(this.name);\n  } else {\n    element.setAttribute(this.name, value);\n  }\n};\n\nAttributeHandler.extend = function (options) {\n  var curType = this;\n  var subType = function AttributeHandlerSubtype(/*arguments*/) {\n    AttributeHandler.apply(this, arguments);\n  };\n  subType.prototype = new curType;\n  subType.extend = curType.extend;\n  if (options) {\n    Object.assign(subType.prototype, options);\n  }\n  return subType;\n};\n\n/// Apply the diff between the attributes of \"oldValue\" and \"value\" to \"element.\"\n//\n// Each subclass must implement a parseValue method which takes a string\n// as an input and returns an ordered dict of attributes. The keys of the dict\n// are unique identifiers (ie. css properties in the case of styles), and the\n// values are the entire attribute which will be injected into the element.\n//\n// Extended below to support classes, SVG elements and styles.\n\nBlaze._DiffingAttributeHandler = AttributeHandler.extend({\n  update: function (element, oldValue, value) {\n    if (!this.getCurrentValue || !this.setValue || !this.parseValue || !this.joinValues)\n      throw new Error(\"Missing methods in subclass of 'DiffingAttributeHandler'\");\n\n    var oldAttrsMap = oldValue ? this.parseValue(oldValue) : new OrderedDict();\n    var attrsMap = value ? this.parseValue(value) : new OrderedDict();\n\n    // the current attributes on the element, which we will mutate.\n\n    var currentAttrString = this.getCurrentValue(element);\n    var currentAttrsMap = currentAttrString ? this.parseValue(currentAttrString) : new OrderedDict();\n\n    // Any outside changes to attributes we add at the end.\n    currentAttrsMap.forEach(function (value, key, i) {\n      // If the key already exists, we do not use the current value, but the new value.\n      if (attrsMap.has(key)) {\n        return;\n      }\n\n      // Key does not already exist, but it existed before. Which means it was explicitly\n      // removed, so we do not add it.\n      if (oldAttrsMap.has(key)) {\n        return;\n      }\n\n      attrsMap.append(key, value);\n    });\n\n    var values = [];\n    attrsMap.forEach(function (value, key, i) {\n      values.push(value);\n    });\n\n    this.setValue(element, this.joinValues(values));\n  }\n});\n\nvar ClassHandler = Blaze._DiffingAttributeHandler.extend({\n  // @param rawValue {String}\n  getCurrentValue: function (element) {\n    return element.className;\n  },\n  setValue: function (element, className) {\n    element.className = className;\n  },\n  parseValue: function (attrString) {\n    var tokens = new OrderedDict();\n\n    attrString.split(' ').forEach(function (token) {\n      if (token) {\n        // Ordered dict requires unique keys.\n        if (! tokens.has(token)) {\n          tokens.append(token, token);\n        }\n      }\n    });\n    return tokens;\n  },\n  joinValues: function (values) {\n    return values.join(' ');\n  }\n});\n\nvar SVGClassHandler = ClassHandler.extend({\n  getCurrentValue: function (element) {\n    return element.className.baseVal;\n  },\n  setValue: function (element, className) {\n    element.setAttribute('class', className);\n  }\n});\n\nvar StyleHandler = Blaze._DiffingAttributeHandler.extend({\n  getCurrentValue: function (element) {\n    return element.getAttribute('style');\n  },\n  setValue: function (element, style) {\n    if (style === '') {\n      element.removeAttribute('style');\n    } else {\n      element.setAttribute('style', style);\n    }\n  },\n\n  // Parse a string to produce a map from property to attribute string.\n  //\n  // Example:\n  // \"color:red; foo:12px\" produces a token {color: \"color:red\", foo:\"foo:12px\"}\n  parseValue: function (attrString) {\n    var tokens = new OrderedDict();\n\n    // Regex for parsing a css attribute declaration, taken from css-parse:\n    // https://github.com/reworkcss/css-parse/blob/7cef3658d0bba872cde05a85339034b187cb3397/index.js#L219\n    var regex = /(\\*?[-#\\/\\*\\\\\\w]+(?:\\[[0-9a-z_-]+\\])?)\\s*:\\s*(?:\\'(?:\\\\\\'|.)*?\\'|\"(?:\\\\\"|.)*?\"|\\([^\\)]*?\\)|[^};])+[;\\s]*/g;\n    var match = regex.exec(attrString);\n    while (match) {\n      // match[0] = entire matching string\n      // match[1] = css property\n      // Prefix the token to prevent conflicts with existing properties.\n\n      // We use the last value for the same key.\n      if (tokens.has(match[1])) {\n        tokens.remove(match[1]);\n      }\n\n      tokens.append(match[1], match[0].trim());\n\n      match = regex.exec(attrString);\n    }\n\n    return tokens;\n  },\n\n  joinValues: function (values) {\n    // TODO: Assure that there is always ; between values. But what is an example where it breaks?\n    return values.join(' ');\n  }\n});\n\nvar BooleanHandler = AttributeHandler.extend({\n  update: function (element, oldValue, value) {\n    var name = this.name;\n    if (value == null) {\n      if (oldValue != null)\n        element[name] = false;\n    } else {\n      element[name] = true;\n    }\n  }\n});\n\nvar DOMPropertyHandler = AttributeHandler.extend({\n  update: function (element, oldValue, value) {\n    var name = this.name;\n    if (value !== element[name])\n      element[name] = value;\n  }\n});\n\n// attributes of the type 'xlink:something' should be set using\n// the correct namespace in order to work\nvar XlinkHandler = AttributeHandler.extend({\n  update: function(element, oldValue, value) {\n    var NS = 'http://www.w3.org/1999/xlink';\n    if (value === null) {\n      if (oldValue !== null)\n        element.removeAttributeNS(NS, this.name);\n    } else {\n      element.setAttributeNS(NS, this.name, this.value);\n    }\n  }\n});\n\n// cross-browser version of `instanceof SVGElement`\nvar isSVGElement = function (elem) {\n  return 'ownerSVGElement' in elem;\n};\n\nvar isUrlAttribute = function (tagName, attrName) {\n  // Compiled from http://www.w3.org/TR/REC-html40/index/attributes.html\n  // and\n  // http://www.w3.org/html/wg/drafts/html/master/index.html#attributes-1\n  var urlAttrs = {\n    FORM: ['action'],\n    BODY: ['background'],\n    BLOCKQUOTE: ['cite'],\n    Q: ['cite'],\n    DEL: ['cite'],\n    INS: ['cite'],\n    OBJECT: ['classid', 'codebase', 'data', 'usemap'],\n    APPLET: ['codebase'],\n    A: ['href'],\n    AREA: ['href'],\n    LINK: ['href'],\n    BASE: ['href'],\n    IMG: ['longdesc', 'src', 'usemap'],\n    FRAME: ['longdesc', 'src'],\n    IFRAME: ['longdesc', 'src'],\n    HEAD: ['profile'],\n    SCRIPT: ['src'],\n    INPUT: ['src', 'usemap', 'formaction'],\n    BUTTON: ['formaction'],\n    BASE: ['href'],\n    MENUITEM: ['icon'],\n    HTML: ['manifest'],\n    VIDEO: ['poster']\n  };\n\n  if (attrName === 'itemid') {\n    return true;\n  }\n\n  var urlAttrNames = urlAttrs[tagName] || [];\n  return urlAttrNames.includes(attrName);\n};\n\n// To get the protocol for a URL, we let the browser normalize it for\n// us, by setting it as the href for an anchor tag and then reading out\n// the 'protocol' property.\nif (Meteor.isClient) {\n  var anchorForNormalization = document.createElement('A');\n}\n\nvar getUrlProtocol = function (url) {\n  if (Meteor.isClient) {\n    anchorForNormalization.href = url;\n    return (anchorForNormalization.protocol || \"\").toLowerCase();\n  } else {\n    throw new Error('getUrlProtocol not implemented on the server');\n  }\n};\n\n// UrlHandler is an attribute handler for all HTML attributes that take\n// URL values. It disallows javascript: URLs, unless\n// Blaze._allowJavascriptUrls() has been called. To detect javascript:\n// urls, we set the attribute on a dummy anchor element and then read\n// out the 'protocol' property of the attribute.\nvar origUpdate = AttributeHandler.prototype.update;\nvar UrlHandler = AttributeHandler.extend({\n  update: function (element, oldValue, value) {\n    var self = this;\n    var args = arguments;\n\n    if (Blaze._javascriptUrlsAllowed()) {\n      origUpdate.apply(self, args);\n    } else {\n      var isJavascriptProtocol = (getUrlProtocol(value) === \"javascript:\");\n      var isVBScriptProtocol   = (getUrlProtocol(value) === \"vbscript:\");\n      if (isJavascriptProtocol || isVBScriptProtocol) {\n        Blaze._warn(\"URLs that use the 'javascript:' or 'vbscript:' protocol are not \" +\n        \"allowed in URL attribute values. \" +\n        \"Call Blaze._allowJavascriptUrls() \" +\n        \"to enable them.\");\n        origUpdate.apply(self, [element, oldValue, null]);\n      } else {\n        origUpdate.apply(self, args);\n      }\n    }\n  }\n});\n\n// XXX make it possible for users to register attribute handlers!\nBlaze._makeAttributeHandler = function (elem, name, value) {\n  // generally, use setAttribute but certain attributes need to be set\n  // by directly setting a JavaScript property on the DOM element.\n  if (name === 'class') {\n    if (isSVGElement(elem)) {\n      return new SVGClassHandler(name, value);\n    } else {\n      return new ClassHandler(name, value);\n    }\n  } else if (name === 'style') {\n    return new StyleHandler(name, value);\n  } else if ((elem.tagName === 'OPTION' && name === 'selected') ||\n  (elem.tagName === 'INPUT' && name === 'checked') ||\n  (elem.tagName === 'VIDEO' && name === 'muted')) {\n    return new BooleanHandler(name, value);\n  } else if ((elem.tagName === 'TEXTAREA' || elem.tagName === 'INPUT')\n  && name === 'value') {\n    // internally, TEXTAREAs tracks their value in the 'value'\n    // attribute just like INPUTs.\n    return new DOMPropertyHandler(name, value);\n  } else if (name.substring(0,6) === 'xlink:') {\n    return new XlinkHandler(name.substring(6), value);\n  } else if (isUrlAttribute(elem.tagName, name)) {\n    return new UrlHandler(name, value);\n  } else {\n    return new AttributeHandler(name, value);\n  }\n\n  // XXX will need one for 'style' on IE, though modern browsers\n  // seem to handle setAttribute ok.\n};\n\nElementAttributesUpdater = function (elem) {\n  this.elem = elem;\n  this.handlers = {};\n};\n\n// Update attributes on `elem` to the dictionary `attrs`, whose\n// values are strings.\nElementAttributesUpdater.prototype.update = function(newAttrs) {\n  var elem = this.elem;\n  var handlers = this.handlers;\n\n  for (var k in handlers) {\n    if (!has(newAttrs, k)) {\n      // remove attributes (and handlers) for attribute names\n      // that don't exist as keys of `newAttrs` and so won't\n      // be visited when traversing it.  (Attributes that\n      // exist in the `newAttrs` object but are `null`\n      // are handled later.)\n      var handler = handlers[k];\n      var oldValue = handler.value;\n      handler.value = null;\n      handler.update(elem, oldValue, null);\n      delete handlers[k];\n    }\n  }\n\n  for (var k in newAttrs) {\n    var handler = null;\n    var oldValue = null;\n    var value = newAttrs[k];\n    if (!has(handlers, k)) {\n      if (value !== null) {\n        // make new handler\n        handler = Blaze._makeAttributeHandler(elem, k, value);\n        handlers[k] = handler;\n      }\n    } else {\n      handler = handlers[k];\n      oldValue = handler.value;\n    }\n    if (oldValue !== value) {\n      handler.value = value;\n      handler.update(elem, oldValue, value);\n      if (value === null)\n        delete handlers[k];\n    }\n  }\n};\n"]},"sourceType":"module","hash":"4893cbe0e2a3b11d93f3c15a9a51300468fed06d"}
