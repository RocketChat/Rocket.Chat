{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/home/weslley/Documents/projects/Rocket.Chat/server/methods/saveUserPreferences.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.linux.x86_64"},"sourceFileName":"server/methods/saveUserPreferences.js","filename":"/home/weslley/Documents/projects/Rocket.Chat/server/methods/saveUserPreferences.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/home/weslley/Documents/projects/Rocket.Chat","root":"/home/weslley/Documents/projects/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/home/weslley/Documents/projects/Rocket.Chat/server/methods/saveUserPreferences.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"server/methods/saveUserPreferences.js"}},"code":"let Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet Match, check;\nmodule.link(\"meteor/check\", {\n  Match(v) {\n    Match = v;\n  },\n\n  check(v) {\n    check = v;\n  }\n\n}, 1);\nlet Users, Subscriptions;\nmodule.link(\"../../app/models/server\", {\n  Users(v) {\n    Users = v;\n  },\n\n  Subscriptions(v) {\n    Subscriptions = v;\n  }\n\n}, 2);\nMeteor.methods({\n  saveUserPreferences(settings) {\n    const keys = {\n      language: Match.Optional(String),\n      newRoomNotification: Match.Optional(String),\n      newMessageNotification: Match.Optional(String),\n      clockMode: Match.Optional(Number),\n      useEmojis: Match.Optional(Boolean),\n      convertAsciiEmoji: Match.Optional(Boolean),\n      saveMobileBandwidth: Match.Optional(Boolean),\n      collapseMediaByDefault: Match.Optional(Boolean),\n      autoImageLoad: Match.Optional(Boolean),\n      emailNotificationMode: Match.Optional(String),\n      unreadAlert: Match.Optional(Boolean),\n      notificationsSoundVolume: Match.Optional(Number),\n      desktopNotifications: Match.Optional(String),\n      pushNotifications: Match.Optional(String),\n      enableAutoAway: Match.Optional(Boolean),\n      highlights: Match.Optional([String]),\n      messageViewMode: Match.Optional(Number),\n      hideUsernames: Match.Optional(Boolean),\n      hideRoles: Match.Optional(Boolean),\n      displayAvatars: Match.Optional(Boolean),\n      hideFlexTab: Match.Optional(Boolean),\n      sendOnEnter: Match.Optional(String),\n      idleTimeLimit: Match.Optional(Number),\n      sidebarShowFavorites: Match.Optional(Boolean),\n      sidebarShowUnread: Match.Optional(Boolean),\n      sidebarSortby: Match.Optional(String),\n      sidebarViewMode: Match.Optional(String),\n      sidebarDisplayAvatar: Match.Optional(Boolean),\n      sidebarGroupByType: Match.Optional(Boolean),\n      muteFocusedConversations: Match.Optional(Boolean)\n    };\n    check(settings, Match.ObjectIncluding(keys));\n    const user = Meteor.user();\n\n    if (!user) {\n      return false;\n    }\n\n    const {\n      desktopNotifications: oldDesktopNotifications,\n      pushNotifications: oldMobileNotifications,\n      emailNotificationMode: oldEmailNotifications\n    } = user.settings && user.settings.preferences || {};\n\n    if (user.settings == null) {\n      Users.clearSettings(user._id);\n    }\n\n    if (settings.language != null) {\n      Users.setLanguage(user._id, settings.language);\n    } // Keep compatibility with old values\n\n\n    if (settings.emailNotificationMode === 'all') {\n      settings.emailNotificationMode = 'mentions';\n    } else if (settings.emailNotificationMode === 'disabled') {\n      settings.emailNotificationMode = 'nothing';\n    }\n\n    if (settings.idleTimeLimit != null && settings.idleTimeLimit < 60) {\n      throw new Meteor.Error('invalid-idle-time-limit-value', 'Invalid idleTimeLimit');\n    }\n\n    Users.setPreferences(user._id, settings); // propagate changed notification preferences\n\n    Meteor.defer(() => {\n      if (settings.desktopNotifications && oldDesktopNotifications !== settings.desktopNotifications) {\n        if (settings.desktopNotifications === 'default') {\n          Subscriptions.clearNotificationUserPreferences(user._id, 'desktopNotifications', 'desktopPrefOrigin');\n        } else {\n          Subscriptions.updateNotificationUserPreferences(user._id, settings.desktopNotifications, 'desktopNotifications', 'desktopPrefOrigin');\n        }\n      }\n\n      if (settings.pushNotifications && oldMobileNotifications !== settings.pushNotifications) {\n        if (settings.pushNotifications === 'default') {\n          Subscriptions.clearNotificationUserPreferences(user._id, 'mobilePushNotifications', 'mobilePrefOrigin');\n        } else {\n          Subscriptions.updateNotificationUserPreferences(user._id, settings.pushNotifications, 'mobilePushNotifications', 'mobilePrefOrigin');\n        }\n      }\n\n      if (settings.emailNotificationMode && oldEmailNotifications !== settings.emailNotificationMode) {\n        if (settings.emailNotificationMode === 'default') {\n          Subscriptions.clearNotificationUserPreferences(user._id, 'emailNotifications', 'emailPrefOrigin');\n        } else {\n          Subscriptions.updateNotificationUserPreferences(user._id, settings.emailNotificationMode, 'emailNotifications', 'emailPrefOrigin');\n        }\n      }\n\n      if (Array.isArray(settings.highlights)) {\n        Subscriptions.updateUserHighlights(user._id, settings.highlights);\n      }\n    });\n    return true;\n  }\n\n});","map":{"version":3,"sources":["server/methods/saveUserPreferences.js"],"names":["Meteor","module","link","v","Match","check","Users","Subscriptions","methods","saveUserPreferences","settings","keys","language","Optional","String","newRoomNotification","newMessageNotification","clockMode","Number","useEmojis","Boolean","convertAsciiEmoji","saveMobileBandwidth","collapseMediaByDefault","autoImageLoad","emailNotificationMode","unreadAlert","notificationsSoundVolume","desktopNotifications","pushNotifications","enableAutoAway","highlights","messageViewMode","hideUsernames","hideRoles","displayAvatars","hideFlexTab","sendOnEnter","idleTimeLimit","sidebarShowFavorites","sidebarShowUnread","sidebarSortby","sidebarViewMode","sidebarDisplayAvatar","sidebarGroupByType","muteFocusedConversations","ObjectIncluding","user","oldDesktopNotifications","oldMobileNotifications","oldEmailNotifications","preferences","clearSettings","_id","setLanguage","Error","setPreferences","defer","clearNotificationUserPreferences","updateNotificationUserPreferences","Array","isArray","updateUserHighlights"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Match, check } from 'meteor/check';\n\nimport { Users, Subscriptions } from '../../app/models/server';\n\nMeteor.methods({\n\tsaveUserPreferences(settings) {\n\t\tconst keys = {\n\t\t\tlanguage: Match.Optional(String),\n\t\t\tnewRoomNotification: Match.Optional(String),\n\t\t\tnewMessageNotification: Match.Optional(String),\n\t\t\tclockMode: Match.Optional(Number),\n\t\t\tuseEmojis: Match.Optional(Boolean),\n\t\t\tconvertAsciiEmoji: Match.Optional(Boolean),\n\t\t\tsaveMobileBandwidth: Match.Optional(Boolean),\n\t\t\tcollapseMediaByDefault: Match.Optional(Boolean),\n\t\t\tautoImageLoad: Match.Optional(Boolean),\n\t\t\temailNotificationMode: Match.Optional(String),\n\t\t\tunreadAlert: Match.Optional(Boolean),\n\t\t\tnotificationsSoundVolume: Match.Optional(Number),\n\t\t\tdesktopNotifications: Match.Optional(String),\n\t\t\tpushNotifications: Match.Optional(String),\n\t\t\tenableAutoAway: Match.Optional(Boolean),\n\t\t\thighlights: Match.Optional([String]),\n\t\t\tmessageViewMode: Match.Optional(Number),\n\t\t\thideUsernames: Match.Optional(Boolean),\n\t\t\thideRoles: Match.Optional(Boolean),\n\t\t\tdisplayAvatars: Match.Optional(Boolean),\n\t\t\thideFlexTab: Match.Optional(Boolean),\n\t\t\tsendOnEnter: Match.Optional(String),\n\t\t\tidleTimeLimit: Match.Optional(Number),\n\t\t\tsidebarShowFavorites: Match.Optional(Boolean),\n\t\t\tsidebarShowUnread: Match.Optional(Boolean),\n\t\t\tsidebarSortby: Match.Optional(String),\n\t\t\tsidebarViewMode: Match.Optional(String),\n\t\t\tsidebarDisplayAvatar: Match.Optional(Boolean),\n\t\t\tsidebarGroupByType: Match.Optional(Boolean),\n\t\t\tmuteFocusedConversations: Match.Optional(Boolean),\n\t\t};\n\t\tcheck(settings, Match.ObjectIncluding(keys));\n\t\tconst user = Meteor.user();\n\n\t\tif (!user) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst {\n\t\t\tdesktopNotifications: oldDesktopNotifications,\n\t\t\tpushNotifications: oldMobileNotifications,\n\t\t\temailNotificationMode: oldEmailNotifications,\n\t\t} = (user.settings && user.settings.preferences) || {};\n\n\t\tif (user.settings == null) {\n\t\t\tUsers.clearSettings(user._id);\n\t\t}\n\n\t\tif (settings.language != null) {\n\t\t\tUsers.setLanguage(user._id, settings.language);\n\t\t}\n\n\t\t// Keep compatibility with old values\n\t\tif (settings.emailNotificationMode === 'all') {\n\t\t\tsettings.emailNotificationMode = 'mentions';\n\t\t} else if (settings.emailNotificationMode === 'disabled') {\n\t\t\tsettings.emailNotificationMode = 'nothing';\n\t\t}\n\n\t\tif (settings.idleTimeLimit != null && settings.idleTimeLimit < 60) {\n\t\t\tthrow new Meteor.Error('invalid-idle-time-limit-value', 'Invalid idleTimeLimit');\n\t\t}\n\n\t\tUsers.setPreferences(user._id, settings);\n\n\t\t// propagate changed notification preferences\n\t\tMeteor.defer(() => {\n\t\t\tif (settings.desktopNotifications && oldDesktopNotifications !== settings.desktopNotifications) {\n\t\t\t\tif (settings.desktopNotifications === 'default') {\n\t\t\t\t\tSubscriptions.clearNotificationUserPreferences(user._id, 'desktopNotifications', 'desktopPrefOrigin');\n\t\t\t\t} else {\n\t\t\t\t\tSubscriptions.updateNotificationUserPreferences(\n\t\t\t\t\t\tuser._id,\n\t\t\t\t\t\tsettings.desktopNotifications,\n\t\t\t\t\t\t'desktopNotifications',\n\t\t\t\t\t\t'desktopPrefOrigin',\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (settings.pushNotifications && oldMobileNotifications !== settings.pushNotifications) {\n\t\t\t\tif (settings.pushNotifications === 'default') {\n\t\t\t\t\tSubscriptions.clearNotificationUserPreferences(user._id, 'mobilePushNotifications', 'mobilePrefOrigin');\n\t\t\t\t} else {\n\t\t\t\t\tSubscriptions.updateNotificationUserPreferences(\n\t\t\t\t\t\tuser._id,\n\t\t\t\t\t\tsettings.pushNotifications,\n\t\t\t\t\t\t'mobilePushNotifications',\n\t\t\t\t\t\t'mobilePrefOrigin',\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (settings.emailNotificationMode && oldEmailNotifications !== settings.emailNotificationMode) {\n\t\t\t\tif (settings.emailNotificationMode === 'default') {\n\t\t\t\t\tSubscriptions.clearNotificationUserPreferences(user._id, 'emailNotifications', 'emailPrefOrigin');\n\t\t\t\t} else {\n\t\t\t\t\tSubscriptions.updateNotificationUserPreferences(\n\t\t\t\t\t\tuser._id,\n\t\t\t\t\t\tsettings.emailNotificationMode,\n\t\t\t\t\t\t'emailNotifications',\n\t\t\t\t\t\t'emailPrefOrigin',\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (Array.isArray(settings.highlights)) {\n\t\t\t\tSubscriptions.updateUserHighlights(user._id, settings.highlights);\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t},\n});\n"]},"sourceType":"module","hash":"f411928d14f60c480b445453d79848428244e666"}
