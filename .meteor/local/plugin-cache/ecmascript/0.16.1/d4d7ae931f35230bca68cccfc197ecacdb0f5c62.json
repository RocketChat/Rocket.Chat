{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/ddp-common/utils.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"packages/ddp-common/utils.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/ddp-common/utils.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/ddp-common/utils.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/ddp-common/utils.js"}},"code":"\"use strict\";\n\nmodule.export({\n  hasOwn: () => hasOwn,\n  slice: () => slice,\n  keys: () => keys,\n  isEmpty: () => isEmpty,\n  last: () => last\n});\nconst hasOwn = Object.prototype.hasOwnProperty;\nconst slice = Array.prototype.slice;\n\nfunction keys(obj) {\n  return Object.keys(Object(obj));\n}\n\nfunction isEmpty(obj) {\n  if (obj == null) {\n    return true;\n  }\n\n  if (Array.isArray(obj) || typeof obj === \"string\") {\n    return obj.length === 0;\n  }\n\n  for (const key in obj) {\n    if (hasOwn.call(obj, key)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction last(array, n, guard) {\n  if (array == null) {\n    return;\n  }\n\n  if (n == null || guard) {\n    return array[array.length - 1];\n  }\n\n  return slice.call(array, Math.max(array.length - n, 0));\n}\n\nDDPCommon.SUPPORTED_DDP_VERSIONS = ['1', 'pre2', 'pre1'];\n\nDDPCommon.parseDDP = function (stringMessage) {\n  try {\n    var msg = JSON.parse(stringMessage);\n  } catch (e) {\n    Meteor._debug(\"Discarding message with invalid JSON\", stringMessage);\n\n    return null;\n  } // DDP messages must be objects.\n\n\n  if (msg === null || typeof msg !== 'object') {\n    Meteor._debug(\"Discarding non-object DDP message\", stringMessage);\n\n    return null;\n  } // massage msg to get it into \"abstract ddp\" rather than \"wire ddp\" format.\n  // switch between \"cleared\" rep of unsetting fields and \"undefined\"\n  // rep of same\n\n\n  if (hasOwn.call(msg, 'cleared')) {\n    if (!hasOwn.call(msg, 'fields')) {\n      msg.fields = {};\n    }\n\n    msg.cleared.forEach(clearKey => {\n      msg.fields[clearKey] = undefined;\n    });\n    delete msg.cleared;\n  }\n\n  ['fields', 'params', 'result'].forEach(field => {\n    if (hasOwn.call(msg, field)) {\n      msg[field] = EJSON._adjustTypesFromJSONValue(msg[field]);\n    }\n  });\n  return msg;\n};\n\nDDPCommon.stringifyDDP = function (msg) {\n  const copy = EJSON.clone(msg); // swizzle 'changed' messages from 'fields undefined' rep to 'fields\n  // and cleared' rep\n\n  if (hasOwn.call(msg, 'fields')) {\n    const cleared = [];\n    Object.keys(msg.fields).forEach(key => {\n      const value = msg.fields[key];\n\n      if (typeof value === \"undefined\") {\n        cleared.push(key);\n        delete copy.fields[key];\n      }\n    });\n\n    if (!isEmpty(cleared)) {\n      copy.cleared = cleared;\n    }\n\n    if (isEmpty(copy.fields)) {\n      delete copy.fields;\n    }\n  } // adjust types to basic\n\n\n  ['fields', 'params', 'result'].forEach(field => {\n    if (hasOwn.call(copy, field)) {\n      copy[field] = EJSON._adjustTypesToJSONValue(copy[field]);\n    }\n  });\n\n  if (msg.id && typeof msg.id !== 'string') {\n    throw new Error(\"Message id is not a string\");\n  }\n\n  return JSON.stringify(copy);\n};","map":{"version":3,"sources":["packages/ddp-common/utils.js"],"names":["module","export","hasOwn","slice","keys","isEmpty","last","Object","prototype","hasOwnProperty","Array","obj","isArray","length","key","call","array","n","guard","Math","max","DDPCommon","SUPPORTED_DDP_VERSIONS","parseDDP","stringMessage","msg","JSON","parse","e","Meteor","_debug","fields","cleared","forEach","clearKey","undefined","field","EJSON","_adjustTypesFromJSONValue","stringifyDDP","copy","clone","value","push","_adjustTypesToJSONValue","id","Error","stringify"],"mappings":"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","sourcesContent":["\"use strict\";\n\nexport const hasOwn = Object.prototype.hasOwnProperty;\nexport const slice = Array.prototype.slice;\n\nexport function keys(obj) {\n  return Object.keys(Object(obj));\n}\n\nexport function isEmpty(obj) {\n  if (obj == null) {\n    return true;\n  }\n\n  if (Array.isArray(obj) ||\n      typeof obj === \"string\") {\n    return obj.length === 0;\n  }\n\n  for (const key in obj) {\n    if (hasOwn.call(obj, key)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nexport function last(array, n, guard) {\n  if (array == null) {\n    return;\n  }\n\n  if ((n == null) || guard) {\n    return array[array.length - 1];\n  }\n\n  return slice.call(array, Math.max(array.length - n, 0));\n}\n\nDDPCommon.SUPPORTED_DDP_VERSIONS = [ '1', 'pre2', 'pre1' ];\n\nDDPCommon.parseDDP = function (stringMessage) {\n  try {\n    var msg = JSON.parse(stringMessage);\n  } catch (e) {\n    Meteor._debug(\"Discarding message with invalid JSON\", stringMessage);\n    return null;\n  }\n  // DDP messages must be objects.\n  if (msg === null || typeof msg !== 'object') {\n    Meteor._debug(\"Discarding non-object DDP message\", stringMessage);\n    return null;\n  }\n\n  // massage msg to get it into \"abstract ddp\" rather than \"wire ddp\" format.\n\n  // switch between \"cleared\" rep of unsetting fields and \"undefined\"\n  // rep of same\n  if (hasOwn.call(msg, 'cleared')) {\n    if (! hasOwn.call(msg, 'fields')) {\n      msg.fields = {};\n    }\n    msg.cleared.forEach(clearKey => {\n      msg.fields[clearKey] = undefined;\n    });\n    delete msg.cleared;\n  }\n\n  ['fields', 'params', 'result'].forEach(field => {\n    if (hasOwn.call(msg, field)) {\n      msg[field] = EJSON._adjustTypesFromJSONValue(msg[field]);\n    }\n  });\n\n  return msg;\n};\n\nDDPCommon.stringifyDDP = function (msg) {\n  const copy = EJSON.clone(msg);\n\n  // swizzle 'changed' messages from 'fields undefined' rep to 'fields\n  // and cleared' rep\n  if (hasOwn.call(msg, 'fields')) {\n    const cleared = [];\n\n    Object.keys(msg.fields).forEach(key => {\n      const value = msg.fields[key];\n\n      if (typeof value === \"undefined\") {\n        cleared.push(key);\n        delete copy.fields[key];\n      }\n    });\n\n    if (! isEmpty(cleared)) {\n      copy.cleared = cleared;\n    }\n\n    if (isEmpty(copy.fields)) {\n      delete copy.fields;\n    }\n  }\n\n  // adjust types to basic\n  ['fields', 'params', 'result'].forEach(field => {\n    if (hasOwn.call(copy, field)) {\n      copy[field] = EJSON._adjustTypesToJSONValue(copy[field]);\n    }\n  });\n\n  if (msg.id && typeof msg.id !== 'string') {\n    throw new Error(\"Message id is not a string\");\n  }\n\n  return JSON.stringify(copy);\n};\n"]},"sourceType":"module","hash":"d4d7ae931f35230bca68cccfc197ecacdb0f5c62"}
