{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/htmljs/visitors.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"packages/htmljs/visitors.js","filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/htmljs/visitors.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","root":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/carlosrodrigues/Desktop/work/rocketchat/Rocket.Chat/packages/htmljs/visitors.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/htmljs/visitors.js"}},"code":"var _typeof;\n\nmodule.link(\"@babel/runtime/helpers/typeof\", {\n  default: function (v) {\n    _typeof = v;\n  }\n}, 0);\nmodule.export({\n  Visitor: function () {\n    return Visitor;\n  },\n  TransformingVisitor: function () {\n    return TransformingVisitor;\n  },\n  ToTextVisitor: function () {\n    return ToTextVisitor;\n  },\n  ToHTMLVisitor: function () {\n    return ToHTMLVisitor;\n  },\n  toHTML: function () {\n    return toHTML;\n  },\n  TEXTMODE: function () {\n    return TEXTMODE;\n  },\n  toText: function () {\n    return toText;\n  }\n});\nvar Tag, CharRef, Comment, Raw, isArray, getTag, isConstructedObject, flattenAttributes, isVoidElement;\nmodule.link(\"./html\", {\n  Tag: function (v) {\n    Tag = v;\n  },\n  CharRef: function (v) {\n    CharRef = v;\n  },\n  Comment: function (v) {\n    Comment = v;\n  },\n  Raw: function (v) {\n    Raw = v;\n  },\n  isArray: function (v) {\n    isArray = v;\n  },\n  getTag: function (v) {\n    getTag = v;\n  },\n  isConstructedObject: function (v) {\n    isConstructedObject = v;\n  },\n  flattenAttributes: function (v) {\n    flattenAttributes = v;\n  },\n  isVoidElement: function (v) {\n    isVoidElement = v;\n  }\n}, 0);\n\nvar IDENTITY = function (x) {\n  return x;\n}; // _assign is like _.extend or the upcoming Object.assign.\n// Copy src's own, enumerable properties onto tgt and return\n// tgt.\n\n\nvar _hasOwnProperty = Object.prototype.hasOwnProperty;\n\nvar _assign = function (tgt, src) {\n  for (var k in meteorBabelHelpers.sanitizeForInObject(src)) {\n    if (_hasOwnProperty.call(src, k)) tgt[k] = src[k];\n  }\n\n  return tgt;\n};\n\nvar Visitor = function (props) {\n  _assign(this, props);\n};\n\nVisitor.def = function (options) {\n  _assign(this.prototype, options);\n};\n\nVisitor.extend = function (options) {\n  var curType = this;\n\n  var subType = function () {\n    function HTMLVisitorSubtype() {\n      Visitor.apply(this, arguments);\n    }\n\n    return HTMLVisitorSubtype;\n  }();\n\n  subType.prototype = new curType();\n  subType.extend = curType.extend;\n  subType.def = curType.def;\n  if (options) _assign(subType.prototype, options);\n  return subType;\n};\n\nVisitor.def({\n  visit: function (content\n  /*, ...*/\n  ) {\n    if (content == null) // null or undefined.\n      return this.visitNull.apply(this, arguments);\n\n    if (_typeof(content) === 'object') {\n      if (content.htmljsType) {\n        switch (content.htmljsType) {\n          case Tag.htmljsType:\n            return this.visitTag.apply(this, arguments);\n\n          case CharRef.htmljsType:\n            return this.visitCharRef.apply(this, arguments);\n\n          case Comment.htmljsType:\n            return this.visitComment.apply(this, arguments);\n\n          case Raw.htmljsType:\n            return this.visitRaw.apply(this, arguments);\n\n          default:\n            throw new Error(\"Unknown htmljs type: \" + content.htmljsType);\n        }\n      }\n\n      if (isArray(content)) return this.visitArray.apply(this, arguments);\n      return this.visitObject.apply(this, arguments);\n    } else if (typeof content === 'string' || typeof content === 'boolean' || typeof content === 'number') {\n      return this.visitPrimitive.apply(this, arguments);\n    } else if (typeof content === 'function') {\n      return this.visitFunction.apply(this, arguments);\n    }\n\n    throw new Error(\"Unexpected object in htmljs: \" + content);\n  },\n  visitNull: function (nullOrUndefined\n  /*, ...*/\n  ) {},\n  visitPrimitive: function (stringBooleanOrNumber\n  /*, ...*/\n  ) {},\n  visitArray: function (array\n  /*, ...*/\n  ) {},\n  visitComment: function (comment\n  /*, ...*/\n  ) {},\n  visitCharRef: function (charRef\n  /*, ...*/\n  ) {},\n  visitRaw: function (raw\n  /*, ...*/\n  ) {},\n  visitTag: function (tag\n  /*, ...*/\n  ) {},\n  visitObject: function (obj\n  /*, ...*/\n  ) {\n    throw new Error(\"Unexpected object in htmljs: \" + obj);\n  },\n  visitFunction: function (fn\n  /*, ...*/\n  ) {\n    throw new Error(\"Unexpected function in htmljs: \" + fn);\n  }\n});\nvar TransformingVisitor = Visitor.extend();\nTransformingVisitor.def({\n  visitNull: IDENTITY,\n  visitPrimitive: IDENTITY,\n  visitArray: function (array) {\n    var result = array;\n\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n\n    for (var i = 0; i < array.length; i++) {\n      var oldItem = array[i];\n      var newItem = this.visit.apply(this, [oldItem].concat(args));\n\n      if (newItem !== oldItem) {\n        // copy `array` on write\n        if (result === array) result = array.slice();\n        result[i] = newItem;\n      }\n    }\n\n    return result;\n  },\n  visitComment: IDENTITY,\n  visitCharRef: IDENTITY,\n  visitRaw: IDENTITY,\n  visitObject: function (obj) {\n    // Don't parse Markdown & RCData as HTML\n    if (obj.textMode != null) {\n      return obj;\n    }\n\n    for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n      args[_key2 - 1] = arguments[_key2];\n    }\n\n    if ('content' in obj) {\n      obj.content = this.visit.apply(this, [obj.content].concat(args));\n    }\n\n    if ('elseContent' in obj) {\n      obj.elseContent = this.visit.apply(this, [obj.elseContent].concat(args));\n    }\n\n    return obj;\n  },\n  visitFunction: IDENTITY,\n  visitTag: function (tag) {\n    var oldChildren = tag.children;\n\n    for (var _len3 = arguments.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n      args[_key3 - 1] = arguments[_key3];\n    }\n\n    var newChildren = this.visitChildren.apply(this, [oldChildren].concat(args));\n    var oldAttrs = tag.attrs;\n    var newAttrs = this.visitAttributes.apply(this, [oldAttrs].concat(args));\n    if (newAttrs === oldAttrs && newChildren === oldChildren) return tag;\n    var newTag = getTag(tag.tagName).apply(null, newChildren);\n    newTag.attrs = newAttrs;\n    return newTag;\n  },\n  visitChildren: function (children) {\n    for (var _len4 = arguments.length, args = new Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n      args[_key4 - 1] = arguments[_key4];\n    }\n\n    return this.visitArray.apply(this, [children].concat(args));\n  },\n  // Transform the `.attrs` property of a tag, which may be a dictionary,\n  // an array, or in some uses, a foreign object (such as\n  // a template tag).\n  visitAttributes: function (attrs) {\n    for (var _len5 = arguments.length, args = new Array(_len5 > 1 ? _len5 - 1 : 0), _key5 = 1; _key5 < _len5; _key5++) {\n      args[_key5 - 1] = arguments[_key5];\n    }\n\n    if (isArray(attrs)) {\n      var result = attrs;\n\n      for (var i = 0; i < attrs.length; i++) {\n        var oldItem = attrs[i];\n        var newItem = this.visitAttributes.apply(this, [oldItem].concat(args));\n\n        if (newItem !== oldItem) {\n          // copy on write\n          if (result === attrs) result = attrs.slice();\n          result[i] = newItem;\n        }\n      }\n\n      return result;\n    }\n\n    if (attrs && isConstructedObject(attrs)) {\n      throw new Error(\"The basic TransformingVisitor does not support \" + \"foreign objects in attributes.  Define a custom \" + \"visitAttributes for this case.\");\n    }\n\n    var oldAttrs = attrs;\n    var newAttrs = oldAttrs;\n\n    if (oldAttrs) {\n      var attrArgs = [null, null];\n      attrArgs.push.apply(attrArgs, arguments);\n\n      for (var k in meteorBabelHelpers.sanitizeForInObject(oldAttrs)) {\n        var oldValue = oldAttrs[k];\n        attrArgs[0] = k;\n        attrArgs[1] = oldValue;\n        var newValue = this.visitAttribute.apply(this, attrArgs);\n\n        if (newValue !== oldValue) {\n          // copy on write\n          if (newAttrs === oldAttrs) newAttrs = _assign({}, oldAttrs);\n          newAttrs[k] = newValue;\n        }\n      }\n    }\n\n    return newAttrs;\n  },\n  // Transform the value of one attribute name/value in an\n  // attributes dictionary.\n  visitAttribute: function (name, value, tag) {\n    for (var _len6 = arguments.length, args = new Array(_len6 > 3 ? _len6 - 3 : 0), _key6 = 3; _key6 < _len6; _key6++) {\n      args[_key6 - 3] = arguments[_key6];\n    }\n\n    return this.visit.apply(this, [value].concat(args));\n  }\n});\nvar ToTextVisitor = Visitor.extend();\nToTextVisitor.def({\n  visitNull: function (nullOrUndefined) {\n    return '';\n  },\n  visitPrimitive: function (stringBooleanOrNumber) {\n    var str = String(stringBooleanOrNumber);\n\n    if (this.textMode === TEXTMODE.RCDATA) {\n      return str.replace(/&/g, '&amp;').replace(/</g, '&lt;');\n    } else if (this.textMode === TEXTMODE.ATTRIBUTE) {\n      // escape `&` and `\"` this time, not `&` and `<`\n      return str.replace(/&/g, '&amp;').replace(/\"/g, '&quot;');\n    } else {\n      return str;\n    }\n  },\n  visitArray: function (array) {\n    var parts = [];\n\n    for (var i = 0; i < array.length; i++) {\n      parts.push(this.visit(array[i]));\n    }\n\n    return parts.join('');\n  },\n  visitComment: function (comment) {\n    throw new Error(\"Can't have a comment here\");\n  },\n  visitCharRef: function (charRef) {\n    if (this.textMode === TEXTMODE.RCDATA || this.textMode === TEXTMODE.ATTRIBUTE) {\n      return charRef.html;\n    } else {\n      return charRef.str;\n    }\n  },\n  visitRaw: function (raw) {\n    return raw.value;\n  },\n  visitTag: function (tag) {\n    // Really we should just disallow Tags here.  However, at the\n    // moment it's useful to stringify any HTML we find.  In\n    // particular, when you include a template within `{{#markdown}}`,\n    // we render the template as text, and since there's currently\n    // no way to make the template be *parsed* as text (e.g. `<template\n    // type=\"text\">`), we hackishly support HTML tags in markdown\n    // in templates by parsing them and stringifying them.\n    return this.visit(this.toHTML(tag));\n  },\n  visitObject: function (x) {\n    throw new Error(\"Unexpected object in htmljs in toText: \" + x);\n  },\n  toHTML: function (node) {\n    return toHTML(node);\n  }\n});\nvar ToHTMLVisitor = Visitor.extend();\nToHTMLVisitor.def({\n  visitNull: function (nullOrUndefined) {\n    return '';\n  },\n  visitPrimitive: function (stringBooleanOrNumber) {\n    var str = String(stringBooleanOrNumber);\n    return str.replace(/&/g, '&amp;').replace(/</g, '&lt;');\n  },\n  visitArray: function (array) {\n    var parts = [];\n\n    for (var i = 0; i < array.length; i++) {\n      parts.push(this.visit(array[i]));\n    }\n\n    return parts.join('');\n  },\n  visitComment: function (comment) {\n    return '<!--' + comment.sanitizedValue + '-->';\n  },\n  visitCharRef: function (charRef) {\n    return charRef.html;\n  },\n  visitRaw: function (raw) {\n    return raw.value;\n  },\n  visitTag: function (tag) {\n    var attrStrs = [];\n    var tagName = tag.tagName;\n    var children = tag.children;\n    var attrs = tag.attrs;\n\n    if (attrs) {\n      attrs = flattenAttributes(attrs);\n\n      for (var k in meteorBabelHelpers.sanitizeForInObject(attrs)) {\n        if (k === 'value' && tagName === 'textarea') {\n          children = [attrs[k], children];\n        } else {\n          var v = this.toText(attrs[k], TEXTMODE.ATTRIBUTE);\n          attrStrs.push(' ' + k + '=\"' + v + '\"');\n        }\n      }\n    }\n\n    var startTag = '<' + tagName + attrStrs.join('') + '>';\n    var childStrs = [];\n    var content;\n\n    if (tagName === 'textarea') {\n      for (var i = 0; i < children.length; i++) {\n        childStrs.push(this.toText(children[i], TEXTMODE.RCDATA));\n      }\n\n      content = childStrs.join('');\n      if (content.slice(0, 1) === '\\n') // TEXTAREA will absorb a newline, so if we see one, add\n        // another one.\n        content = '\\n' + content;\n    } else {\n      for (var i = 0; i < children.length; i++) {\n        childStrs.push(this.visit(children[i]));\n      }\n\n      content = childStrs.join('');\n    }\n\n    var result = startTag + content;\n\n    if (children.length || !isVoidElement(tagName)) {\n      // \"Void\" elements like BR are the only ones that don't get a close\n      // tag in HTML5.  They shouldn't have contents, either, so we could\n      // throw an error upon seeing contents here.\n      result += '</' + tagName + '>';\n    }\n\n    return result;\n  },\n  visitObject: function (x) {\n    throw new Error(\"Unexpected object in htmljs in toHTML: \" + x);\n  },\n  toText: function (node, textMode) {\n    return toText(node, textMode);\n  }\n}); ////////////////////////////// TOHTML\n\nfunction toHTML(content) {\n  return new ToHTMLVisitor().visit(content);\n}\n\nvar TEXTMODE = {\n  STRING: 1,\n  RCDATA: 2,\n  ATTRIBUTE: 3\n};\n\nfunction toText(content, textMode) {\n  if (!textMode) throw new Error(\"textMode required for HTML.toText\");\n  if (!(textMode === TEXTMODE.STRING || textMode === TEXTMODE.RCDATA || textMode === TEXTMODE.ATTRIBUTE)) throw new Error(\"Unknown textMode: \" + textMode);\n  var visitor = new ToTextVisitor({\n    textMode: textMode\n  });\n  return visitor.visit(content);\n}","map":{"version":3,"sources":["packages/htmljs/visitors.js"],"names":["_typeof","module","link","default","v","export","Visitor","TransformingVisitor","ToTextVisitor","ToHTMLVisitor","toHTML","TEXTMODE","toText","Tag","CharRef","Comment","Raw","isArray","getTag","isConstructedObject","flattenAttributes","isVoidElement","IDENTITY","x","_hasOwnProperty","Object","prototype","hasOwnProperty","_assign","tgt","src","k","call","props","def","options","extend","curType","subType","HTMLVisitorSubtype","apply","arguments","visit","content","visitNull","htmljsType","visitTag","visitCharRef","visitComment","visitRaw","Error","visitArray","visitObject","visitPrimitive","visitFunction","nullOrUndefined","stringBooleanOrNumber","array","comment","charRef","raw","tag","obj","fn","result","args","i","length","oldItem","newItem","slice","textMode","elseContent","oldChildren","children","newChildren","visitChildren","oldAttrs","attrs","newAttrs","visitAttributes","newTag","tagName","attrArgs","push","oldValue","newValue","visitAttribute","name","value","str","String","RCDATA","replace","ATTRIBUTE","parts","join","html","node","sanitizedValue","attrStrs","startTag","childStrs","STRING","visitor"],"mappings":"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","sourcesContent":["import {\n  Tag,\n  CharRef,\n  Comment,\n  Raw,\n  isArray,\n  getTag,\n  isConstructedObject,\n  flattenAttributes,\n  isVoidElement,\n} from './html';\n\n\nvar IDENTITY = function (x) { return x; };\n\n// _assign is like _.extend or the upcoming Object.assign.\n// Copy src's own, enumerable properties onto tgt and return\n// tgt.\nvar _hasOwnProperty = Object.prototype.hasOwnProperty;\nvar _assign = function (tgt, src) {\n  for (var k in src) {\n    if (_hasOwnProperty.call(src, k))\n      tgt[k] = src[k];\n  }\n  return tgt;\n};\n\nexport const Visitor = function (props) {\n  _assign(this, props);\n};\n\nVisitor.def = function (options) {\n  _assign(this.prototype, options);\n};\n\nVisitor.extend = function (options) {\n  var curType = this;\n  var subType = function HTMLVisitorSubtype(/*arguments*/) {\n    Visitor.apply(this, arguments);\n  };\n  subType.prototype = new curType;\n  subType.extend = curType.extend;\n  subType.def = curType.def;\n  if (options)\n    _assign(subType.prototype, options);\n  return subType;\n};\n\nVisitor.def({\n  visit: function (content/*, ...*/) {\n    if (content == null)\n      // null or undefined.\n      return this.visitNull.apply(this, arguments);\n\n    if (typeof content === 'object') {\n      if (content.htmljsType) {\n        switch (content.htmljsType) {\n        case Tag.htmljsType:\n          return this.visitTag.apply(this, arguments);\n        case CharRef.htmljsType:\n          return this.visitCharRef.apply(this, arguments);\n        case Comment.htmljsType:\n          return this.visitComment.apply(this, arguments);\n        case Raw.htmljsType:\n          return this.visitRaw.apply(this, arguments);\n        default:\n          throw new Error(\"Unknown htmljs type: \" + content.htmljsType);\n        }\n      }\n\n      if (isArray(content))\n        return this.visitArray.apply(this, arguments);\n\n      return this.visitObject.apply(this, arguments);\n\n    } else if ((typeof content === 'string') ||\n               (typeof content === 'boolean') ||\n               (typeof content === 'number')) {\n      return this.visitPrimitive.apply(this, arguments);\n\n    } else if (typeof content === 'function') {\n      return this.visitFunction.apply(this, arguments);\n    }\n\n    throw new Error(\"Unexpected object in htmljs: \" + content);\n\n  },\n  visitNull: function (nullOrUndefined/*, ...*/) {},\n  visitPrimitive: function (stringBooleanOrNumber/*, ...*/) {},\n  visitArray: function (array/*, ...*/) {},\n  visitComment: function (comment/*, ...*/) {},\n  visitCharRef: function (charRef/*, ...*/) {},\n  visitRaw: function (raw/*, ...*/) {},\n  visitTag: function (tag/*, ...*/) {},\n  visitObject: function (obj/*, ...*/) {\n    throw new Error(\"Unexpected object in htmljs: \" + obj);\n  },\n  visitFunction: function (fn/*, ...*/) {\n    throw new Error(\"Unexpected function in htmljs: \" + fn);\n  }\n});\n\nexport const TransformingVisitor = Visitor.extend();\nTransformingVisitor.def({\n  visitNull: IDENTITY,\n  visitPrimitive: IDENTITY,\n  visitArray: function (array, ...args) {\n    var result = array;\n    for (var i = 0; i < array.length; i++) {\n      var oldItem = array[i];\n      var newItem = this.visit(oldItem, ...args);\n      if (newItem !== oldItem) {\n        // copy `array` on write\n        if (result === array)\n          result = array.slice();\n        result[i] = newItem;\n      }\n    }\n    return result;\n  },\n  visitComment: IDENTITY,\n  visitCharRef: IDENTITY,\n  visitRaw: IDENTITY,\n  visitObject: function(obj, ...args){\n    // Don't parse Markdown & RCData as HTML\n    if (obj.textMode != null){\n      return obj;\n    }\n    if ('content' in obj) {\n      obj.content = this.visit(obj.content, ...args);\n    }\n    if ('elseContent' in obj){\n      obj.elseContent = this.visit(obj.elseContent, ...args);\n    }\n    return obj;\n  },\n  visitFunction: IDENTITY,\n  visitTag: function (tag, ...args) {\n    var oldChildren = tag.children;\n    var newChildren = this.visitChildren(oldChildren, ...args);\n\n    var oldAttrs = tag.attrs;\n    var newAttrs = this.visitAttributes(oldAttrs, ...args);\n\n    if (newAttrs === oldAttrs && newChildren === oldChildren)\n      return tag;\n\n    var newTag = getTag(tag.tagName).apply(null, newChildren);\n    newTag.attrs = newAttrs;\n    return newTag;\n  },\n  visitChildren: function (children, ...args) {\n    return this.visitArray(children, ...args);\n  },\n  // Transform the `.attrs` property of a tag, which may be a dictionary,\n  // an array, or in some uses, a foreign object (such as\n  // a template tag).\n  visitAttributes: function (attrs, ...args) {\n    if (isArray(attrs)) {\n      var result = attrs;\n      for (var i = 0; i < attrs.length; i++) {\n        var oldItem = attrs[i];\n        var newItem = this.visitAttributes(oldItem, ...args);\n        if (newItem !== oldItem) {\n          // copy on write\n          if (result === attrs)\n            result = attrs.slice();\n          result[i] = newItem;\n        }\n      }\n      return result;\n    }\n\n    if (attrs && isConstructedObject(attrs)) {\n      throw new Error(\"The basic TransformingVisitor does not support \" +\n                      \"foreign objects in attributes.  Define a custom \" +\n                      \"visitAttributes for this case.\");\n    }\n\n    var oldAttrs = attrs;\n    var newAttrs = oldAttrs;\n    if (oldAttrs) {\n      var attrArgs = [null, null];\n      attrArgs.push.apply(attrArgs, arguments);\n      for (var k in oldAttrs) {\n        var oldValue = oldAttrs[k];\n        attrArgs[0] = k;\n        attrArgs[1] = oldValue;\n        var newValue = this.visitAttribute.apply(this, attrArgs);\n        if (newValue !== oldValue) {\n          // copy on write\n          if (newAttrs === oldAttrs)\n            newAttrs = _assign({}, oldAttrs);\n          newAttrs[k] = newValue;\n        }\n      }\n    }\n\n    return newAttrs;\n  },\n  // Transform the value of one attribute name/value in an\n  // attributes dictionary.\n  visitAttribute: function (name, value, tag, ...args) {\n    return this.visit(value, ...args);\n  }\n});\n\n\nexport const ToTextVisitor = Visitor.extend();\nToTextVisitor.def({\n  visitNull: function (nullOrUndefined) {\n    return '';\n  },\n  visitPrimitive: function (stringBooleanOrNumber) {\n    var str = String(stringBooleanOrNumber);\n    if (this.textMode === TEXTMODE.RCDATA) {\n      return str.replace(/&/g, '&amp;').replace(/</g, '&lt;');\n    } else if (this.textMode === TEXTMODE.ATTRIBUTE) {\n      // escape `&` and `\"` this time, not `&` and `<`\n      return str.replace(/&/g, '&amp;').replace(/\"/g, '&quot;');\n    } else {\n      return str;\n    }\n  },\n  visitArray: function (array) {\n    var parts = [];\n    for (var i = 0; i < array.length; i++)\n      parts.push(this.visit(array[i]));\n    return parts.join('');\n  },\n  visitComment: function (comment) {\n    throw new Error(\"Can't have a comment here\");\n  },\n  visitCharRef: function (charRef) {\n    if (this.textMode === TEXTMODE.RCDATA ||\n        this.textMode === TEXTMODE.ATTRIBUTE) {\n      return charRef.html;\n    } else {\n      return charRef.str;\n    }\n  },\n  visitRaw: function (raw) {\n    return raw.value;\n  },\n  visitTag: function (tag) {\n    // Really we should just disallow Tags here.  However, at the\n    // moment it's useful to stringify any HTML we find.  In\n    // particular, when you include a template within `{{#markdown}}`,\n    // we render the template as text, and since there's currently\n    // no way to make the template be *parsed* as text (e.g. `<template\n    // type=\"text\">`), we hackishly support HTML tags in markdown\n    // in templates by parsing them and stringifying them.\n    return this.visit(this.toHTML(tag));\n  },\n  visitObject: function (x) {\n    throw new Error(\"Unexpected object in htmljs in toText: \" + x);\n  },\n  toHTML: function (node) {\n    return toHTML(node);\n  }\n});\n\n\n\nexport const ToHTMLVisitor = Visitor.extend();\nToHTMLVisitor.def({\n  visitNull: function (nullOrUndefined) {\n    return '';\n  },\n  visitPrimitive: function (stringBooleanOrNumber) {\n    var str = String(stringBooleanOrNumber);\n    return str.replace(/&/g, '&amp;').replace(/</g, '&lt;');\n  },\n  visitArray: function (array) {\n    var parts = [];\n    for (var i = 0; i < array.length; i++)\n      parts.push(this.visit(array[i]));\n    return parts.join('');\n  },\n  visitComment: function (comment) {\n    return '<!--' + comment.sanitizedValue + '-->';\n  },\n  visitCharRef: function (charRef) {\n    return charRef.html;\n  },\n  visitRaw: function (raw) {\n    return raw.value;\n  },\n  visitTag: function (tag) {\n    var attrStrs = [];\n\n    var tagName = tag.tagName;\n    var children = tag.children;\n\n    var attrs = tag.attrs;\n    if (attrs) {\n      attrs = flattenAttributes(attrs);\n      for (var k in attrs) {\n        if (k === 'value' && tagName === 'textarea') {\n          children = [attrs[k], children];\n        } else {\n          var v = this.toText(attrs[k], TEXTMODE.ATTRIBUTE);\n          attrStrs.push(' ' + k + '=\"' + v + '\"');\n        }\n      }\n    }\n\n    var startTag = '<' + tagName + attrStrs.join('') + '>';\n\n    var childStrs = [];\n    var content;\n    if (tagName === 'textarea') {\n\n      for (var i = 0; i < children.length; i++)\n        childStrs.push(this.toText(children[i], TEXTMODE.RCDATA));\n\n      content = childStrs.join('');\n      if (content.slice(0, 1) === '\\n')\n        // TEXTAREA will absorb a newline, so if we see one, add\n        // another one.\n        content = '\\n' + content;\n\n    } else {\n      for (var i = 0; i < children.length; i++)\n        childStrs.push(this.visit(children[i]));\n\n      content = childStrs.join('');\n    }\n\n    var result = startTag + content;\n\n    if (children.length || ! isVoidElement(tagName)) {\n      // \"Void\" elements like BR are the only ones that don't get a close\n      // tag in HTML5.  They shouldn't have contents, either, so we could\n      // throw an error upon seeing contents here.\n      result += '</' + tagName + '>';\n    }\n\n    return result;\n  },\n  visitObject: function (x) {\n    throw new Error(\"Unexpected object in htmljs in toHTML: \" + x);\n  },\n  toText: function (node, textMode) {\n    return toText(node, textMode);\n  }\n});\n\n\n\n////////////////////////////// TOHTML\n\nexport function toHTML(content) {\n  return (new ToHTMLVisitor).visit(content);\n}\n\n// Escaping modes for outputting text when generating HTML.\nexport const TEXTMODE = {\n  STRING: 1,\n  RCDATA: 2,\n  ATTRIBUTE: 3\n};\n\n\nexport function toText(content, textMode) {\n  if (! textMode)\n    throw new Error(\"textMode required for HTML.toText\");\n  if (! (textMode === TEXTMODE.STRING ||\n         textMode === TEXTMODE.RCDATA ||\n         textMode === TEXTMODE.ATTRIBUTE))\n    throw new Error(\"Unknown textMode: \" + textMode);\n\n  var visitor = new ToTextVisitor({textMode: textMode});\n  return visitor.visit(content);\n}\n"]},"sourceType":"module","hash":"e05945c3829c3ffe8ad40456a3404c0e69bf4e1b"}
