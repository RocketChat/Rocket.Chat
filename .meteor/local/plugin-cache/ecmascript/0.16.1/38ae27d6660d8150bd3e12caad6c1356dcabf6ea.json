{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/home/weslley/Documents/projects/Rocket.Chat/app/models/server/models/_Base.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.linux.x86_64"},"sourceFileName":"app/models/server/models/_Base.js","filename":"/home/weslley/Documents/projects/Rocket.Chat/app/models/server/models/_Base.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/home/weslley/Documents/projects/Rocket.Chat","root":"/home/weslley/Documents/projects/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/home/weslley/Documents/projects/Rocket.Chat/app/models/server/models/_Base.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/models/server/models/_Base.js"}},"code":"module.export({\n  Base: () => Base\n});\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet check;\nmodule.link(\"meteor/check\", {\n  check(v) {\n    check = v;\n  }\n\n}, 1);\n\nlet _;\n\nmodule.link(\"underscore\", {\n  default(v) {\n    _ = v;\n  }\n\n}, 2);\nlet BaseDb;\nmodule.link(\"./_BaseDb\", {\n  BaseDb(v) {\n    BaseDb = v;\n  }\n\n}, 3);\n\nclass Base {\n  constructor(nameOrModel, options) {\n    this._db = new BaseDb(nameOrModel, this, options);\n    this.model = this._db.model;\n    this.collectionName = this._db.collectionName;\n    this.name = this._db.name;\n    this.removeListener = this._db.removeListener.bind(this._db);\n    this.on = this._db.on.bind(this._db);\n    this.emit = this._db.emit.bind(this._db);\n    this.db = this;\n  }\n\n  get origin() {\n    return '_db';\n  }\n\n  roleBaseQuery() {}\n\n  findRolesByUserId(userId) {\n    const query = this.roleBaseQuery(userId);\n    return this.find(query, {\n      fields: {\n        roles: 1\n      }\n    });\n  }\n  /**\n   * @param {string} userId\n   * @param {IRole['_id']} roleId\n   * @param {string} scope the value for the role scope (room id)\n   */\n\n\n  isUserInRole(userId, roleId, scope) {\n    const query = this.roleBaseQuery(userId, scope);\n\n    if (query == null) {\n      return false;\n    }\n\n    query.roles = roleId;\n    return !_.isUndefined(this.findOne(query, {\n      fields: {\n        roles: 1\n      }\n    }));\n  }\n  /**\n   * @param {string} uid\n   * @param {string} scope the value for the role scope (room id)\n   */\n\n\n  isUserInRoleScope(uid, scope) {\n    const query = this.roleBaseQuery(uid, scope);\n\n    if (!query) {\n      return false;\n    }\n\n    const options = {\n      fields: {\n        _id: 1\n      }\n    };\n    const found = this.findOne(query, options);\n    return !!found;\n  }\n  /**\n   * @param {string} userId\n   * @param {IRole['_id'][]} roles the list of role ids\n   * @param {string} scope the value for the role scope (room id)\n   */\n\n\n  addRolesByUserId(userId, roles, scope) {\n    roles = [].concat(roles);\n    const query = this.roleBaseQuery(userId, scope);\n    const update = {\n      $addToSet: {\n        roles: {\n          $each: roles\n        }\n      }\n    };\n    return this.update(query, update);\n  }\n  /**\n   * @param {string} userId\n   * @param {IRole['_id'][]} roles the list of role ids\n   * @param {string} scope the value for the role scope (room id)\n   */\n\n\n  removeRolesByUserId(userId, roles, scope) {\n    roles = [].concat(roles);\n    const query = this.roleBaseQuery(userId, scope);\n    const update = {\n      $pullAll: {\n        roles\n      }\n    };\n    return this.update(query, update);\n  }\n\n  findUsersInRoles() {\n    throw new Meteor.Error('overwrite-function', 'You must overwrite this function in the extended classes');\n  }\n\n  arrayToCursor(data) {\n    return {\n      fetch() {\n        return data;\n      },\n\n      count() {\n        return data.length;\n      },\n\n      forEach(fn) {\n        return data.forEach(fn);\n      }\n\n    };\n  }\n\n  setUpdatedAt() {\n    return this._db.setUpdatedAt(...arguments);\n  }\n\n  find() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    try {\n      return this[this.origin].find(...args);\n    } catch (e) {\n      console.error('Exception on find', e, ...args);\n    }\n  }\n\n  findById() {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    try {\n      return this[this.origin].findById(...args);\n    } catch (e) {\n      console.error('Exception on find', e, ...args);\n    }\n  }\n\n  findOne() {\n    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n\n    try {\n      return this[this.origin].findOne(...args);\n    } catch (e) {\n      console.error('Exception on find', e, ...args);\n    }\n  }\n\n  findOneById() {\n    for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n      args[_key4] = arguments[_key4];\n    }\n\n    try {\n      return this[this.origin].findOneById(...args);\n    } catch (e) {\n      console.error('Exception on find', e, ...args);\n    }\n  }\n\n  findOneByIds(ids, options) {\n    check(ids, [String]);\n\n    try {\n      return this[this.origin].findOneByIds(ids, options);\n    } catch (e) {\n      for (var _len5 = arguments.length, args = new Array(_len5 > 2 ? _len5 - 2 : 0), _key5 = 2; _key5 < _len5; _key5++) {\n        args[_key5 - 2] = arguments[_key5];\n      }\n\n      console.error('Exception on find', e, [ids, options, ...args]);\n    }\n  }\n\n  insert() {\n    return this._db.insert(...arguments);\n  }\n\n  update() {\n    return this._db.update(...arguments);\n  }\n\n  upsert() {\n    return this._db.upsert(...arguments);\n  }\n\n  remove() {\n    return this._db.remove(...arguments);\n  }\n\n  insertOrUpsert() {\n    return this._db.insertOrUpsert(...arguments);\n  }\n\n  allow() {\n    return this._db.allow(...arguments);\n  }\n\n  deny() {\n    return this._db.deny(...arguments);\n  }\n\n  ensureIndex() {\n    return this._db.ensureIndex(...arguments);\n  }\n\n  dropIndex() {\n    return this._db.dropIndex(...arguments);\n  }\n\n  tryEnsureIndex() {\n    return this._db.tryEnsureIndex(...arguments);\n  }\n\n  tryDropIndex() {\n    return this._db.tryDropIndex(...arguments);\n  }\n\n  trashFind() {\n    return this._db.trashFind(...arguments);\n  }\n\n  trashFindOneById() {\n    return this._db.trashFindOneById(...arguments);\n  }\n\n  trashFindDeletedAfter() {\n    return this._db.trashFindDeletedAfter(...arguments);\n  }\n\n  trashFindDeleted() {\n    return this._db.trashFindDeleted(...arguments);\n  }\n\n}","map":{"version":3,"sources":["app/models/server/models/_Base.js"],"names":["module","export","Base","Meteor","link","v","check","_","default","BaseDb","constructor","nameOrModel","options","_db","model","collectionName","name","removeListener","bind","on","emit","db","origin","roleBaseQuery","findRolesByUserId","userId","query","find","fields","roles","isUserInRole","roleId","scope","isUndefined","findOne","isUserInRoleScope","uid","_id","found","addRolesByUserId","concat","update","$addToSet","$each","removeRolesByUserId","$pullAll","findUsersInRoles","Error","arrayToCursor","data","fetch","count","length","forEach","fn","setUpdatedAt","args","e","console","error","findById","findOneById","findOneByIds","ids","String","insert","upsert","remove","insertOrUpsert","allow","deny","ensureIndex","dropIndex","tryEnsureIndex","tryDropIndex","trashFind","trashFindOneById","trashFindDeletedAfter","trashFindDeleted"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport _ from 'underscore';\n\nimport { BaseDb } from './_BaseDb';\n\nexport class Base {\n\tconstructor(nameOrModel, options) {\n\t\tthis._db = new BaseDb(nameOrModel, this, options);\n\t\tthis.model = this._db.model;\n\t\tthis.collectionName = this._db.collectionName;\n\t\tthis.name = this._db.name;\n\n\t\tthis.removeListener = this._db.removeListener.bind(this._db);\n\t\tthis.on = this._db.on.bind(this._db);\n\t\tthis.emit = this._db.emit.bind(this._db);\n\n\t\tthis.db = this;\n\t}\n\n\tget origin() {\n\t\treturn '_db';\n\t}\n\n\troleBaseQuery() {}\n\n\tfindRolesByUserId(userId) {\n\t\tconst query = this.roleBaseQuery(userId);\n\t\treturn this.find(query, { fields: { roles: 1 } });\n\t}\n\n\t/**\n\t * @param {string} userId\n\t * @param {IRole['_id']} roleId\n\t * @param {string} scope the value for the role scope (room id)\n\t */\n\tisUserInRole(userId, roleId, scope) {\n\t\tconst query = this.roleBaseQuery(userId, scope);\n\n\t\tif (query == null) {\n\t\t\treturn false;\n\t\t}\n\n\t\tquery.roles = roleId;\n\t\treturn !_.isUndefined(this.findOne(query, { fields: { roles: 1 } }));\n\t}\n\n\t/**\n\t * @param {string} uid\n\t * @param {string} scope the value for the role scope (room id)\n\t */\n\tisUserInRoleScope(uid, scope) {\n\t\tconst query = this.roleBaseQuery(uid, scope);\n\t\tif (!query) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tfields: { _id: 1 },\n\t\t};\n\n\t\tconst found = this.findOne(query, options);\n\t\treturn !!found;\n\t}\n\n\t/**\n\t * @param {string} userId\n\t * @param {IRole['_id'][]} roles the list of role ids\n\t * @param {string} scope the value for the role scope (room id)\n\t */\n\taddRolesByUserId(userId, roles, scope) {\n\t\troles = [].concat(roles);\n\t\tconst query = this.roleBaseQuery(userId, scope);\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\troles: { $each: roles },\n\t\t\t},\n\t\t};\n\t\treturn this.update(query, update);\n\t}\n\n\t/**\n\t * @param {string} userId\n\t * @param {IRole['_id'][]} roles the list of role ids\n\t * @param {string} scope the value for the role scope (room id)\n\t */\n\tremoveRolesByUserId(userId, roles, scope) {\n\t\troles = [].concat(roles);\n\t\tconst query = this.roleBaseQuery(userId, scope);\n\t\tconst update = {\n\t\t\t$pullAll: {\n\t\t\t\troles,\n\t\t\t},\n\t\t};\n\t\treturn this.update(query, update);\n\t}\n\n\tfindUsersInRoles() {\n\t\tthrow new Meteor.Error('overwrite-function', 'You must overwrite this function in the extended classes');\n\t}\n\n\tarrayToCursor(data) {\n\t\treturn {\n\t\t\tfetch() {\n\t\t\t\treturn data;\n\t\t\t},\n\t\t\tcount() {\n\t\t\t\treturn data.length;\n\t\t\t},\n\t\t\tforEach(fn) {\n\t\t\t\treturn data.forEach(fn);\n\t\t\t},\n\t\t};\n\t}\n\n\tsetUpdatedAt(...args /* record, checkQuery, query*/) {\n\t\treturn this._db.setUpdatedAt(...args);\n\t}\n\n\tfind(...args) {\n\t\ttry {\n\t\t\treturn this[this.origin].find(...args);\n\t\t} catch (e) {\n\t\t\tconsole.error('Exception on find', e, ...args);\n\t\t}\n\t}\n\n\tfindById(...args) {\n\t\ttry {\n\t\t\treturn this[this.origin].findById(...args);\n\t\t} catch (e) {\n\t\t\tconsole.error('Exception on find', e, ...args);\n\t\t}\n\t}\n\n\tfindOne(...args) {\n\t\ttry {\n\t\t\treturn this[this.origin].findOne(...args);\n\t\t} catch (e) {\n\t\t\tconsole.error('Exception on find', e, ...args);\n\t\t}\n\t}\n\n\tfindOneById(...args) {\n\t\ttry {\n\t\t\treturn this[this.origin].findOneById(...args);\n\t\t} catch (e) {\n\t\t\tconsole.error('Exception on find', e, ...args);\n\t\t}\n\t}\n\n\tfindOneByIds(ids, options, ...args) {\n\t\tcheck(ids, [String]);\n\n\t\ttry {\n\t\t\treturn this[this.origin].findOneByIds(ids, options);\n\t\t} catch (e) {\n\t\t\tconsole.error('Exception on find', e, [ids, options, ...args]);\n\t\t}\n\t}\n\n\tinsert(...args /* record*/) {\n\t\treturn this._db.insert(...args);\n\t}\n\n\tupdate(...args /* query, update, options*/) {\n\t\treturn this._db.update(...args);\n\t}\n\n\tupsert(...args /* query, update*/) {\n\t\treturn this._db.upsert(...args);\n\t}\n\n\tremove(...args /* query*/) {\n\t\treturn this._db.remove(...args);\n\t}\n\n\tinsertOrUpsert(...args) {\n\t\treturn this._db.insertOrUpsert(...args);\n\t}\n\n\tallow(...args) {\n\t\treturn this._db.allow(...args);\n\t}\n\n\tdeny(...args) {\n\t\treturn this._db.deny(...args);\n\t}\n\n\tensureIndex(...args) {\n\t\treturn this._db.ensureIndex(...args);\n\t}\n\n\tdropIndex(...args) {\n\t\treturn this._db.dropIndex(...args);\n\t}\n\n\ttryEnsureIndex(...args) {\n\t\treturn this._db.tryEnsureIndex(...args);\n\t}\n\n\ttryDropIndex(...args) {\n\t\treturn this._db.tryDropIndex(...args);\n\t}\n\n\ttrashFind(...args /* query, options*/) {\n\t\treturn this._db.trashFind(...args);\n\t}\n\n\ttrashFindOneById(...args /* _id, options*/) {\n\t\treturn this._db.trashFindOneById(...args);\n\t}\n\n\ttrashFindDeletedAfter(...args /* deletedAt, query, options*/) {\n\t\treturn this._db.trashFindDeletedAfter(...args);\n\t}\n\n\ttrashFindDeleted(...args) {\n\t\treturn this._db.trashFindDeleted(...args);\n\t}\n}\n"]},"sourceType":"module","hash":"38ae27d6660d8150bd3e12caad6c1356dcabf6ea"}
