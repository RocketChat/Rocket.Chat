[{"type":"js","data":"//////////////////////////////////////////////////////////////////////////\n//                                                                      //\n// This is a generated file. You can view the original                  //\n// source in your browser if your browser supports source maps.         //\n// Source maps are supported by all recent versions of Chrome, Safari,  //\n// and Firefox, and by Internet Explorer 11.                            //\n//                                                                      //\n//////////////////////////////////////////////////////////////////////////\n\n\n(function () {\n\n/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar global = Package.meteor.global;\nvar meteorEnv = Package.meteor.meteorEnv;\nvar Retry = Package.retry.Retry;\nvar meteorInstall = Package.modules.meteorInstall;\nvar Promise = Package.promise.Promise;\n\n/* Package-scope variables */\nvar options, SockJS;\n\nvar require = meteorInstall({\"node_modules\":{\"meteor\":{\"socket-stream-client\":{\"browser.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                     //\n// packages/socket-stream-client/browser.js                                                                            //\n//                                                                                                                     //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                       //\nlet _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 0);\nmodule.export({\n  ClientStream: () => ClientStream\n});\nlet toSockjsUrl, toWebsocketUrl;\nmodule.link(\"./urls.js\", {\n  toSockjsUrl(v) {\n    toSockjsUrl = v;\n  },\n\n  toWebsocketUrl(v) {\n    toWebsocketUrl = v;\n  }\n\n}, 0);\nlet StreamClientCommon;\nmodule.link(\"./common.js\", {\n  StreamClientCommon(v) {\n    StreamClientCommon = v;\n  }\n\n}, 1);\nmodule.link(\"./sockjs-0.3.4.js\");\n\nclass ClientStream extends StreamClientCommon {\n  // @param url {String} URL to Meteor app\n  //   \"http://subdomain.meteor.com/\" or \"/\" or\n  //   \"ddp+sockjs://foo-**.meteor.com/sockjs\"\n  constructor(url, options) {\n    super(options);\n\n    this._initCommon(this.options); //// Constants\n    // how long between hearing heartbeat from the server until we declare\n    // the connection dead. heartbeats come every 45s (stream_server.js)\n    //\n    // NOTE: this is a older timeout mechanism. We now send heartbeats at\n    // the DDP level (https://github.com/meteor/meteor/pull/1865), and\n    // expect those timeouts to kill a non-responsive connection before\n    // this timeout fires. This is kept around for compatibility (when\n    // talking to a server that doesn't support DDP heartbeats) and can be\n    // removed later.\n\n\n    this.HEARTBEAT_TIMEOUT = 100 * 1000;\n    this.rawUrl = url;\n    this.socket = null;\n    this.lastError = null;\n    this.heartbeatTimer = null; // Listen to global 'online' event if we are running in a browser.\n\n    window.addEventListener('online', this._online.bind(this), false\n    /* useCapture */\n    ); //// Kickoff!\n\n    this._launchConnection();\n  } // data is a utf8 string. Data sent while not connected is dropped on\n  // the floor, and it is up the user of this API to retransmit lost\n  // messages on 'reset'\n\n\n  send(data) {\n    if (this.currentStatus.connected) {\n      this.socket.send(data);\n    }\n  } // Changes where this connection points\n\n\n  _changeUrl(url) {\n    this.rawUrl = url;\n  }\n\n  _connected() {\n    if (this.connectionTimer) {\n      clearTimeout(this.connectionTimer);\n      this.connectionTimer = null;\n    }\n\n    if (this.currentStatus.connected) {\n      // already connected. do nothing. this probably shouldn't happen.\n      return;\n    } // update status\n\n\n    this.currentStatus.status = 'connected';\n    this.currentStatus.connected = true;\n    this.currentStatus.retryCount = 0;\n    this.statusChanged(); // fire resets. This must come after status change so that clients\n    // can call send from within a reset callback.\n\n    this.forEachCallback('reset', callback => {\n      callback();\n    });\n  }\n\n  _cleanup(maybeError) {\n    this._clearConnectionAndHeartbeatTimers();\n\n    if (this.socket) {\n      this.socket.onmessage = this.socket.onclose = this.socket.onerror = this.socket.onheartbeat = () => {};\n\n      this.socket.close();\n      this.socket = null;\n    }\n\n    this.forEachCallback('disconnect', callback => {\n      callback(maybeError);\n    });\n  }\n\n  _clearConnectionAndHeartbeatTimers() {\n    if (this.connectionTimer) {\n      clearTimeout(this.connectionTimer);\n      this.connectionTimer = null;\n    }\n\n    if (this.heartbeatTimer) {\n      clearTimeout(this.heartbeatTimer);\n      this.heartbeatTimer = null;\n    }\n  }\n\n  _heartbeat_timeout() {\n    console.log('Connection timeout. No sockjs heartbeat received.');\n\n    this._lostConnection(new this.ConnectionError(\"Heartbeat timed out\"));\n  }\n\n  _heartbeat_received() {\n    // If we've already permanently shut down this stream, the timeout is\n    // already cleared, and we don't need to set it again.\n    if (this._forcedToDisconnect) return;\n    if (this.heartbeatTimer) clearTimeout(this.heartbeatTimer);\n    this.heartbeatTimer = setTimeout(this._heartbeat_timeout.bind(this), this.HEARTBEAT_TIMEOUT);\n  }\n\n  _sockjsProtocolsWhitelist() {\n    // only allow polling protocols. no streaming.  streaming\n    // makes safari spin.\n    var protocolsWhitelist = ['xdr-polling', 'xhr-polling', 'iframe-xhr-polling', 'jsonp-polling']; // iOS 4 and 5 and below crash when using websockets over certain\n    // proxies. this seems to be resolved with iOS 6. eg\n    // https://github.com/LearnBoost/socket.io/issues/193#issuecomment-7308865.\n    //\n    // iOS <4 doesn't support websockets at all so sockjs will just\n    // immediately fall back to http\n\n    var noWebsockets = navigator && /iPhone|iPad|iPod/.test(navigator.userAgent) && /OS 4_|OS 5_/.test(navigator.userAgent);\n    if (!noWebsockets) protocolsWhitelist = ['websocket'].concat(protocolsWhitelist);\n    return protocolsWhitelist;\n  }\n\n  _launchConnection() {\n    this._cleanup(); // cleanup the old socket, if there was one.\n\n\n    var options = _objectSpread({\n      protocols_whitelist: this._sockjsProtocolsWhitelist()\n    }, this.options._sockjsOptions);\n\n    const hasSockJS = typeof SockJS === \"function\";\n    this.socket = hasSockJS // Convert raw URL to SockJS URL each time we open a connection, so\n    // that we can connect to random hostnames and get around browser\n    // per-host connection limits.\n    ? new SockJS(toSockjsUrl(this.rawUrl), undefined, options) : new WebSocket(toWebsocketUrl(this.rawUrl));\n\n    this.socket.onopen = data => {\n      this.lastError = null;\n\n      this._connected();\n    };\n\n    this.socket.onmessage = data => {\n      this.lastError = null;\n\n      this._heartbeat_received();\n\n      if (this.currentStatus.connected) {\n        this.forEachCallback('message', callback => {\n          callback(data.data);\n        });\n      }\n    };\n\n    this.socket.onclose = () => {\n      this._lostConnection();\n    };\n\n    this.socket.onerror = error => {\n      const {\n        lastError\n      } = this;\n      this.lastError = error;\n      if (lastError) return;\n      console.error('stream error', error, new Date().toDateString());\n    };\n\n    this.socket.onheartbeat = () => {\n      this.lastError = null;\n\n      this._heartbeat_received();\n    };\n\n    if (this.connectionTimer) clearTimeout(this.connectionTimer);\n    this.connectionTimer = setTimeout(() => {\n      this._lostConnection(new this.ConnectionError(\"DDP connection timed out\"));\n    }, this.CONNECT_TIMEOUT);\n  }\n\n}\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"common.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                     //\n// packages/socket-stream-client/common.js                                                                             //\n//                                                                                                                     //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                       //\nlet _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 0);\nmodule.export({\n  StreamClientCommon: () => StreamClientCommon\n});\nlet Retry;\nmodule.link(\"meteor/retry\", {\n  Retry(v) {\n    Retry = v;\n  }\n\n}, 0);\nconst forcedReconnectError = new Error(\"forced reconnect\");\n\nclass StreamClientCommon {\n  constructor(options) {\n    this.options = _objectSpread({\n      retry: true\n    }, options || null);\n    this.ConnectionError = options && options.ConnectionError || Error;\n  } // Register for callbacks.\n\n\n  on(name, callback) {\n    if (name !== 'message' && name !== 'reset' && name !== 'disconnect') throw new Error('unknown event type: ' + name);\n    if (!this.eventCallbacks[name]) this.eventCallbacks[name] = [];\n    this.eventCallbacks[name].push(callback);\n  }\n\n  forEachCallback(name, cb) {\n    if (!this.eventCallbacks[name] || !this.eventCallbacks[name].length) {\n      return;\n    }\n\n    this.eventCallbacks[name].forEach(cb);\n  }\n\n  _initCommon(options) {\n    options = options || Object.create(null); //// Constants\n    // how long to wait until we declare the connection attempt\n    // failed.\n\n    this.CONNECT_TIMEOUT = options.connectTimeoutMs || 10000;\n    this.eventCallbacks = Object.create(null); // name -> [callback]\n\n    this._forcedToDisconnect = false; //// Reactive status\n\n    this.currentStatus = {\n      status: 'connecting',\n      connected: false,\n      retryCount: 0\n    };\n\n    if (Package.tracker) {\n      this.statusListeners = new Package.tracker.Tracker.Dependency();\n    }\n\n    this.statusChanged = () => {\n      if (this.statusListeners) {\n        this.statusListeners.changed();\n      }\n    }; //// Retry logic\n\n\n    this._retry = new Retry();\n    this.connectionTimer = null;\n  } // Trigger a reconnect.\n\n\n  reconnect(options) {\n    options = options || Object.create(null);\n\n    if (options.url) {\n      this._changeUrl(options.url);\n    }\n\n    if (options._sockjsOptions) {\n      this.options._sockjsOptions = options._sockjsOptions;\n    }\n\n    if (this.currentStatus.connected) {\n      if (options._force || options.url) {\n        this._lostConnection(forcedReconnectError);\n      }\n\n      return;\n    } // if we're mid-connection, stop it.\n\n\n    if (this.currentStatus.status === 'connecting') {\n      // Pretend it's a clean close.\n      this._lostConnection();\n    }\n\n    this._retry.clear();\n\n    this.currentStatus.retryCount -= 1; // don't count manual retries\n\n    this._retryNow();\n  }\n\n  disconnect(options) {\n    options = options || Object.create(null); // Failed is permanent. If we're failed, don't let people go back\n    // online by calling 'disconnect' then 'reconnect'.\n\n    if (this._forcedToDisconnect) return; // If _permanent is set, permanently disconnect a stream. Once a stream\n    // is forced to disconnect, it can never reconnect. This is for\n    // error cases such as ddp version mismatch, where trying again\n    // won't fix the problem.\n\n    if (options._permanent) {\n      this._forcedToDisconnect = true;\n    }\n\n    this._cleanup();\n\n    this._retry.clear();\n\n    this.currentStatus = {\n      status: options._permanent ? 'failed' : 'offline',\n      connected: false,\n      retryCount: 0\n    };\n    if (options._permanent && options._error) this.currentStatus.reason = options._error;\n    this.statusChanged();\n  } // maybeError is set unless it's a clean protocol-level close.\n\n\n  _lostConnection(maybeError) {\n    this._cleanup(maybeError);\n\n    this._retryLater(maybeError); // sets status. no need to do it here.\n\n  } // fired when we detect that we've gone online. try to reconnect\n  // immediately.\n\n\n  _online() {\n    // if we've requested to be offline by disconnecting, don't reconnect.\n    if (this.currentStatus.status != 'offline') this.reconnect();\n  }\n\n  _retryLater(maybeError) {\n    var timeout = 0;\n\n    if (this.options.retry || maybeError === forcedReconnectError) {\n      timeout = this._retry.retryLater(this.currentStatus.retryCount, this._retryNow.bind(this));\n      this.currentStatus.status = 'waiting';\n      this.currentStatus.retryTime = new Date().getTime() + timeout;\n    } else {\n      this.currentStatus.status = 'failed';\n      delete this.currentStatus.retryTime;\n    }\n\n    this.currentStatus.connected = false;\n    this.statusChanged();\n  }\n\n  _retryNow() {\n    if (this._forcedToDisconnect) return;\n    this.currentStatus.retryCount += 1;\n    this.currentStatus.status = 'connecting';\n    this.currentStatus.connected = false;\n    delete this.currentStatus.retryTime;\n    this.statusChanged();\n\n    this._launchConnection();\n  } // Get current status. Reactive.\n\n\n  status() {\n    if (this.statusListeners) {\n      this.statusListeners.depend();\n    }\n\n    return this.currentStatus;\n  }\n\n}\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"sockjs-0.3.4.js\":function module(require){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                     //\n// packages/socket-stream-client/sockjs-0.3.4.js                                                                       //\n//                                                                                                                     //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                       //\n// XXX METEOR changes in <METEOR>\n\n/* SockJS client, version 0.3.4, http://sockjs.org, MIT License\n\nCopyright (c) 2011-2012 VMware, Inc.\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n*/\n// <METEOR> Commented out JSO implementation (use json package instead).\n// JSON2 by Douglas Crockford (minified).\n// var JSON;JSON||(JSON={}),function(){function str(a,b){var c,d,e,f,g=gap,h,i=b[a];i&&typeof i==\"object\"&&typeof i.toJSON==\"function\"&&(i=i.toJSON(a)),typeof rep==\"function\"&&(i=rep.call(b,a,i));switch(typeof i){case\"string\":return quote(i);case\"number\":return isFinite(i)?String(i):\"null\";case\"boolean\":case\"null\":return String(i);case\"object\":if(!i)return\"null\";gap+=indent,h=[];if(Object.prototype.toString.apply(i)===\"[object Array]\"){f=i.length;for(c=0;c<f;c+=1)h[c]=str(c,i)||\"null\";e=h.length===0?\"[]\":gap?\"[\\n\"+gap+h.join(\",\\n\"+gap)+\"\\n\"+g+\"]\":\"[\"+h.join(\",\")+\"]\",gap=g;return e}if(rep&&typeof rep==\"object\"){f=rep.length;for(c=0;c<f;c+=1)typeof rep[c]==\"string\"&&(d=rep[c],e=str(d,i),e&&h.push(quote(d)+(gap?\": \":\":\")+e))}else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?\": \":\":\")+e));e=h.length===0?\"{}\":gap?\"{\\n\"+gap+h.join(\",\\n\"+gap)+\"\\n\"+g+\"}\":\"{\"+h.join(\",\")+\"}\",gap=g;return e}}function quote(a){escapable.lastIndex=0;return escapable.test(a)?'\"'+a.replace(escapable,function(a){var b=meta[a];return typeof b==\"string\"?b:\"\\\\u\"+(\"0000\"+a.charCodeAt(0).toString(16)).slice(-4)})+'\"':'\"'+a+'\"'}function f(a){return a<10?\"0\"+a:a}\"use strict\",typeof Date.prototype.toJSON!=\"function\"&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+\"-\"+f(this.getUTCMonth()+1)+\"-\"+f(this.getUTCDate())+\"T\"+f(this.getUTCHours())+\":\"+f(this.getUTCMinutes())+\":\"+f(this.getUTCSeconds())+\"Z\":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,escapable=/[\\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,gap,indent,meta={\"\\b\":\"\\\\b\",\"\\t\":\"\\\\t\",\"\\n\":\"\\\\n\",\"\\f\":\"\\\\f\",\"\\r\":\"\\\\r\",'\"':'\\\\\"',\"\\\\\":\"\\\\\\\\\"},rep;typeof JSON.stringify!=\"function\"&&(JSON.stringify=function(a,b,c){var d;gap=\"\",indent=\"\";if(typeof c==\"number\")for(d=0;d<c;d+=1)indent+=\" \";else typeof c==\"string\"&&(indent=c);rep=b;if(!b||typeof b==\"function\"||typeof b==\"object\"&&typeof b.length==\"number\")return str(\"\",{\"\":a});throw new Error(\"JSON.stringify\")}),typeof JSON.parse!=\"function\"&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e==\"object\")for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),d!==undefined?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return\"\\\\u\"+(\"0000\"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\\],:{}\\s]*$/.test(text.replace(/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g,\"@\").replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g,\"]\").replace(/(?:^|:|,)(?:\\s*\\[)+/g,\"\"))){j=eval(\"(\"+text+\")\");return typeof reviver==\"function\"?walk({\"\":j},\"\"):j}throw new SyntaxError(\"JSON.parse\")})}()\n// </METEOR>\n//     [*] Including lib/index.js\n// Public object\nSockJS = function () {\n  var _document = document;\n  var _window = window;\n  var utils = {}; //         [*] Including lib/reventtarget.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n\n  /* Simplified implementation of DOM2 EventTarget.\n   *   http://www.w3.org/TR/DOM-Level-2-Events/events.html#Events-EventTarget\n   */\n\n  var REventTarget = function () {};\n\n  REventTarget.prototype.addEventListener = function (eventType, listener) {\n    if (!this._listeners) {\n      this._listeners = {};\n    }\n\n    if (!(eventType in this._listeners)) {\n      this._listeners[eventType] = [];\n    }\n\n    var arr = this._listeners[eventType];\n\n    if (utils.arrIndexOf(arr, listener) === -1) {\n      arr.push(listener);\n    }\n\n    return;\n  };\n\n  REventTarget.prototype.removeEventListener = function (eventType, listener) {\n    if (!(this._listeners && eventType in this._listeners)) {\n      return;\n    }\n\n    var arr = this._listeners[eventType];\n    var idx = utils.arrIndexOf(arr, listener);\n\n    if (idx !== -1) {\n      if (arr.length > 1) {\n        this._listeners[eventType] = arr.slice(0, idx).concat(arr.slice(idx + 1));\n      } else {\n        delete this._listeners[eventType];\n      }\n\n      return;\n    }\n\n    return;\n  };\n\n  REventTarget.prototype.dispatchEvent = function (event) {\n    var t = event.type;\n    var args = Array.prototype.slice.call(arguments, 0);\n\n    if (this['on' + t]) {\n      this['on' + t].apply(this, args);\n    }\n\n    if (this._listeners && t in this._listeners) {\n      for (var i = 0; i < this._listeners[t].length; i++) {\n        this._listeners[t][i].apply(this, args);\n      }\n    }\n  }; //         [*] End of lib/reventtarget.js\n  //         [*] Including lib/simpleevent.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n\n\n  var SimpleEvent = function (type, obj) {\n    this.type = type;\n\n    if (typeof obj !== 'undefined') {\n      for (var k in obj) {\n        if (!obj.hasOwnProperty(k)) continue;\n        this[k] = obj[k];\n      }\n    }\n  };\n\n  SimpleEvent.prototype.toString = function () {\n    var r = [];\n\n    for (var k in this) {\n      if (!this.hasOwnProperty(k)) continue;\n      var v = this[k];\n      if (typeof v === 'function') v = '[function]';\n      r.push(k + '=' + v);\n    }\n\n    return 'SimpleEvent(' + r.join(', ') + ')';\n  }; //         [*] End of lib/simpleevent.js\n  //         [*] Including lib/eventemitter.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n\n\n  var EventEmitter = function (events) {\n    var that = this;\n    that._events = events || [];\n    that._listeners = {};\n  };\n\n  EventEmitter.prototype.emit = function (type) {\n    var that = this;\n\n    that._verifyType(type);\n\n    if (that._nuked) return;\n    var args = Array.prototype.slice.call(arguments, 1);\n\n    if (that['on' + type]) {\n      that['on' + type].apply(that, args);\n    }\n\n    if (type in that._listeners) {\n      for (var i = 0; i < that._listeners[type].length; i++) {\n        that._listeners[type][i].apply(that, args);\n      }\n    }\n  };\n\n  EventEmitter.prototype.on = function (type, callback) {\n    var that = this;\n\n    that._verifyType(type);\n\n    if (that._nuked) return;\n\n    if (!(type in that._listeners)) {\n      that._listeners[type] = [];\n    }\n\n    that._listeners[type].push(callback);\n  };\n\n  EventEmitter.prototype._verifyType = function (type) {\n    var that = this;\n\n    if (utils.arrIndexOf(that._events, type) === -1) {\n      utils.log('Event ' + JSON.stringify(type) + ' not listed ' + JSON.stringify(that._events) + ' in ' + that);\n    }\n  };\n\n  EventEmitter.prototype.nuke = function () {\n    var that = this;\n    that._nuked = true;\n\n    for (var i = 0; i < that._events.length; i++) {\n      delete that[that._events[i]];\n    }\n\n    that._listeners = {};\n  }; //         [*] End of lib/eventemitter.js\n  //         [*] Including lib/utils.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n\n\n  var random_string_chars = 'abcdefghijklmnopqrstuvwxyz0123456789_';\n\n  utils.random_string = function (length, max) {\n    max = max || random_string_chars.length;\n    var i,\n        ret = [];\n\n    for (i = 0; i < length; i++) {\n      ret.push(random_string_chars.substr(Math.floor(Math.random() * max), 1));\n    }\n\n    return ret.join('');\n  };\n\n  utils.random_number = function (max) {\n    return Math.floor(Math.random() * max);\n  };\n\n  utils.random_number_string = function (max) {\n    var t = ('' + (max - 1)).length;\n    var p = Array(t + 1).join('0');\n    return (p + utils.random_number(max)).slice(-t);\n  }; // Assuming that url looks like: http://asdasd:111/asd\n\n\n  utils.getOrigin = function (url) {\n    url += '/';\n    var parts = url.split('/').slice(0, 3);\n    return parts.join('/');\n  };\n\n  utils.isSameOriginUrl = function (url_a, url_b) {\n    // location.origin would do, but it's not always available.\n    if (!url_b) url_b = _window.location.href;\n    return url_a.split('/').slice(0, 3).join('/') === url_b.split('/').slice(0, 3).join('/');\n  }; // <METEOR>\n  // https://github.com/sockjs/sockjs-client/issues/79\n\n\n  utils.isSameOriginScheme = function (url_a, url_b) {\n    if (!url_b) url_b = _window.location.href;\n    return url_a.split(':')[0] === url_b.split(':')[0];\n  }; // </METEOR>\n\n\n  utils.getParentDomain = function (url) {\n    // ipv4 ip address\n    if (/^[0-9.]*$/.test(url)) return url; // ipv6 ip address\n\n    if (/^\\[/.test(url)) return url; // no dots\n\n    if (!/[.]/.test(url)) return url;\n    var parts = url.split('.').slice(1);\n    return parts.join('.');\n  };\n\n  utils.objectExtend = function (dst, src) {\n    for (var k in src) {\n      if (src.hasOwnProperty(k)) {\n        dst[k] = src[k];\n      }\n    }\n\n    return dst;\n  };\n\n  var WPrefix = '_jp';\n\n  utils.polluteGlobalNamespace = function () {\n    if (!(WPrefix in _window)) {\n      _window[WPrefix] = {};\n    }\n  };\n\n  utils.closeFrame = function (code, reason) {\n    return 'c' + JSON.stringify([code, reason]);\n  };\n\n  utils.userSetCode = function (code) {\n    return code === 1000 || code >= 3000 && code <= 4999;\n  }; // See: http://www.erg.abdn.ac.uk/~gerrit/dccp/notes/ccid2/rto_estimator/\n  // and RFC 2988.\n\n\n  utils.countRTO = function (rtt) {\n    var rto;\n\n    if (rtt > 100) {\n      rto = 3 * rtt; // rto > 300msec\n    } else {\n      rto = rtt + 200; // 200msec < rto <= 300msec\n    }\n\n    return rto;\n  };\n\n  utils.log = function () {\n    if (_window.console && console.log && console.log.apply) {\n      console.log.apply(console, arguments);\n    }\n  };\n\n  utils.debug = function () {\n    if (_window.console && console.debug && console.debug.apply) {\n      console.debug.apply(console, arguments);\n    }\n  };\n\n  utils.bind = function (fun, that) {\n    if (fun.bind) {\n      return fun.bind(that);\n    } else {\n      return function () {\n        return fun.apply(that, arguments);\n      };\n    }\n  };\n\n  utils.flatUrl = function (url) {\n    return url.indexOf('?') === -1 && url.indexOf('#') === -1;\n  }; // `relativeTo` is an optional absolute URL. If provided, `url` will be\n  // interpreted relative to `relativeTo`. Defaults to `document.location`.\n  // <METEOR>\n\n\n  utils.amendUrl = function (url, relativeTo) {\n    var baseUrl;\n\n    if (relativeTo === undefined) {\n      baseUrl = _document.location;\n    } else {\n      var protocolMatch = /^([a-z0-9.+-]+:)/i.exec(relativeTo);\n\n      if (protocolMatch) {\n        var protocol = protocolMatch[0].toLowerCase();\n        var rest = relativeTo.substring(protocol.length);\n        var hostMatch = /[a-z0-9\\.-]+(:[0-9]+)?/.exec(rest);\n        if (hostMatch) var host = hostMatch[0];\n      }\n\n      if (!protocol || !host) throw new Error(\"relativeTo must be an absolute url\");\n      baseUrl = {\n        protocol: protocol,\n        host: host\n      };\n    }\n\n    if (!url) {\n      throw new Error('Wrong url for SockJS');\n    }\n\n    if (!utils.flatUrl(url)) {\n      throw new Error('Only basic urls are supported in SockJS');\n    } //  '//abc' --> 'http://abc'\n\n\n    if (url.indexOf('//') === 0) {\n      url = baseUrl.protocol + url;\n    } // '/abc' --> 'http://localhost:1234/abc'\n\n\n    if (url.indexOf('/') === 0) {\n      url = baseUrl.protocol + '//' + baseUrl.host + url;\n    } // </METEOR>\n    // strip trailing slashes\n\n\n    url = url.replace(/[/]+$/, ''); // We have a full url here, with proto and host. For some browsers\n    // http://localhost:80/ is not in the same origin as http://localhost/\n    // Remove explicit :80 or :443 in such cases. See #74\n\n    var parts = url.split(\"/\");\n\n    if (parts[0] === \"http:\" && /:80$/.test(parts[2]) || parts[0] === \"https:\" && /:443$/.test(parts[2])) {\n      parts[2] = parts[2].replace(/:(80|443)$/, \"\");\n    }\n\n    url = parts.join(\"/\");\n    return url;\n  }; // IE doesn't support [].indexOf.\n\n\n  utils.arrIndexOf = function (arr, obj) {\n    for (var i = 0; i < arr.length; i++) {\n      if (arr[i] === obj) {\n        return i;\n      }\n    }\n\n    return -1;\n  };\n\n  utils.arrSkip = function (arr, obj) {\n    var idx = utils.arrIndexOf(arr, obj);\n\n    if (idx === -1) {\n      return arr.slice();\n    } else {\n      var dst = arr.slice(0, idx);\n      return dst.concat(arr.slice(idx + 1));\n    }\n  }; // Via: https://gist.github.com/1133122/2121c601c5549155483f50be3da5305e83b8c5df\n\n\n  utils.isArray = Array.isArray || function (value) {\n    return {}.toString.call(value).indexOf('Array') >= 0;\n  };\n\n  utils.delay = function (t, fun) {\n    if (typeof t === 'function') {\n      fun = t;\n      t = 0;\n    }\n\n    return setTimeout(fun, t);\n  }; // Chars worth escaping, as defined by Douglas Crockford:\n  //   https://github.com/douglascrockford/JSON-js/blob/47a9882cddeb1e8529e07af9736218075372b8ac/json2.js#L196\n\n\n  var json_escapable = /[\\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,\n      json_lookup = {\n    \"\\0\": \"\\\\u0000\",\n    \"\\x01\": \"\\\\u0001\",\n    \"\\x02\": \"\\\\u0002\",\n    \"\\x03\": \"\\\\u0003\",\n    \"\\x04\": \"\\\\u0004\",\n    \"\\x05\": \"\\\\u0005\",\n    \"\\x06\": \"\\\\u0006\",\n    \"\\x07\": \"\\\\u0007\",\n    \"\\b\": \"\\\\b\",\n    \"\\t\": \"\\\\t\",\n    \"\\n\": \"\\\\n\",\n    \"\\x0B\": \"\\\\u000b\",\n    \"\\f\": \"\\\\f\",\n    \"\\r\": \"\\\\r\",\n    \"\\x0E\": \"\\\\u000e\",\n    \"\\x0F\": \"\\\\u000f\",\n    \"\\x10\": \"\\\\u0010\",\n    \"\\x11\": \"\\\\u0011\",\n    \"\\x12\": \"\\\\u0012\",\n    \"\\x13\": \"\\\\u0013\",\n    \"\\x14\": \"\\\\u0014\",\n    \"\\x15\": \"\\\\u0015\",\n    \"\\x16\": \"\\\\u0016\",\n    \"\\x17\": \"\\\\u0017\",\n    \"\\x18\": \"\\\\u0018\",\n    \"\\x19\": \"\\\\u0019\",\n    \"\\x1A\": \"\\\\u001a\",\n    \"\\x1B\": \"\\\\u001b\",\n    \"\\x1C\": \"\\\\u001c\",\n    \"\\x1D\": \"\\\\u001d\",\n    \"\\x1E\": \"\\\\u001e\",\n    \"\\x1F\": \"\\\\u001f\",\n    \"\\\"\": \"\\\\\\\"\",\n    \"\\\\\": \"\\\\\\\\\",\n    \"\\x7F\": \"\\\\u007f\",\n    \"\\x80\": \"\\\\u0080\",\n    \"\\x81\": \"\\\\u0081\",\n    \"\\x82\": \"\\\\u0082\",\n    \"\\x83\": \"\\\\u0083\",\n    \"\\x84\": \"\\\\u0084\",\n    \"\\x85\": \"\\\\u0085\",\n    \"\\x86\": \"\\\\u0086\",\n    \"\\x87\": \"\\\\u0087\",\n    \"\\x88\": \"\\\\u0088\",\n    \"\\x89\": \"\\\\u0089\",\n    \"\\x8A\": \"\\\\u008a\",\n    \"\\x8B\": \"\\\\u008b\",\n    \"\\x8C\": \"\\\\u008c\",\n    \"\\x8D\": \"\\\\u008d\",\n    \"\\x8E\": \"\\\\u008e\",\n    \"\\x8F\": \"\\\\u008f\",\n    \"\\x90\": \"\\\\u0090\",\n    \"\\x91\": \"\\\\u0091\",\n    \"\\x92\": \"\\\\u0092\",\n    \"\\x93\": \"\\\\u0093\",\n    \"\\x94\": \"\\\\u0094\",\n    \"\\x95\": \"\\\\u0095\",\n    \"\\x96\": \"\\\\u0096\",\n    \"\\x97\": \"\\\\u0097\",\n    \"\\x98\": \"\\\\u0098\",\n    \"\\x99\": \"\\\\u0099\",\n    \"\\x9A\": \"\\\\u009a\",\n    \"\\x9B\": \"\\\\u009b\",\n    \"\\x9C\": \"\\\\u009c\",\n    \"\\x9D\": \"\\\\u009d\",\n    \"\\x9E\": \"\\\\u009e\",\n    \"\\x9F\": \"\\\\u009f\",\n    \"\\xAD\": \"\\\\u00ad\",\n    \"\\u0600\": \"\\\\u0600\",\n    \"\\u0601\": \"\\\\u0601\",\n    \"\\u0602\": \"\\\\u0602\",\n    \"\\u0603\": \"\\\\u0603\",\n    \"\\u0604\": \"\\\\u0604\",\n    \"\\u070F\": \"\\\\u070f\",\n    \"\\u17B4\": \"\\\\u17b4\",\n    \"\\u17B5\": \"\\\\u17b5\",\n    \"\\u200C\": \"\\\\u200c\",\n    \"\\u200D\": \"\\\\u200d\",\n    \"\\u200E\": \"\\\\u200e\",\n    \"\\u200F\": \"\\\\u200f\",\n    \"\\u2028\": \"\\\\u2028\",\n    \"\\u2029\": \"\\\\u2029\",\n    \"\\u202A\": \"\\\\u202a\",\n    \"\\u202B\": \"\\\\u202b\",\n    \"\\u202C\": \"\\\\u202c\",\n    \"\\u202D\": \"\\\\u202d\",\n    \"\\u202E\": \"\\\\u202e\",\n    \"\\u202F\": \"\\\\u202f\",\n    \"\\u2060\": \"\\\\u2060\",\n    \"\\u2061\": \"\\\\u2061\",\n    \"\\u2062\": \"\\\\u2062\",\n    \"\\u2063\": \"\\\\u2063\",\n    \"\\u2064\": \"\\\\u2064\",\n    \"\\u2065\": \"\\\\u2065\",\n    \"\\u2066\": \"\\\\u2066\",\n    \"\\u2067\": \"\\\\u2067\",\n    \"\\u2068\": \"\\\\u2068\",\n    \"\\u2069\": \"\\\\u2069\",\n    \"\\u206A\": \"\\\\u206a\",\n    \"\\u206B\": \"\\\\u206b\",\n    \"\\u206C\": \"\\\\u206c\",\n    \"\\u206D\": \"\\\\u206d\",\n    \"\\u206E\": \"\\\\u206e\",\n    \"\\u206F\": \"\\\\u206f\",\n    \"\\uFEFF\": \"\\\\ufeff\",\n    \"\\uFFF0\": \"\\\\ufff0\",\n    \"\\uFFF1\": \"\\\\ufff1\",\n    \"\\uFFF2\": \"\\\\ufff2\",\n    \"\\uFFF3\": \"\\\\ufff3\",\n    \"\\uFFF4\": \"\\\\ufff4\",\n    \"\\uFFF5\": \"\\\\ufff5\",\n    \"\\uFFF6\": \"\\\\ufff6\",\n    \"\\uFFF7\": \"\\\\ufff7\",\n    \"\\uFFF8\": \"\\\\ufff8\",\n    \"\\uFFF9\": \"\\\\ufff9\",\n    \"\\uFFFA\": \"\\\\ufffa\",\n    \"\\uFFFB\": \"\\\\ufffb\",\n    \"\\uFFFC\": \"\\\\ufffc\",\n    \"\\uFFFD\": \"\\\\ufffd\",\n    \"\\uFFFE\": \"\\\\ufffe\",\n    \"\\uFFFF\": \"\\\\uffff\"\n  }; // Some extra characters that Chrome gets wrong, and substitutes with\n  // something else on the wire.\n\n  var extra_escapable = /[\\x00-\\x1f\\ud800-\\udfff\\ufffe\\uffff\\u0300-\\u0333\\u033d-\\u0346\\u034a-\\u034c\\u0350-\\u0352\\u0357-\\u0358\\u035c-\\u0362\\u0374\\u037e\\u0387\\u0591-\\u05af\\u05c4\\u0610-\\u0617\\u0653-\\u0654\\u0657-\\u065b\\u065d-\\u065e\\u06df-\\u06e2\\u06eb-\\u06ec\\u0730\\u0732-\\u0733\\u0735-\\u0736\\u073a\\u073d\\u073f-\\u0741\\u0743\\u0745\\u0747\\u07eb-\\u07f1\\u0951\\u0958-\\u095f\\u09dc-\\u09dd\\u09df\\u0a33\\u0a36\\u0a59-\\u0a5b\\u0a5e\\u0b5c-\\u0b5d\\u0e38-\\u0e39\\u0f43\\u0f4d\\u0f52\\u0f57\\u0f5c\\u0f69\\u0f72-\\u0f76\\u0f78\\u0f80-\\u0f83\\u0f93\\u0f9d\\u0fa2\\u0fa7\\u0fac\\u0fb9\\u1939-\\u193a\\u1a17\\u1b6b\\u1cda-\\u1cdb\\u1dc0-\\u1dcf\\u1dfc\\u1dfe\\u1f71\\u1f73\\u1f75\\u1f77\\u1f79\\u1f7b\\u1f7d\\u1fbb\\u1fbe\\u1fc9\\u1fcb\\u1fd3\\u1fdb\\u1fe3\\u1feb\\u1fee-\\u1fef\\u1ff9\\u1ffb\\u1ffd\\u2000-\\u2001\\u20d0-\\u20d1\\u20d4-\\u20d7\\u20e7-\\u20e9\\u2126\\u212a-\\u212b\\u2329-\\u232a\\u2adc\\u302b-\\u302c\\uaab2-\\uaab3\\uf900-\\ufa0d\\ufa10\\ufa12\\ufa15-\\ufa1e\\ufa20\\ufa22\\ufa25-\\ufa26\\ufa2a-\\ufa2d\\ufa30-\\ufa6d\\ufa70-\\ufad9\\ufb1d\\ufb1f\\ufb2a-\\ufb36\\ufb38-\\ufb3c\\ufb3e\\ufb40-\\ufb41\\ufb43-\\ufb44\\ufb46-\\ufb4e\\ufff0-\\uffff]/g,\n      extra_lookup; // JSON Quote string. Use native implementation when possible.\n\n  var JSONQuote = JSON && JSON.stringify || function (string) {\n    json_escapable.lastIndex = 0;\n\n    if (json_escapable.test(string)) {\n      string = string.replace(json_escapable, function (a) {\n        return json_lookup[a];\n      });\n    }\n\n    return '\"' + string + '\"';\n  }; // This may be quite slow, so let's delay until user actually uses bad\n  // characters.\n\n\n  var unroll_lookup = function (escapable) {\n    var i;\n    var unrolled = {};\n    var c = [];\n\n    for (i = 0; i < 65536; i++) {\n      c.push(String.fromCharCode(i));\n    }\n\n    escapable.lastIndex = 0;\n    c.join('').replace(escapable, function (a) {\n      unrolled[a] = \"\\\\u\" + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n      return '';\n    });\n    escapable.lastIndex = 0;\n    return unrolled;\n  }; // Quote string, also taking care of unicode characters that browsers\n  // often break. Especially, take care of unicode surrogates:\n  //    http://en.wikipedia.org/wiki/Mapping_of_Unicode_characters#Surrogates\n\n\n  utils.quote = function (string) {\n    var quoted = JSONQuote(string); // In most cases this should be very fast and good enough.\n\n    extra_escapable.lastIndex = 0;\n\n    if (!extra_escapable.test(quoted)) {\n      return quoted;\n    }\n\n    if (!extra_lookup) extra_lookup = unroll_lookup(extra_escapable);\n    return quoted.replace(extra_escapable, function (a) {\n      return extra_lookup[a];\n    });\n  };\n\n  var _all_protocols = ['websocket', 'xdr-streaming', 'xhr-streaming', 'iframe-eventsource', 'iframe-htmlfile', 'xdr-polling', 'xhr-polling', 'iframe-xhr-polling', 'jsonp-polling'];\n\n  utils.probeProtocols = function () {\n    var probed = {};\n\n    for (var i = 0; i < _all_protocols.length; i++) {\n      var protocol = _all_protocols[i]; // User can have a typo in protocol name.\n\n      probed[protocol] = SockJS[protocol] && SockJS[protocol].enabled();\n    }\n\n    return probed;\n  };\n\n  utils.detectProtocols = function (probed, protocols_whitelist, info) {\n    var pe = {},\n        protocols = [];\n    if (!protocols_whitelist) protocols_whitelist = _all_protocols;\n\n    for (var i = 0; i < protocols_whitelist.length; i++) {\n      var protocol = protocols_whitelist[i];\n      pe[protocol] = probed[protocol];\n    }\n\n    var maybe_push = function (protos) {\n      var proto = protos.shift();\n\n      if (pe[proto]) {\n        protocols.push(proto);\n      } else {\n        if (protos.length > 0) {\n          maybe_push(protos);\n        }\n      }\n    }; // 1. Websocket\n\n\n    if (info.websocket !== false) {\n      maybe_push(['websocket']);\n    } // 2. Streaming\n\n\n    if (pe['xhr-streaming'] && !info.null_origin) {\n      protocols.push('xhr-streaming');\n    } else {\n      if (pe['xdr-streaming'] && !info.cookie_needed && !info.null_origin) {\n        protocols.push('xdr-streaming');\n      } else {\n        maybe_push(['iframe-eventsource', 'iframe-htmlfile']);\n      }\n    } // 3. Polling\n\n\n    if (pe['xhr-polling'] && !info.null_origin) {\n      protocols.push('xhr-polling');\n    } else {\n      if (pe['xdr-polling'] && !info.cookie_needed && !info.null_origin) {\n        protocols.push('xdr-polling');\n      } else {\n        maybe_push(['iframe-xhr-polling', 'jsonp-polling']);\n      }\n    }\n\n    return protocols;\n  }; //         [*] End of lib/utils.js\n  //         [*] Including lib/dom.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n  // May be used by htmlfile jsonp and transports.\n\n\n  var MPrefix = '_sockjs_global';\n\n  utils.createHook = function () {\n    var window_id = 'a' + utils.random_string(8);\n\n    if (!(MPrefix in _window)) {\n      var map = {};\n\n      _window[MPrefix] = function (window_id) {\n        if (!(window_id in map)) {\n          map[window_id] = {\n            id: window_id,\n            del: function () {\n              delete map[window_id];\n            }\n          };\n        }\n\n        return map[window_id];\n      };\n    }\n\n    return _window[MPrefix](window_id);\n  };\n\n  utils.attachMessage = function (listener) {\n    utils.attachEvent('message', listener);\n  };\n\n  utils.attachEvent = function (event, listener) {\n    if (typeof _window.addEventListener !== 'undefined') {\n      _window.addEventListener(event, listener, false);\n    } else {\n      // IE quirks.\n      // According to: http://stevesouders.com/misc/test-postmessage.php\n      // the message gets delivered only to 'document', not 'window'.\n      _document.attachEvent(\"on\" + event, listener); // I get 'window' for ie8.\n\n\n      _window.attachEvent(\"on\" + event, listener);\n    }\n  };\n\n  utils.detachMessage = function (listener) {\n    utils.detachEvent('message', listener);\n  };\n\n  utils.detachEvent = function (event, listener) {\n    if (typeof _window.addEventListener !== 'undefined') {\n      _window.removeEventListener(event, listener, false);\n    } else {\n      _document.detachEvent(\"on\" + event, listener);\n\n      _window.detachEvent(\"on\" + event, listener);\n    }\n  };\n\n  var on_unload = {}; // Things registered after beforeunload are to be called immediately.\n\n  var after_unload = false;\n\n  var trigger_unload_callbacks = function () {\n    for (var ref in on_unload) {\n      on_unload[ref]();\n      delete on_unload[ref];\n    }\n\n    ;\n  };\n\n  var unload_triggered = function () {\n    if (after_unload) return;\n    after_unload = true;\n    trigger_unload_callbacks();\n  }; // 'unload' alone is not reliable in opera within an iframe, but we\n  // can't use `beforeunload` as IE fires it on javascript: links.\n\n\n  utils.attachEvent('unload', unload_triggered);\n\n  utils.unload_add = function (listener) {\n    var ref = utils.random_string(8);\n    on_unload[ref] = listener;\n\n    if (after_unload) {\n      utils.delay(trigger_unload_callbacks);\n    }\n\n    return ref;\n  };\n\n  utils.unload_del = function (ref) {\n    if (ref in on_unload) delete on_unload[ref];\n  };\n\n  utils.createIframe = function (iframe_url, error_callback) {\n    var iframe = _document.createElement('iframe');\n\n    var tref, unload_ref;\n\n    var unattach = function () {\n      clearTimeout(tref); // Explorer had problems with that.\n\n      try {\n        iframe.onload = null;\n      } catch (x) {}\n\n      iframe.onerror = null;\n    };\n\n    var cleanup = function () {\n      if (iframe) {\n        unattach(); // This timeout makes chrome fire onbeforeunload event\n        // within iframe. Without the timeout it goes straight to\n        // onunload.\n\n        setTimeout(function () {\n          if (iframe) {\n            iframe.parentNode.removeChild(iframe);\n          }\n\n          iframe = null;\n        }, 0);\n        utils.unload_del(unload_ref);\n      }\n    };\n\n    var onerror = function (r) {\n      if (iframe) {\n        cleanup();\n        error_callback(r);\n      }\n    };\n\n    var post = function (msg, origin) {\n      try {\n        // When the iframe is not loaded, IE raises an exception\n        // on 'contentWindow'.\n        if (iframe && iframe.contentWindow) {\n          iframe.contentWindow.postMessage(msg, origin);\n        }\n      } catch (x) {}\n\n      ;\n    };\n\n    iframe.src = iframe_url;\n    iframe.style.display = 'none';\n    iframe.style.position = 'absolute';\n\n    iframe.onerror = function () {\n      onerror('onerror');\n    };\n\n    iframe.onload = function () {\n      // `onload` is triggered before scripts on the iframe are\n      // executed. Give it few seconds to actually load stuff.\n      clearTimeout(tref);\n      tref = setTimeout(function () {\n        onerror('onload timeout');\n      }, 2000);\n    };\n\n    _document.body.appendChild(iframe);\n\n    tref = setTimeout(function () {\n      onerror('timeout');\n    }, 15000);\n    unload_ref = utils.unload_add(cleanup);\n    return {\n      post: post,\n      cleanup: cleanup,\n      loaded: unattach\n    };\n  };\n\n  utils.createHtmlfile = function (iframe_url, error_callback) {\n    var doc = new ActiveXObject('htmlfile');\n    var tref, unload_ref;\n    var iframe;\n\n    var unattach = function () {\n      clearTimeout(tref);\n    };\n\n    var cleanup = function () {\n      if (doc) {\n        unattach();\n        utils.unload_del(unload_ref);\n        iframe.parentNode.removeChild(iframe);\n        iframe = doc = null;\n        CollectGarbage();\n      }\n    };\n\n    var onerror = function (r) {\n      if (doc) {\n        cleanup();\n        error_callback(r);\n      }\n    };\n\n    var post = function (msg, origin) {\n      try {\n        // When the iframe is not loaded, IE raises an exception\n        // on 'contentWindow'.\n        if (iframe && iframe.contentWindow) {\n          iframe.contentWindow.postMessage(msg, origin);\n        }\n      } catch (x) {}\n\n      ;\n    };\n\n    doc.open();\n    doc.write('<html><s' + 'cript>' + 'document.domain=\"' + document.domain + '\";' + '</s' + 'cript></html>');\n    doc.close();\n    doc.parentWindow[WPrefix] = _window[WPrefix];\n    var c = doc.createElement('div');\n    doc.body.appendChild(c);\n    iframe = doc.createElement('iframe');\n    c.appendChild(iframe);\n    iframe.src = iframe_url;\n    tref = setTimeout(function () {\n      onerror('timeout');\n    }, 15000);\n    unload_ref = utils.unload_add(cleanup);\n    return {\n      post: post,\n      cleanup: cleanup,\n      loaded: unattach\n    };\n  }; //         [*] End of lib/dom.js\n  //         [*] Including lib/dom2.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n\n\n  var AbstractXHRObject = function () {};\n\n  AbstractXHRObject.prototype = new EventEmitter(['chunk', 'finish']);\n\n  AbstractXHRObject.prototype._start = function (method, url, payload, opts) {\n    var that = this;\n\n    try {\n      that.xhr = new XMLHttpRequest();\n    } catch (x) {}\n\n    ;\n\n    if (!that.xhr) {\n      try {\n        that.xhr = new _window.ActiveXObject('Microsoft.XMLHTTP');\n      } catch (x) {}\n\n      ;\n    }\n\n    if (_window.ActiveXObject || _window.XDomainRequest) {\n      // IE8 caches even POSTs\n      url += (url.indexOf('?') === -1 ? '?' : '&') + 't=' + +new Date();\n    } // Explorer tends to keep connection open, even after the\n    // tab gets closed: http://bugs.jquery.com/ticket/5280\n\n\n    that.unload_ref = utils.unload_add(function () {\n      that._cleanup(true);\n    });\n\n    try {\n      that.xhr.open(method, url, true);\n    } catch (e) {\n      // IE raises an exception on wrong port.\n      that.emit('finish', 0, '');\n\n      that._cleanup();\n\n      return;\n    }\n\n    ;\n\n    if (!opts || !opts.no_credentials) {\n      // Mozilla docs says https://developer.mozilla.org/en/XMLHttpRequest :\n      // \"This never affects same-site requests.\"\n      that.xhr.withCredentials = 'true';\n    }\n\n    if (opts && opts.headers) {\n      for (var key in opts.headers) {\n        that.xhr.setRequestHeader(key, opts.headers[key]);\n      }\n    }\n\n    that.xhr.onreadystatechange = function () {\n      if (that.xhr) {\n        var x = that.xhr;\n\n        switch (x.readyState) {\n          case 3:\n            // IE doesn't like peeking into responseText or status\n            // on Microsoft.XMLHTTP and readystate=3\n            try {\n              var status = x.status;\n              var text = x.responseText;\n            } catch (x) {}\n\n            ; // IE returns 1223 for 204: http://bugs.jquery.com/ticket/1450\n\n            if (status === 1223) status = 204; // IE does return readystate == 3 for 404 answers.\n\n            if (text && text.length > 0) {\n              that.emit('chunk', status, text);\n            }\n\n            break;\n\n          case 4:\n            var status = x.status; // IE returns 1223 for 204: http://bugs.jquery.com/ticket/1450\n\n            if (status === 1223) status = 204;\n            that.emit('finish', status, x.responseText);\n\n            that._cleanup(false);\n\n            break;\n        }\n      }\n    };\n\n    that.xhr.send(payload);\n  };\n\n  AbstractXHRObject.prototype._cleanup = function (abort) {\n    var that = this;\n    if (!that.xhr) return;\n    utils.unload_del(that.unload_ref); // IE needs this field to be a function\n\n    that.xhr.onreadystatechange = function () {};\n\n    if (abort) {\n      try {\n        that.xhr.abort();\n      } catch (x) {}\n\n      ;\n    }\n\n    that.unload_ref = that.xhr = null;\n  };\n\n  AbstractXHRObject.prototype.close = function () {\n    var that = this;\n    that.nuke();\n\n    that._cleanup(true);\n  };\n\n  var XHRCorsObject = utils.XHRCorsObject = function () {\n    var that = this,\n        args = arguments;\n    utils.delay(function () {\n      that._start.apply(that, args);\n    });\n  };\n\n  XHRCorsObject.prototype = new AbstractXHRObject();\n\n  var XHRLocalObject = utils.XHRLocalObject = function (method, url, payload) {\n    var that = this;\n    utils.delay(function () {\n      that._start(method, url, payload, {\n        no_credentials: true\n      });\n    });\n  };\n\n  XHRLocalObject.prototype = new AbstractXHRObject(); // References:\n  //   http://ajaxian.com/archives/100-line-ajax-wrapper\n  //   http://msdn.microsoft.com/en-us/library/cc288060(v=VS.85).aspx\n\n  var XDRObject = utils.XDRObject = function (method, url, payload) {\n    var that = this;\n    utils.delay(function () {\n      that._start(method, url, payload);\n    });\n  };\n\n  XDRObject.prototype = new EventEmitter(['chunk', 'finish']);\n\n  XDRObject.prototype._start = function (method, url, payload) {\n    var that = this;\n    var xdr = new XDomainRequest(); // IE caches even POSTs\n\n    url += (url.indexOf('?') === -1 ? '?' : '&') + 't=' + +new Date();\n\n    var onerror = xdr.ontimeout = xdr.onerror = function () {\n      that.emit('finish', 0, '');\n\n      that._cleanup(false);\n    };\n\n    xdr.onprogress = function () {\n      that.emit('chunk', 200, xdr.responseText);\n    };\n\n    xdr.onload = function () {\n      that.emit('finish', 200, xdr.responseText);\n\n      that._cleanup(false);\n    };\n\n    that.xdr = xdr;\n    that.unload_ref = utils.unload_add(function () {\n      that._cleanup(true);\n    });\n\n    try {\n      // Fails with AccessDenied if port number is bogus\n      that.xdr.open(method, url);\n      that.xdr.send(payload);\n    } catch (x) {\n      onerror();\n    }\n  };\n\n  XDRObject.prototype._cleanup = function (abort) {\n    var that = this;\n    if (!that.xdr) return;\n    utils.unload_del(that.unload_ref);\n    that.xdr.ontimeout = that.xdr.onerror = that.xdr.onprogress = that.xdr.onload = null;\n\n    if (abort) {\n      try {\n        that.xdr.abort();\n      } catch (x) {}\n\n      ;\n    }\n\n    that.unload_ref = that.xdr = null;\n  };\n\n  XDRObject.prototype.close = function () {\n    var that = this;\n    that.nuke();\n\n    that._cleanup(true);\n  }; // 1. Is natively via XHR\n  // 2. Is natively via XDR\n  // 3. Nope, but postMessage is there so it should work via the Iframe.\n  // 4. Nope, sorry.\n\n\n  utils.isXHRCorsCapable = function () {\n    if (_window.XMLHttpRequest && 'withCredentials' in new XMLHttpRequest()) {\n      return 1;\n    } // XDomainRequest doesn't work if page is served from file://\n\n\n    if (_window.XDomainRequest && _document.domain) {\n      return 2;\n    }\n\n    if (IframeTransport.enabled()) {\n      return 3;\n    }\n\n    return 4;\n  }; //         [*] End of lib/dom2.js\n  //         [*] Including lib/sockjs.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n\n\n  var SockJS = function (url, dep_protocols_whitelist, options) {\n    if (!(this instanceof SockJS)) {\n      // makes `new` optional\n      return new SockJS(url, dep_protocols_whitelist, options);\n    }\n\n    var that = this,\n        protocols_whitelist;\n    that._options = {\n      devel: false,\n      debug: false,\n      protocols_whitelist: [],\n      info: undefined,\n      rtt: undefined\n    };\n\n    if (options) {\n      utils.objectExtend(that._options, options);\n    }\n\n    that._base_url = utils.amendUrl(url);\n    that._server = that._options.server || utils.random_number_string(1000);\n\n    if (that._options.protocols_whitelist && that._options.protocols_whitelist.length) {\n      protocols_whitelist = that._options.protocols_whitelist;\n    } else {\n      // Deprecated API\n      if (typeof dep_protocols_whitelist === 'string' && dep_protocols_whitelist.length > 0) {\n        protocols_whitelist = [dep_protocols_whitelist];\n      } else if (utils.isArray(dep_protocols_whitelist)) {\n        protocols_whitelist = dep_protocols_whitelist;\n      } else {\n        protocols_whitelist = null;\n      }\n\n      if (protocols_whitelist) {\n        that._debug('Deprecated API: Use \"protocols_whitelist\" option ' + 'instead of supplying protocol list as a second ' + 'parameter to SockJS constructor.');\n      }\n    }\n\n    that._protocols = [];\n    that.protocol = null;\n    that.readyState = SockJS.CONNECTING;\n    that._ir = createInfoReceiver(that._base_url);\n\n    that._ir.onfinish = function (info, rtt) {\n      that._ir = null;\n\n      if (info) {\n        if (that._options.info) {\n          // Override if user supplies the option\n          info = utils.objectExtend(info, that._options.info);\n        }\n\n        if (that._options.rtt) {\n          rtt = that._options.rtt;\n        }\n\n        that._applyInfo(info, rtt, protocols_whitelist);\n\n        that._didClose();\n      } else {\n        that._didClose(1002, 'Can\\'t connect to server', true);\n      }\n    };\n  }; // Inheritance\n\n\n  SockJS.prototype = new REventTarget();\n  SockJS.version = \"0.3.4\";\n  SockJS.CONNECTING = 0;\n  SockJS.OPEN = 1;\n  SockJS.CLOSING = 2;\n  SockJS.CLOSED = 3;\n\n  SockJS.prototype._debug = function () {\n    if (this._options.debug) utils.log.apply(utils, arguments);\n  };\n\n  SockJS.prototype._dispatchOpen = function () {\n    var that = this;\n\n    if (that.readyState === SockJS.CONNECTING) {\n      if (that._transport_tref) {\n        clearTimeout(that._transport_tref);\n        that._transport_tref = null;\n      }\n\n      that.readyState = SockJS.OPEN;\n      that.dispatchEvent(new SimpleEvent(\"open\"));\n    } else {\n      // The server might have been restarted, and lost track of our\n      // connection.\n      that._didClose(1006, \"Server lost session\");\n    }\n  };\n\n  SockJS.prototype._dispatchMessage = function (data) {\n    var that = this;\n    if (that.readyState !== SockJS.OPEN) return;\n    that.dispatchEvent(new SimpleEvent(\"message\", {\n      data: data\n    }));\n  };\n\n  SockJS.prototype._dispatchHeartbeat = function (data) {\n    var that = this;\n    if (that.readyState !== SockJS.OPEN) return;\n    that.dispatchEvent(new SimpleEvent('heartbeat', {}));\n  };\n\n  SockJS.prototype._didClose = function (code, reason, force) {\n    var that = this;\n\n    if (that.readyState !== SockJS.CONNECTING && that.readyState !== SockJS.OPEN && that.readyState !== SockJS.CLOSING) {\n      utils.debug('INVALID_STATE_ERR', that.readyState);\n      return;\n    }\n\n    if (that._ir) {\n      that._ir.nuke();\n\n      that._ir = null;\n    }\n\n    if (that._transport) {\n      that._transport.doCleanup();\n\n      that._transport = null;\n    }\n\n    var close_event = new SimpleEvent(\"close\", {\n      code: code,\n      reason: reason,\n      wasClean: utils.userSetCode(code)\n    });\n\n    if (!utils.userSetCode(code) && that.readyState === SockJS.CONNECTING && !force) {\n      if (that._try_next_protocol(close_event)) {\n        return;\n      }\n\n      close_event = new SimpleEvent(\"close\", {\n        code: 2000,\n        reason: \"All transports failed\",\n        wasClean: false,\n        last_event: close_event\n      });\n    }\n\n    that.readyState = SockJS.CLOSED;\n    utils.delay(function () {\n      that.dispatchEvent(close_event);\n    });\n  };\n\n  SockJS.prototype._didMessage = function (data) {\n    var that = this;\n    var type = data.slice(0, 1);\n\n    switch (type) {\n      case 'o':\n        that._dispatchOpen();\n\n        break;\n\n      case 'a':\n        var payload = JSON.parse(data.slice(1) || '[]');\n\n        for (var i = 0; i < payload.length; i++) {\n          that._dispatchMessage(payload[i]);\n        }\n\n        break;\n\n      case 'm':\n        var payload = JSON.parse(data.slice(1) || 'null');\n\n        that._dispatchMessage(payload);\n\n        break;\n\n      case 'c':\n        var payload = JSON.parse(data.slice(1) || '[]');\n\n        that._didClose(payload[0], payload[1]);\n\n        break;\n\n      case 'h':\n        that._dispatchHeartbeat();\n\n        break;\n    }\n  };\n\n  SockJS.prototype._try_next_protocol = function (close_event) {\n    var that = this;\n\n    if (that.protocol) {\n      that._debug('Closed transport:', that.protocol, '' + close_event);\n\n      that.protocol = null;\n    }\n\n    if (that._transport_tref) {\n      clearTimeout(that._transport_tref);\n      that._transport_tref = null;\n    }\n\n    while (1) {\n      var protocol = that.protocol = that._protocols.shift();\n\n      if (!protocol) {\n        return false;\n      } // Some protocols require access to `body`, what if were in\n      // the `head`?\n\n\n      if (SockJS[protocol] && SockJS[protocol].need_body === true && (!_document.body || typeof _document.readyState !== 'undefined' && _document.readyState !== 'complete')) {\n        that._protocols.unshift(protocol);\n\n        that.protocol = 'waiting-for-load';\n        utils.attachEvent('load', function () {\n          that._try_next_protocol();\n        });\n        return true;\n      }\n\n      if (!SockJS[protocol] || !SockJS[protocol].enabled(that._options)) {\n        that._debug('Skipping transport:', protocol);\n      } else {\n        var roundTrips = SockJS[protocol].roundTrips || 1;\n        var to = (that._options.rto || 0) * roundTrips || 5000;\n        that._transport_tref = utils.delay(to, function () {\n          if (that.readyState === SockJS.CONNECTING) {\n            // I can't understand how it is possible to run\n            // this timer, when the state is CLOSED, but\n            // apparently in IE everythin is possible.\n            that._didClose(2007, \"Transport timeouted\");\n          }\n        });\n        var connid = utils.random_string(8);\n        var trans_url = that._base_url + '/' + that._server + '/' + connid;\n\n        that._debug('Opening transport:', protocol, ' url:' + trans_url, ' RTO:' + that._options.rto);\n\n        that._transport = new SockJS[protocol](that, trans_url, that._base_url);\n        return true;\n      }\n    }\n  };\n\n  SockJS.prototype.close = function (code, reason) {\n    var that = this;\n    if (code && !utils.userSetCode(code)) throw new Error(\"INVALID_ACCESS_ERR\");\n\n    if (that.readyState !== SockJS.CONNECTING && that.readyState !== SockJS.OPEN) {\n      return false;\n    }\n\n    that.readyState = SockJS.CLOSING;\n\n    that._didClose(code || 1000, reason || \"Normal closure\");\n\n    return true;\n  };\n\n  SockJS.prototype.send = function (data) {\n    var that = this;\n    if (that.readyState === SockJS.CONNECTING) throw new Error('INVALID_STATE_ERR');\n\n    if (that.readyState === SockJS.OPEN) {\n      that._transport.doSend(utils.quote('' + data));\n    }\n\n    return true;\n  };\n\n  SockJS.prototype._applyInfo = function (info, rtt, protocols_whitelist) {\n    var that = this;\n    that._options.info = info;\n    that._options.rtt = rtt;\n    that._options.rto = utils.countRTO(rtt);\n    that._options.info.null_origin = !_document.domain; // Servers can override base_url, eg to provide a randomized domain name and\n    // avoid browser per-domain connection limits.\n\n    if (info.base_url) // <METEOR>\n      that._base_url = utils.amendUrl(info.base_url, that._base_url); // </METEOR>\n\n    var probed = utils.probeProtocols();\n    that._protocols = utils.detectProtocols(probed, protocols_whitelist, info); // <METEOR>\n    // https://github.com/sockjs/sockjs-client/issues/79\n    // Hack to avoid XDR when using different protocols\n    // We're on IE trying to do cross-protocol. jsonp only.\n\n    if (!utils.isSameOriginScheme(that._base_url) && 2 === utils.isXHRCorsCapable()) {\n      that._protocols = ['jsonp-polling'];\n    } // </METEOR>\n\n  }; //         [*] End of lib/sockjs.js\n  //         [*] Including lib/trans-websocket.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n\n\n  var WebSocketTransport = SockJS.websocket = function (ri, trans_url) {\n    var that = this;\n    var url = trans_url + '/websocket';\n\n    if (url.slice(0, 5) === 'https') {\n      url = 'wss' + url.slice(5);\n    } else {\n      url = 'ws' + url.slice(4);\n    }\n\n    that.ri = ri;\n    that.url = url;\n    var Constructor = _window.WebSocket || _window.MozWebSocket;\n    that.ws = new Constructor(that.url);\n\n    that.ws.onmessage = function (e) {\n      that.ri._didMessage(e.data);\n    }; // Firefox has an interesting bug. If a websocket connection is\n    // created after onunload, it stays alive even when user\n    // navigates away from the page. In such situation let's lie -\n    // let's not open the ws connection at all. See:\n    // https://github.com/sockjs/sockjs-client/issues/28\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=696085\n\n\n    that.unload_ref = utils.unload_add(function () {\n      that.ws.close();\n    });\n\n    that.ws.onclose = function () {\n      that.ri._didMessage(utils.closeFrame(1006, \"WebSocket connection broken\"));\n    };\n  };\n\n  WebSocketTransport.prototype.doSend = function (data) {\n    this.ws.send('[' + data + ']');\n  };\n\n  WebSocketTransport.prototype.doCleanup = function () {\n    var that = this;\n    var ws = that.ws;\n\n    if (ws) {\n      ws.onmessage = ws.onclose = null;\n      ws.close();\n      utils.unload_del(that.unload_ref);\n      that.unload_ref = that.ri = that.ws = null;\n    }\n  };\n\n  WebSocketTransport.enabled = function () {\n    return !!(_window.WebSocket || _window.MozWebSocket);\n  }; // In theory, ws should require 1 round trip. But in chrome, this is\n  // not very stable over SSL. Most likely a ws connection requires a\n  // separate SSL connection, in which case 2 round trips are an\n  // absolute minumum.\n\n\n  WebSocketTransport.roundTrips = 2; //         [*] End of lib/trans-websocket.js\n  //         [*] Including lib/trans-sender.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n\n  var BufferedSender = function () {};\n\n  BufferedSender.prototype.send_constructor = function (sender) {\n    var that = this;\n    that.send_buffer = [];\n    that.sender = sender;\n  };\n\n  BufferedSender.prototype.doSend = function (message) {\n    var that = this;\n    that.send_buffer.push(message);\n\n    if (!that.send_stop) {\n      that.send_schedule();\n    }\n  }; // For polling transports in a situation when in the message callback,\n  // new message is being send. If the sending connection was started\n  // before receiving one, it is possible to saturate the network and\n  // timeout due to the lack of receiving socket. To avoid that we delay\n  // sending messages by some small time, in order to let receiving\n  // connection be started beforehand. This is only a halfmeasure and\n  // does not fix the big problem, but it does make the tests go more\n  // stable on slow networks.\n\n\n  BufferedSender.prototype.send_schedule_wait = function () {\n    var that = this;\n    var tref;\n\n    that.send_stop = function () {\n      that.send_stop = null;\n      clearTimeout(tref);\n    };\n\n    tref = utils.delay(25, function () {\n      that.send_stop = null;\n      that.send_schedule();\n    });\n  };\n\n  BufferedSender.prototype.send_schedule = function () {\n    var that = this;\n\n    if (that.send_buffer.length > 0) {\n      var payload = '[' + that.send_buffer.join(',') + ']';\n      that.send_stop = that.sender(that.trans_url, payload, function (success, abort_reason) {\n        that.send_stop = null;\n\n        if (success === false) {\n          that.ri._didClose(1006, 'Sending error ' + abort_reason);\n        } else {\n          that.send_schedule_wait();\n        }\n      });\n      that.send_buffer = [];\n    }\n  };\n\n  BufferedSender.prototype.send_destructor = function () {\n    var that = this;\n\n    if (that._send_stop) {\n      that._send_stop();\n    }\n\n    that._send_stop = null;\n  };\n\n  var jsonPGenericSender = function (url, payload, callback) {\n    var that = this;\n\n    if (!('_send_form' in that)) {\n      var form = that._send_form = _document.createElement('form');\n\n      var area = that._send_area = _document.createElement('textarea');\n\n      area.name = 'd';\n      form.style.display = 'none';\n      form.style.position = 'absolute';\n      form.method = 'POST';\n      form.enctype = 'application/x-www-form-urlencoded';\n      form.acceptCharset = \"UTF-8\";\n      form.appendChild(area);\n\n      _document.body.appendChild(form);\n    }\n\n    var form = that._send_form;\n    var area = that._send_area;\n    var id = 'a' + utils.random_string(8);\n    form.target = id;\n    form.action = url + '/jsonp_send?i=' + id;\n    var iframe;\n\n    try {\n      // ie6 dynamic iframes with target=\"\" support (thanks Chris Lambacher)\n      iframe = _document.createElement('<iframe name=\"' + id + '\">');\n    } catch (x) {\n      iframe = _document.createElement('iframe');\n      iframe.name = id;\n    }\n\n    iframe.id = id;\n    form.appendChild(iframe);\n    iframe.style.display = 'none';\n\n    try {\n      area.value = payload;\n    } catch (e) {\n      utils.log('Your browser is seriously broken. Go home! ' + e.message);\n    }\n\n    form.submit();\n\n    var completed = function (e) {\n      if (!iframe.onerror) return;\n      iframe.onreadystatechange = iframe.onerror = iframe.onload = null; // Opera mini doesn't like if we GC iframe\n      // immediately, thus this timeout.\n\n      utils.delay(500, function () {\n        iframe.parentNode.removeChild(iframe);\n        iframe = null;\n      });\n      area.value = ''; // It is not possible to detect if the iframe succeeded or\n      // failed to submit our form.\n\n      callback(true);\n    };\n\n    iframe.onerror = iframe.onload = completed;\n\n    iframe.onreadystatechange = function (e) {\n      if (iframe.readyState == 'complete') completed();\n    };\n\n    return completed;\n  };\n\n  var createAjaxSender = function (AjaxObject) {\n    return function (url, payload, callback) {\n      var xo = new AjaxObject('POST', url + '/xhr_send', payload);\n\n      xo.onfinish = function (status, text) {\n        callback(status === 200 || status === 204, 'http status ' + status);\n      };\n\n      return function (abort_reason) {\n        callback(false, abort_reason);\n      };\n    };\n  }; //         [*] End of lib/trans-sender.js\n  //         [*] Including lib/trans-jsonp-receiver.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n  // Parts derived from Socket.io:\n  //    https://github.com/LearnBoost/socket.io/blob/0.6.17/lib/socket.io/transports/jsonp-polling.js\n  // and jQuery-JSONP:\n  //    https://code.google.com/p/jquery-jsonp/source/browse/trunk/core/jquery.jsonp.js\n\n\n  var jsonPGenericReceiver = function (url, callback) {\n    var tref;\n\n    var script = _document.createElement('script');\n\n    var script2; // Opera synchronous load trick.\n\n    var close_script = function (frame) {\n      if (script2) {\n        script2.parentNode.removeChild(script2);\n        script2 = null;\n      }\n\n      if (script) {\n        clearTimeout(tref); // Unfortunately, you can't really abort script loading of\n        // the script.\n\n        script.parentNode.removeChild(script);\n        script.onreadystatechange = script.onerror = script.onload = script.onclick = null;\n        script = null;\n        callback(frame);\n        callback = null;\n      }\n    }; // IE9 fires 'error' event after orsc or before, in random order.\n\n\n    var loaded_okay = false;\n    var error_timer = null;\n    script.id = 'a' + utils.random_string(8);\n    script.src = url;\n    script.type = 'text/javascript';\n    script.charset = 'UTF-8';\n\n    script.onerror = function (e) {\n      if (!error_timer) {\n        // Delay firing close_script.\n        error_timer = setTimeout(function () {\n          if (!loaded_okay) {\n            close_script(utils.closeFrame(1006, \"JSONP script loaded abnormally (onerror)\"));\n          }\n        }, 1000);\n      }\n    };\n\n    script.onload = function (e) {\n      close_script(utils.closeFrame(1006, \"JSONP script loaded abnormally (onload)\"));\n    };\n\n    script.onreadystatechange = function (e) {\n      if (/loaded|closed/.test(script.readyState)) {\n        if (script && script.htmlFor && script.onclick) {\n          loaded_okay = true;\n\n          try {\n            // In IE, actually execute the script.\n            script.onclick();\n          } catch (x) {}\n        }\n\n        if (script) {\n          close_script(utils.closeFrame(1006, \"JSONP script loaded abnormally (onreadystatechange)\"));\n        }\n      }\n    }; // IE: event/htmlFor/onclick trick.\n    // One can't rely on proper order for onreadystatechange. In order to\n    // make sure, set a 'htmlFor' and 'event' properties, so that\n    // script code will be installed as 'onclick' handler for the\n    // script object. Later, onreadystatechange, manually execute this\n    // code. FF and Chrome doesn't work with 'event' and 'htmlFor'\n    // set. For reference see:\n    //   http://jaubourg.net/2010/07/loading-script-as-onclick-handler-of.html\n    // Also, read on that about script ordering:\n    //   http://wiki.whatwg.org/wiki/Dynamic_Script_Execution_Order\n\n\n    if (typeof script.async === 'undefined' && _document.attachEvent) {\n      // According to mozilla docs, in recent browsers script.async defaults\n      // to 'true', so we may use it to detect a good browser:\n      // https://developer.mozilla.org/en/HTML/Element/script\n      if (!/opera/i.test(navigator.userAgent)) {\n        // Naively assume we're in IE\n        try {\n          script.htmlFor = script.id;\n          script.event = \"onclick\";\n        } catch (x) {}\n\n        script.async = true;\n      } else {\n        // Opera, second sync script hack\n        script2 = _document.createElement('script');\n        script2.text = \"try{var a = document.getElementById('\" + script.id + \"'); if(a)a.onerror();}catch(x){};\";\n        script.async = script2.async = false;\n      }\n    }\n\n    if (typeof script.async !== 'undefined') {\n      script.async = true;\n    } // Fallback mostly for Konqueror - stupid timer, 35 seconds shall be plenty.\n\n\n    tref = setTimeout(function () {\n      close_script(utils.closeFrame(1006, \"JSONP script loaded abnormally (timeout)\"));\n    }, 35000);\n\n    var head = _document.getElementsByTagName('head')[0];\n\n    head.insertBefore(script, head.firstChild);\n\n    if (script2) {\n      head.insertBefore(script2, head.firstChild);\n    }\n\n    return close_script;\n  }; //         [*] End of lib/trans-jsonp-receiver.js\n  //         [*] Including lib/trans-jsonp-polling.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n  // The simplest and most robust transport, using the well-know cross\n  // domain hack - JSONP. This transport is quite inefficient - one\n  // mssage could use up to one http request. But at least it works almost\n  // everywhere.\n  // Known limitations:\n  //   o you will get a spinning cursor\n  //   o for Konqueror a dumb timer is needed to detect errors\n\n\n  var JsonPTransport = SockJS['jsonp-polling'] = function (ri, trans_url) {\n    utils.polluteGlobalNamespace();\n    var that = this;\n    that.ri = ri;\n    that.trans_url = trans_url;\n    that.send_constructor(jsonPGenericSender);\n\n    that._schedule_recv();\n  }; // Inheritnace\n\n\n  JsonPTransport.prototype = new BufferedSender();\n\n  JsonPTransport.prototype._schedule_recv = function () {\n    var that = this;\n\n    var callback = function (data) {\n      that._recv_stop = null;\n\n      if (data) {\n        // no data - heartbeat;\n        if (!that._is_closing) {\n          that.ri._didMessage(data);\n        }\n      } // The message can be a close message, and change is_closing state.\n\n\n      if (!that._is_closing) {\n        that._schedule_recv();\n      }\n    };\n\n    that._recv_stop = jsonPReceiverWrapper(that.trans_url + '/jsonp', jsonPGenericReceiver, callback);\n  };\n\n  JsonPTransport.enabled = function () {\n    return true;\n  };\n\n  JsonPTransport.need_body = true;\n\n  JsonPTransport.prototype.doCleanup = function () {\n    var that = this;\n    that._is_closing = true;\n\n    if (that._recv_stop) {\n      that._recv_stop();\n    }\n\n    that.ri = that._recv_stop = null;\n    that.send_destructor();\n  }; // Abstract away code that handles global namespace pollution.\n\n\n  var jsonPReceiverWrapper = function (url, constructReceiver, user_callback) {\n    var id = 'a' + utils.random_string(6);\n    var url_id = url + '?c=' + escape(WPrefix + '.' + id); // Unfortunately it is not possible to abort loading of the\n    // script. We need to keep track of frake close frames.\n\n    var aborting = 0; // Callback will be called exactly once.\n\n    var callback = function (frame) {\n      switch (aborting) {\n        case 0:\n          // Normal behaviour - delete hook _and_ emit message.\n          delete _window[WPrefix][id];\n          user_callback(frame);\n          break;\n\n        case 1:\n          // Fake close frame - emit but don't delete hook.\n          user_callback(frame);\n          aborting = 2;\n          break;\n\n        case 2:\n          // Got frame after connection was closed, delete hook, don't emit.\n          delete _window[WPrefix][id];\n          break;\n      }\n    };\n\n    var close_script = constructReceiver(url_id, callback);\n    _window[WPrefix][id] = close_script;\n\n    var stop = function () {\n      if (_window[WPrefix][id]) {\n        aborting = 1;\n\n        _window[WPrefix][id](utils.closeFrame(1000, \"JSONP user aborted read\"));\n      }\n    };\n\n    return stop;\n  }; //         [*] End of lib/trans-jsonp-polling.js\n  //         [*] Including lib/trans-xhr.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n\n\n  var AjaxBasedTransport = function () {};\n\n  AjaxBasedTransport.prototype = new BufferedSender();\n\n  AjaxBasedTransport.prototype.run = function (ri, trans_url, url_suffix, Receiver, AjaxObject) {\n    var that = this;\n    that.ri = ri;\n    that.trans_url = trans_url;\n    that.send_constructor(createAjaxSender(AjaxObject));\n    that.poll = new Polling(ri, Receiver, trans_url + url_suffix, AjaxObject);\n  };\n\n  AjaxBasedTransport.prototype.doCleanup = function () {\n    var that = this;\n\n    if (that.poll) {\n      that.poll.abort();\n      that.poll = null;\n    }\n  }; // xhr-streaming\n\n\n  var XhrStreamingTransport = SockJS['xhr-streaming'] = function (ri, trans_url) {\n    this.run(ri, trans_url, '/xhr_streaming', XhrReceiver, utils.XHRCorsObject);\n  };\n\n  XhrStreamingTransport.prototype = new AjaxBasedTransport();\n\n  XhrStreamingTransport.enabled = function () {\n    // Support for CORS Ajax aka Ajax2? Opera 12 claims CORS but\n    // doesn't do streaming.\n    return _window.XMLHttpRequest && 'withCredentials' in new XMLHttpRequest() && !/opera/i.test(navigator.userAgent);\n  };\n\n  XhrStreamingTransport.roundTrips = 2; // preflight, ajax\n  // Safari gets confused when a streaming ajax request is started\n  // before onload. This causes the load indicator to spin indefinetely.\n\n  XhrStreamingTransport.need_body = true; // According to:\n  //   http://stackoverflow.com/questions/1641507/detect-browser-support-for-cross-domain-xmlhttprequests\n  //   http://hacks.mozilla.org/2009/07/cross-site-xmlhttprequest-with-cors/\n  // xdr-streaming\n\n  var XdrStreamingTransport = SockJS['xdr-streaming'] = function (ri, trans_url) {\n    this.run(ri, trans_url, '/xhr_streaming', XhrReceiver, utils.XDRObject);\n  };\n\n  XdrStreamingTransport.prototype = new AjaxBasedTransport();\n\n  XdrStreamingTransport.enabled = function () {\n    return !!_window.XDomainRequest;\n  };\n\n  XdrStreamingTransport.roundTrips = 2; // preflight, ajax\n  // xhr-polling\n\n  var XhrPollingTransport = SockJS['xhr-polling'] = function (ri, trans_url) {\n    this.run(ri, trans_url, '/xhr', XhrReceiver, utils.XHRCorsObject);\n  };\n\n  XhrPollingTransport.prototype = new AjaxBasedTransport();\n  XhrPollingTransport.enabled = XhrStreamingTransport.enabled;\n  XhrPollingTransport.roundTrips = 2; // preflight, ajax\n  // xdr-polling\n\n  var XdrPollingTransport = SockJS['xdr-polling'] = function (ri, trans_url) {\n    this.run(ri, trans_url, '/xhr', XhrReceiver, utils.XDRObject);\n  };\n\n  XdrPollingTransport.prototype = new AjaxBasedTransport();\n  XdrPollingTransport.enabled = XdrStreamingTransport.enabled;\n  XdrPollingTransport.roundTrips = 2; // preflight, ajax\n  //         [*] End of lib/trans-xhr.js\n  //         [*] Including lib/trans-iframe.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n  // Few cool transports do work only for same-origin. In order to make\n  // them working cross-domain we shall use iframe, served form the\n  // remote domain. New browsers, have capabilities to communicate with\n  // cross domain iframe, using postMessage(). In IE it was implemented\n  // from IE 8+, but of course, IE got some details wrong:\n  //    http://msdn.microsoft.com/en-us/library/cc197015(v=VS.85).aspx\n  //    http://stevesouders.com/misc/test-postmessage.php\n\n  var IframeTransport = function () {};\n\n  IframeTransport.prototype.i_constructor = function (ri, trans_url, base_url) {\n    var that = this;\n    that.ri = ri;\n    that.origin = utils.getOrigin(base_url);\n    that.base_url = base_url;\n    that.trans_url = trans_url;\n    var iframe_url = base_url + '/iframe.html';\n\n    if (that.ri._options.devel) {\n      iframe_url += '?t=' + +new Date();\n    }\n\n    that.window_id = utils.random_string(8);\n    iframe_url += '#' + that.window_id;\n    that.iframeObj = utils.createIframe(iframe_url, function (r) {\n      that.ri._didClose(1006, \"Unable to load an iframe (\" + r + \")\");\n    });\n    that.onmessage_cb = utils.bind(that.onmessage, that);\n    utils.attachMessage(that.onmessage_cb);\n  };\n\n  IframeTransport.prototype.doCleanup = function () {\n    var that = this;\n\n    if (that.iframeObj) {\n      utils.detachMessage(that.onmessage_cb);\n\n      try {\n        // When the iframe is not loaded, IE raises an exception\n        // on 'contentWindow'.\n        if (that.iframeObj.iframe.contentWindow) {\n          that.postMessage('c');\n        }\n      } catch (x) {}\n\n      that.iframeObj.cleanup();\n      that.iframeObj = null;\n      that.onmessage_cb = that.iframeObj = null;\n    }\n  };\n\n  IframeTransport.prototype.onmessage = function (e) {\n    var that = this;\n    if (e.origin !== that.origin) return;\n    var window_id = e.data.slice(0, 8);\n    var type = e.data.slice(8, 9);\n    var data = e.data.slice(9);\n    if (window_id !== that.window_id) return;\n\n    switch (type) {\n      case 's':\n        that.iframeObj.loaded();\n        that.postMessage('s', JSON.stringify([SockJS.version, that.protocol, that.trans_url, that.base_url]));\n        break;\n\n      case 't':\n        that.ri._didMessage(data);\n\n        break;\n    }\n  };\n\n  IframeTransport.prototype.postMessage = function (type, data) {\n    var that = this;\n    that.iframeObj.post(that.window_id + type + (data || ''), that.origin);\n  };\n\n  IframeTransport.prototype.doSend = function (message) {\n    this.postMessage('m', message);\n  };\n\n  IframeTransport.enabled = function () {\n    // postMessage misbehaves in konqueror 4.6.5 - the messages are delivered with\n    // huge delay, or not at all.\n    var konqueror = navigator && navigator.userAgent && navigator.userAgent.indexOf('Konqueror') !== -1;\n    return (typeof _window.postMessage === 'function' || typeof _window.postMessage === 'object') && !konqueror;\n  }; //         [*] End of lib/trans-iframe.js\n  //         [*] Including lib/trans-iframe-within.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n\n\n  var curr_window_id;\n\n  var postMessage = function (type, data) {\n    if (parent !== _window) {\n      parent.postMessage(curr_window_id + type + (data || ''), '*');\n    } else {\n      utils.log(\"Can't postMessage, no parent window.\", type, data);\n    }\n  };\n\n  var FacadeJS = function () {};\n\n  FacadeJS.prototype._didClose = function (code, reason) {\n    postMessage('t', utils.closeFrame(code, reason));\n  };\n\n  FacadeJS.prototype._didMessage = function (frame) {\n    postMessage('t', frame);\n  };\n\n  FacadeJS.prototype._doSend = function (data) {\n    this._transport.doSend(data);\n  };\n\n  FacadeJS.prototype._doCleanup = function () {\n    this._transport.doCleanup();\n  };\n\n  utils.parent_origin = undefined;\n\n  SockJS.bootstrap_iframe = function () {\n    var facade;\n    curr_window_id = _document.location.hash.slice(1);\n\n    var onMessage = function (e) {\n      if (e.source !== parent) return;\n      if (typeof utils.parent_origin === 'undefined') utils.parent_origin = e.origin;\n      if (e.origin !== utils.parent_origin) return;\n      var window_id = e.data.slice(0, 8);\n      var type = e.data.slice(8, 9);\n      var data = e.data.slice(9);\n      if (window_id !== curr_window_id) return;\n\n      switch (type) {\n        case 's':\n          var p = JSON.parse(data);\n          var version = p[0];\n          var protocol = p[1];\n          var trans_url = p[2];\n          var base_url = p[3];\n\n          if (version !== SockJS.version) {\n            utils.log(\"Incompatibile SockJS! Main site uses:\" + \" \\\"\" + version + \"\\\", the iframe:\" + \" \\\"\" + SockJS.version + \"\\\".\");\n          }\n\n          if (!utils.flatUrl(trans_url) || !utils.flatUrl(base_url)) {\n            utils.log(\"Only basic urls are supported in SockJS\");\n            return;\n          }\n\n          if (!utils.isSameOriginUrl(trans_url) || !utils.isSameOriginUrl(base_url)) {\n            utils.log(\"Can't connect to different domain from within an \" + \"iframe. (\" + JSON.stringify([_window.location.href, trans_url, base_url]) + \")\");\n            return;\n          }\n\n          facade = new FacadeJS();\n          facade._transport = new FacadeJS[protocol](facade, trans_url, base_url);\n          break;\n\n        case 'm':\n          facade._doSend(data);\n\n          break;\n\n        case 'c':\n          if (facade) facade._doCleanup();\n          facade = null;\n          break;\n      }\n    }; // alert('test ticker');\n    // facade = new FacadeJS();\n    // facade._transport = new FacadeJS['w-iframe-xhr-polling'](facade, 'http://host.com:9999/ticker/12/basd');\n\n\n    utils.attachMessage(onMessage); // Start\n\n    postMessage('s');\n  }; //         [*] End of lib/trans-iframe-within.js\n  //         [*] Including lib/info.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n\n\n  var InfoReceiver = function (base_url, AjaxObject) {\n    var that = this;\n    utils.delay(function () {\n      that.doXhr(base_url, AjaxObject);\n    });\n  };\n\n  InfoReceiver.prototype = new EventEmitter(['finish']);\n\n  InfoReceiver.prototype.doXhr = function (base_url, AjaxObject) {\n    var that = this;\n    var t0 = new Date().getTime(); // <METEOR>\n    // https://github.com/sockjs/sockjs-client/pull/129\n    // var xo = new AjaxObject('GET', base_url + '/info');\n\n    var xo = new AjaxObject( // add cachebusting parameter to url to work around a chrome bug:\n    // https://code.google.com/p/chromium/issues/detail?id=263981\n    // or misbehaving proxies.\n    'GET', base_url + '/info?cb=' + utils.random_string(10)); // </METEOR>\n\n    var tref = utils.delay(8000, function () {\n      xo.ontimeout();\n    });\n\n    xo.onfinish = function (status, text) {\n      clearTimeout(tref);\n      tref = null;\n\n      if (status === 200) {\n        var rtt = new Date().getTime() - t0;\n        var info = JSON.parse(text);\n        if (typeof info !== 'object') info = {};\n        that.emit('finish', info, rtt);\n      } else {\n        that.emit('finish');\n      }\n    };\n\n    xo.ontimeout = function () {\n      xo.close();\n      that.emit('finish');\n    };\n  };\n\n  var InfoReceiverIframe = function (base_url) {\n    var that = this;\n\n    var go = function () {\n      var ifr = new IframeTransport();\n      ifr.protocol = 'w-iframe-info-receiver';\n\n      var fun = function (r) {\n        if (typeof r === 'string' && r.substr(0, 1) === 'm') {\n          var d = JSON.parse(r.substr(1));\n          var info = d[0],\n              rtt = d[1];\n          that.emit('finish', info, rtt);\n        } else {\n          that.emit('finish');\n        }\n\n        ifr.doCleanup();\n        ifr = null;\n      };\n\n      var mock_ri = {\n        _options: {},\n        _didClose: fun,\n        _didMessage: fun\n      };\n      ifr.i_constructor(mock_ri, base_url, base_url);\n    };\n\n    if (!_document.body) {\n      utils.attachEvent('load', go);\n    } else {\n      go();\n    }\n  };\n\n  InfoReceiverIframe.prototype = new EventEmitter(['finish']);\n\n  var InfoReceiverFake = function () {\n    // It may not be possible to do cross domain AJAX to get the info\n    // data, for example for IE7. But we want to run JSONP, so let's\n    // fake the response, with rtt=2s (rto=6s).\n    var that = this;\n    utils.delay(function () {\n      that.emit('finish', {}, 2000);\n    });\n  };\n\n  InfoReceiverFake.prototype = new EventEmitter(['finish']);\n\n  var createInfoReceiver = function (base_url) {\n    if (utils.isSameOriginUrl(base_url)) {\n      // If, for some reason, we have SockJS locally - there's no\n      // need to start up the complex machinery. Just use ajax.\n      return new InfoReceiver(base_url, utils.XHRLocalObject);\n    }\n\n    switch (utils.isXHRCorsCapable()) {\n      case 1:\n        // XHRLocalObject -> no_credentials=true\n        return new InfoReceiver(base_url, utils.XHRLocalObject);\n\n      case 2:\n        // <METEOR>\n        // https://github.com/sockjs/sockjs-client/issues/79\n        // XDR doesn't work across different schemes\n        // http://blogs.msdn.com/b/ieinternals/archive/2010/05/13/xdomainrequest-restrictions-limitations-and-workarounds.aspx\n        if (utils.isSameOriginScheme(base_url)) return new InfoReceiver(base_url, utils.XDRObject);else return new InfoReceiverFake();\n      // </METEOR>\n\n      case 3:\n        // Opera\n        return new InfoReceiverIframe(base_url);\n\n      default:\n        // IE 7\n        return new InfoReceiverFake();\n    }\n\n    ;\n  };\n\n  var WInfoReceiverIframe = FacadeJS['w-iframe-info-receiver'] = function (ri, _trans_url, base_url) {\n    var ir = new InfoReceiver(base_url, utils.XHRLocalObject);\n\n    ir.onfinish = function (info, rtt) {\n      ri._didMessage('m' + JSON.stringify([info, rtt]));\n\n      ri._didClose();\n    };\n  };\n\n  WInfoReceiverIframe.prototype.doCleanup = function () {}; //         [*] End of lib/info.js\n  //         [*] Including lib/trans-iframe-eventsource.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n\n\n  var EventSourceIframeTransport = SockJS['iframe-eventsource'] = function () {\n    var that = this;\n    that.protocol = 'w-iframe-eventsource';\n    that.i_constructor.apply(that, arguments);\n  };\n\n  EventSourceIframeTransport.prototype = new IframeTransport();\n\n  EventSourceIframeTransport.enabled = function () {\n    return 'EventSource' in _window && IframeTransport.enabled();\n  };\n\n  EventSourceIframeTransport.need_body = true;\n  EventSourceIframeTransport.roundTrips = 3; // html, javascript, eventsource\n  // w-iframe-eventsource\n\n  var EventSourceTransport = FacadeJS['w-iframe-eventsource'] = function (ri, trans_url) {\n    this.run(ri, trans_url, '/eventsource', EventSourceReceiver, utils.XHRLocalObject);\n  };\n\n  EventSourceTransport.prototype = new AjaxBasedTransport(); //         [*] End of lib/trans-iframe-eventsource.js\n  //         [*] Including lib/trans-iframe-xhr-polling.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n\n  var XhrPollingIframeTransport = SockJS['iframe-xhr-polling'] = function () {\n    var that = this;\n    that.protocol = 'w-iframe-xhr-polling';\n    that.i_constructor.apply(that, arguments);\n  };\n\n  XhrPollingIframeTransport.prototype = new IframeTransport();\n\n  XhrPollingIframeTransport.enabled = function () {\n    return _window.XMLHttpRequest && IframeTransport.enabled();\n  };\n\n  XhrPollingIframeTransport.need_body = true;\n  XhrPollingIframeTransport.roundTrips = 3; // html, javascript, xhr\n  // w-iframe-xhr-polling\n\n  var XhrPollingITransport = FacadeJS['w-iframe-xhr-polling'] = function (ri, trans_url) {\n    this.run(ri, trans_url, '/xhr', XhrReceiver, utils.XHRLocalObject);\n  };\n\n  XhrPollingITransport.prototype = new AjaxBasedTransport(); //         [*] End of lib/trans-iframe-xhr-polling.js\n  //         [*] Including lib/trans-iframe-htmlfile.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n  // This transport generally works in any browser, but will cause a\n  // spinning cursor to appear in any browser other than IE.\n  // We may test this transport in all browsers - why not, but in\n  // production it should be only run in IE.\n\n  var HtmlFileIframeTransport = SockJS['iframe-htmlfile'] = function () {\n    var that = this;\n    that.protocol = 'w-iframe-htmlfile';\n    that.i_constructor.apply(that, arguments);\n  }; // Inheritance.\n\n\n  HtmlFileIframeTransport.prototype = new IframeTransport();\n\n  HtmlFileIframeTransport.enabled = function () {\n    return IframeTransport.enabled();\n  };\n\n  HtmlFileIframeTransport.need_body = true;\n  HtmlFileIframeTransport.roundTrips = 3; // html, javascript, htmlfile\n  // w-iframe-htmlfile\n\n  var HtmlFileTransport = FacadeJS['w-iframe-htmlfile'] = function (ri, trans_url) {\n    this.run(ri, trans_url, '/htmlfile', HtmlfileReceiver, utils.XHRLocalObject);\n  };\n\n  HtmlFileTransport.prototype = new AjaxBasedTransport(); //         [*] End of lib/trans-iframe-htmlfile.js\n  //         [*] Including lib/trans-polling.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n\n  var Polling = function (ri, Receiver, recv_url, AjaxObject) {\n    var that = this;\n    that.ri = ri;\n    that.Receiver = Receiver;\n    that.recv_url = recv_url;\n    that.AjaxObject = AjaxObject;\n\n    that._scheduleRecv();\n  };\n\n  Polling.prototype._scheduleRecv = function () {\n    var that = this;\n    var poll = that.poll = new that.Receiver(that.recv_url, that.AjaxObject);\n    var msg_counter = 0;\n\n    poll.onmessage = function (e) {\n      msg_counter += 1;\n\n      that.ri._didMessage(e.data);\n    };\n\n    poll.onclose = function (e) {\n      that.poll = poll = poll.onmessage = poll.onclose = null;\n\n      if (!that.poll_is_closing) {\n        if (e.reason === 'permanent') {\n          that.ri._didClose(1006, 'Polling error (' + e.reason + ')');\n        } else {\n          that._scheduleRecv();\n        }\n      }\n    };\n  };\n\n  Polling.prototype.abort = function () {\n    var that = this;\n    that.poll_is_closing = true;\n\n    if (that.poll) {\n      that.poll.abort();\n    }\n  }; //         [*] End of lib/trans-polling.js\n  //         [*] Including lib/trans-receiver-eventsource.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n\n\n  var EventSourceReceiver = function (url) {\n    var that = this;\n    var es = new EventSource(url);\n\n    es.onmessage = function (e) {\n      that.dispatchEvent(new SimpleEvent('message', {\n        'data': unescape(e.data)\n      }));\n    };\n\n    that.es_close = es.onerror = function (e, abort_reason) {\n      // ES on reconnection has readyState = 0 or 1.\n      // on network error it's CLOSED = 2\n      var reason = abort_reason ? 'user' : es.readyState !== 2 ? 'network' : 'permanent';\n      that.es_close = es.onmessage = es.onerror = null; // EventSource reconnects automatically.\n\n      es.close();\n      es = null; // Safari and chrome < 15 crash if we close window before\n      // waiting for ES cleanup. See:\n      //   https://code.google.com/p/chromium/issues/detail?id=89155\n\n      utils.delay(200, function () {\n        that.dispatchEvent(new SimpleEvent('close', {\n          reason: reason\n        }));\n      });\n    };\n  };\n\n  EventSourceReceiver.prototype = new REventTarget();\n\n  EventSourceReceiver.prototype.abort = function () {\n    var that = this;\n\n    if (that.es_close) {\n      that.es_close({}, true);\n    }\n  }; //         [*] End of lib/trans-receiver-eventsource.js\n  //         [*] Including lib/trans-receiver-htmlfile.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n\n\n  var _is_ie_htmlfile_capable;\n\n  var isIeHtmlfileCapable = function () {\n    if (_is_ie_htmlfile_capable === undefined) {\n      if ('ActiveXObject' in _window) {\n        try {\n          _is_ie_htmlfile_capable = !!new ActiveXObject('htmlfile');\n        } catch (x) {}\n      } else {\n        _is_ie_htmlfile_capable = false;\n      }\n    }\n\n    return _is_ie_htmlfile_capable;\n  };\n\n  var HtmlfileReceiver = function (url) {\n    var that = this;\n    utils.polluteGlobalNamespace();\n    that.id = 'a' + utils.random_string(6, 26);\n    url += (url.indexOf('?') === -1 ? '?' : '&') + 'c=' + escape(WPrefix + '.' + that.id);\n    var constructor = isIeHtmlfileCapable() ? utils.createHtmlfile : utils.createIframe;\n    var iframeObj;\n    _window[WPrefix][that.id] = {\n      start: function () {\n        iframeObj.loaded();\n      },\n      message: function (data) {\n        that.dispatchEvent(new SimpleEvent('message', {\n          'data': data\n        }));\n      },\n      stop: function () {\n        that.iframe_close({}, 'network');\n      }\n    };\n\n    that.iframe_close = function (e, abort_reason) {\n      iframeObj.cleanup();\n      that.iframe_close = iframeObj = null;\n      delete _window[WPrefix][that.id];\n      that.dispatchEvent(new SimpleEvent('close', {\n        reason: abort_reason\n      }));\n    };\n\n    iframeObj = constructor(url, function (e) {\n      that.iframe_close({}, 'permanent');\n    });\n  };\n\n  HtmlfileReceiver.prototype = new REventTarget();\n\n  HtmlfileReceiver.prototype.abort = function () {\n    var that = this;\n\n    if (that.iframe_close) {\n      that.iframe_close({}, 'user');\n    }\n  }; //         [*] End of lib/trans-receiver-htmlfile.js\n  //         [*] Including lib/trans-receiver-xhr.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n\n\n  var XhrReceiver = function (url, AjaxObject) {\n    var that = this;\n    var buf_pos = 0;\n    that.xo = new AjaxObject('POST', url, null);\n\n    that.xo.onchunk = function (status, text) {\n      if (status !== 200) return;\n\n      while (1) {\n        var buf = text.slice(buf_pos);\n        var p = buf.indexOf('\\n');\n        if (p === -1) break;\n        buf_pos += p + 1;\n        var msg = buf.slice(0, p);\n        that.dispatchEvent(new SimpleEvent('message', {\n          data: msg\n        }));\n      }\n    };\n\n    that.xo.onfinish = function (status, text) {\n      that.xo.onchunk(status, text);\n      that.xo = null;\n      var reason = status === 200 ? 'network' : 'permanent';\n      that.dispatchEvent(new SimpleEvent('close', {\n        reason: reason\n      }));\n    };\n  };\n\n  XhrReceiver.prototype = new REventTarget();\n\n  XhrReceiver.prototype.abort = function () {\n    var that = this;\n\n    if (that.xo) {\n      that.xo.close();\n      that.dispatchEvent(new SimpleEvent('close', {\n        reason: 'user'\n      }));\n      that.xo = null;\n    }\n  }; //         [*] End of lib/trans-receiver-xhr.js\n  //         [*] Including lib/test-hooks.js\n\n  /*\n   * ***** BEGIN LICENSE BLOCK *****\n   * Copyright (c) 2011-2012 VMware, Inc.\n   *\n   * For the license see COPYING.\n   * ***** END LICENSE BLOCK *****\n   */\n  // For testing\n\n\n  SockJS.getUtils = function () {\n    return utils;\n  };\n\n  SockJS.getIframeTransport = function () {\n    return IframeTransport;\n  }; //         [*] End of lib/test-hooks.js\n\n\n  return SockJS;\n}();\n\nif ('_sockjs_onload' in window) setTimeout(_sockjs_onload, 1); // AMD compliance\n\nif (typeof define === 'function' && define.amd) {\n  define('sockjs', [], function () {\n    return SockJS;\n  });\n} //     [*] End of lib/index.js\n// [*] End of lib/all.js\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"urls.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                     //\n// packages/socket-stream-client/urls.js                                                                               //\n//                                                                                                                     //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                       //\nmodule.export({\n  toSockjsUrl: () => toSockjsUrl,\n  toWebsocketUrl: () => toWebsocketUrl\n});\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\n\n// @param url {String} URL to Meteor app, eg:\n//   \"/\" or \"madewith.meteor.com\" or \"https://foo.meteor.com\"\n//   or \"ddp+sockjs://ddp--****-foo.meteor.com/sockjs\"\n// @returns {String} URL to the endpoint with the specific scheme and subPath, e.g.\n// for scheme \"http\" and subPath \"sockjs\"\n//   \"http://subdomain.meteor.com/sockjs\" or \"/sockjs\"\n//   or \"https://ddp--1234-foo.meteor.com/sockjs\"\nfunction translateUrl(url, newSchemeBase, subPath) {\n  if (!newSchemeBase) {\n    newSchemeBase = 'http';\n  }\n\n  if (subPath !== \"sockjs\" && url.startsWith(\"/\")) {\n    url = Meteor.absoluteUrl(url.substr(1));\n  }\n\n  var ddpUrlMatch = url.match(/^ddp(i?)\\+sockjs:\\/\\//);\n  var httpUrlMatch = url.match(/^http(s?):\\/\\//);\n  var newScheme;\n\n  if (ddpUrlMatch) {\n    // Remove scheme and split off the host.\n    var urlAfterDDP = url.substr(ddpUrlMatch[0].length);\n    newScheme = ddpUrlMatch[1] === 'i' ? newSchemeBase : newSchemeBase + 's';\n    var slashPos = urlAfterDDP.indexOf('/');\n    var host = slashPos === -1 ? urlAfterDDP : urlAfterDDP.substr(0, slashPos);\n    var rest = slashPos === -1 ? '' : urlAfterDDP.substr(slashPos); // In the host (ONLY!), change '*' characters into random digits. This\n    // allows different stream connections to connect to different hostnames\n    // and avoid browser per-hostname connection limits.\n\n    host = host.replace(/\\*/g, () => Math.floor(Math.random() * 10));\n    return newScheme + '://' + host + rest;\n  } else if (httpUrlMatch) {\n    newScheme = !httpUrlMatch[1] ? newSchemeBase : newSchemeBase + 's';\n    var urlAfterHttp = url.substr(httpUrlMatch[0].length);\n    url = newScheme + '://' + urlAfterHttp;\n  } // Prefix FQDNs but not relative URLs\n\n\n  if (url.indexOf('://') === -1 && !url.startsWith('/')) {\n    url = newSchemeBase + '://' + url;\n  } // XXX This is not what we should be doing: if I have a site\n  // deployed at \"/foo\", then DDP.connect(\"/\") should actually connect\n  // to \"/\", not to \"/foo\". \"/\" is an absolute path. (Contrast: if\n  // deployed at \"/foo\", it would be reasonable for DDP.connect(\"bar\")\n  // to connect to \"/foo/bar\").\n  //\n  // We should make this properly honor absolute paths rather than\n  // forcing the path to be relative to the site root. Simultaneously,\n  // we should set DDP_DEFAULT_CONNECTION_URL to include the site\n  // root. See also client_convenience.js #RationalizingRelativeDDPURLs\n\n\n  url = Meteor._relativeToSiteRootUrl(url);\n  if (url.endsWith('/')) return url + subPath;else return url + '/' + subPath;\n}\n\nfunction toSockjsUrl(url) {\n  return translateUrl(url, 'http', 'sockjs');\n}\n\nfunction toWebsocketUrl(url) {\n  return translateUrl(url, 'ws', 'websocket');\n}\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}}}},{\n  \"extensions\": [\n    \".js\",\n    \".json\"\n  ]\n});\n\n\n/* Exports */\nPackage._define(\"socket-stream-client\");\n\n})();\n","servePath":"/packages/socket-stream-client.js","sourceMap":{"version":3,"sources":["packages/socket-stream-client/browser.js","packages/socket-stream-client/common.js","packages/socket-stream-client/sockjs-0.3.4.js","packages/socket-stream-client/urls.js"],"names":["_objectSpread","module","link","default","v","export","ClientStream","toSockjsUrl","toWebsocketUrl","StreamClientCommon","constructor","url","options","_initCommon","HEARTBEAT_TIMEOUT","rawUrl","socket","lastError","heartbeatTimer","window","addEventListener","_online","bind","_launchConnection","send","data","currentStatus","connected","_changeUrl","_connected","connectionTimer","clearTimeout","status","retryCount","statusChanged","forEachCallback","callback","_cleanup","maybeError","_clearConnectionAndHeartbeatTimers","onmessage","onclose","onerror","onheartbeat","close","_heartbeat_timeout","console","log","_lostConnection","ConnectionError","_heartbeat_received","_forcedToDisconnect","setTimeout","_sockjsProtocolsWhitelist","protocolsWhitelist","noWebsockets","navigator","test","userAgent","concat","protocols_whitelist","_sockjsOptions","hasSockJS","SockJS","undefined","WebSocket","onopen","error","Date","toDateString","CONNECT_TIMEOUT","Retry","forcedReconnectError","Error","retry","on","name","eventCallbacks","push","cb","length","forEach","Object","create","connectTimeoutMs","Package","tracker","statusListeners","Tracker","Dependency","changed","_retry","reconnect","_force","clear","_retryNow","disconnect","_permanent","_error","reason","_retryLater","timeout","retryLater","retryTime","getTime","depend","_document","document","_window","utils","REventTarget","prototype","eventType","listener","_listeners","arr","arrIndexOf","removeEventListener","idx","slice","dispatchEvent","event","t","type","args","Array","call","arguments","apply","i","SimpleEvent","obj","k","hasOwnProperty","toString","r","join","EventEmitter","events","that","_events","emit","_verifyType","_nuked","JSON","stringify","nuke","random_string_chars","random_string","max","ret","substr","Math","floor","random","random_number","random_number_string","p","getOrigin","parts","split","isSameOriginUrl","url_a","url_b","location","href","isSameOriginScheme","getParentDomain","objectExtend","dst","src","WPrefix","polluteGlobalNamespace","closeFrame","code","userSetCode","countRTO","rtt","rto","debug","fun","flatUrl","indexOf","amendUrl","relativeTo","baseUrl","protocolMatch","exec","protocol","toLowerCase","rest","substring","hostMatch","host","replace","arrSkip","isArray","value","delay","json_escapable","json_lookup","extra_escapable","extra_lookup","JSONQuote","string","lastIndex","a","unroll_lookup","escapable","unrolled","c","String","fromCharCode","charCodeAt","quote","quoted","_all_protocols","probeProtocols","probed","enabled","detectProtocols","info","pe","protocols","maybe_push","protos","proto","shift","websocket","null_origin","cookie_needed","MPrefix","createHook","window_id","map","id","del","attachMessage","attachEvent","detachMessage","detachEvent","on_unload","after_unload","trigger_unload_callbacks","ref","unload_triggered","unload_add","unload_del","createIframe","iframe_url","error_callback","iframe","createElement","tref","unload_ref","unattach","onload","x","cleanup","parentNode","removeChild","post","msg","origin","contentWindow","postMessage","style","display","position","body","appendChild","loaded","createHtmlfile","doc","ActiveXObject","CollectGarbage","open","write","domain","parentWindow","AbstractXHRObject","_start","method","payload","opts","xhr","XMLHttpRequest","XDomainRequest","e","no_credentials","withCredentials","headers","key","setRequestHeader","onreadystatechange","readyState","text","responseText","abort","XHRCorsObject","XHRLocalObject","XDRObject","xdr","ontimeout","onprogress","isXHRCorsCapable","IframeTransport","dep_protocols_whitelist","_options","devel","_base_url","_server","server","_debug","_protocols","CONNECTING","_ir","createInfoReceiver","onfinish","_applyInfo","_didClose","version","OPEN","CLOSING","CLOSED","_dispatchOpen","_transport_tref","_dispatchMessage","_dispatchHeartbeat","force","_transport","doCleanup","close_event","wasClean","_try_next_protocol","last_event","_didMessage","parse","need_body","unshift","roundTrips","to","connid","trans_url","doSend","base_url","WebSocketTransport","ri","Constructor","MozWebSocket","ws","BufferedSender","send_constructor","sender","send_buffer","message","send_stop","send_schedule","send_schedule_wait","success","abort_reason","send_destructor","_send_stop","jsonPGenericSender","form","_send_form","area","_send_area","enctype","acceptCharset","target","action","submit","completed","createAjaxSender","AjaxObject","xo","jsonPGenericReceiver","script","script2","close_script","frame","onclick","loaded_okay","error_timer","charset","htmlFor","async","head","getElementsByTagName","insertBefore","firstChild","JsonPTransport","_schedule_recv","_recv_stop","_is_closing","jsonPReceiverWrapper","constructReceiver","user_callback","url_id","escape","aborting","stop","AjaxBasedTransport","run","url_suffix","Receiver","poll","Polling","XhrStreamingTransport","XhrReceiver","XdrStreamingTransport","XhrPollingTransport","XdrPollingTransport","i_constructor","iframeObj","onmessage_cb","konqueror","curr_window_id","parent","FacadeJS","_doSend","_doCleanup","parent_origin","bootstrap_iframe","facade","hash","onMessage","source","InfoReceiver","doXhr","t0","InfoReceiverIframe","go","ifr","d","mock_ri","InfoReceiverFake","WInfoReceiverIframe","_trans_url","ir","EventSourceIframeTransport","EventSourceTransport","EventSourceReceiver","XhrPollingIframeTransport","XhrPollingITransport","HtmlFileIframeTransport","HtmlFileTransport","HtmlfileReceiver","recv_url","_scheduleRecv","msg_counter","poll_is_closing","es","EventSource","unescape","es_close","_is_ie_htmlfile_capable","isIeHtmlfileCapable","start","iframe_close","buf_pos","onchunk","buf","getUtils","getIframeTransport","_sockjs_onload","define","amd","Meteor","translateUrl","newSchemeBase","subPath","startsWith","absoluteUrl","ddpUrlMatch","match","httpUrlMatch","newScheme","urlAfterDDP","slashPos","urlAfterHttp","_relativeToSiteRootUrl","endsWith"],"mappings":"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","file":"/packages/socket-stream-client.js","sourcesContent":["import {\n  toSockjsUrl,\n  toWebsocketUrl,\n} from \"./urls.js\";\n\nimport { StreamClientCommon } from \"./common.js\";\n\n// Statically importing SockJS here will prevent native WebSocket usage\n// below (in favor of SockJS), but will ensure maximum compatibility for\n// clients stuck in unusual networking environments.\nimport \"./sockjs-0.3.4.js\";\n\nexport class ClientStream extends StreamClientCommon {\n  // @param url {String} URL to Meteor app\n  //   \"http://subdomain.meteor.com/\" or \"/\" or\n  //   \"ddp+sockjs://foo-**.meteor.com/sockjs\"\n  constructor(url, options) {\n    super(options);\n\n    this._initCommon(this.options);\n\n    //// Constants\n\n    // how long between hearing heartbeat from the server until we declare\n    // the connection dead. heartbeats come every 45s (stream_server.js)\n    //\n    // NOTE: this is a older timeout mechanism. We now send heartbeats at\n    // the DDP level (https://github.com/meteor/meteor/pull/1865), and\n    // expect those timeouts to kill a non-responsive connection before\n    // this timeout fires. This is kept around for compatibility (when\n    // talking to a server that doesn't support DDP heartbeats) and can be\n    // removed later.\n    this.HEARTBEAT_TIMEOUT = 100 * 1000;\n\n    this.rawUrl = url;\n    this.socket = null;\n    this.lastError = null;\n\n    this.heartbeatTimer = null;\n\n    // Listen to global 'online' event if we are running in a browser.\n    window.addEventListener(\n      'online',\n      this._online.bind(this),\n      false /* useCapture */\n    );\n\n    //// Kickoff!\n    this._launchConnection();\n  }\n\n  // data is a utf8 string. Data sent while not connected is dropped on\n  // the floor, and it is up the user of this API to retransmit lost\n  // messages on 'reset'\n  send(data) {\n    if (this.currentStatus.connected) {\n      this.socket.send(data);\n    }\n  }\n\n  // Changes where this connection points\n  _changeUrl(url) {\n    this.rawUrl = url;\n  }\n\n  _connected() {\n    if (this.connectionTimer) {\n      clearTimeout(this.connectionTimer);\n      this.connectionTimer = null;\n    }\n\n    if (this.currentStatus.connected) {\n      // already connected. do nothing. this probably shouldn't happen.\n      return;\n    }\n\n    // update status\n    this.currentStatus.status = 'connected';\n    this.currentStatus.connected = true;\n    this.currentStatus.retryCount = 0;\n    this.statusChanged();\n\n    // fire resets. This must come after status change so that clients\n    // can call send from within a reset callback.\n    this.forEachCallback('reset', callback => {\n      callback();\n    });\n  }\n\n  _cleanup(maybeError) {\n    this._clearConnectionAndHeartbeatTimers();\n    if (this.socket) {\n      this.socket.onmessage = this.socket.onclose = this.socket.onerror = this.socket.onheartbeat = () => {};\n      this.socket.close();\n      this.socket = null;\n    }\n\n    this.forEachCallback('disconnect', callback => {\n      callback(maybeError);\n    });\n  }\n\n  _clearConnectionAndHeartbeatTimers() {\n    if (this.connectionTimer) {\n      clearTimeout(this.connectionTimer);\n      this.connectionTimer = null;\n    }\n    if (this.heartbeatTimer) {\n      clearTimeout(this.heartbeatTimer);\n      this.heartbeatTimer = null;\n    }\n  }\n\n  _heartbeat_timeout() {\n    console.log('Connection timeout. No sockjs heartbeat received.');\n    this._lostConnection(new this.ConnectionError(\"Heartbeat timed out\"));\n  }\n\n  _heartbeat_received() {\n    // If we've already permanently shut down this stream, the timeout is\n    // already cleared, and we don't need to set it again.\n    if (this._forcedToDisconnect) return;\n    if (this.heartbeatTimer) clearTimeout(this.heartbeatTimer);\n    this.heartbeatTimer = setTimeout(\n      this._heartbeat_timeout.bind(this),\n      this.HEARTBEAT_TIMEOUT\n    );\n  }\n\n  _sockjsProtocolsWhitelist() {\n    // only allow polling protocols. no streaming.  streaming\n    // makes safari spin.\n    var protocolsWhitelist = [\n      'xdr-polling',\n      'xhr-polling',\n      'iframe-xhr-polling',\n      'jsonp-polling'\n    ];\n\n    // iOS 4 and 5 and below crash when using websockets over certain\n    // proxies. this seems to be resolved with iOS 6. eg\n    // https://github.com/LearnBoost/socket.io/issues/193#issuecomment-7308865.\n    //\n    // iOS <4 doesn't support websockets at all so sockjs will just\n    // immediately fall back to http\n    var noWebsockets =\n      navigator &&\n      /iPhone|iPad|iPod/.test(navigator.userAgent) &&\n      /OS 4_|OS 5_/.test(navigator.userAgent);\n\n    if (!noWebsockets)\n      protocolsWhitelist = ['websocket'].concat(protocolsWhitelist);\n\n    return protocolsWhitelist;\n  }\n\n  _launchConnection() {\n    this._cleanup(); // cleanup the old socket, if there was one.\n\n    var options = {\n      protocols_whitelist: this._sockjsProtocolsWhitelist(),\n      ...this.options._sockjsOptions\n    };\n\n    const hasSockJS = typeof SockJS === \"function\";\n\n    this.socket = hasSockJS\n      // Convert raw URL to SockJS URL each time we open a connection, so\n      // that we can connect to random hostnames and get around browser\n      // per-host connection limits.\n      ? new SockJS(toSockjsUrl(this.rawUrl), undefined, options)\n      : new WebSocket(toWebsocketUrl(this.rawUrl));\n\n    this.socket.onopen = data => {\n      this.lastError = null;\n      this._connected();\n    };\n\n    this.socket.onmessage = data => {\n      this.lastError = null;\n      this._heartbeat_received();\n      if (this.currentStatus.connected) {\n        this.forEachCallback('message', callback => {\n          callback(data.data);\n        });\n      }\n    };\n\n    this.socket.onclose = () => {\n      this._lostConnection();\n    };\n\n    this.socket.onerror = error => {\n      const { lastError } = this;\n      this.lastError = error;\n      if (lastError) return;\n      console.error(\n        'stream error',\n        error,\n        new Date().toDateString()\n      );\n    };\n\n    this.socket.onheartbeat = () => {\n      this.lastError = null;\n      this._heartbeat_received();\n    };\n\n    if (this.connectionTimer) clearTimeout(this.connectionTimer);\n    this.connectionTimer = setTimeout(() => {\n      this._lostConnection(\n        new this.ConnectionError(\"DDP connection timed out\")\n      );\n    }, this.CONNECT_TIMEOUT);\n  }\n}\n","import { Retry } from 'meteor/retry';\n\nconst forcedReconnectError = new Error(\"forced reconnect\");\n\nexport class StreamClientCommon {\n  constructor(options) {\n    this.options = {\n      retry: true,\n      ...(options || null),\n    };\n\n    this.ConnectionError =\n      options && options.ConnectionError || Error;\n  }\n\n  // Register for callbacks.\n  on(name, callback) {\n    if (name !== 'message' && name !== 'reset' && name !== 'disconnect')\n      throw new Error('unknown event type: ' + name);\n\n    if (!this.eventCallbacks[name]) this.eventCallbacks[name] = [];\n    this.eventCallbacks[name].push(callback);\n  }\n\n  forEachCallback(name, cb) {\n    if (!this.eventCallbacks[name] || !this.eventCallbacks[name].length) {\n      return;\n    }\n\n    this.eventCallbacks[name].forEach(cb);\n  }\n\n  _initCommon(options) {\n    options = options || Object.create(null);\n\n    //// Constants\n\n    // how long to wait until we declare the connection attempt\n    // failed.\n    this.CONNECT_TIMEOUT = options.connectTimeoutMs || 10000;\n\n    this.eventCallbacks = Object.create(null); // name -> [callback]\n\n    this._forcedToDisconnect = false;\n\n    //// Reactive status\n    this.currentStatus = {\n      status: 'connecting',\n      connected: false,\n      retryCount: 0\n    };\n\n    if (Package.tracker) {\n      this.statusListeners = new Package.tracker.Tracker.Dependency();\n    }\n\n    this.statusChanged = () => {\n      if (this.statusListeners) {\n        this.statusListeners.changed();\n      }\n    };\n\n    //// Retry logic\n    this._retry = new Retry();\n    this.connectionTimer = null;\n  }\n\n  // Trigger a reconnect.\n  reconnect(options) {\n    options = options || Object.create(null);\n\n    if (options.url) {\n      this._changeUrl(options.url);\n    }\n\n    if (options._sockjsOptions) {\n      this.options._sockjsOptions = options._sockjsOptions;\n    }\n\n    if (this.currentStatus.connected) {\n      if (options._force || options.url) {\n        this._lostConnection(forcedReconnectError);\n      }\n      return;\n    }\n\n    // if we're mid-connection, stop it.\n    if (this.currentStatus.status === 'connecting') {\n      // Pretend it's a clean close.\n      this._lostConnection();\n    }\n\n    this._retry.clear();\n    this.currentStatus.retryCount -= 1; // don't count manual retries\n    this._retryNow();\n  }\n\n  disconnect(options) {\n    options = options || Object.create(null);\n\n    // Failed is permanent. If we're failed, don't let people go back\n    // online by calling 'disconnect' then 'reconnect'.\n    if (this._forcedToDisconnect) return;\n\n    // If _permanent is set, permanently disconnect a stream. Once a stream\n    // is forced to disconnect, it can never reconnect. This is for\n    // error cases such as ddp version mismatch, where trying again\n    // won't fix the problem.\n    if (options._permanent) {\n      this._forcedToDisconnect = true;\n    }\n\n    this._cleanup();\n    this._retry.clear();\n\n    this.currentStatus = {\n      status: options._permanent ? 'failed' : 'offline',\n      connected: false,\n      retryCount: 0\n    };\n\n    if (options._permanent && options._error)\n      this.currentStatus.reason = options._error;\n\n    this.statusChanged();\n  }\n\n  // maybeError is set unless it's a clean protocol-level close.\n  _lostConnection(maybeError) {\n    this._cleanup(maybeError);\n    this._retryLater(maybeError); // sets status. no need to do it here.\n  }\n\n  // fired when we detect that we've gone online. try to reconnect\n  // immediately.\n  _online() {\n    // if we've requested to be offline by disconnecting, don't reconnect.\n    if (this.currentStatus.status != 'offline') this.reconnect();\n  }\n\n  _retryLater(maybeError) {\n    var timeout = 0;\n    if (this.options.retry ||\n        maybeError === forcedReconnectError) {\n      timeout = this._retry.retryLater(\n        this.currentStatus.retryCount,\n        this._retryNow.bind(this)\n      );\n      this.currentStatus.status = 'waiting';\n      this.currentStatus.retryTime = new Date().getTime() + timeout;\n    } else {\n      this.currentStatus.status = 'failed';\n      delete this.currentStatus.retryTime;\n    }\n\n    this.currentStatus.connected = false;\n    this.statusChanged();\n  }\n\n  _retryNow() {\n    if (this._forcedToDisconnect) return;\n\n    this.currentStatus.retryCount += 1;\n    this.currentStatus.status = 'connecting';\n    this.currentStatus.connected = false;\n    delete this.currentStatus.retryTime;\n    this.statusChanged();\n\n    this._launchConnection();\n  }\n\n  // Get current status. Reactive.\n  status() {\n    if (this.statusListeners) {\n      this.statusListeners.depend();\n    }\n    return this.currentStatus;\n  }\n}\n","// XXX METEOR changes in <METEOR>\n\n/* SockJS client, version 0.3.4, http://sockjs.org, MIT License\n\nCopyright (c) 2011-2012 VMware, Inc.\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n*/\n\n// <METEOR> Commented out JSO implementation (use json package instead).\n// JSON2 by Douglas Crockford (minified).\n// var JSON;JSON||(JSON={}),function(){function str(a,b){var c,d,e,f,g=gap,h,i=b[a];i&&typeof i==\"object\"&&typeof i.toJSON==\"function\"&&(i=i.toJSON(a)),typeof rep==\"function\"&&(i=rep.call(b,a,i));switch(typeof i){case\"string\":return quote(i);case\"number\":return isFinite(i)?String(i):\"null\";case\"boolean\":case\"null\":return String(i);case\"object\":if(!i)return\"null\";gap+=indent,h=[];if(Object.prototype.toString.apply(i)===\"[object Array]\"){f=i.length;for(c=0;c<f;c+=1)h[c]=str(c,i)||\"null\";e=h.length===0?\"[]\":gap?\"[\\n\"+gap+h.join(\",\\n\"+gap)+\"\\n\"+g+\"]\":\"[\"+h.join(\",\")+\"]\",gap=g;return e}if(rep&&typeof rep==\"object\"){f=rep.length;for(c=0;c<f;c+=1)typeof rep[c]==\"string\"&&(d=rep[c],e=str(d,i),e&&h.push(quote(d)+(gap?\": \":\":\")+e))}else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?\": \":\":\")+e));e=h.length===0?\"{}\":gap?\"{\\n\"+gap+h.join(\",\\n\"+gap)+\"\\n\"+g+\"}\":\"{\"+h.join(\",\")+\"}\",gap=g;return e}}function quote(a){escapable.lastIndex=0;return escapable.test(a)?'\"'+a.replace(escapable,function(a){var b=meta[a];return typeof b==\"string\"?b:\"\\\\u\"+(\"0000\"+a.charCodeAt(0).toString(16)).slice(-4)})+'\"':'\"'+a+'\"'}function f(a){return a<10?\"0\"+a:a}\"use strict\",typeof Date.prototype.toJSON!=\"function\"&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+\"-\"+f(this.getUTCMonth()+1)+\"-\"+f(this.getUTCDate())+\"T\"+f(this.getUTCHours())+\":\"+f(this.getUTCMinutes())+\":\"+f(this.getUTCSeconds())+\"Z\":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,escapable=/[\\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,gap,indent,meta={\"\\b\":\"\\\\b\",\"\\t\":\"\\\\t\",\"\\n\":\"\\\\n\",\"\\f\":\"\\\\f\",\"\\r\":\"\\\\r\",'\"':'\\\\\"',\"\\\\\":\"\\\\\\\\\"},rep;typeof JSON.stringify!=\"function\"&&(JSON.stringify=function(a,b,c){var d;gap=\"\",indent=\"\";if(typeof c==\"number\")for(d=0;d<c;d+=1)indent+=\" \";else typeof c==\"string\"&&(indent=c);rep=b;if(!b||typeof b==\"function\"||typeof b==\"object\"&&typeof b.length==\"number\")return str(\"\",{\"\":a});throw new Error(\"JSON.stringify\")}),typeof JSON.parse!=\"function\"&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e==\"object\")for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),d!==undefined?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return\"\\\\u\"+(\"0000\"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\\],:{}\\s]*$/.test(text.replace(/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g,\"@\").replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g,\"]\").replace(/(?:^|:|,)(?:\\s*\\[)+/g,\"\"))){j=eval(\"(\"+text+\")\");return typeof reviver==\"function\"?walk({\"\":j},\"\"):j}throw new SyntaxError(\"JSON.parse\")})}()\n// </METEOR>\n\n//     [*] Including lib/index.js\n// Public object\nSockJS = (function(){\n              var _document = document;\n              var _window = window;\n              var utils = {};\n\n\n//         [*] Including lib/reventtarget.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\n/* Simplified implementation of DOM2 EventTarget.\n *   http://www.w3.org/TR/DOM-Level-2-Events/events.html#Events-EventTarget\n */\nvar REventTarget = function() {};\nREventTarget.prototype.addEventListener = function (eventType, listener) {\n    if(!this._listeners) {\n         this._listeners = {};\n    }\n    if(!(eventType in this._listeners)) {\n        this._listeners[eventType] = [];\n    }\n    var arr = this._listeners[eventType];\n    if(utils.arrIndexOf(arr, listener) === -1) {\n        arr.push(listener);\n    }\n    return;\n};\n\nREventTarget.prototype.removeEventListener = function (eventType, listener) {\n    if(!(this._listeners && (eventType in this._listeners))) {\n        return;\n    }\n    var arr = this._listeners[eventType];\n    var idx = utils.arrIndexOf(arr, listener);\n    if (idx !== -1) {\n        if(arr.length > 1) {\n            this._listeners[eventType] = arr.slice(0, idx).concat( arr.slice(idx+1) );\n        } else {\n            delete this._listeners[eventType];\n        }\n        return;\n    }\n    return;\n};\n\nREventTarget.prototype.dispatchEvent = function (event) {\n    var t = event.type;\n    var args = Array.prototype.slice.call(arguments, 0);\n    if (this['on'+t]) {\n        this['on'+t].apply(this, args);\n    }\n    if (this._listeners && t in this._listeners) {\n        for(var i=0; i < this._listeners[t].length; i++) {\n            this._listeners[t][i].apply(this, args);\n        }\n    }\n};\n//         [*] End of lib/reventtarget.js\n\n\n//         [*] Including lib/simpleevent.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\nvar SimpleEvent = function(type, obj) {\n    this.type = type;\n    if (typeof obj !== 'undefined') {\n        for(var k in obj) {\n            if (!obj.hasOwnProperty(k)) continue;\n            this[k] = obj[k];\n        }\n    }\n};\n\nSimpleEvent.prototype.toString = function() {\n    var r = [];\n    for(var k in this) {\n        if (!this.hasOwnProperty(k)) continue;\n        var v = this[k];\n        if (typeof v === 'function') v = '[function]';\n        r.push(k + '=' + v);\n    }\n    return 'SimpleEvent(' + r.join(', ') + ')';\n};\n//         [*] End of lib/simpleevent.js\n\n\n//         [*] Including lib/eventemitter.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\nvar EventEmitter = function(events) {\n    var that = this;\n    that._events = events || [];\n    that._listeners = {};\n};\nEventEmitter.prototype.emit = function(type) {\n    var that = this;\n    that._verifyType(type);\n    if (that._nuked) return;\n\n    var args = Array.prototype.slice.call(arguments, 1);\n    if (that['on'+type]) {\n        that['on'+type].apply(that, args);\n    }\n    if (type in that._listeners) {\n        for(var i = 0; i < that._listeners[type].length; i++) {\n            that._listeners[type][i].apply(that, args);\n        }\n    }\n};\n\nEventEmitter.prototype.on = function(type, callback) {\n    var that = this;\n    that._verifyType(type);\n    if (that._nuked) return;\n\n    if (!(type in that._listeners)) {\n        that._listeners[type] = [];\n    }\n    that._listeners[type].push(callback);\n};\n\nEventEmitter.prototype._verifyType = function(type) {\n    var that = this;\n    if (utils.arrIndexOf(that._events, type) === -1) {\n        utils.log('Event ' + JSON.stringify(type) +\n                  ' not listed ' + JSON.stringify(that._events) +\n                  ' in ' + that);\n    }\n};\n\nEventEmitter.prototype.nuke = function() {\n    var that = this;\n    that._nuked = true;\n    for(var i=0; i<that._events.length; i++) {\n        delete that[that._events[i]];\n    }\n    that._listeners = {};\n};\n//         [*] End of lib/eventemitter.js\n\n\n//         [*] Including lib/utils.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\nvar random_string_chars = 'abcdefghijklmnopqrstuvwxyz0123456789_';\nutils.random_string = function(length, max) {\n    max = max || random_string_chars.length;\n    var i, ret = [];\n    for(i=0; i < length; i++) {\n        ret.push( random_string_chars.substr(Math.floor(Math.random() * max),1) );\n    }\n    return ret.join('');\n};\nutils.random_number = function(max) {\n    return Math.floor(Math.random() * max);\n};\nutils.random_number_string = function(max) {\n    var t = (''+(max - 1)).length;\n    var p = Array(t+1).join('0');\n    return (p + utils.random_number(max)).slice(-t);\n};\n\n// Assuming that url looks like: http://asdasd:111/asd\nutils.getOrigin = function(url) {\n    url += '/';\n    var parts = url.split('/').slice(0, 3);\n    return parts.join('/');\n};\n\nutils.isSameOriginUrl = function(url_a, url_b) {\n    // location.origin would do, but it's not always available.\n    if (!url_b) url_b = _window.location.href;\n\n    return (url_a.split('/').slice(0,3).join('/')\n                ===\n            url_b.split('/').slice(0,3).join('/'));\n};\n\n// <METEOR>\n// https://github.com/sockjs/sockjs-client/issues/79\nutils.isSameOriginScheme = function(url_a, url_b) {\n    if (!url_b) url_b = _window.location.href;\n\n    return (url_a.split(':')[0]\n                ===\n            url_b.split(':')[0]);\n};\n// </METEOR>\n\n\nutils.getParentDomain = function(url) {\n    // ipv4 ip address\n    if (/^[0-9.]*$/.test(url)) return url;\n    // ipv6 ip address\n    if (/^\\[/.test(url)) return url;\n    // no dots\n    if (!(/[.]/.test(url))) return url;\n\n    var parts = url.split('.').slice(1);\n    return parts.join('.');\n};\n\nutils.objectExtend = function(dst, src) {\n    for(var k in src) {\n        if (src.hasOwnProperty(k)) {\n            dst[k] = src[k];\n        }\n    }\n    return dst;\n};\n\nvar WPrefix = '_jp';\n\nutils.polluteGlobalNamespace = function() {\n    if (!(WPrefix in _window)) {\n        _window[WPrefix] = {};\n    }\n};\n\nutils.closeFrame = function (code, reason) {\n    return 'c'+JSON.stringify([code, reason]);\n};\n\nutils.userSetCode = function (code) {\n    return code === 1000 || (code >= 3000 && code <= 4999);\n};\n\n// See: http://www.erg.abdn.ac.uk/~gerrit/dccp/notes/ccid2/rto_estimator/\n// and RFC 2988.\nutils.countRTO = function (rtt) {\n    var rto;\n    if (rtt > 100) {\n        rto = 3 * rtt; // rto > 300msec\n    } else {\n        rto = rtt + 200; // 200msec < rto <= 300msec\n    }\n    return rto;\n}\n\nutils.log = function() {\n    if (_window.console && console.log && console.log.apply) {\n        console.log.apply(console, arguments);\n    }\n};\n\nutils.debug = function() {\n    if (_window.console && console.debug && console.debug.apply) {\n        console.debug.apply(console, arguments);\n    }\n};\n\nutils.bind = function(fun, that) {\n    if (fun.bind) {\n        return fun.bind(that);\n    } else {\n        return function() {\n            return fun.apply(that, arguments);\n        };\n    }\n};\n\nutils.flatUrl = function(url) {\n    return url.indexOf('?') === -1 && url.indexOf('#') === -1;\n};\n\n// `relativeTo` is an optional absolute URL. If provided, `url` will be\n// interpreted relative to `relativeTo`. Defaults to `document.location`.\n// <METEOR>\nutils.amendUrl = function(url, relativeTo) {\n    var baseUrl;\n    if (relativeTo === undefined) {\n      baseUrl = _document.location;\n    } else {\n      var protocolMatch = /^([a-z0-9.+-]+:)/i.exec(relativeTo);\n      if (protocolMatch) {\n        var protocol = protocolMatch[0].toLowerCase();\n        var rest = relativeTo.substring(protocol.length);\n        var hostMatch = /[a-z0-9\\.-]+(:[0-9]+)?/.exec(rest);\n        if (hostMatch)\n          var host = hostMatch[0];\n      }\n      if (! protocol || ! host)\n        throw new Error(\"relativeTo must be an absolute url\");\n      baseUrl = {\n        protocol: protocol,\n        host: host\n      };\n    }\n    if (!url) {\n        throw new Error('Wrong url for SockJS');\n    }\n    if (!utils.flatUrl(url)) {\n        throw new Error('Only basic urls are supported in SockJS');\n    }\n\n    //  '//abc' --> 'http://abc'\n    if (url.indexOf('//') === 0) {\n        url = baseUrl.protocol + url;\n    }\n    // '/abc' --> 'http://localhost:1234/abc'\n    if (url.indexOf('/') === 0) {\n        url = baseUrl.protocol + '//' + baseUrl.host + url;\n    }\n    // </METEOR>\n    // strip trailing slashes\n    url = url.replace(/[/]+$/,'');\n\n    // We have a full url here, with proto and host. For some browsers\n    // http://localhost:80/ is not in the same origin as http://localhost/\n\t// Remove explicit :80 or :443 in such cases. See #74\n    var parts = url.split(\"/\");\n    if ((parts[0] === \"http:\" && /:80$/.test(parts[2])) ||\n\t    (parts[0] === \"https:\" && /:443$/.test(parts[2]))) {\n\t\tparts[2] = parts[2].replace(/:(80|443)$/, \"\");\n\t}\n    url = parts.join(\"/\");\n    return url;\n};\n\n// IE doesn't support [].indexOf.\nutils.arrIndexOf = function(arr, obj){\n    for(var i=0; i < arr.length; i++){\n        if(arr[i] === obj){\n            return i;\n        }\n    }\n    return -1;\n};\n\nutils.arrSkip = function(arr, obj) {\n    var idx = utils.arrIndexOf(arr, obj);\n    if (idx === -1) {\n        return arr.slice();\n    } else {\n        var dst = arr.slice(0, idx);\n        return dst.concat(arr.slice(idx+1));\n    }\n};\n\n// Via: https://gist.github.com/1133122/2121c601c5549155483f50be3da5305e83b8c5df\nutils.isArray = Array.isArray || function(value) {\n    return {}.toString.call(value).indexOf('Array') >= 0\n};\n\nutils.delay = function(t, fun) {\n    if(typeof t === 'function') {\n        fun = t;\n        t = 0;\n    }\n    return setTimeout(fun, t);\n};\n\n\n// Chars worth escaping, as defined by Douglas Crockford:\n//   https://github.com/douglascrockford/JSON-js/blob/47a9882cddeb1e8529e07af9736218075372b8ac/json2.js#L196\nvar json_escapable = /[\\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,\n    json_lookup = {\n\"\\u0000\":\"\\\\u0000\",\"\\u0001\":\"\\\\u0001\",\"\\u0002\":\"\\\\u0002\",\"\\u0003\":\"\\\\u0003\",\n\"\\u0004\":\"\\\\u0004\",\"\\u0005\":\"\\\\u0005\",\"\\u0006\":\"\\\\u0006\",\"\\u0007\":\"\\\\u0007\",\n\"\\b\":\"\\\\b\",\"\\t\":\"\\\\t\",\"\\n\":\"\\\\n\",\"\\u000b\":\"\\\\u000b\",\"\\f\":\"\\\\f\",\"\\r\":\"\\\\r\",\n\"\\u000e\":\"\\\\u000e\",\"\\u000f\":\"\\\\u000f\",\"\\u0010\":\"\\\\u0010\",\"\\u0011\":\"\\\\u0011\",\n\"\\u0012\":\"\\\\u0012\",\"\\u0013\":\"\\\\u0013\",\"\\u0014\":\"\\\\u0014\",\"\\u0015\":\"\\\\u0015\",\n\"\\u0016\":\"\\\\u0016\",\"\\u0017\":\"\\\\u0017\",\"\\u0018\":\"\\\\u0018\",\"\\u0019\":\"\\\\u0019\",\n\"\\u001a\":\"\\\\u001a\",\"\\u001b\":\"\\\\u001b\",\"\\u001c\":\"\\\\u001c\",\"\\u001d\":\"\\\\u001d\",\n\"\\u001e\":\"\\\\u001e\",\"\\u001f\":\"\\\\u001f\",\"\\\"\":\"\\\\\\\"\",\"\\\\\":\"\\\\\\\\\",\n\"\\u007f\":\"\\\\u007f\",\"\\u0080\":\"\\\\u0080\",\"\\u0081\":\"\\\\u0081\",\"\\u0082\":\"\\\\u0082\",\n\"\\u0083\":\"\\\\u0083\",\"\\u0084\":\"\\\\u0084\",\"\\u0085\":\"\\\\u0085\",\"\\u0086\":\"\\\\u0086\",\n\"\\u0087\":\"\\\\u0087\",\"\\u0088\":\"\\\\u0088\",\"\\u0089\":\"\\\\u0089\",\"\\u008a\":\"\\\\u008a\",\n\"\\u008b\":\"\\\\u008b\",\"\\u008c\":\"\\\\u008c\",\"\\u008d\":\"\\\\u008d\",\"\\u008e\":\"\\\\u008e\",\n\"\\u008f\":\"\\\\u008f\",\"\\u0090\":\"\\\\u0090\",\"\\u0091\":\"\\\\u0091\",\"\\u0092\":\"\\\\u0092\",\n\"\\u0093\":\"\\\\u0093\",\"\\u0094\":\"\\\\u0094\",\"\\u0095\":\"\\\\u0095\",\"\\u0096\":\"\\\\u0096\",\n\"\\u0097\":\"\\\\u0097\",\"\\u0098\":\"\\\\u0098\",\"\\u0099\":\"\\\\u0099\",\"\\u009a\":\"\\\\u009a\",\n\"\\u009b\":\"\\\\u009b\",\"\\u009c\":\"\\\\u009c\",\"\\u009d\":\"\\\\u009d\",\"\\u009e\":\"\\\\u009e\",\n\"\\u009f\":\"\\\\u009f\",\"\\u00ad\":\"\\\\u00ad\",\"\\u0600\":\"\\\\u0600\",\"\\u0601\":\"\\\\u0601\",\n\"\\u0602\":\"\\\\u0602\",\"\\u0603\":\"\\\\u0603\",\"\\u0604\":\"\\\\u0604\",\"\\u070f\":\"\\\\u070f\",\n\"\\u17b4\":\"\\\\u17b4\",\"\\u17b5\":\"\\\\u17b5\",\"\\u200c\":\"\\\\u200c\",\"\\u200d\":\"\\\\u200d\",\n\"\\u200e\":\"\\\\u200e\",\"\\u200f\":\"\\\\u200f\",\"\\u2028\":\"\\\\u2028\",\"\\u2029\":\"\\\\u2029\",\n\"\\u202a\":\"\\\\u202a\",\"\\u202b\":\"\\\\u202b\",\"\\u202c\":\"\\\\u202c\",\"\\u202d\":\"\\\\u202d\",\n\"\\u202e\":\"\\\\u202e\",\"\\u202f\":\"\\\\u202f\",\"\\u2060\":\"\\\\u2060\",\"\\u2061\":\"\\\\u2061\",\n\"\\u2062\":\"\\\\u2062\",\"\\u2063\":\"\\\\u2063\",\"\\u2064\":\"\\\\u2064\",\"\\u2065\":\"\\\\u2065\",\n\"\\u2066\":\"\\\\u2066\",\"\\u2067\":\"\\\\u2067\",\"\\u2068\":\"\\\\u2068\",\"\\u2069\":\"\\\\u2069\",\n\"\\u206a\":\"\\\\u206a\",\"\\u206b\":\"\\\\u206b\",\"\\u206c\":\"\\\\u206c\",\"\\u206d\":\"\\\\u206d\",\n\"\\u206e\":\"\\\\u206e\",\"\\u206f\":\"\\\\u206f\",\"\\ufeff\":\"\\\\ufeff\",\"\\ufff0\":\"\\\\ufff0\",\n\"\\ufff1\":\"\\\\ufff1\",\"\\ufff2\":\"\\\\ufff2\",\"\\ufff3\":\"\\\\ufff3\",\"\\ufff4\":\"\\\\ufff4\",\n\"\\ufff5\":\"\\\\ufff5\",\"\\ufff6\":\"\\\\ufff6\",\"\\ufff7\":\"\\\\ufff7\",\"\\ufff8\":\"\\\\ufff8\",\n\"\\ufff9\":\"\\\\ufff9\",\"\\ufffa\":\"\\\\ufffa\",\"\\ufffb\":\"\\\\ufffb\",\"\\ufffc\":\"\\\\ufffc\",\n\"\\ufffd\":\"\\\\ufffd\",\"\\ufffe\":\"\\\\ufffe\",\"\\uffff\":\"\\\\uffff\"};\n\n// Some extra characters that Chrome gets wrong, and substitutes with\n// something else on the wire.\nvar extra_escapable = /[\\x00-\\x1f\\ud800-\\udfff\\ufffe\\uffff\\u0300-\\u0333\\u033d-\\u0346\\u034a-\\u034c\\u0350-\\u0352\\u0357-\\u0358\\u035c-\\u0362\\u0374\\u037e\\u0387\\u0591-\\u05af\\u05c4\\u0610-\\u0617\\u0653-\\u0654\\u0657-\\u065b\\u065d-\\u065e\\u06df-\\u06e2\\u06eb-\\u06ec\\u0730\\u0732-\\u0733\\u0735-\\u0736\\u073a\\u073d\\u073f-\\u0741\\u0743\\u0745\\u0747\\u07eb-\\u07f1\\u0951\\u0958-\\u095f\\u09dc-\\u09dd\\u09df\\u0a33\\u0a36\\u0a59-\\u0a5b\\u0a5e\\u0b5c-\\u0b5d\\u0e38-\\u0e39\\u0f43\\u0f4d\\u0f52\\u0f57\\u0f5c\\u0f69\\u0f72-\\u0f76\\u0f78\\u0f80-\\u0f83\\u0f93\\u0f9d\\u0fa2\\u0fa7\\u0fac\\u0fb9\\u1939-\\u193a\\u1a17\\u1b6b\\u1cda-\\u1cdb\\u1dc0-\\u1dcf\\u1dfc\\u1dfe\\u1f71\\u1f73\\u1f75\\u1f77\\u1f79\\u1f7b\\u1f7d\\u1fbb\\u1fbe\\u1fc9\\u1fcb\\u1fd3\\u1fdb\\u1fe3\\u1feb\\u1fee-\\u1fef\\u1ff9\\u1ffb\\u1ffd\\u2000-\\u2001\\u20d0-\\u20d1\\u20d4-\\u20d7\\u20e7-\\u20e9\\u2126\\u212a-\\u212b\\u2329-\\u232a\\u2adc\\u302b-\\u302c\\uaab2-\\uaab3\\uf900-\\ufa0d\\ufa10\\ufa12\\ufa15-\\ufa1e\\ufa20\\ufa22\\ufa25-\\ufa26\\ufa2a-\\ufa2d\\ufa30-\\ufa6d\\ufa70-\\ufad9\\ufb1d\\ufb1f\\ufb2a-\\ufb36\\ufb38-\\ufb3c\\ufb3e\\ufb40-\\ufb41\\ufb43-\\ufb44\\ufb46-\\ufb4e\\ufff0-\\uffff]/g,\n    extra_lookup;\n\n// JSON Quote string. Use native implementation when possible.\nvar JSONQuote = (JSON && JSON.stringify) || function(string) {\n    json_escapable.lastIndex = 0;\n    if (json_escapable.test(string)) {\n        string = string.replace(json_escapable, function(a) {\n            return json_lookup[a];\n        });\n    }\n    return '\"' + string + '\"';\n};\n\n// This may be quite slow, so let's delay until user actually uses bad\n// characters.\nvar unroll_lookup = function(escapable) {\n    var i;\n    var unrolled = {}\n    var c = []\n    for(i=0; i<65536; i++) {\n        c.push( String.fromCharCode(i) );\n    }\n    escapable.lastIndex = 0;\n    c.join('').replace(escapable, function (a) {\n        unrolled[ a ] = '\\\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n        return '';\n    });\n    escapable.lastIndex = 0;\n    return unrolled;\n};\n\n// Quote string, also taking care of unicode characters that browsers\n// often break. Especially, take care of unicode surrogates:\n//    http://en.wikipedia.org/wiki/Mapping_of_Unicode_characters#Surrogates\nutils.quote = function(string) {\n    var quoted = JSONQuote(string);\n\n    // In most cases this should be very fast and good enough.\n    extra_escapable.lastIndex = 0;\n    if(!extra_escapable.test(quoted)) {\n        return quoted;\n    }\n\n    if(!extra_lookup) extra_lookup = unroll_lookup(extra_escapable);\n\n    return quoted.replace(extra_escapable, function(a) {\n        return extra_lookup[a];\n    });\n}\n\nvar _all_protocols = ['websocket',\n                      'xdr-streaming',\n                      'xhr-streaming',\n                      'iframe-eventsource',\n                      'iframe-htmlfile',\n                      'xdr-polling',\n                      'xhr-polling',\n                      'iframe-xhr-polling',\n                      'jsonp-polling'];\n\nutils.probeProtocols = function() {\n    var probed = {};\n    for(var i=0; i<_all_protocols.length; i++) {\n        var protocol = _all_protocols[i];\n        // User can have a typo in protocol name.\n        probed[protocol] = SockJS[protocol] &&\n                           SockJS[protocol].enabled();\n    }\n    return probed;\n};\n\nutils.detectProtocols = function(probed, protocols_whitelist, info) {\n    var pe = {},\n        protocols = [];\n    if (!protocols_whitelist) protocols_whitelist = _all_protocols;\n    for(var i=0; i<protocols_whitelist.length; i++) {\n        var protocol = protocols_whitelist[i];\n        pe[protocol] = probed[protocol];\n    }\n    var maybe_push = function(protos) {\n        var proto = protos.shift();\n        if (pe[proto]) {\n            protocols.push(proto);\n        } else {\n            if (protos.length > 0) {\n                maybe_push(protos);\n            }\n        }\n    }\n\n    // 1. Websocket\n    if (info.websocket !== false) {\n        maybe_push(['websocket']);\n    }\n\n    // 2. Streaming\n    if (pe['xhr-streaming'] && !info.null_origin) {\n        protocols.push('xhr-streaming');\n    } else {\n        if (pe['xdr-streaming'] && !info.cookie_needed && !info.null_origin) {\n            protocols.push('xdr-streaming');\n        } else {\n            maybe_push(['iframe-eventsource',\n                        'iframe-htmlfile']);\n        }\n    }\n\n    // 3. Polling\n    if (pe['xhr-polling'] && !info.null_origin) {\n        protocols.push('xhr-polling');\n    } else {\n        if (pe['xdr-polling'] && !info.cookie_needed && !info.null_origin) {\n            protocols.push('xdr-polling');\n        } else {\n            maybe_push(['iframe-xhr-polling',\n                        'jsonp-polling']);\n        }\n    }\n    return protocols;\n}\n//         [*] End of lib/utils.js\n\n\n//         [*] Including lib/dom.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\n// May be used by htmlfile jsonp and transports.\nvar MPrefix = '_sockjs_global';\nutils.createHook = function() {\n    var window_id = 'a' + utils.random_string(8);\n    if (!(MPrefix in _window)) {\n        var map = {};\n        _window[MPrefix] = function(window_id) {\n            if (!(window_id in map)) {\n                map[window_id] = {\n                    id: window_id,\n                    del: function() {delete map[window_id];}\n                };\n            }\n            return map[window_id];\n        }\n    }\n    return _window[MPrefix](window_id);\n};\n\n\n\nutils.attachMessage = function(listener) {\n    utils.attachEvent('message', listener);\n};\nutils.attachEvent = function(event, listener) {\n    if (typeof _window.addEventListener !== 'undefined') {\n        _window.addEventListener(event, listener, false);\n    } else {\n        // IE quirks.\n        // According to: http://stevesouders.com/misc/test-postmessage.php\n        // the message gets delivered only to 'document', not 'window'.\n        _document.attachEvent(\"on\" + event, listener);\n        // I get 'window' for ie8.\n        _window.attachEvent(\"on\" + event, listener);\n    }\n};\n\nutils.detachMessage = function(listener) {\n    utils.detachEvent('message', listener);\n};\nutils.detachEvent = function(event, listener) {\n    if (typeof _window.addEventListener !== 'undefined') {\n        _window.removeEventListener(event, listener, false);\n    } else {\n        _document.detachEvent(\"on\" + event, listener);\n        _window.detachEvent(\"on\" + event, listener);\n    }\n};\n\n\nvar on_unload = {};\n// Things registered after beforeunload are to be called immediately.\nvar after_unload = false;\n\nvar trigger_unload_callbacks = function() {\n    for(var ref in on_unload) {\n        on_unload[ref]();\n        delete on_unload[ref];\n    };\n};\n\nvar unload_triggered = function() {\n    if(after_unload) return;\n    after_unload = true;\n    trigger_unload_callbacks();\n};\n\n// 'unload' alone is not reliable in opera within an iframe, but we\n// can't use `beforeunload` as IE fires it on javascript: links.\nutils.attachEvent('unload', unload_triggered);\n\nutils.unload_add = function(listener) {\n    var ref = utils.random_string(8);\n    on_unload[ref] = listener;\n    if (after_unload) {\n        utils.delay(trigger_unload_callbacks);\n    }\n    return ref;\n};\nutils.unload_del = function(ref) {\n    if (ref in on_unload)\n        delete on_unload[ref];\n};\n\n\nutils.createIframe = function (iframe_url, error_callback) {\n    var iframe = _document.createElement('iframe');\n    var tref, unload_ref;\n    var unattach = function() {\n        clearTimeout(tref);\n        // Explorer had problems with that.\n        try {iframe.onload = null;} catch (x) {}\n        iframe.onerror = null;\n    };\n    var cleanup = function() {\n        if (iframe) {\n            unattach();\n            // This timeout makes chrome fire onbeforeunload event\n            // within iframe. Without the timeout it goes straight to\n            // onunload.\n            setTimeout(function() {\n                if(iframe) {\n                    iframe.parentNode.removeChild(iframe);\n                }\n                iframe = null;\n            }, 0);\n            utils.unload_del(unload_ref);\n        }\n    };\n    var onerror = function(r) {\n        if (iframe) {\n            cleanup();\n            error_callback(r);\n        }\n    };\n    var post = function(msg, origin) {\n        try {\n            // When the iframe is not loaded, IE raises an exception\n            // on 'contentWindow'.\n            if (iframe && iframe.contentWindow) {\n                iframe.contentWindow.postMessage(msg, origin);\n            }\n        } catch (x) {};\n    };\n\n    iframe.src = iframe_url;\n    iframe.style.display = 'none';\n    iframe.style.position = 'absolute';\n    iframe.onerror = function(){onerror('onerror');};\n    iframe.onload = function() {\n        // `onload` is triggered before scripts on the iframe are\n        // executed. Give it few seconds to actually load stuff.\n        clearTimeout(tref);\n        tref = setTimeout(function(){onerror('onload timeout');}, 2000);\n    };\n    _document.body.appendChild(iframe);\n    tref = setTimeout(function(){onerror('timeout');}, 15000);\n    unload_ref = utils.unload_add(cleanup);\n    return {\n        post: post,\n        cleanup: cleanup,\n        loaded: unattach\n    };\n};\n\nutils.createHtmlfile = function (iframe_url, error_callback) {\n    var doc = new ActiveXObject('htmlfile');\n    var tref, unload_ref;\n    var iframe;\n    var unattach = function() {\n        clearTimeout(tref);\n    };\n    var cleanup = function() {\n        if (doc) {\n            unattach();\n            utils.unload_del(unload_ref);\n            iframe.parentNode.removeChild(iframe);\n            iframe = doc = null;\n            CollectGarbage();\n        }\n    };\n    var onerror = function(r)  {\n        if (doc) {\n            cleanup();\n            error_callback(r);\n        }\n    };\n    var post = function(msg, origin) {\n        try {\n            // When the iframe is not loaded, IE raises an exception\n            // on 'contentWindow'.\n            if (iframe && iframe.contentWindow) {\n                iframe.contentWindow.postMessage(msg, origin);\n            }\n        } catch (x) {};\n    };\n\n    doc.open();\n    doc.write('<html><s' + 'cript>' +\n              'document.domain=\"' + document.domain + '\";' +\n              '</s' + 'cript></html>');\n    doc.close();\n    doc.parentWindow[WPrefix] = _window[WPrefix];\n    var c = doc.createElement('div');\n    doc.body.appendChild(c);\n    iframe = doc.createElement('iframe');\n    c.appendChild(iframe);\n    iframe.src = iframe_url;\n    tref = setTimeout(function(){onerror('timeout');}, 15000);\n    unload_ref = utils.unload_add(cleanup);\n    return {\n        post: post,\n        cleanup: cleanup,\n        loaded: unattach\n    };\n};\n//         [*] End of lib/dom.js\n\n\n//         [*] Including lib/dom2.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\nvar AbstractXHRObject = function(){};\nAbstractXHRObject.prototype = new EventEmitter(['chunk', 'finish']);\n\nAbstractXHRObject.prototype._start = function(method, url, payload, opts) {\n    var that = this;\n\n    try {\n        that.xhr = new XMLHttpRequest();\n    } catch(x) {};\n\n    if (!that.xhr) {\n        try {\n            that.xhr = new _window.ActiveXObject('Microsoft.XMLHTTP');\n        } catch(x) {};\n    }\n    if (_window.ActiveXObject || _window.XDomainRequest) {\n        // IE8 caches even POSTs\n        url += ((url.indexOf('?') === -1) ? '?' : '&') + 't='+(+new Date);\n    }\n\n    // Explorer tends to keep connection open, even after the\n    // tab gets closed: http://bugs.jquery.com/ticket/5280\n    that.unload_ref = utils.unload_add(function(){that._cleanup(true);});\n    try {\n        that.xhr.open(method, url, true);\n    } catch(e) {\n        // IE raises an exception on wrong port.\n        that.emit('finish', 0, '');\n        that._cleanup();\n        return;\n    };\n\n    if (!opts || !opts.no_credentials) {\n        // Mozilla docs says https://developer.mozilla.org/en/XMLHttpRequest :\n        // \"This never affects same-site requests.\"\n        that.xhr.withCredentials = 'true';\n    }\n    if (opts && opts.headers) {\n        for(var key in opts.headers) {\n            that.xhr.setRequestHeader(key, opts.headers[key]);\n        }\n    }\n\n    that.xhr.onreadystatechange = function() {\n        if (that.xhr) {\n            var x = that.xhr;\n            switch (x.readyState) {\n            case 3:\n                // IE doesn't like peeking into responseText or status\n                // on Microsoft.XMLHTTP and readystate=3\n                try {\n                    var status = x.status;\n                    var text = x.responseText;\n                } catch (x) {};\n                // IE returns 1223 for 204: http://bugs.jquery.com/ticket/1450\n                if (status === 1223) status = 204;\n\n                // IE does return readystate == 3 for 404 answers.\n                if (text && text.length > 0) {\n                    that.emit('chunk', status, text);\n                }\n                break;\n            case 4:\n                var status = x.status;\n                // IE returns 1223 for 204: http://bugs.jquery.com/ticket/1450\n                if (status === 1223) status = 204;\n\n                that.emit('finish', status, x.responseText);\n                that._cleanup(false);\n                break;\n            }\n        }\n    };\n    that.xhr.send(payload);\n};\n\nAbstractXHRObject.prototype._cleanup = function(abort) {\n    var that = this;\n    if (!that.xhr) return;\n    utils.unload_del(that.unload_ref);\n\n    // IE needs this field to be a function\n    that.xhr.onreadystatechange = function(){};\n\n    if (abort) {\n        try {\n            that.xhr.abort();\n        } catch(x) {};\n    }\n    that.unload_ref = that.xhr = null;\n};\n\nAbstractXHRObject.prototype.close = function() {\n    var that = this;\n    that.nuke();\n    that._cleanup(true);\n};\n\nvar XHRCorsObject = utils.XHRCorsObject = function() {\n    var that = this, args = arguments;\n    utils.delay(function(){that._start.apply(that, args);});\n};\nXHRCorsObject.prototype = new AbstractXHRObject();\n\nvar XHRLocalObject = utils.XHRLocalObject = function(method, url, payload) {\n    var that = this;\n    utils.delay(function(){\n        that._start(method, url, payload, {\n            no_credentials: true\n        });\n    });\n};\nXHRLocalObject.prototype = new AbstractXHRObject();\n\n\n\n// References:\n//   http://ajaxian.com/archives/100-line-ajax-wrapper\n//   http://msdn.microsoft.com/en-us/library/cc288060(v=VS.85).aspx\nvar XDRObject = utils.XDRObject = function(method, url, payload) {\n    var that = this;\n    utils.delay(function(){that._start(method, url, payload);});\n};\nXDRObject.prototype = new EventEmitter(['chunk', 'finish']);\nXDRObject.prototype._start = function(method, url, payload) {\n    var that = this;\n    var xdr = new XDomainRequest();\n    // IE caches even POSTs\n    url += ((url.indexOf('?') === -1) ? '?' : '&') + 't='+(+new Date);\n\n    var onerror = xdr.ontimeout = xdr.onerror = function() {\n        that.emit('finish', 0, '');\n        that._cleanup(false);\n    };\n    xdr.onprogress = function() {\n        that.emit('chunk', 200, xdr.responseText);\n    };\n    xdr.onload = function() {\n        that.emit('finish', 200, xdr.responseText);\n        that._cleanup(false);\n    };\n    that.xdr = xdr;\n    that.unload_ref = utils.unload_add(function(){that._cleanup(true);});\n    try {\n        // Fails with AccessDenied if port number is bogus\n        that.xdr.open(method, url);\n        that.xdr.send(payload);\n    } catch(x) {\n        onerror();\n    }\n};\n\nXDRObject.prototype._cleanup = function(abort) {\n    var that = this;\n    if (!that.xdr) return;\n    utils.unload_del(that.unload_ref);\n\n    that.xdr.ontimeout = that.xdr.onerror = that.xdr.onprogress =\n        that.xdr.onload = null;\n    if (abort) {\n        try {\n            that.xdr.abort();\n        } catch(x) {};\n    }\n    that.unload_ref = that.xdr = null;\n};\n\nXDRObject.prototype.close = function() {\n    var that = this;\n    that.nuke();\n    that._cleanup(true);\n};\n\n// 1. Is natively via XHR\n// 2. Is natively via XDR\n// 3. Nope, but postMessage is there so it should work via the Iframe.\n// 4. Nope, sorry.\nutils.isXHRCorsCapable = function() {\n    if (_window.XMLHttpRequest && 'withCredentials' in new XMLHttpRequest()) {\n        return 1;\n    }\n    // XDomainRequest doesn't work if page is served from file://\n    if (_window.XDomainRequest && _document.domain) {\n        return 2;\n    }\n    if (IframeTransport.enabled()) {\n        return 3;\n    }\n    return 4;\n};\n//         [*] End of lib/dom2.js\n\n\n//         [*] Including lib/sockjs.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\nvar SockJS = function(url, dep_protocols_whitelist, options) {\n    if (!(this instanceof SockJS)) {\n        // makes `new` optional\n        return new SockJS(url, dep_protocols_whitelist, options);\n    }\n\n    var that = this, protocols_whitelist;\n    that._options = {devel: false, debug: false, protocols_whitelist: [],\n                     info: undefined, rtt: undefined};\n    if (options) {\n        utils.objectExtend(that._options, options);\n    }\n    that._base_url = utils.amendUrl(url);\n    that._server = that._options.server || utils.random_number_string(1000);\n    if (that._options.protocols_whitelist &&\n        that._options.protocols_whitelist.length) {\n        protocols_whitelist = that._options.protocols_whitelist;\n    } else {\n        // Deprecated API\n        if (typeof dep_protocols_whitelist === 'string' &&\n            dep_protocols_whitelist.length > 0) {\n            protocols_whitelist = [dep_protocols_whitelist];\n        } else if (utils.isArray(dep_protocols_whitelist)) {\n            protocols_whitelist = dep_protocols_whitelist\n        } else {\n            protocols_whitelist = null;\n        }\n        if (protocols_whitelist) {\n            that._debug('Deprecated API: Use \"protocols_whitelist\" option ' +\n                        'instead of supplying protocol list as a second ' +\n                        'parameter to SockJS constructor.');\n        }\n    }\n    that._protocols = [];\n    that.protocol = null;\n    that.readyState = SockJS.CONNECTING;\n    that._ir = createInfoReceiver(that._base_url);\n    that._ir.onfinish = function(info, rtt) {\n        that._ir = null;\n        if (info) {\n            if (that._options.info) {\n                // Override if user supplies the option\n                info = utils.objectExtend(info, that._options.info);\n            }\n            if (that._options.rtt) {\n                rtt = that._options.rtt;\n            }\n            that._applyInfo(info, rtt, protocols_whitelist);\n            that._didClose();\n        } else {\n            that._didClose(1002, 'Can\\'t connect to server', true);\n        }\n    };\n};\n// Inheritance\nSockJS.prototype = new REventTarget();\n\nSockJS.version = \"0.3.4\";\n\nSockJS.CONNECTING = 0;\nSockJS.OPEN = 1;\nSockJS.CLOSING = 2;\nSockJS.CLOSED = 3;\n\nSockJS.prototype._debug = function() {\n    if (this._options.debug)\n        utils.log.apply(utils, arguments);\n};\n\nSockJS.prototype._dispatchOpen = function() {\n    var that = this;\n    if (that.readyState === SockJS.CONNECTING) {\n        if (that._transport_tref) {\n            clearTimeout(that._transport_tref);\n            that._transport_tref = null;\n        }\n        that.readyState = SockJS.OPEN;\n        that.dispatchEvent(new SimpleEvent(\"open\"));\n    } else {\n        // The server might have been restarted, and lost track of our\n        // connection.\n        that._didClose(1006, \"Server lost session\");\n    }\n};\n\nSockJS.prototype._dispatchMessage = function(data) {\n    var that = this;\n    if (that.readyState !== SockJS.OPEN)\n            return;\n    that.dispatchEvent(new SimpleEvent(\"message\", {data: data}));\n};\n\nSockJS.prototype._dispatchHeartbeat = function(data) {\n    var that = this;\n    if (that.readyState !== SockJS.OPEN)\n        return;\n    that.dispatchEvent(new SimpleEvent('heartbeat', {}));\n};\n\nSockJS.prototype._didClose = function(code, reason, force) {\n    var that = this;\n    if (that.readyState !== SockJS.CONNECTING &&\n        that.readyState !== SockJS.OPEN &&\n        that.readyState !== SockJS.CLOSING) {\n        utils.debug('INVALID_STATE_ERR', that.readyState);\n        return;\n    }\n    if (that._ir) {\n        that._ir.nuke();\n        that._ir = null;\n    }\n\n    if (that._transport) {\n        that._transport.doCleanup();\n        that._transport = null;\n    }\n\n    var close_event = new SimpleEvent(\"close\", {\n        code: code,\n        reason: reason,\n        wasClean: utils.userSetCode(code)});\n\n    if (!utils.userSetCode(code) &&\n        that.readyState === SockJS.CONNECTING && !force) {\n        if (that._try_next_protocol(close_event)) {\n            return;\n        }\n        close_event = new SimpleEvent(\"close\", {code: 2000,\n                                                reason: \"All transports failed\",\n                                                wasClean: false,\n                                                last_event: close_event});\n    }\n    that.readyState = SockJS.CLOSED;\n\n    utils.delay(function() {\n                   that.dispatchEvent(close_event);\n                });\n};\n\nSockJS.prototype._didMessage = function(data) {\n    var that = this;\n    var type = data.slice(0, 1);\n    switch(type) {\n    case 'o':\n        that._dispatchOpen();\n        break;\n    case 'a':\n        var payload = JSON.parse(data.slice(1) || '[]');\n        for(var i=0; i < payload.length; i++){\n            that._dispatchMessage(payload[i]);\n        }\n        break;\n    case 'm':\n        var payload = JSON.parse(data.slice(1) || 'null');\n        that._dispatchMessage(payload);\n        break;\n    case 'c':\n        var payload = JSON.parse(data.slice(1) || '[]');\n        that._didClose(payload[0], payload[1]);\n        break;\n    case 'h':\n        that._dispatchHeartbeat();\n        break;\n    }\n};\n\nSockJS.prototype._try_next_protocol = function(close_event) {\n    var that = this;\n    if (that.protocol) {\n        that._debug('Closed transport:', that.protocol, ''+close_event);\n        that.protocol = null;\n    }\n    if (that._transport_tref) {\n        clearTimeout(that._transport_tref);\n        that._transport_tref = null;\n    }\n\n    while(1) {\n        var protocol = that.protocol = that._protocols.shift();\n        if (!protocol) {\n            return false;\n        }\n        // Some protocols require access to `body`, what if were in\n        // the `head`?\n        if (SockJS[protocol] &&\n            SockJS[protocol].need_body === true &&\n            (!_document.body ||\n             (typeof _document.readyState !== 'undefined'\n              && _document.readyState !== 'complete'))) {\n            that._protocols.unshift(protocol);\n            that.protocol = 'waiting-for-load';\n            utils.attachEvent('load', function(){\n                that._try_next_protocol();\n            });\n            return true;\n        }\n\n        if (!SockJS[protocol] ||\n              !SockJS[protocol].enabled(that._options)) {\n            that._debug('Skipping transport:', protocol);\n        } else {\n            var roundTrips = SockJS[protocol].roundTrips || 1;\n            var to = ((that._options.rto || 0) * roundTrips) || 5000;\n            that._transport_tref = utils.delay(to, function() {\n                if (that.readyState === SockJS.CONNECTING) {\n                    // I can't understand how it is possible to run\n                    // this timer, when the state is CLOSED, but\n                    // apparently in IE everythin is possible.\n                    that._didClose(2007, \"Transport timeouted\");\n                }\n            });\n\n            var connid = utils.random_string(8);\n            var trans_url = that._base_url + '/' + that._server + '/' + connid;\n            that._debug('Opening transport:', protocol, ' url:'+trans_url,\n                        ' RTO:'+that._options.rto);\n            that._transport = new SockJS[protocol](that, trans_url,\n                                                   that._base_url);\n            return true;\n        }\n    }\n};\n\nSockJS.prototype.close = function(code, reason) {\n    var that = this;\n    if (code && !utils.userSetCode(code))\n        throw new Error(\"INVALID_ACCESS_ERR\");\n    if(that.readyState !== SockJS.CONNECTING &&\n       that.readyState !== SockJS.OPEN) {\n        return false;\n    }\n    that.readyState = SockJS.CLOSING;\n    that._didClose(code || 1000, reason || \"Normal closure\");\n    return true;\n};\n\nSockJS.prototype.send = function(data) {\n    var that = this;\n    if (that.readyState === SockJS.CONNECTING)\n        throw new Error('INVALID_STATE_ERR');\n    if (that.readyState === SockJS.OPEN) {\n        that._transport.doSend(utils.quote('' + data));\n    }\n    return true;\n};\n\nSockJS.prototype._applyInfo = function(info, rtt, protocols_whitelist) {\n    var that = this;\n    that._options.info = info;\n    that._options.rtt = rtt;\n    that._options.rto = utils.countRTO(rtt);\n    that._options.info.null_origin = !_document.domain;\n    // Servers can override base_url, eg to provide a randomized domain name and\n    // avoid browser per-domain connection limits.\n    if (info.base_url)\n      // <METEOR>\n      that._base_url = utils.amendUrl(info.base_url, that._base_url);\n      // </METEOR>\n    var probed = utils.probeProtocols();\n    that._protocols = utils.detectProtocols(probed, protocols_whitelist, info);\n// <METEOR>\n// https://github.com/sockjs/sockjs-client/issues/79\n    // Hack to avoid XDR when using different protocols\n    // We're on IE trying to do cross-protocol. jsonp only.\n    if (!utils.isSameOriginScheme(that._base_url) &&\n        2 === utils.isXHRCorsCapable()) {\n        that._protocols = ['jsonp-polling'];\n    }\n// </METEOR>\n};\n//         [*] End of lib/sockjs.js\n\n\n//         [*] Including lib/trans-websocket.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\nvar WebSocketTransport = SockJS.websocket = function(ri, trans_url) {\n    var that = this;\n    var url = trans_url + '/websocket';\n    if (url.slice(0, 5) === 'https') {\n        url = 'wss' + url.slice(5);\n    } else {\n        url = 'ws' + url.slice(4);\n    }\n    that.ri = ri;\n    that.url = url;\n    var Constructor = _window.WebSocket || _window.MozWebSocket;\n\n    that.ws = new Constructor(that.url);\n    that.ws.onmessage = function(e) {\n        that.ri._didMessage(e.data);\n    };\n    // Firefox has an interesting bug. If a websocket connection is\n    // created after onunload, it stays alive even when user\n    // navigates away from the page. In such situation let's lie -\n    // let's not open the ws connection at all. See:\n    // https://github.com/sockjs/sockjs-client/issues/28\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=696085\n    that.unload_ref = utils.unload_add(function(){that.ws.close()});\n    that.ws.onclose = function() {\n        that.ri._didMessage(utils.closeFrame(1006, \"WebSocket connection broken\"));\n    };\n};\n\nWebSocketTransport.prototype.doSend = function(data) {\n    this.ws.send('[' + data + ']');\n};\n\nWebSocketTransport.prototype.doCleanup = function() {\n    var that = this;\n    var ws = that.ws;\n    if (ws) {\n        ws.onmessage = ws.onclose = null;\n        ws.close();\n        utils.unload_del(that.unload_ref);\n        that.unload_ref = that.ri = that.ws = null;\n    }\n};\n\nWebSocketTransport.enabled = function() {\n    return !!(_window.WebSocket || _window.MozWebSocket);\n};\n\n// In theory, ws should require 1 round trip. But in chrome, this is\n// not very stable over SSL. Most likely a ws connection requires a\n// separate SSL connection, in which case 2 round trips are an\n// absolute minumum.\nWebSocketTransport.roundTrips = 2;\n//         [*] End of lib/trans-websocket.js\n\n\n//         [*] Including lib/trans-sender.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\nvar BufferedSender = function() {};\nBufferedSender.prototype.send_constructor = function(sender) {\n    var that = this;\n    that.send_buffer = [];\n    that.sender = sender;\n};\nBufferedSender.prototype.doSend = function(message) {\n    var that = this;\n    that.send_buffer.push(message);\n    if (!that.send_stop) {\n        that.send_schedule();\n    }\n};\n\n// For polling transports in a situation when in the message callback,\n// new message is being send. If the sending connection was started\n// before receiving one, it is possible to saturate the network and\n// timeout due to the lack of receiving socket. To avoid that we delay\n// sending messages by some small time, in order to let receiving\n// connection be started beforehand. This is only a halfmeasure and\n// does not fix the big problem, but it does make the tests go more\n// stable on slow networks.\nBufferedSender.prototype.send_schedule_wait = function() {\n    var that = this;\n    var tref;\n    that.send_stop = function() {\n        that.send_stop = null;\n        clearTimeout(tref);\n    };\n    tref = utils.delay(25, function() {\n        that.send_stop = null;\n        that.send_schedule();\n    });\n};\n\nBufferedSender.prototype.send_schedule = function() {\n    var that = this;\n    if (that.send_buffer.length > 0) {\n        var payload = '[' + that.send_buffer.join(',') + ']';\n        that.send_stop = that.sender(that.trans_url, payload, function(success, abort_reason) {\n            that.send_stop = null;\n            if (success === false) {\n                that.ri._didClose(1006, 'Sending error ' + abort_reason);\n            } else {\n                that.send_schedule_wait();\n            }\n        });\n        that.send_buffer = [];\n    }\n};\n\nBufferedSender.prototype.send_destructor = function() {\n    var that = this;\n    if (that._send_stop) {\n        that._send_stop();\n    }\n    that._send_stop = null;\n};\n\nvar jsonPGenericSender = function(url, payload, callback) {\n    var that = this;\n\n    if (!('_send_form' in that)) {\n        var form = that._send_form = _document.createElement('form');\n        var area = that._send_area = _document.createElement('textarea');\n        area.name = 'd';\n        form.style.display = 'none';\n        form.style.position = 'absolute';\n        form.method = 'POST';\n        form.enctype = 'application/x-www-form-urlencoded';\n        form.acceptCharset = \"UTF-8\";\n        form.appendChild(area);\n        _document.body.appendChild(form);\n    }\n    var form = that._send_form;\n    var area = that._send_area;\n    var id = 'a' + utils.random_string(8);\n    form.target = id;\n    form.action = url + '/jsonp_send?i=' + id;\n\n    var iframe;\n    try {\n        // ie6 dynamic iframes with target=\"\" support (thanks Chris Lambacher)\n        iframe = _document.createElement('<iframe name=\"'+ id +'\">');\n    } catch(x) {\n        iframe = _document.createElement('iframe');\n        iframe.name = id;\n    }\n    iframe.id = id;\n    form.appendChild(iframe);\n    iframe.style.display = 'none';\n\n    try {\n        area.value = payload;\n    } catch(e) {\n        utils.log('Your browser is seriously broken. Go home! ' + e.message);\n    }\n    form.submit();\n\n    var completed = function(e) {\n        if (!iframe.onerror) return;\n        iframe.onreadystatechange = iframe.onerror = iframe.onload = null;\n        // Opera mini doesn't like if we GC iframe\n        // immediately, thus this timeout.\n        utils.delay(500, function() {\n                       iframe.parentNode.removeChild(iframe);\n                       iframe = null;\n                   });\n        area.value = '';\n        // It is not possible to detect if the iframe succeeded or\n        // failed to submit our form.\n        callback(true);\n    };\n    iframe.onerror = iframe.onload = completed;\n    iframe.onreadystatechange = function(e) {\n        if (iframe.readyState == 'complete') completed();\n    };\n    return completed;\n};\n\nvar createAjaxSender = function(AjaxObject) {\n    return function(url, payload, callback) {\n        var xo = new AjaxObject('POST', url + '/xhr_send', payload);\n        xo.onfinish = function(status, text) {\n            callback(status === 200 || status === 204,\n                     'http status ' + status);\n        };\n        return function(abort_reason) {\n            callback(false, abort_reason);\n        };\n    };\n};\n//         [*] End of lib/trans-sender.js\n\n\n//         [*] Including lib/trans-jsonp-receiver.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\n// Parts derived from Socket.io:\n//    https://github.com/LearnBoost/socket.io/blob/0.6.17/lib/socket.io/transports/jsonp-polling.js\n// and jQuery-JSONP:\n//    https://code.google.com/p/jquery-jsonp/source/browse/trunk/core/jquery.jsonp.js\nvar jsonPGenericReceiver = function(url, callback) {\n    var tref;\n    var script = _document.createElement('script');\n    var script2;  // Opera synchronous load trick.\n    var close_script = function(frame) {\n        if (script2) {\n            script2.parentNode.removeChild(script2);\n            script2 = null;\n        }\n        if (script) {\n            clearTimeout(tref);\n            // Unfortunately, you can't really abort script loading of\n            // the script.\n            script.parentNode.removeChild(script);\n            script.onreadystatechange = script.onerror =\n                script.onload = script.onclick = null;\n            script = null;\n            callback(frame);\n            callback = null;\n        }\n    };\n\n    // IE9 fires 'error' event after orsc or before, in random order.\n    var loaded_okay = false;\n    var error_timer = null;\n\n    script.id = 'a' + utils.random_string(8);\n    script.src = url;\n    script.type = 'text/javascript';\n    script.charset = 'UTF-8';\n    script.onerror = function(e) {\n        if (!error_timer) {\n            // Delay firing close_script.\n            error_timer = setTimeout(function() {\n                if (!loaded_okay) {\n                    close_script(utils.closeFrame(\n                        1006,\n                        \"JSONP script loaded abnormally (onerror)\"));\n                }\n            }, 1000);\n        }\n    };\n    script.onload = function(e) {\n        close_script(utils.closeFrame(1006, \"JSONP script loaded abnormally (onload)\"));\n    };\n\n    script.onreadystatechange = function(e) {\n        if (/loaded|closed/.test(script.readyState)) {\n            if (script && script.htmlFor && script.onclick) {\n                loaded_okay = true;\n                try {\n                    // In IE, actually execute the script.\n                    script.onclick();\n                } catch (x) {}\n            }\n            if (script) {\n                close_script(utils.closeFrame(1006, \"JSONP script loaded abnormally (onreadystatechange)\"));\n            }\n        }\n    };\n    // IE: event/htmlFor/onclick trick.\n    // One can't rely on proper order for onreadystatechange. In order to\n    // make sure, set a 'htmlFor' and 'event' properties, so that\n    // script code will be installed as 'onclick' handler for the\n    // script object. Later, onreadystatechange, manually execute this\n    // code. FF and Chrome doesn't work with 'event' and 'htmlFor'\n    // set. For reference see:\n    //   http://jaubourg.net/2010/07/loading-script-as-onclick-handler-of.html\n    // Also, read on that about script ordering:\n    //   http://wiki.whatwg.org/wiki/Dynamic_Script_Execution_Order\n    if (typeof script.async === 'undefined' && _document.attachEvent) {\n        // According to mozilla docs, in recent browsers script.async defaults\n        // to 'true', so we may use it to detect a good browser:\n        // https://developer.mozilla.org/en/HTML/Element/script\n        if (!/opera/i.test(navigator.userAgent)) {\n            // Naively assume we're in IE\n            try {\n                script.htmlFor = script.id;\n                script.event = \"onclick\";\n            } catch (x) {}\n            script.async = true;\n        } else {\n            // Opera, second sync script hack\n            script2 = _document.createElement('script');\n            script2.text = \"try{var a = document.getElementById('\"+script.id+\"'); if(a)a.onerror();}catch(x){};\";\n            script.async = script2.async = false;\n        }\n    }\n    if (typeof script.async !== 'undefined') {\n        script.async = true;\n    }\n\n    // Fallback mostly for Konqueror - stupid timer, 35 seconds shall be plenty.\n    tref = setTimeout(function() {\n                          close_script(utils.closeFrame(1006, \"JSONP script loaded abnormally (timeout)\"));\n                      }, 35000);\n\n    var head = _document.getElementsByTagName('head')[0];\n    head.insertBefore(script, head.firstChild);\n    if (script2) {\n        head.insertBefore(script2, head.firstChild);\n    }\n    return close_script;\n};\n//         [*] End of lib/trans-jsonp-receiver.js\n\n\n//         [*] Including lib/trans-jsonp-polling.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\n// The simplest and most robust transport, using the well-know cross\n// domain hack - JSONP. This transport is quite inefficient - one\n// mssage could use up to one http request. But at least it works almost\n// everywhere.\n// Known limitations:\n//   o you will get a spinning cursor\n//   o for Konqueror a dumb timer is needed to detect errors\n\n\nvar JsonPTransport = SockJS['jsonp-polling'] = function(ri, trans_url) {\n    utils.polluteGlobalNamespace();\n    var that = this;\n    that.ri = ri;\n    that.trans_url = trans_url;\n    that.send_constructor(jsonPGenericSender);\n    that._schedule_recv();\n};\n\n// Inheritnace\nJsonPTransport.prototype = new BufferedSender();\n\nJsonPTransport.prototype._schedule_recv = function() {\n    var that = this;\n    var callback = function(data) {\n        that._recv_stop = null;\n        if (data) {\n            // no data - heartbeat;\n            if (!that._is_closing) {\n                that.ri._didMessage(data);\n            }\n        }\n        // The message can be a close message, and change is_closing state.\n        if (!that._is_closing) {\n            that._schedule_recv();\n        }\n    };\n    that._recv_stop = jsonPReceiverWrapper(that.trans_url + '/jsonp',\n                                           jsonPGenericReceiver, callback);\n};\n\nJsonPTransport.enabled = function() {\n    return true;\n};\n\nJsonPTransport.need_body = true;\n\n\nJsonPTransport.prototype.doCleanup = function() {\n    var that = this;\n    that._is_closing = true;\n    if (that._recv_stop) {\n        that._recv_stop();\n    }\n    that.ri = that._recv_stop = null;\n    that.send_destructor();\n};\n\n\n// Abstract away code that handles global namespace pollution.\nvar jsonPReceiverWrapper = function(url, constructReceiver, user_callback) {\n    var id = 'a' + utils.random_string(6);\n    var url_id = url + '?c=' + escape(WPrefix + '.' + id);\n\n    // Unfortunately it is not possible to abort loading of the\n    // script. We need to keep track of frake close frames.\n    var aborting = 0;\n\n    // Callback will be called exactly once.\n    var callback = function(frame) {\n        switch(aborting) {\n        case 0:\n            // Normal behaviour - delete hook _and_ emit message.\n            delete _window[WPrefix][id];\n            user_callback(frame);\n            break;\n        case 1:\n            // Fake close frame - emit but don't delete hook.\n            user_callback(frame);\n            aborting = 2;\n            break;\n        case 2:\n            // Got frame after connection was closed, delete hook, don't emit.\n            delete _window[WPrefix][id];\n            break;\n        }\n    };\n\n    var close_script = constructReceiver(url_id, callback);\n    _window[WPrefix][id] = close_script;\n    var stop = function() {\n        if (_window[WPrefix][id]) {\n            aborting = 1;\n            _window[WPrefix][id](utils.closeFrame(1000, \"JSONP user aborted read\"));\n        }\n    };\n    return stop;\n};\n//         [*] End of lib/trans-jsonp-polling.js\n\n\n//         [*] Including lib/trans-xhr.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\nvar AjaxBasedTransport = function() {};\nAjaxBasedTransport.prototype = new BufferedSender();\n\nAjaxBasedTransport.prototype.run = function(ri, trans_url,\n                                            url_suffix, Receiver, AjaxObject) {\n    var that = this;\n    that.ri = ri;\n    that.trans_url = trans_url;\n    that.send_constructor(createAjaxSender(AjaxObject));\n    that.poll = new Polling(ri, Receiver,\n                            trans_url + url_suffix, AjaxObject);\n};\n\nAjaxBasedTransport.prototype.doCleanup = function() {\n    var that = this;\n    if (that.poll) {\n        that.poll.abort();\n        that.poll = null;\n    }\n};\n\n// xhr-streaming\nvar XhrStreamingTransport = SockJS['xhr-streaming'] = function(ri, trans_url) {\n    this.run(ri, trans_url, '/xhr_streaming', XhrReceiver, utils.XHRCorsObject);\n};\n\nXhrStreamingTransport.prototype = new AjaxBasedTransport();\n\nXhrStreamingTransport.enabled = function() {\n    // Support for CORS Ajax aka Ajax2? Opera 12 claims CORS but\n    // doesn't do streaming.\n    return (_window.XMLHttpRequest &&\n            'withCredentials' in new XMLHttpRequest() &&\n            (!/opera/i.test(navigator.userAgent)));\n};\nXhrStreamingTransport.roundTrips = 2; // preflight, ajax\n\n// Safari gets confused when a streaming ajax request is started\n// before onload. This causes the load indicator to spin indefinetely.\nXhrStreamingTransport.need_body = true;\n\n\n// According to:\n//   http://stackoverflow.com/questions/1641507/detect-browser-support-for-cross-domain-xmlhttprequests\n//   http://hacks.mozilla.org/2009/07/cross-site-xmlhttprequest-with-cors/\n\n\n// xdr-streaming\nvar XdrStreamingTransport = SockJS['xdr-streaming'] = function(ri, trans_url) {\n    this.run(ri, trans_url, '/xhr_streaming', XhrReceiver, utils.XDRObject);\n};\n\nXdrStreamingTransport.prototype = new AjaxBasedTransport();\n\nXdrStreamingTransport.enabled = function() {\n    return !!_window.XDomainRequest;\n};\nXdrStreamingTransport.roundTrips = 2; // preflight, ajax\n\n\n\n// xhr-polling\nvar XhrPollingTransport = SockJS['xhr-polling'] = function(ri, trans_url) {\n    this.run(ri, trans_url, '/xhr', XhrReceiver, utils.XHRCorsObject);\n};\n\nXhrPollingTransport.prototype = new AjaxBasedTransport();\n\nXhrPollingTransport.enabled = XhrStreamingTransport.enabled;\nXhrPollingTransport.roundTrips = 2; // preflight, ajax\n\n\n// xdr-polling\nvar XdrPollingTransport = SockJS['xdr-polling'] = function(ri, trans_url) {\n    this.run(ri, trans_url, '/xhr', XhrReceiver, utils.XDRObject);\n};\n\nXdrPollingTransport.prototype = new AjaxBasedTransport();\n\nXdrPollingTransport.enabled = XdrStreamingTransport.enabled;\nXdrPollingTransport.roundTrips = 2; // preflight, ajax\n//         [*] End of lib/trans-xhr.js\n\n\n//         [*] Including lib/trans-iframe.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\n// Few cool transports do work only for same-origin. In order to make\n// them working cross-domain we shall use iframe, served form the\n// remote domain. New browsers, have capabilities to communicate with\n// cross domain iframe, using postMessage(). In IE it was implemented\n// from IE 8+, but of course, IE got some details wrong:\n//    http://msdn.microsoft.com/en-us/library/cc197015(v=VS.85).aspx\n//    http://stevesouders.com/misc/test-postmessage.php\n\nvar IframeTransport = function() {};\n\nIframeTransport.prototype.i_constructor = function(ri, trans_url, base_url) {\n    var that = this;\n    that.ri = ri;\n    that.origin = utils.getOrigin(base_url);\n    that.base_url = base_url;\n    that.trans_url = trans_url;\n\n    var iframe_url = base_url + '/iframe.html';\n    if (that.ri._options.devel) {\n        iframe_url += '?t=' + (+new Date);\n    }\n    that.window_id = utils.random_string(8);\n    iframe_url += '#' + that.window_id;\n\n    that.iframeObj = utils.createIframe(iframe_url, function(r) {\n                                            that.ri._didClose(1006, \"Unable to load an iframe (\" + r + \")\");\n                                        });\n\n    that.onmessage_cb = utils.bind(that.onmessage, that);\n    utils.attachMessage(that.onmessage_cb);\n};\n\nIframeTransport.prototype.doCleanup = function() {\n    var that = this;\n    if (that.iframeObj) {\n        utils.detachMessage(that.onmessage_cb);\n        try {\n            // When the iframe is not loaded, IE raises an exception\n            // on 'contentWindow'.\n            if (that.iframeObj.iframe.contentWindow) {\n                that.postMessage('c');\n            }\n        } catch (x) {}\n        that.iframeObj.cleanup();\n        that.iframeObj = null;\n        that.onmessage_cb = that.iframeObj = null;\n    }\n};\n\nIframeTransport.prototype.onmessage = function(e) {\n    var that = this;\n    if (e.origin !== that.origin) return;\n    var window_id = e.data.slice(0, 8);\n    var type = e.data.slice(8, 9);\n    var data = e.data.slice(9);\n\n    if (window_id !== that.window_id) return;\n\n    switch(type) {\n    case 's':\n        that.iframeObj.loaded();\n        that.postMessage('s', JSON.stringify([SockJS.version, that.protocol, that.trans_url, that.base_url]));\n        break;\n    case 't':\n        that.ri._didMessage(data);\n        break;\n    }\n};\n\nIframeTransport.prototype.postMessage = function(type, data) {\n    var that = this;\n    that.iframeObj.post(that.window_id + type + (data || ''), that.origin);\n};\n\nIframeTransport.prototype.doSend = function (message) {\n    this.postMessage('m', message);\n};\n\nIframeTransport.enabled = function() {\n    // postMessage misbehaves in konqueror 4.6.5 - the messages are delivered with\n    // huge delay, or not at all.\n    var konqueror = navigator && navigator.userAgent && navigator.userAgent.indexOf('Konqueror') !== -1;\n    return ((typeof _window.postMessage === 'function' ||\n            typeof _window.postMessage === 'object') && (!konqueror));\n};\n//         [*] End of lib/trans-iframe.js\n\n\n//         [*] Including lib/trans-iframe-within.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\nvar curr_window_id;\n\nvar postMessage = function (type, data) {\n    if(parent !== _window) {\n        parent.postMessage(curr_window_id + type + (data || ''), '*');\n    } else {\n        utils.log(\"Can't postMessage, no parent window.\", type, data);\n    }\n};\n\nvar FacadeJS = function() {};\nFacadeJS.prototype._didClose = function (code, reason) {\n    postMessage('t', utils.closeFrame(code, reason));\n};\nFacadeJS.prototype._didMessage = function (frame) {\n    postMessage('t', frame);\n};\nFacadeJS.prototype._doSend = function (data) {\n    this._transport.doSend(data);\n};\nFacadeJS.prototype._doCleanup = function () {\n    this._transport.doCleanup();\n};\n\nutils.parent_origin = undefined;\n\nSockJS.bootstrap_iframe = function() {\n    var facade;\n    curr_window_id = _document.location.hash.slice(1);\n    var onMessage = function(e) {\n        if(e.source !== parent) return;\n        if(typeof utils.parent_origin === 'undefined')\n            utils.parent_origin = e.origin;\n        if (e.origin !== utils.parent_origin) return;\n\n        var window_id = e.data.slice(0, 8);\n        var type = e.data.slice(8, 9);\n        var data = e.data.slice(9);\n        if (window_id !== curr_window_id) return;\n        switch(type) {\n        case 's':\n            var p = JSON.parse(data);\n            var version = p[0];\n            var protocol = p[1];\n            var trans_url = p[2];\n            var base_url = p[3];\n            if (version !== SockJS.version) {\n                utils.log(\"Incompatibile SockJS! Main site uses:\" +\n                          \" \\\"\" + version + \"\\\", the iframe:\" +\n                          \" \\\"\" + SockJS.version + \"\\\".\");\n            }\n            if (!utils.flatUrl(trans_url) || !utils.flatUrl(base_url)) {\n                utils.log(\"Only basic urls are supported in SockJS\");\n                return;\n            }\n\n            if (!utils.isSameOriginUrl(trans_url) ||\n                !utils.isSameOriginUrl(base_url)) {\n                utils.log(\"Can't connect to different domain from within an \" +\n                          \"iframe. (\" + JSON.stringify([_window.location.href, trans_url, base_url]) +\n                          \")\");\n                return;\n            }\n            facade = new FacadeJS();\n            facade._transport = new FacadeJS[protocol](facade, trans_url, base_url);\n            break;\n        case 'm':\n            facade._doSend(data);\n            break;\n        case 'c':\n            if (facade)\n                facade._doCleanup();\n            facade = null;\n            break;\n        }\n    };\n\n    // alert('test ticker');\n    // facade = new FacadeJS();\n    // facade._transport = new FacadeJS['w-iframe-xhr-polling'](facade, 'http://host.com:9999/ticker/12/basd');\n\n    utils.attachMessage(onMessage);\n\n    // Start\n    postMessage('s');\n};\n//         [*] End of lib/trans-iframe-within.js\n\n\n//         [*] Including lib/info.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\nvar InfoReceiver = function(base_url, AjaxObject) {\n    var that = this;\n    utils.delay(function(){that.doXhr(base_url, AjaxObject);});\n};\n\nInfoReceiver.prototype = new EventEmitter(['finish']);\n\nInfoReceiver.prototype.doXhr = function(base_url, AjaxObject) {\n    var that = this;\n    var t0 = (new Date()).getTime();\n\n// <METEOR>\n  // https://github.com/sockjs/sockjs-client/pull/129\n  // var xo = new AjaxObject('GET', base_url + '/info');\n\n    var xo = new AjaxObject(\n      // add cachebusting parameter to url to work around a chrome bug:\n      // https://code.google.com/p/chromium/issues/detail?id=263981\n      // or misbehaving proxies.\n      'GET', base_url + '/info?cb=' + utils.random_string(10))\n// </METEOR>\n\n    var tref = utils.delay(8000,\n                           function(){xo.ontimeout();});\n\n    xo.onfinish = function(status, text) {\n        clearTimeout(tref);\n        tref = null;\n        if (status === 200) {\n            var rtt = (new Date()).getTime() - t0;\n            var info = JSON.parse(text);\n            if (typeof info !== 'object') info = {};\n            that.emit('finish', info, rtt);\n        } else {\n            that.emit('finish');\n        }\n    };\n    xo.ontimeout = function() {\n        xo.close();\n        that.emit('finish');\n    };\n};\n\nvar InfoReceiverIframe = function(base_url) {\n    var that = this;\n    var go = function() {\n        var ifr = new IframeTransport();\n        ifr.protocol = 'w-iframe-info-receiver';\n        var fun = function(r) {\n            if (typeof r === 'string' && r.substr(0,1) === 'm') {\n                var d = JSON.parse(r.substr(1));\n                var info = d[0], rtt = d[1];\n                that.emit('finish', info, rtt);\n            } else {\n                that.emit('finish');\n            }\n            ifr.doCleanup();\n            ifr = null;\n        };\n        var mock_ri = {\n            _options: {},\n            _didClose: fun,\n            _didMessage: fun\n        };\n        ifr.i_constructor(mock_ri, base_url, base_url);\n    }\n    if(!_document.body) {\n        utils.attachEvent('load', go);\n    } else {\n        go();\n    }\n};\nInfoReceiverIframe.prototype = new EventEmitter(['finish']);\n\n\nvar InfoReceiverFake = function() {\n    // It may not be possible to do cross domain AJAX to get the info\n    // data, for example for IE7. But we want to run JSONP, so let's\n    // fake the response, with rtt=2s (rto=6s).\n    var that = this;\n    utils.delay(function() {\n        that.emit('finish', {}, 2000);\n    });\n};\nInfoReceiverFake.prototype = new EventEmitter(['finish']);\n\nvar createInfoReceiver = function(base_url) {\n    if (utils.isSameOriginUrl(base_url)) {\n        // If, for some reason, we have SockJS locally - there's no\n        // need to start up the complex machinery. Just use ajax.\n        return new InfoReceiver(base_url, utils.XHRLocalObject);\n    }\n    switch (utils.isXHRCorsCapable()) {\n    case 1:\n        // XHRLocalObject -> no_credentials=true\n        return new InfoReceiver(base_url, utils.XHRLocalObject);\n    case 2:\n// <METEOR>\n// https://github.com/sockjs/sockjs-client/issues/79\n        // XDR doesn't work across different schemes\n        // http://blogs.msdn.com/b/ieinternals/archive/2010/05/13/xdomainrequest-restrictions-limitations-and-workarounds.aspx\n        if (utils.isSameOriginScheme(base_url))\n            return new InfoReceiver(base_url, utils.XDRObject);\n        else\n            return new InfoReceiverFake();\n// </METEOR>\n    case 3:\n        // Opera\n        return new InfoReceiverIframe(base_url);\n    default:\n        // IE 7\n        return new InfoReceiverFake();\n    };\n};\n\n\nvar WInfoReceiverIframe = FacadeJS['w-iframe-info-receiver'] = function(ri, _trans_url, base_url) {\n    var ir = new InfoReceiver(base_url, utils.XHRLocalObject);\n    ir.onfinish = function(info, rtt) {\n        ri._didMessage('m'+JSON.stringify([info, rtt]));\n        ri._didClose();\n    }\n};\nWInfoReceiverIframe.prototype.doCleanup = function() {};\n//         [*] End of lib/info.js\n\n\n//         [*] Including lib/trans-iframe-eventsource.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\nvar EventSourceIframeTransport = SockJS['iframe-eventsource'] = function () {\n    var that = this;\n    that.protocol = 'w-iframe-eventsource';\n    that.i_constructor.apply(that, arguments);\n};\n\nEventSourceIframeTransport.prototype = new IframeTransport();\n\nEventSourceIframeTransport.enabled = function () {\n    return ('EventSource' in _window) && IframeTransport.enabled();\n};\n\nEventSourceIframeTransport.need_body = true;\nEventSourceIframeTransport.roundTrips = 3; // html, javascript, eventsource\n\n\n// w-iframe-eventsource\nvar EventSourceTransport = FacadeJS['w-iframe-eventsource'] = function(ri, trans_url) {\n    this.run(ri, trans_url, '/eventsource', EventSourceReceiver, utils.XHRLocalObject);\n}\nEventSourceTransport.prototype = new AjaxBasedTransport();\n//         [*] End of lib/trans-iframe-eventsource.js\n\n\n//         [*] Including lib/trans-iframe-xhr-polling.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\nvar XhrPollingIframeTransport = SockJS['iframe-xhr-polling'] = function () {\n    var that = this;\n    that.protocol = 'w-iframe-xhr-polling';\n    that.i_constructor.apply(that, arguments);\n};\n\nXhrPollingIframeTransport.prototype = new IframeTransport();\n\nXhrPollingIframeTransport.enabled = function () {\n    return _window.XMLHttpRequest && IframeTransport.enabled();\n};\n\nXhrPollingIframeTransport.need_body = true;\nXhrPollingIframeTransport.roundTrips = 3; // html, javascript, xhr\n\n\n// w-iframe-xhr-polling\nvar XhrPollingITransport = FacadeJS['w-iframe-xhr-polling'] = function(ri, trans_url) {\n    this.run(ri, trans_url, '/xhr', XhrReceiver, utils.XHRLocalObject);\n};\n\nXhrPollingITransport.prototype = new AjaxBasedTransport();\n//         [*] End of lib/trans-iframe-xhr-polling.js\n\n\n//         [*] Including lib/trans-iframe-htmlfile.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\n// This transport generally works in any browser, but will cause a\n// spinning cursor to appear in any browser other than IE.\n// We may test this transport in all browsers - why not, but in\n// production it should be only run in IE.\n\nvar HtmlFileIframeTransport = SockJS['iframe-htmlfile'] = function () {\n    var that = this;\n    that.protocol = 'w-iframe-htmlfile';\n    that.i_constructor.apply(that, arguments);\n};\n\n// Inheritance.\nHtmlFileIframeTransport.prototype = new IframeTransport();\n\nHtmlFileIframeTransport.enabled = function() {\n    return IframeTransport.enabled();\n};\n\nHtmlFileIframeTransport.need_body = true;\nHtmlFileIframeTransport.roundTrips = 3; // html, javascript, htmlfile\n\n\n// w-iframe-htmlfile\nvar HtmlFileTransport = FacadeJS['w-iframe-htmlfile'] = function(ri, trans_url) {\n    this.run(ri, trans_url, '/htmlfile', HtmlfileReceiver, utils.XHRLocalObject);\n};\nHtmlFileTransport.prototype = new AjaxBasedTransport();\n//         [*] End of lib/trans-iframe-htmlfile.js\n\n\n//         [*] Including lib/trans-polling.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\nvar Polling = function(ri, Receiver, recv_url, AjaxObject) {\n    var that = this;\n    that.ri = ri;\n    that.Receiver = Receiver;\n    that.recv_url = recv_url;\n    that.AjaxObject = AjaxObject;\n    that._scheduleRecv();\n};\n\nPolling.prototype._scheduleRecv = function() {\n    var that = this;\n    var poll = that.poll = new that.Receiver(that.recv_url, that.AjaxObject);\n    var msg_counter = 0;\n    poll.onmessage = function(e) {\n        msg_counter += 1;\n        that.ri._didMessage(e.data);\n    };\n    poll.onclose = function(e) {\n        that.poll = poll = poll.onmessage = poll.onclose = null;\n        if (!that.poll_is_closing) {\n            if (e.reason === 'permanent') {\n                that.ri._didClose(1006, 'Polling error (' + e.reason + ')');\n            } else {\n                that._scheduleRecv();\n            }\n        }\n    };\n};\n\nPolling.prototype.abort = function() {\n    var that = this;\n    that.poll_is_closing = true;\n    if (that.poll) {\n        that.poll.abort();\n    }\n};\n//         [*] End of lib/trans-polling.js\n\n\n//         [*] Including lib/trans-receiver-eventsource.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\nvar EventSourceReceiver = function(url) {\n    var that = this;\n    var es = new EventSource(url);\n    es.onmessage = function(e) {\n        that.dispatchEvent(new SimpleEvent('message',\n                                           {'data': unescape(e.data)}));\n    };\n    that.es_close = es.onerror = function(e, abort_reason) {\n        // ES on reconnection has readyState = 0 or 1.\n        // on network error it's CLOSED = 2\n        var reason = abort_reason ? 'user' :\n            (es.readyState !== 2 ? 'network' : 'permanent');\n        that.es_close = es.onmessage = es.onerror = null;\n        // EventSource reconnects automatically.\n        es.close();\n        es = null;\n        // Safari and chrome < 15 crash if we close window before\n        // waiting for ES cleanup. See:\n        //   https://code.google.com/p/chromium/issues/detail?id=89155\n        utils.delay(200, function() {\n                        that.dispatchEvent(new SimpleEvent('close', {reason: reason}));\n                    });\n    };\n};\n\nEventSourceReceiver.prototype = new REventTarget();\n\nEventSourceReceiver.prototype.abort = function() {\n    var that = this;\n    if (that.es_close) {\n        that.es_close({}, true);\n    }\n};\n//         [*] End of lib/trans-receiver-eventsource.js\n\n\n//         [*] Including lib/trans-receiver-htmlfile.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\nvar _is_ie_htmlfile_capable;\nvar isIeHtmlfileCapable = function() {\n    if (_is_ie_htmlfile_capable === undefined) {\n        if ('ActiveXObject' in _window) {\n            try {\n                _is_ie_htmlfile_capable = !!new ActiveXObject('htmlfile');\n            } catch (x) {}\n        } else {\n            _is_ie_htmlfile_capable = false;\n        }\n    }\n    return _is_ie_htmlfile_capable;\n};\n\n\nvar HtmlfileReceiver = function(url) {\n    var that = this;\n    utils.polluteGlobalNamespace();\n\n    that.id = 'a' + utils.random_string(6, 26);\n    url += ((url.indexOf('?') === -1) ? '?' : '&') +\n        'c=' + escape(WPrefix + '.' + that.id);\n\n    var constructor = isIeHtmlfileCapable() ?\n        utils.createHtmlfile : utils.createIframe;\n\n    var iframeObj;\n    _window[WPrefix][that.id] = {\n        start: function () {\n            iframeObj.loaded();\n        },\n        message: function (data) {\n            that.dispatchEvent(new SimpleEvent('message', {'data': data}));\n        },\n        stop: function () {\n            that.iframe_close({}, 'network');\n        }\n    };\n    that.iframe_close = function(e, abort_reason) {\n        iframeObj.cleanup();\n        that.iframe_close = iframeObj = null;\n        delete _window[WPrefix][that.id];\n        that.dispatchEvent(new SimpleEvent('close', {reason: abort_reason}));\n    };\n    iframeObj = constructor(url, function(e) {\n                                that.iframe_close({}, 'permanent');\n                            });\n};\n\nHtmlfileReceiver.prototype = new REventTarget();\n\nHtmlfileReceiver.prototype.abort = function() {\n    var that = this;\n    if (that.iframe_close) {\n        that.iframe_close({}, 'user');\n    }\n};\n//         [*] End of lib/trans-receiver-htmlfile.js\n\n\n//         [*] Including lib/trans-receiver-xhr.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\nvar XhrReceiver = function(url, AjaxObject) {\n    var that = this;\n    var buf_pos = 0;\n\n    that.xo = new AjaxObject('POST', url, null);\n    that.xo.onchunk = function(status, text) {\n        if (status !== 200) return;\n        while (1) {\n            var buf = text.slice(buf_pos);\n            var p = buf.indexOf('\\n');\n            if (p === -1) break;\n            buf_pos += p+1;\n            var msg = buf.slice(0, p);\n            that.dispatchEvent(new SimpleEvent('message', {data: msg}));\n        }\n    };\n    that.xo.onfinish = function(status, text) {\n        that.xo.onchunk(status, text);\n        that.xo = null;\n        var reason = status === 200 ? 'network' : 'permanent';\n        that.dispatchEvent(new SimpleEvent('close', {reason: reason}));\n    }\n};\n\nXhrReceiver.prototype = new REventTarget();\n\nXhrReceiver.prototype.abort = function() {\n    var that = this;\n    if (that.xo) {\n        that.xo.close();\n        that.dispatchEvent(new SimpleEvent('close', {reason: 'user'}));\n        that.xo = null;\n    }\n};\n//         [*] End of lib/trans-receiver-xhr.js\n\n\n//         [*] Including lib/test-hooks.js\n/*\n * ***** BEGIN LICENSE BLOCK *****\n * Copyright (c) 2011-2012 VMware, Inc.\n *\n * For the license see COPYING.\n * ***** END LICENSE BLOCK *****\n */\n\n// For testing\nSockJS.getUtils = function(){\n    return utils;\n};\n\nSockJS.getIframeTransport = function(){\n    return IframeTransport;\n};\n//         [*] End of lib/test-hooks.js\n\n                  return SockJS;\n          })();\nif ('_sockjs_onload' in window) setTimeout(_sockjs_onload, 1);\n\n// AMD compliance\nif (typeof define === 'function' && define.amd) {\n    define('sockjs', [], function(){return SockJS;});\n}\n//     [*] End of lib/index.js\n\n// [*] End of lib/all.js\n","import { Meteor } from \"meteor/meteor\";\n\n// @param url {String} URL to Meteor app, eg:\n//   \"/\" or \"madewith.meteor.com\" or \"https://foo.meteor.com\"\n//   or \"ddp+sockjs://ddp--****-foo.meteor.com/sockjs\"\n// @returns {String} URL to the endpoint with the specific scheme and subPath, e.g.\n// for scheme \"http\" and subPath \"sockjs\"\n//   \"http://subdomain.meteor.com/sockjs\" or \"/sockjs\"\n//   or \"https://ddp--1234-foo.meteor.com/sockjs\"\nfunction translateUrl(url, newSchemeBase, subPath) {\n  if (!newSchemeBase) {\n    newSchemeBase = 'http';\n  }\n\n  if (subPath !== \"sockjs\" && url.startsWith(\"/\")) {\n    url = Meteor.absoluteUrl(url.substr(1));\n  }\n\n  var ddpUrlMatch = url.match(/^ddp(i?)\\+sockjs:\\/\\//);\n  var httpUrlMatch = url.match(/^http(s?):\\/\\//);\n  var newScheme;\n  if (ddpUrlMatch) {\n    // Remove scheme and split off the host.\n    var urlAfterDDP = url.substr(ddpUrlMatch[0].length);\n    newScheme = ddpUrlMatch[1] === 'i' ? newSchemeBase : newSchemeBase + 's';\n    var slashPos = urlAfterDDP.indexOf('/');\n    var host = slashPos === -1 ? urlAfterDDP : urlAfterDDP.substr(0, slashPos);\n    var rest = slashPos === -1 ? '' : urlAfterDDP.substr(slashPos);\n\n    // In the host (ONLY!), change '*' characters into random digits. This\n    // allows different stream connections to connect to different hostnames\n    // and avoid browser per-hostname connection limits.\n    host = host.replace(/\\*/g, () => Math.floor(Math.random() * 10));\n\n    return newScheme + '://' + host + rest;\n  } else if (httpUrlMatch) {\n    newScheme = !httpUrlMatch[1] ? newSchemeBase : newSchemeBase + 's';\n    var urlAfterHttp = url.substr(httpUrlMatch[0].length);\n    url = newScheme + '://' + urlAfterHttp;\n  }\n\n  // Prefix FQDNs but not relative URLs\n  if (url.indexOf('://') === -1 && !url.startsWith('/')) {\n    url = newSchemeBase + '://' + url;\n  }\n\n  // XXX This is not what we should be doing: if I have a site\n  // deployed at \"/foo\", then DDP.connect(\"/\") should actually connect\n  // to \"/\", not to \"/foo\". \"/\" is an absolute path. (Contrast: if\n  // deployed at \"/foo\", it would be reasonable for DDP.connect(\"bar\")\n  // to connect to \"/foo/bar\").\n  //\n  // We should make this properly honor absolute paths rather than\n  // forcing the path to be relative to the site root. Simultaneously,\n  // we should set DDP_DEFAULT_CONNECTION_URL to include the site\n  // root. See also client_convenience.js #RationalizingRelativeDDPURLs\n  url = Meteor._relativeToSiteRootUrl(url);\n\n  if (url.endsWith('/')) return url + subPath;\n  else return url + '/' + subPath;\n}\n\nexport function toSockjsUrl(url) {\n  return translateUrl(url, 'http', 'sockjs');\n}\n\nexport function toWebsocketUrl(url) {\n  return translateUrl(url, 'ws', 'websocket');\n}\n"]}}]