[{"type":"js","data":"//////////////////////////////////////////////////////////////////////////\n//                                                                      //\n// This is a generated file. You can view the original                  //\n// source in your browser if your browser supports source maps.         //\n// Source maps are supported by all recent versions of Chrome, Safari,  //\n// and Firefox, and by Internet Explorer 11.                            //\n//                                                                      //\n//////////////////////////////////////////////////////////////////////////\n\n\n(function () {\n\n/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar global = Package.meteor.global;\nvar meteorEnv = Package.meteor.meteorEnv;\nvar check = Package.check.check;\nvar Match = Package.check.Match;\nvar URL = Package.url.URL;\nvar URLSearchParams = Package.url.URLSearchParams;\nvar Reload = Package.reload.Reload;\nvar Base64 = Package.base64.Base64;\nvar meteorInstall = Package.modules.meteorInstall;\nvar Promise = Package.promise.Promise;\n\n/* Package-scope variables */\nvar OAuth;\n\nvar require = meteorInstall({\"node_modules\":{\"meteor\":{\"oauth\":{\"oauth_client.js\":function module(){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                     //\n// packages/oauth/oauth_client.js                                                                                      //\n//                                                                                                                     //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                       //\n// credentialToken -> credentialSecret. You must provide both the\n// credentialToken and the credentialSecret to retrieve an access token from\n// the _pendingCredentials collection.\nconst credentialSecrets = {};\nOAuth = {};\n\nOAuth.showPopup = (url, callback, dimensions) => {\n  throw new Error(\"OAuth.showPopup must be implemented on this arch.\");\n}; // Determine the login style (popup or redirect) for this login flow.\n//\n//\n\n\nOAuth._loginStyle = (service, config, options) => {\n  if (Meteor.isCordova) {\n    return \"popup\";\n  }\n\n  let loginStyle = options && options.loginStyle || config.loginStyle || 'popup';\n  if (![\"popup\", \"redirect\"].includes(loginStyle)) throw new Error(\"Invalid login style: \".concat(loginStyle)); // If we don't have session storage (for example, Safari in private\n  // mode), the redirect login flow won't work, so fallback to the\n  // popup style.\n\n  if (loginStyle === 'redirect') {\n    try {\n      sessionStorage.setItem('Meteor.oauth.test', 'test');\n      sessionStorage.removeItem('Meteor.oauth.test');\n    } catch (e) {\n      loginStyle = 'popup';\n    }\n  }\n\n  return loginStyle;\n};\n\nOAuth._stateParam = (loginStyle, credentialToken, redirectUrl) => {\n  var _Meteor$settings, _Meteor$settings$publ, _Meteor$settings$publ2, _Meteor$settings$publ3;\n\n  const state = {\n    loginStyle,\n    credentialToken,\n    isCordova: Meteor.isCordova\n  };\n\n  if (loginStyle === 'redirect' || (_Meteor$settings = Meteor.settings) !== null && _Meteor$settings !== void 0 && (_Meteor$settings$publ = _Meteor$settings.public) !== null && _Meteor$settings$publ !== void 0 && (_Meteor$settings$publ2 = _Meteor$settings$publ.packages) !== null && _Meteor$settings$publ2 !== void 0 && (_Meteor$settings$publ3 = _Meteor$settings$publ2.oauth) !== null && _Meteor$settings$publ3 !== void 0 && _Meteor$settings$publ3.setRedirectUrlWhenLoginStyleIsPopup && loginStyle === 'popup') {\n    state.redirectUrl = redirectUrl || '' + window.location;\n  } // Encode base64 as not all login services URI-encode the state\n  // parameter when they pass it back to us.\n  // Use the 'base64' package here because 'btoa' isn't supported in IE8/9.\n\n\n  return Base64.encode(JSON.stringify(state));\n}; // At the beginning of the redirect login flow, before we redirect to\n// the login service, save the credential token for this login attempt\n// in the reload migration data.\n//\n\n\nOAuth.saveDataForRedirect = (loginService, credentialToken) => {\n  Reload._onMigrate('oauth', () => [true, {\n    loginService,\n    credentialToken\n  }]);\n\n  Reload._migrate(null, {\n    immediateMigration: true\n  });\n}; // At the end of the redirect login flow, when we've redirected back\n// to the application, retrieve the credentialToken and (if the login\n// was successful) the credentialSecret.\n//\n// Called at application startup.  Returns null if this is normal\n// application startup and we weren't just redirected at the end of\n// the login flow.\n//\n\n\nOAuth.getDataAfterRedirect = () => {\n  const migrationData = Reload._migrationData('oauth');\n\n  if (!(migrationData && migrationData.credentialToken)) return null;\n  const {\n    credentialToken\n  } = migrationData;\n  const key = OAuth._storageTokenPrefix + credentialToken;\n  let credentialSecret;\n\n  try {\n    credentialSecret = sessionStorage.getItem(key);\n    sessionStorage.removeItem(key);\n  } catch (e) {\n    Meteor._debug('error retrieving credentialSecret', e);\n  }\n\n  return {\n    loginService: migrationData.loginService,\n    credentialToken,\n    credentialSecret\n  };\n}; // Launch an OAuth login flow.  For the popup login style, show the\n// popup.  For the redirect login style, save the credential token for\n// this login attempt in the reload migration data, and redirect to\n// the service for the login.\n//\n// options:\n//  loginService: \"facebook\", \"google\", etc.\n//  loginStyle: \"popup\" or \"redirect\"\n//  loginUrl: The URL at the login service provider to start the OAuth flow.\n//  credentialRequestCompleteCallback: for the popup flow, call when the popup\n//    is closed and we have the credential from the login service.\n//  credentialToken: our identifier for this login flow.\n//\n\n\nOAuth.launchLogin = options => {\n  if (!options.loginService) throw new Error('loginService required');\n\n  if (options.loginStyle === 'popup') {\n    OAuth.showPopup(options.loginUrl, options.credentialRequestCompleteCallback.bind(null, options.credentialToken), options.popupOptions);\n  } else if (options.loginStyle === 'redirect') {\n    OAuth.saveDataForRedirect(options.loginService, options.credentialToken);\n    window.location = options.loginUrl;\n  } else {\n    throw new Error('invalid login style');\n  }\n}; // Called by the popup when the OAuth flow is completed, right before\n// the popup closes.\n\n\nOAuth._handleCredentialSecret = (credentialToken, secret) => {\n  check(credentialToken, String);\n  check(secret, String);\n\n  if (!Object.prototype.hasOwnProperty.call(credentialSecrets, credentialToken)) {\n    credentialSecrets[credentialToken] = secret;\n  } else {\n    throw new Error(\"Duplicate credential token from OAuth login\");\n  }\n}; // Used by accounts-oauth, which needs both a credentialToken and the\n// corresponding to credential secret to call the `login` method over DDP.\n\n\nOAuth._retrieveCredentialSecret = credentialToken => {\n  // First check the secrets collected by OAuth._handleCredentialSecret,\n  // then check localStorage. This matches what we do in\n  // end_of_login_response.html.\n  let secret = credentialSecrets[credentialToken];\n\n  if (!secret) {\n    const localStorageKey = OAuth._storageTokenPrefix + credentialToken;\n    secret = Meteor._localStorage.getItem(localStorageKey);\n\n    Meteor._localStorage.removeItem(localStorageKey);\n  } else {\n    delete credentialSecrets[credentialToken];\n  }\n\n  return secret;\n};\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"oauth_browser.js\":function module(){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                     //\n// packages/oauth/oauth_browser.js                                                                                     //\n//                                                                                                                     //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                       //\n// Browser specific code for the OAuth package.\n// Open a popup window, centered on the screen, and call a callback when it\n// closes.\n//\n// @param url {String} url to show\n// @param callback {Function} Callback function to call on completion. Takes no\n//   arguments.\n// @param dimensions {optional Object(width, height)} The dimensions of\n//   the popup. If not passed defaults to something sane.\nOAuth.showPopup = (url, callback, dimensions) => {\n  // default dimensions that worked well for facebook and google\n  const popup = openCenteredPopup(url, dimensions && dimensions.width || 650, dimensions && dimensions.height || 331);\n  const checkPopupOpen = setInterval(() => {\n    let popupClosed;\n\n    try {\n      // Fix for #328 - added a second test criteria (popup.closed === undefined)\n      // to humour this Android quirk:\n      // http://code.google.com/p/android/issues/detail?id=21061\n      popupClosed = popup.closed || popup.closed === undefined;\n    } catch (e) {\n      // For some unknown reason, IE9 (and others?) sometimes (when\n      // the popup closes too quickly?) throws \"SCRIPT16386: No such\n      // interface supported\" when trying to read 'popup.closed'. Try\n      // again in 100ms.\n      return;\n    }\n\n    if (popupClosed) {\n      clearInterval(checkPopupOpen);\n      callback();\n    }\n  }, 100);\n};\n\nconst openCenteredPopup = function (url, width, height) {\n  const screenX = typeof window.screenX !== 'undefined' ? window.screenX : window.screenLeft;\n  const screenY = typeof window.screenY !== 'undefined' ? window.screenY : window.screenTop;\n  const outerWidth = typeof window.outerWidth !== 'undefined' ? window.outerWidth : document.body.clientWidth;\n  const outerHeight = typeof window.outerHeight !== 'undefined' ? window.outerHeight : document.body.clientHeight - 22; // XXX what is the 22?\n  // Use `outerWidth - width` and `outerHeight - height` for help in\n  // positioning the popup centered relative to the current window\n\n  const left = screenX + (outerWidth - width) / 2;\n  const top = screenY + (outerHeight - height) / 2;\n  const features = \"width=\".concat(width, \",height=\").concat(height) + \",left=\".concat(left, \",top=\").concat(top, \",scrollbars=yes\");\n  const newwindow = window.open(url, 'Login', features);\n\n  if (typeof newwindow === 'undefined') {\n    // blocked by a popup blocker maybe?\n    const err = new Error(\"The login popup was blocked by the browser\");\n    err.attemptedUrl = url;\n    throw err;\n  }\n\n  if (newwindow.focus) newwindow.focus();\n  return newwindow;\n};\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"oauth_common.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                     //\n// packages/oauth/oauth_common.js                                                                                      //\n//                                                                                                                     //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                       //\nlet _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 0);\nOAuth._storageTokenPrefix = \"Meteor.oauth.credentialSecret-\";\n\nOAuth._redirectUri = (serviceName, config, params, absoluteUrlOptions) => {\n  // Clone because we're going to mutate 'params'. The 'cordova' and\n  // 'android' parameters are only used for picking the host of the\n  // redirect URL, and not actually included in the redirect URL itself.\n  let isCordova = false;\n  let isAndroid = false;\n\n  if (params) {\n    params = _objectSpread({}, params);\n    isCordova = params.cordova;\n    isAndroid = params.android;\n    delete params.cordova;\n    delete params.android;\n\n    if (Object.keys(params).length === 0) {\n      params = undefined;\n    }\n  }\n\n  if (Meteor.isServer && isCordova) {\n    const url = Npm.require('url');\n\n    let rootUrl = process.env.MOBILE_ROOT_URL || __meteor_runtime_config__.ROOT_URL;\n\n    if (isAndroid) {\n      // Match the replace that we do in cordova boilerplate\n      // (boilerplate-generator package).\n      // XXX Maybe we should put this in a separate package or something\n      // that is used here and by boilerplate-generator? Or maybe\n      // `Meteor.absoluteUrl` should know how to do this?\n      const parsedRootUrl = url.parse(rootUrl);\n\n      if (parsedRootUrl.hostname === \"localhost\") {\n        parsedRootUrl.hostname = \"10.0.2.2\";\n        delete parsedRootUrl.host;\n      }\n\n      rootUrl = url.format(parsedRootUrl);\n    }\n\n    absoluteUrlOptions = _objectSpread(_objectSpread({}, absoluteUrlOptions), {}, {\n      // For Cordova clients, redirect to the special Cordova root url\n      // (likely a local IP in development mode).\n      rootUrl\n    });\n  }\n\n  return URL._constructUrl(Meteor.absoluteUrl(\"_oauth/\".concat(serviceName), absoluteUrlOptions), null, params);\n};\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}}}},{\n  \"extensions\": [\n    \".js\",\n    \".json\"\n  ]\n});\n\nrequire(\"/node_modules/meteor/oauth/oauth_client.js\");\nrequire(\"/node_modules/meteor/oauth/oauth_browser.js\");\nrequire(\"/node_modules/meteor/oauth/oauth_common.js\");\n\n/* Exports */\nPackage._define(\"oauth\", {\n  OAuth: OAuth\n});\n\n})();\n","servePath":"/packages/oauth.js","sourceMap":{"version":3,"sources":["packages/oauth/oauth_client.js","packages/oauth/oauth_browser.js","packages/oauth/oauth_common.js"],"names":["credentialSecrets","OAuth","showPopup","url","callback","dimensions","Error","_loginStyle","service","config","options","Meteor","isCordova","loginStyle","includes","sessionStorage","setItem","removeItem","e","_stateParam","credentialToken","redirectUrl","state","settings","public","packages","oauth","setRedirectUrlWhenLoginStyleIsPopup","window","location","Base64","encode","JSON","stringify","saveDataForRedirect","loginService","Reload","_onMigrate","_migrate","immediateMigration","getDataAfterRedirect","migrationData","_migrationData","key","_storageTokenPrefix","credentialSecret","getItem","_debug","launchLogin","loginUrl","credentialRequestCompleteCallback","bind","popupOptions","_handleCredentialSecret","secret","check","String","Object","prototype","hasOwnProperty","call","_retrieveCredentialSecret","localStorageKey","_localStorage","popup","openCenteredPopup","width","height","checkPopupOpen","setInterval","popupClosed","closed","undefined","clearInterval","screenX","screenLeft","screenY","screenTop","outerWidth","document","body","clientWidth","outerHeight","clientHeight","left","top","features","newwindow","open","err","attemptedUrl","focus","_objectSpread","module","link","default","v","_redirectUri","serviceName","params","absoluteUrlOptions","isAndroid","cordova","android","keys","length","isServer","Npm","require","rootUrl","process","env","MOBILE_ROOT_URL","__meteor_runtime_config__","ROOT_URL","parsedRootUrl","parse","hostname","host","format","URL","_constructUrl","absoluteUrl"],"mappings":"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","file":"/packages/oauth.js","sourcesContent":["// credentialToken -> credentialSecret. You must provide both the\n// credentialToken and the credentialSecret to retrieve an access token from\n// the _pendingCredentials collection.\nconst credentialSecrets = {};\n\nOAuth = {};\n\nOAuth.showPopup = (url, callback, dimensions) => {\n  throw new Error(\"OAuth.showPopup must be implemented on this arch.\");\n};\n\n// Determine the login style (popup or redirect) for this login flow.\n//\n//\nOAuth._loginStyle = (service, config, options) => {\n\n  if (Meteor.isCordova) {\n    return \"popup\";\n  }\n\n  let loginStyle = (options && options.loginStyle) || config.loginStyle || 'popup';\n\n  if (! [\"popup\", \"redirect\"].includes(loginStyle))\n    throw new Error(`Invalid login style: ${loginStyle}`);\n\n  // If we don't have session storage (for example, Safari in private\n  // mode), the redirect login flow won't work, so fallback to the\n  // popup style.\n  if (loginStyle === 'redirect') {\n    try {\n      sessionStorage.setItem('Meteor.oauth.test', 'test');\n      sessionStorage.removeItem('Meteor.oauth.test');\n    } catch (e) {\n      loginStyle = 'popup';\n    }\n  }\n\n  return loginStyle;\n};\n\nOAuth._stateParam = (loginStyle, credentialToken, redirectUrl) => {\n  const state = {\n    loginStyle,\n    credentialToken,\n    isCordova: Meteor.isCordova\n  };\n\n  if (loginStyle === 'redirect' ||\n    (Meteor.settings?.public?.packages?.oauth?.setRedirectUrlWhenLoginStyleIsPopup && loginStyle === 'popup')\n  ) {\n    state.redirectUrl = redirectUrl || ('' + window.location);\n  }\n\n  // Encode base64 as not all login services URI-encode the state\n  // parameter when they pass it back to us.\n  // Use the 'base64' package here because 'btoa' isn't supported in IE8/9.\n  return Base64.encode(JSON.stringify(state));\n};\n\n\n// At the beginning of the redirect login flow, before we redirect to\n// the login service, save the credential token for this login attempt\n// in the reload migration data.\n//\nOAuth.saveDataForRedirect = (loginService, credentialToken) => {\n  Reload._onMigrate('oauth', () => [true, { loginService, credentialToken }]);\n  Reload._migrate(null, {immediateMigration: true});\n};\n\n// At the end of the redirect login flow, when we've redirected back\n// to the application, retrieve the credentialToken and (if the login\n// was successful) the credentialSecret.\n//\n// Called at application startup.  Returns null if this is normal\n// application startup and we weren't just redirected at the end of\n// the login flow.\n//\nOAuth.getDataAfterRedirect = () => {\n  const migrationData = Reload._migrationData('oauth');\n\n  if (! (migrationData && migrationData.credentialToken))\n    return null;\n\n  const { credentialToken } = migrationData;\n  const key = OAuth._storageTokenPrefix + credentialToken;\n  let credentialSecret;\n  try {\n    credentialSecret = sessionStorage.getItem(key);\n    sessionStorage.removeItem(key);\n  } catch (e) {\n    Meteor._debug('error retrieving credentialSecret', e);\n  }\n  return {\n    loginService: migrationData.loginService,\n    credentialToken,\n    credentialSecret,\n  };\n};\n\n// Launch an OAuth login flow.  For the popup login style, show the\n// popup.  For the redirect login style, save the credential token for\n// this login attempt in the reload migration data, and redirect to\n// the service for the login.\n//\n// options:\n//  loginService: \"facebook\", \"google\", etc.\n//  loginStyle: \"popup\" or \"redirect\"\n//  loginUrl: The URL at the login service provider to start the OAuth flow.\n//  credentialRequestCompleteCallback: for the popup flow, call when the popup\n//    is closed and we have the credential from the login service.\n//  credentialToken: our identifier for this login flow.\n//\nOAuth.launchLogin = options => {\n  if (! options.loginService)\n    throw new Error('loginService required');\n  if (options.loginStyle === 'popup') {\n    OAuth.showPopup(\n      options.loginUrl,\n      options.credentialRequestCompleteCallback.bind(null, options.credentialToken),\n      options.popupOptions);\n  } else if (options.loginStyle === 'redirect') {\n    OAuth.saveDataForRedirect(options.loginService, options.credentialToken);\n    window.location = options.loginUrl;\n  } else {\n    throw new Error('invalid login style');\n  }\n};\n\n// Called by the popup when the OAuth flow is completed, right before\n// the popup closes.\nOAuth._handleCredentialSecret = (credentialToken, secret) => {\n  check(credentialToken, String);\n  check(secret, String);\n  if (! Object.prototype.hasOwnProperty.call(credentialSecrets, credentialToken)) {\n    credentialSecrets[credentialToken] = secret;\n  } else {\n    throw new Error(\"Duplicate credential token from OAuth login\");\n  }\n};\n\n// Used by accounts-oauth, which needs both a credentialToken and the\n// corresponding to credential secret to call the `login` method over DDP.\nOAuth._retrieveCredentialSecret = credentialToken => {\n  // First check the secrets collected by OAuth._handleCredentialSecret,\n  // then check localStorage. This matches what we do in\n  // end_of_login_response.html.\n  let secret = credentialSecrets[credentialToken];\n  if (! secret) {\n    const localStorageKey = OAuth._storageTokenPrefix + credentialToken;\n    secret = Meteor._localStorage.getItem(localStorageKey);\n    Meteor._localStorage.removeItem(localStorageKey);\n  } else {\n    delete credentialSecrets[credentialToken];\n  }\n  return secret;\n};\n","// Browser specific code for the OAuth package.\n\n// Open a popup window, centered on the screen, and call a callback when it\n// closes.\n//\n// @param url {String} url to show\n// @param callback {Function} Callback function to call on completion. Takes no\n//   arguments.\n// @param dimensions {optional Object(width, height)} The dimensions of\n//   the popup. If not passed defaults to something sane.\nOAuth.showPopup = (url, callback, dimensions) => {\n  // default dimensions that worked well for facebook and google\n  const popup = openCenteredPopup(\n    url,\n    (dimensions && dimensions.width) || 650,\n    (dimensions && dimensions.height) || 331\n  );\n\n  const checkPopupOpen = setInterval(() => {\n    let popupClosed;\n    try {\n      // Fix for #328 - added a second test criteria (popup.closed === undefined)\n      // to humour this Android quirk:\n      // http://code.google.com/p/android/issues/detail?id=21061\n      popupClosed = popup.closed || popup.closed === undefined;\n    } catch (e) {\n      // For some unknown reason, IE9 (and others?) sometimes (when\n      // the popup closes too quickly?) throws \"SCRIPT16386: No such\n      // interface supported\" when trying to read 'popup.closed'. Try\n      // again in 100ms.\n      return;\n    }\n\n    if (popupClosed) {\n      clearInterval(checkPopupOpen);\n      callback();\n    }\n  }, 100);\n};\n\nconst openCenteredPopup = function(url, width, height) {\n  const screenX = typeof window.screenX !== 'undefined'\n        ? window.screenX : window.screenLeft;\n  const screenY = typeof window.screenY !== 'undefined'\n        ? window.screenY : window.screenTop;\n  const outerWidth = typeof window.outerWidth !== 'undefined'\n        ? window.outerWidth : document.body.clientWidth;\n  const outerHeight = typeof window.outerHeight !== 'undefined'\n        ? window.outerHeight : (document.body.clientHeight - 22);\n  // XXX what is the 22?\n\n  // Use `outerWidth - width` and `outerHeight - height` for help in\n  // positioning the popup centered relative to the current window\n  const left = screenX + (outerWidth - width) / 2;\n  const top = screenY + (outerHeight - height) / 2;\n  const features = (`width=${width},height=${height}` +\n                  `,left=${left},top=${top},scrollbars=yes`);\n\n\n  const newwindow = window.open(url, 'Login', features);\n\n  if (typeof newwindow === 'undefined') {\n    // blocked by a popup blocker maybe?\n    const err = new Error(\"The login popup was blocked by the browser\");\n    err.attemptedUrl = url;\n    throw err;\n  }\n\n  if (newwindow.focus)\n    newwindow.focus();\n  \n  return newwindow;\n};","OAuth._storageTokenPrefix = \"Meteor.oauth.credentialSecret-\";\n\nOAuth._redirectUri = (serviceName, config, params, absoluteUrlOptions) => {\n  // Clone because we're going to mutate 'params'. The 'cordova' and\n  // 'android' parameters are only used for picking the host of the\n  // redirect URL, and not actually included in the redirect URL itself.\n  let isCordova = false;\n  let isAndroid = false;\n  if (params) {\n    params = { ...params };\n    isCordova = params.cordova;\n    isAndroid = params.android;\n    delete params.cordova;\n    delete params.android;\n    if (Object.keys(params).length === 0) {\n      params = undefined;\n    }\n  }\n\n  if (Meteor.isServer && isCordova) {\n    const url = Npm.require('url');\n    let rootUrl = process.env.MOBILE_ROOT_URL ||\n          __meteor_runtime_config__.ROOT_URL;\n\n    if (isAndroid) {\n      // Match the replace that we do in cordova boilerplate\n      // (boilerplate-generator package).\n      // XXX Maybe we should put this in a separate package or something\n      // that is used here and by boilerplate-generator? Or maybe\n      // `Meteor.absoluteUrl` should know how to do this?\n      const parsedRootUrl = url.parse(rootUrl);\n      if (parsedRootUrl.hostname === \"localhost\") {\n        parsedRootUrl.hostname = \"10.0.2.2\";\n        delete parsedRootUrl.host;\n      }\n      rootUrl = url.format(parsedRootUrl);\n    }\n\n    absoluteUrlOptions = {\n      ...absoluteUrlOptions,\n      // For Cordova clients, redirect to the special Cordova root url\n      // (likely a local IP in development mode).\n      rootUrl,\n    };\n  }\n\n  return URL._constructUrl(\n    Meteor.absoluteUrl(`_oauth/${serviceName}`, absoluteUrlOptions),\n    null,\n    params);\n};\n"]}}]