import { BlockBuilder } from './BlockBuilder.ts';
import { require } from '../../../lib/require.ts';
const { RocketChatAssociationModel } = require('@rocket.chat/apps-engine/definition/metadata/RocketChatAssociations.js');
export class MessageBuilder {
  kind;
  msg;
  constructor(message){
    this.kind = RocketChatAssociationModel.MESSAGE;
    this.msg = message || {};
  }
  setData(data) {
    delete data.id;
    this.msg = data;
    return this;
  }
  setUpdateData(data, editor) {
    this.msg = data;
    this.msg.editor = editor;
    this.msg.editedAt = new Date();
    return this;
  }
  setThreadId(threadId) {
    this.msg.threadId = threadId;
    return this;
  }
  getThreadId() {
    return this.msg.threadId;
  }
  setRoom(room) {
    this.msg.room = room;
    return this;
  }
  getRoom() {
    return this.msg.room;
  }
  setSender(sender) {
    this.msg.sender = sender;
    return this;
  }
  getSender() {
    return this.msg.sender;
  }
  setText(text) {
    this.msg.text = text;
    return this;
  }
  getText() {
    return this.msg.text;
  }
  setEmojiAvatar(emoji) {
    this.msg.emoji = emoji;
    return this;
  }
  getEmojiAvatar() {
    return this.msg.emoji;
  }
  setAvatarUrl(avatarUrl) {
    this.msg.avatarUrl = avatarUrl;
    return this;
  }
  getAvatarUrl() {
    return this.msg.avatarUrl;
  }
  setUsernameAlias(alias) {
    this.msg.alias = alias;
    return this;
  }
  getUsernameAlias() {
    return this.msg.alias;
  }
  addAttachment(attachment) {
    if (!this.msg.attachments) {
      this.msg.attachments = [];
    }
    this.msg.attachments.push(attachment);
    return this;
  }
  setAttachments(attachments) {
    this.msg.attachments = attachments;
    return this;
  }
  getAttachments() {
    return this.msg.attachments;
  }
  replaceAttachment(position, attachment) {
    if (!this.msg.attachments) {
      this.msg.attachments = [];
    }
    if (!this.msg.attachments[position]) {
      throw new Error(`No attachment found at the index of "${position}" to replace.`);
    }
    this.msg.attachments[position] = attachment;
    return this;
  }
  removeAttachment(position) {
    if (!this.msg.attachments) {
      this.msg.attachments = [];
    }
    if (!this.msg.attachments[position]) {
      throw new Error(`No attachment found at the index of "${position}" to remove.`);
    }
    this.msg.attachments.splice(position, 1);
    return this;
  }
  setEditor(user) {
    this.msg.editor = user;
    return this;
  }
  getEditor() {
    return this.msg.editor;
  }
  setGroupable(groupable) {
    this.msg.groupable = groupable;
    return this;
  }
  getGroupable() {
    return this.msg.groupable;
  }
  setParseUrls(parseUrls) {
    this.msg.parseUrls = parseUrls;
    return this;
  }
  getParseUrls() {
    return this.msg.parseUrls;
  }
  getMessage() {
    if (!this.msg.room) {
      throw new Error('The "room" property is required.');
    }
    return this.msg;
  }
  addBlocks(blocks) {
    if (!Array.isArray(this.msg.blocks)) {
      this.msg.blocks = [];
    }
    if (blocks instanceof BlockBuilder) {
      this.msg.blocks.push(...blocks.getBlocks());
    } else {
      this.msg.blocks.push(...blocks);
    }
    return this;
  }
  setBlocks(blocks) {
    if (blocks instanceof BlockBuilder) {
      this.msg.blocks = blocks.getBlocks();
    } else {
      this.msg.blocks = blocks;
    }
    return this;
  }
  getBlocks() {
    return this.msg.blocks;
  }
  addCustomField(key, value) {
    if (!this.msg.customFields) {
      this.msg.customFields = {};
    }
    if (this.msg.customFields[key]) {
      throw new Error(`The message already contains a custom field by the key: ${key}`);
    }
    if (key.includes('.')) {
      throw new Error(`The given key contains a period, which is not allowed. Key: ${key}`);
    }
    this.msg.customFields[key] = value;
    return this;
  }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZpbGU6Ly8vVXNlcnMvYWJoaW5hdi9yb2NrZXQuY2hhdC9Sb2NrZXQuQ2hhdC9wYWNrYWdlcy9hcHBzLWVuZ2luZS9kZW5vLXJ1bnRpbWUvbGliL2FjY2Vzc29ycy9idWlsZGVycy9NZXNzYWdlQnVpbGRlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBMYXlvdXRCbG9jayB9IGZyb20gJ0Byb2NrZXQuY2hhdC91aS1raXQnO1xuXG5pbXBvcnQgdHlwZSB7IElNZXNzYWdlQnVpbGRlciB9IGZyb20gJ0Byb2NrZXQuY2hhdC9hcHBzLWVuZ2luZS9kZWZpbml0aW9uL2FjY2Vzc29ycy9JTWVzc2FnZUJ1aWxkZXIudHMnO1xuaW1wb3J0IHR5cGUgeyBSb2NrZXRDaGF0QXNzb2NpYXRpb25Nb2RlbCBhcyBfUm9ja2V0Q2hhdEFzc29jaWF0aW9uTW9kZWwgfSBmcm9tICdAcm9ja2V0LmNoYXQvYXBwcy1lbmdpbmUvZGVmaW5pdGlvbi9tZXRhZGF0YS9Sb2NrZXRDaGF0QXNzb2NpYXRpb25zLnRzJztcbmltcG9ydCB0eXBlIHsgSU1lc3NhZ2UgfSBmcm9tICdAcm9ja2V0LmNoYXQvYXBwcy1lbmdpbmUvZGVmaW5pdGlvbi9tZXNzYWdlcy9JTWVzc2FnZS50cyc7XG5pbXBvcnQgdHlwZSB7IElNZXNzYWdlQXR0YWNobWVudCB9IGZyb20gJ0Byb2NrZXQuY2hhdC9hcHBzLWVuZ2luZS9kZWZpbml0aW9uL21lc3NhZ2VzL0lNZXNzYWdlQXR0YWNobWVudC50cyc7XG5pbXBvcnQgdHlwZSB7IElVc2VyIH0gZnJvbSAnQHJvY2tldC5jaGF0L2FwcHMtZW5naW5lL2RlZmluaXRpb24vdXNlcnMvSVVzZXIudHMnO1xuaW1wb3J0IHR5cGUgeyBJUm9vbSB9IGZyb20gJ0Byb2NrZXQuY2hhdC9hcHBzLWVuZ2luZS9kZWZpbml0aW9uL3Jvb21zL0lSb29tLnRzJztcbmltcG9ydCB0eXBlIHsgSUJsb2NrIH0gZnJvbSAnQHJvY2tldC5jaGF0L2FwcHMtZW5naW5lL2RlZmluaXRpb24vdWlraXQvYmxvY2tzL0Jsb2Nrcy50cyc7XG5cbmltcG9ydCB7IEJsb2NrQnVpbGRlciB9IGZyb20gJy4vQmxvY2tCdWlsZGVyLnRzJztcbmltcG9ydCB7IHJlcXVpcmUgfSBmcm9tICcuLi8uLi8uLi9saWIvcmVxdWlyZS50cyc7XG5cbmNvbnN0IHsgUm9ja2V0Q2hhdEFzc29jaWF0aW9uTW9kZWwgfSA9IHJlcXVpcmUoJ0Byb2NrZXQuY2hhdC9hcHBzLWVuZ2luZS9kZWZpbml0aW9uL21ldGFkYXRhL1JvY2tldENoYXRBc3NvY2lhdGlvbnMuanMnKSBhcyB7XG4gICAgUm9ja2V0Q2hhdEFzc29jaWF0aW9uTW9kZWw6IHR5cGVvZiBfUm9ja2V0Q2hhdEFzc29jaWF0aW9uTW9kZWw7XG59O1xuXG5leHBvcnQgY2xhc3MgTWVzc2FnZUJ1aWxkZXIgaW1wbGVtZW50cyBJTWVzc2FnZUJ1aWxkZXIge1xuICAgIHB1YmxpYyBraW5kOiBfUm9ja2V0Q2hhdEFzc29jaWF0aW9uTW9kZWwuTUVTU0FHRTtcblxuICAgIHByaXZhdGUgbXNnOiBJTWVzc2FnZTtcblxuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2U/OiBJTWVzc2FnZSkge1xuICAgICAgICB0aGlzLmtpbmQgPSBSb2NrZXRDaGF0QXNzb2NpYXRpb25Nb2RlbC5NRVNTQUdFO1xuICAgICAgICB0aGlzLm1zZyA9IG1lc3NhZ2UgfHwgKHt9IGFzIElNZXNzYWdlKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0RGF0YShkYXRhOiBJTWVzc2FnZSk6IElNZXNzYWdlQnVpbGRlciB7XG4gICAgICAgIGRlbGV0ZSBkYXRhLmlkO1xuICAgICAgICB0aGlzLm1zZyA9IGRhdGE7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMgYXMgSU1lc3NhZ2VCdWlsZGVyO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRVcGRhdGVEYXRhKGRhdGE6IElNZXNzYWdlLCBlZGl0b3I6IElVc2VyKTogSU1lc3NhZ2VCdWlsZGVyIHtcbiAgICAgICAgdGhpcy5tc2cgPSBkYXRhO1xuICAgICAgICB0aGlzLm1zZy5lZGl0b3IgPSBlZGl0b3I7XG4gICAgICAgIHRoaXMubXNnLmVkaXRlZEF0ID0gbmV3IERhdGUoKTtcblxuICAgICAgICByZXR1cm4gdGhpcyBhcyBJTWVzc2FnZUJ1aWxkZXI7XG4gICAgfVxuXG4gICAgcHVibGljIHNldFRocmVhZElkKHRocmVhZElkOiBzdHJpbmcpOiBJTWVzc2FnZUJ1aWxkZXIge1xuICAgICAgICB0aGlzLm1zZy50aHJlYWRJZCA9IHRocmVhZElkO1xuXG4gICAgICAgIHJldHVybiB0aGlzIGFzIElNZXNzYWdlQnVpbGRlcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0VGhyZWFkSWQoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubXNnLnRocmVhZElkITtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0Um9vbShyb29tOiBJUm9vbSk6IElNZXNzYWdlQnVpbGRlciB7XG4gICAgICAgIHRoaXMubXNnLnJvb20gPSByb29tO1xuICAgICAgICByZXR1cm4gdGhpcyBhcyBJTWVzc2FnZUJ1aWxkZXI7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFJvb20oKTogSVJvb20ge1xuICAgICAgICByZXR1cm4gdGhpcy5tc2cucm9vbTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0U2VuZGVyKHNlbmRlcjogSVVzZXIpOiBJTWVzc2FnZUJ1aWxkZXIge1xuICAgICAgICB0aGlzLm1zZy5zZW5kZXIgPSBzZW5kZXI7XG4gICAgICAgIHJldHVybiB0aGlzIGFzIElNZXNzYWdlQnVpbGRlcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0U2VuZGVyKCk6IElVc2VyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubXNnLnNlbmRlcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0VGV4dCh0ZXh0OiBzdHJpbmcpOiBJTWVzc2FnZUJ1aWxkZXIge1xuICAgICAgICB0aGlzLm1zZy50ZXh0ID0gdGV4dDtcbiAgICAgICAgcmV0dXJuIHRoaXMgYXMgSU1lc3NhZ2VCdWlsZGVyO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRUZXh0KCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLm1zZy50ZXh0ITtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0RW1vamlBdmF0YXIoZW1vamk6IHN0cmluZyk6IElNZXNzYWdlQnVpbGRlciB7XG4gICAgICAgIHRoaXMubXNnLmVtb2ppID0gZW1vamk7XG4gICAgICAgIHJldHVybiB0aGlzIGFzIElNZXNzYWdlQnVpbGRlcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0RW1vamlBdmF0YXIoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubXNnLmVtb2ppITtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0QXZhdGFyVXJsKGF2YXRhclVybDogc3RyaW5nKTogSU1lc3NhZ2VCdWlsZGVyIHtcbiAgICAgICAgdGhpcy5tc2cuYXZhdGFyVXJsID0gYXZhdGFyVXJsO1xuICAgICAgICByZXR1cm4gdGhpcyBhcyBJTWVzc2FnZUJ1aWxkZXI7XG4gICAgfVxuXG4gICAgcHVibGljIGdldEF2YXRhclVybCgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5tc2cuYXZhdGFyVXJsITtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0VXNlcm5hbWVBbGlhcyhhbGlhczogc3RyaW5nKTogSU1lc3NhZ2VCdWlsZGVyIHtcbiAgICAgICAgdGhpcy5tc2cuYWxpYXMgPSBhbGlhcztcbiAgICAgICAgcmV0dXJuIHRoaXMgYXMgSU1lc3NhZ2VCdWlsZGVyO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRVc2VybmFtZUFsaWFzKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLm1zZy5hbGlhcyE7XG4gICAgfVxuXG4gICAgcHVibGljIGFkZEF0dGFjaG1lbnQoYXR0YWNobWVudDogSU1lc3NhZ2VBdHRhY2htZW50KTogSU1lc3NhZ2VCdWlsZGVyIHtcbiAgICAgICAgaWYgKCF0aGlzLm1zZy5hdHRhY2htZW50cykge1xuICAgICAgICAgICAgdGhpcy5tc2cuYXR0YWNobWVudHMgPSBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubXNnLmF0dGFjaG1lbnRzLnB1c2goYXR0YWNobWVudCk7XG4gICAgICAgIHJldHVybiB0aGlzIGFzIElNZXNzYWdlQnVpbGRlcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0QXR0YWNobWVudHMoYXR0YWNobWVudHM6IEFycmF5PElNZXNzYWdlQXR0YWNobWVudD4pOiBJTWVzc2FnZUJ1aWxkZXIge1xuICAgICAgICB0aGlzLm1zZy5hdHRhY2htZW50cyA9IGF0dGFjaG1lbnRzO1xuICAgICAgICByZXR1cm4gdGhpcyBhcyBJTWVzc2FnZUJ1aWxkZXI7XG4gICAgfVxuXG4gICAgcHVibGljIGdldEF0dGFjaG1lbnRzKCk6IEFycmF5PElNZXNzYWdlQXR0YWNobWVudD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5tc2cuYXR0YWNobWVudHMhO1xuICAgIH1cblxuICAgIHB1YmxpYyByZXBsYWNlQXR0YWNobWVudChwb3NpdGlvbjogbnVtYmVyLCBhdHRhY2htZW50OiBJTWVzc2FnZUF0dGFjaG1lbnQpOiBJTWVzc2FnZUJ1aWxkZXIge1xuICAgICAgICBpZiAoIXRoaXMubXNnLmF0dGFjaG1lbnRzKSB7XG4gICAgICAgICAgICB0aGlzLm1zZy5hdHRhY2htZW50cyA9IFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF0aGlzLm1zZy5hdHRhY2htZW50c1twb3NpdGlvbl0pIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gYXR0YWNobWVudCBmb3VuZCBhdCB0aGUgaW5kZXggb2YgXCIke3Bvc2l0aW9ufVwiIHRvIHJlcGxhY2UuYCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm1zZy5hdHRhY2htZW50c1twb3NpdGlvbl0gPSBhdHRhY2htZW50O1xuICAgICAgICByZXR1cm4gdGhpcyBhcyBJTWVzc2FnZUJ1aWxkZXI7XG4gICAgfVxuXG4gICAgcHVibGljIHJlbW92ZUF0dGFjaG1lbnQocG9zaXRpb246IG51bWJlcik6IElNZXNzYWdlQnVpbGRlciB7XG4gICAgICAgIGlmICghdGhpcy5tc2cuYXR0YWNobWVudHMpIHtcbiAgICAgICAgICAgIHRoaXMubXNnLmF0dGFjaG1lbnRzID0gW107XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMubXNnLmF0dGFjaG1lbnRzW3Bvc2l0aW9uXSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBhdHRhY2htZW50IGZvdW5kIGF0IHRoZSBpbmRleCBvZiBcIiR7cG9zaXRpb259XCIgdG8gcmVtb3ZlLmApO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5tc2cuYXR0YWNobWVudHMuc3BsaWNlKHBvc2l0aW9uLCAxKTtcblxuICAgICAgICByZXR1cm4gdGhpcyBhcyBJTWVzc2FnZUJ1aWxkZXI7XG4gICAgfVxuXG4gICAgcHVibGljIHNldEVkaXRvcih1c2VyOiBJVXNlcik6IElNZXNzYWdlQnVpbGRlciB7XG4gICAgICAgIHRoaXMubXNnLmVkaXRvciA9IHVzZXI7XG4gICAgICAgIHJldHVybiB0aGlzIGFzIElNZXNzYWdlQnVpbGRlcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0RWRpdG9yKCk6IElVc2VyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubXNnLmVkaXRvcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0R3JvdXBhYmxlKGdyb3VwYWJsZTogYm9vbGVhbik6IElNZXNzYWdlQnVpbGRlciB7XG4gICAgICAgIHRoaXMubXNnLmdyb3VwYWJsZSA9IGdyb3VwYWJsZTtcbiAgICAgICAgcmV0dXJuIHRoaXMgYXMgSU1lc3NhZ2VCdWlsZGVyO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRHcm91cGFibGUoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLm1zZy5ncm91cGFibGUhO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRQYXJzZVVybHMocGFyc2VVcmxzOiBib29sZWFuKTogSU1lc3NhZ2VCdWlsZGVyIHtcbiAgICAgICAgdGhpcy5tc2cucGFyc2VVcmxzID0gcGFyc2VVcmxzO1xuICAgICAgICByZXR1cm4gdGhpcyBhcyBJTWVzc2FnZUJ1aWxkZXI7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFBhcnNlVXJscygpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubXNnLnBhcnNlVXJscyE7XG4gICAgfVxuXG4gICAgcHVibGljIGdldE1lc3NhZ2UoKTogSU1lc3NhZ2Uge1xuICAgICAgICBpZiAoIXRoaXMubXNnLnJvb20pIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIFwicm9vbVwiIHByb3BlcnR5IGlzIHJlcXVpcmVkLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMubXNnO1xuICAgIH1cblxuICAgIHB1YmxpYyBhZGRCbG9ja3MoYmxvY2tzOiBCbG9ja0J1aWxkZXIgfCBBcnJheTxJQmxvY2sgfCBMYXlvdXRCbG9jaz4pIHtcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHRoaXMubXNnLmJsb2NrcykpIHtcbiAgICAgICAgICAgIHRoaXMubXNnLmJsb2NrcyA9IFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGJsb2NrcyBpbnN0YW5jZW9mIEJsb2NrQnVpbGRlcikge1xuICAgICAgICAgICAgdGhpcy5tc2cuYmxvY2tzLnB1c2goLi4uYmxvY2tzLmdldEJsb2NrcygpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubXNnLmJsb2Nrcy5wdXNoKC4uLmJsb2Nrcyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcyBhcyBJTWVzc2FnZUJ1aWxkZXI7XG4gICAgfVxuXG4gICAgcHVibGljIHNldEJsb2NrcyhibG9ja3M6IEJsb2NrQnVpbGRlciB8IEFycmF5PElCbG9jayB8IExheW91dEJsb2NrPikge1xuICAgICAgICBpZiAoYmxvY2tzIGluc3RhbmNlb2YgQmxvY2tCdWlsZGVyKSB7XG4gICAgICAgICAgICB0aGlzLm1zZy5ibG9ja3MgPSBibG9ja3MuZ2V0QmxvY2tzKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm1zZy5ibG9ja3MgPSBibG9ja3M7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcyBhcyBJTWVzc2FnZUJ1aWxkZXI7XG4gICAgfVxuXG4gICAgcHVibGljIGdldEJsb2NrcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubXNnLmJsb2NrcyE7XG4gICAgfVxuXG4gICAgcHVibGljIGFkZEN1c3RvbUZpZWxkKGtleTogc3RyaW5nLCB2YWx1ZTogdW5rbm93bik6IElNZXNzYWdlQnVpbGRlciB7XG4gICAgICAgIGlmICghdGhpcy5tc2cuY3VzdG9tRmllbGRzKSB7XG4gICAgICAgICAgICB0aGlzLm1zZy5jdXN0b21GaWVsZHMgPSB7fTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLm1zZy5jdXN0b21GaWVsZHNba2V5XSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgbWVzc2FnZSBhbHJlYWR5IGNvbnRhaW5zIGEgY3VzdG9tIGZpZWxkIGJ5IHRoZSBrZXk6ICR7a2V5fWApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGtleS5pbmNsdWRlcygnLicpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBnaXZlbiBrZXkgY29udGFpbnMgYSBwZXJpb2QsIHdoaWNoIGlzIG5vdCBhbGxvd2VkLiBLZXk6ICR7a2V5fWApO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5tc2cuY3VzdG9tRmllbGRzW2tleV0gPSB2YWx1ZTtcblxuICAgICAgICByZXR1cm4gdGhpcyBhcyBJTWVzc2FnZUJ1aWxkZXI7XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQVVBLFNBQVMsWUFBWSxRQUFRLG9CQUFvQjtBQUNqRCxTQUFTLE9BQU8sUUFBUSwwQkFBMEI7QUFFbEQsTUFBTSxFQUFFLDBCQUEwQixFQUFFLEdBQUcsUUFBUTtBQUkvQyxPQUFPLE1BQU07RUFDRixLQUEwQztFQUV6QyxJQUFjO0VBRXRCLFlBQVksT0FBa0IsQ0FBRTtJQUM1QixJQUFJLENBQUMsSUFBSSxHQUFHLDJCQUEyQixPQUFPO0lBQzlDLElBQUksQ0FBQyxHQUFHLEdBQUcsV0FBWSxDQUFDO0VBQzVCO0VBRU8sUUFBUSxJQUFjLEVBQW1CO0lBQzVDLE9BQU8sS0FBSyxFQUFFO0lBQ2QsSUFBSSxDQUFDLEdBQUcsR0FBRztJQUVYLE9BQU8sSUFBSTtFQUNmO0VBRU8sY0FBYyxJQUFjLEVBQUUsTUFBYSxFQUFtQjtJQUNqRSxJQUFJLENBQUMsR0FBRyxHQUFHO0lBQ1gsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEdBQUc7SUFDbEIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEdBQUcsSUFBSTtJQUV4QixPQUFPLElBQUk7RUFDZjtFQUVPLFlBQVksUUFBZ0IsRUFBbUI7SUFDbEQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEdBQUc7SUFFcEIsT0FBTyxJQUFJO0VBQ2Y7RUFFTyxjQUFzQjtJQUN6QixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUTtFQUM1QjtFQUVPLFFBQVEsSUFBVyxFQUFtQjtJQUN6QyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksR0FBRztJQUNoQixPQUFPLElBQUk7RUFDZjtFQUVPLFVBQWlCO0lBQ3BCLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJO0VBQ3hCO0VBRU8sVUFBVSxNQUFhLEVBQW1CO0lBQzdDLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxHQUFHO0lBQ2xCLE9BQU8sSUFBSTtFQUNmO0VBRU8sWUFBbUI7SUFDdEIsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU07RUFDMUI7RUFFTyxRQUFRLElBQVksRUFBbUI7SUFDMUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEdBQUc7SUFDaEIsT0FBTyxJQUFJO0VBQ2Y7RUFFTyxVQUFrQjtJQUNyQixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSTtFQUN4QjtFQUVPLGVBQWUsS0FBYSxFQUFtQjtJQUNsRCxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssR0FBRztJQUNqQixPQUFPLElBQUk7RUFDZjtFQUVPLGlCQUF5QjtJQUM1QixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSztFQUN6QjtFQUVPLGFBQWEsU0FBaUIsRUFBbUI7SUFDcEQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEdBQUc7SUFDckIsT0FBTyxJQUFJO0VBQ2Y7RUFFTyxlQUF1QjtJQUMxQixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUztFQUM3QjtFQUVPLGlCQUFpQixLQUFhLEVBQW1CO0lBQ3BELElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxHQUFHO0lBQ2pCLE9BQU8sSUFBSTtFQUNmO0VBRU8sbUJBQTJCO0lBQzlCLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLO0VBQ3pCO0VBRU8sY0FBYyxVQUE4QixFQUFtQjtJQUNsRSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUU7TUFDdkIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEdBQUcsRUFBRTtJQUM3QjtJQUVBLElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQztJQUMxQixPQUFPLElBQUk7RUFDZjtFQUVPLGVBQWUsV0FBc0MsRUFBbUI7SUFDM0UsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEdBQUc7SUFDdkIsT0FBTyxJQUFJO0VBQ2Y7RUFFTyxpQkFBNEM7SUFDL0MsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLFdBQVc7RUFDL0I7RUFFTyxrQkFBa0IsUUFBZ0IsRUFBRSxVQUE4QixFQUFtQjtJQUN4RixJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUU7TUFDdkIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEdBQUcsRUFBRTtJQUM3QjtJQUVBLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxTQUFTLEVBQUU7TUFDakMsTUFBTSxJQUFJLE1BQU0sQ0FBQyxxQ0FBcUMsRUFBRSxTQUFTLGFBQWEsQ0FBQztJQUNuRjtJQUVBLElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLFNBQVMsR0FBRztJQUNqQyxPQUFPLElBQUk7RUFDZjtFQUVPLGlCQUFpQixRQUFnQixFQUFtQjtJQUN2RCxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUU7TUFDdkIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEdBQUcsRUFBRTtJQUM3QjtJQUVBLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxTQUFTLEVBQUU7TUFDakMsTUFBTSxJQUFJLE1BQU0sQ0FBQyxxQ0FBcUMsRUFBRSxTQUFTLFlBQVksQ0FBQztJQUNsRjtJQUVBLElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxVQUFVO0lBRXRDLE9BQU8sSUFBSTtFQUNmO0VBRU8sVUFBVSxJQUFXLEVBQW1CO0lBQzNDLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxHQUFHO0lBQ2xCLE9BQU8sSUFBSTtFQUNmO0VBRU8sWUFBbUI7SUFDdEIsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU07RUFDMUI7RUFFTyxhQUFhLFNBQWtCLEVBQW1CO0lBQ3JELElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxHQUFHO0lBQ3JCLE9BQU8sSUFBSTtFQUNmO0VBRU8sZUFBd0I7SUFDM0IsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVM7RUFDN0I7RUFFTyxhQUFhLFNBQWtCLEVBQW1CO0lBQ3JELElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxHQUFHO0lBQ3JCLE9BQU8sSUFBSTtFQUNmO0VBRU8sZUFBd0I7SUFDM0IsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVM7RUFDN0I7RUFFTyxhQUF1QjtJQUMxQixJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUU7TUFDaEIsTUFBTSxJQUFJLE1BQU07SUFDcEI7SUFFQSxPQUFPLElBQUksQ0FBQyxHQUFHO0VBQ25CO0VBRU8sVUFBVSxNQUFrRCxFQUFFO0lBQ2pFLElBQUksQ0FBQyxNQUFNLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRztNQUNqQyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxFQUFFO0lBQ3hCO0lBRUEsSUFBSSxrQkFBa0IsY0FBYztNQUNoQyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLElBQUksT0FBTyxTQUFTO0lBQzVDLE9BQU87TUFDSCxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLElBQUk7SUFDNUI7SUFFQSxPQUFPLElBQUk7RUFDZjtFQUVPLFVBQVUsTUFBa0QsRUFBRTtJQUNqRSxJQUFJLGtCQUFrQixjQUFjO01BQ2hDLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxHQUFHLE9BQU8sU0FBUztJQUN0QyxPQUFPO01BQ0gsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEdBQUc7SUFDdEI7SUFFQSxPQUFPLElBQUk7RUFDZjtFQUVPLFlBQVk7SUFDZixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTTtFQUMxQjtFQUVPLGVBQWUsR0FBVyxFQUFFLEtBQWMsRUFBbUI7SUFDaEUsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFO01BQ3hCLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxHQUFHLENBQUM7SUFDN0I7SUFFQSxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRTtNQUM1QixNQUFNLElBQUksTUFBTSxDQUFDLHdEQUF3RCxFQUFFLElBQUksQ0FBQztJQUNwRjtJQUVBLElBQUksSUFBSSxRQUFRLENBQUMsTUFBTTtNQUNuQixNQUFNLElBQUksTUFBTSxDQUFDLDREQUE0RCxFQUFFLElBQUksQ0FBQztJQUN4RjtJQUVBLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLElBQUksR0FBRztJQUU3QixPQUFPLElBQUk7RUFDZjtBQUNKIn0=