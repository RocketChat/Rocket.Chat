import { writeAll } from "https://deno.land/std@0.216.0/io/write_all.ts";
import * as jsonrpc from 'jsonrpc-lite';
import { AppObjectRegistry } from '../AppObjectRegistry.ts';
import { encoder } from './codec.ts';
export function isRequest(message) {
  return message.type === 'request' || message.type === 'notification';
}
export function isResponse(message) {
  return message.type === 'success' || message.type === 'error';
}
export function isErrorResponse(message) {
  return message instanceof jsonrpc.ErrorObject;
}
const COMMAND_PONG = '_zPONG';
export const RPCResponseObserver = new EventTarget();
export const Queue = new class Queue {
  queue = [];
  isProcessing = false;
  async processQueue() {
    if (this.isProcessing) {
      return;
    }
    this.isProcessing = true;
    while(this.queue.length){
      const message = this.queue.shift();
      if (message) {
        await Transport.send(message);
      }
    }
    this.isProcessing = false;
  }
  enqueue(message) {
    this.queue.push(encoder.encode(message));
    this.processQueue();
  }
  getCurrentSize() {
    return this.queue.length;
  }
};
export const Transport = new class Transporter {
  selectedTransport;
  constructor(){
    this.selectedTransport = this.stdoutTransport.bind(this);
  }
  async stdoutTransport(message) {
    await writeAll(Deno.stdout, message);
  }
  async noopTransport(_message) {}
  selectTransport(transport) {
    switch(transport){
      case 'stdout':
        this.selectedTransport = this.stdoutTransport.bind(this);
        break;
      case 'noop':
        this.selectedTransport = this.noopTransport.bind(this);
        break;
    }
  }
  send(message) {
    return this.selectedTransport(message);
  }
}();
export function parseMessage(message) {
  let parsed;
  if (typeof message === 'string') {
    parsed = jsonrpc.parse(message);
  } else {
    parsed = jsonrpc.parseObject(message);
  }
  if (Array.isArray(parsed)) {
    throw jsonrpc.error(null, jsonrpc.JsonRpcError.invalidRequest(null));
  }
  if (parsed.type === 'invalid') {
    throw jsonrpc.error(null, parsed.payload);
  }
  return parsed;
}
export async function sendInvalidRequestError() {
  const rpc = jsonrpc.error(null, jsonrpc.JsonRpcError.invalidRequest(null));
  await Queue.enqueue(rpc);
}
export async function sendInvalidParamsError(id) {
  const rpc = jsonrpc.error(id, jsonrpc.JsonRpcError.invalidParams(null));
  await Queue.enqueue(rpc);
}
export async function sendParseError() {
  const rpc = jsonrpc.error(null, jsonrpc.JsonRpcError.parseError(null));
  await Queue.enqueue(rpc);
}
export async function sendMethodNotFound(id) {
  const rpc = jsonrpc.error(id, jsonrpc.JsonRpcError.methodNotFound(null));
  await Queue.enqueue(rpc);
}
export async function errorResponse({ error: { message, code = -32000, data = {} }, id }) {
  const logger = AppObjectRegistry.get('logger');
  if (logger?.hasEntries()) {
    data.logs = logger.getLogs();
  }
  const rpc = jsonrpc.error(id, new jsonrpc.JsonRpcError(message, code, data));
  await Queue.enqueue(rpc);
}
export async function successResponse({ id, result }) {
  const payload = {
    value: result
  };
  const logger = AppObjectRegistry.get('logger');
  if (logger?.hasEntries()) {
    payload.logs = logger.getLogs();
  }
  const rpc = jsonrpc.success(id, payload);
  await Queue.enqueue(rpc);
}
export function pongResponse() {
  return Promise.resolve(Queue.enqueue(COMMAND_PONG));
}
export async function sendRequest(requestDescriptor) {
  const request = jsonrpc.request(Math.random().toString(36).slice(2), requestDescriptor.method, requestDescriptor.params);
  // TODO: add timeout to this
  const responsePromise = new Promise((resolve, reject)=>{
    const handler = (event)=>{
      if (event instanceof ErrorEvent) {
        reject(event.error);
      }
      if (event instanceof CustomEvent) {
        resolve(event.detail);
      }
      RPCResponseObserver.removeEventListener(`response:${request.id}`, handler);
    };
    RPCResponseObserver.addEventListener(`response:${request.id}`, handler);
  });
  await Queue.enqueue(request);
  return responsePromise;
}
export function sendNotification({ method, params }) {
  const request = jsonrpc.notification(method, params);
  Queue.enqueue(request);
}
export function log(params) {
  sendNotification({
    method: 'log',
    params
  });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZpbGU6Ly8vVXNlcnMvYWJoaW5hdi9yb2NrZXQuY2hhdC9Sb2NrZXQuQ2hhdC9wYWNrYWdlcy9hcHBzLWVuZ2luZS9kZW5vLXJ1bnRpbWUvbGliL21lc3Nlbmdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB3cml0ZUFsbCB9IGZyb20gXCJodHRwczovL2Rlbm8ubGFuZC9zdGRAMC4yMTYuMC9pby93cml0ZV9hbGwudHNcIjtcblxuaW1wb3J0ICogYXMganNvbnJwYyBmcm9tICdqc29ucnBjLWxpdGUnO1xuXG5pbXBvcnQgeyBBcHBPYmplY3RSZWdpc3RyeSB9IGZyb20gJy4uL0FwcE9iamVjdFJlZ2lzdHJ5LnRzJztcbmltcG9ydCB0eXBlIHsgTG9nZ2VyIH0gZnJvbSAnLi9sb2dnZXIudHMnO1xuaW1wb3J0IHsgZW5jb2RlciB9IGZyb20gJy4vY29kZWMudHMnO1xuXG5leHBvcnQgdHlwZSBSZXF1ZXN0RGVzY3JpcHRvciA9IFBpY2s8anNvbnJwYy5SZXF1ZXN0T2JqZWN0LCAnbWV0aG9kJyB8ICdwYXJhbXMnPjtcblxuZXhwb3J0IHR5cGUgTm90aWZpY2F0aW9uRGVzY3JpcHRvciA9IFBpY2s8anNvbnJwYy5Ob3RpZmljYXRpb25PYmplY3QsICdtZXRob2QnIHwgJ3BhcmFtcyc+O1xuXG5leHBvcnQgdHlwZSBTdWNjZXNzUmVzcG9uc2VEZXNjcmlwdG9yID0gUGljazxqc29ucnBjLlN1Y2Nlc3NPYmplY3QsICdpZCcgfCAncmVzdWx0Jz47XG5cbmV4cG9ydCB0eXBlIEVycm9yUmVzcG9uc2VEZXNjcmlwdG9yID0gUGljazxqc29ucnBjLkVycm9yT2JqZWN0LCAnaWQnIHwgJ2Vycm9yJz47XG5cbmV4cG9ydCB0eXBlIEpzb25ScGNSZXF1ZXN0ID0ganNvbnJwYy5JUGFyc2VkT2JqZWN0UmVxdWVzdCB8IGpzb25ycGMuSVBhcnNlZE9iamVjdE5vdGlmaWNhdGlvbjtcbmV4cG9ydCB0eXBlIEpzb25ScGNSZXNwb25zZSA9IGpzb25ycGMuSVBhcnNlZE9iamVjdFN1Y2Nlc3MgfCBqc29ucnBjLklQYXJzZWRPYmplY3RFcnJvcjtcblxuZXhwb3J0IGZ1bmN0aW9uIGlzUmVxdWVzdChtZXNzYWdlOiBqc29ucnBjLklQYXJzZWRPYmplY3QpOiBtZXNzYWdlIGlzIEpzb25ScGNSZXF1ZXN0IHtcbiAgICByZXR1cm4gbWVzc2FnZS50eXBlID09PSAncmVxdWVzdCcgfHwgbWVzc2FnZS50eXBlID09PSAnbm90aWZpY2F0aW9uJztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzUmVzcG9uc2UobWVzc2FnZToganNvbnJwYy5JUGFyc2VkT2JqZWN0KTogbWVzc2FnZSBpcyBKc29uUnBjUmVzcG9uc2Uge1xuICAgIHJldHVybiBtZXNzYWdlLnR5cGUgPT09ICdzdWNjZXNzJyB8fCBtZXNzYWdlLnR5cGUgPT09ICdlcnJvcic7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0Vycm9yUmVzcG9uc2UobWVzc2FnZToganNvbnJwYy5Kc29uUnBjKTogbWVzc2FnZSBpcyBqc29ucnBjLkVycm9yT2JqZWN0IHtcbiAgICByZXR1cm4gbWVzc2FnZSBpbnN0YW5jZW9mIGpzb25ycGMuRXJyb3JPYmplY3Q7XG59XG5cbmNvbnN0IENPTU1BTkRfUE9ORyA9ICdfelBPTkcnO1xuXG5leHBvcnQgY29uc3QgUlBDUmVzcG9uc2VPYnNlcnZlciA9IG5ldyBFdmVudFRhcmdldCgpO1xuXG5leHBvcnQgY29uc3QgUXVldWUgPSBuZXcgKGNsYXNzIFF1ZXVlIHtcbiAgICBwcml2YXRlIHF1ZXVlOiBVaW50OEFycmF5W10gPSBbXTtcbiAgICBwcml2YXRlIGlzUHJvY2Vzc2luZyA9IGZhbHNlO1xuXG4gICAgcHJpdmF0ZSBhc3luYyBwcm9jZXNzUXVldWUoKSB7XG4gICAgICAgIGlmICh0aGlzLmlzUHJvY2Vzc2luZykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5pc1Byb2Nlc3NpbmcgPSB0cnVlO1xuXG4gICAgICAgIHdoaWxlICh0aGlzLnF1ZXVlLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IHRoaXMucXVldWUuc2hpZnQoKTtcblxuICAgICAgICAgICAgaWYgKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBUcmFuc3BvcnQuc2VuZChtZXNzYWdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuaXNQcm9jZXNzaW5nID0gZmFsc2U7XG4gICAgfVxuXG4gICAgcHVibGljIGVucXVldWUobWVzc2FnZToganNvbnJwYy5Kc29uUnBjIHwgdHlwZW9mIENPTU1BTkRfUE9ORykge1xuICAgICAgICB0aGlzLnF1ZXVlLnB1c2goZW5jb2Rlci5lbmNvZGUobWVzc2FnZSkpO1xuICAgICAgICB0aGlzLnByb2Nlc3NRdWV1ZSgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRDdXJyZW50U2l6ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucXVldWUubGVuZ3RoO1xuICAgIH1cbn0pO1xuXG5leHBvcnQgY29uc3QgVHJhbnNwb3J0ID0gbmV3IChjbGFzcyBUcmFuc3BvcnRlciB7XG4gICAgcHJpdmF0ZSBzZWxlY3RlZFRyYW5zcG9ydDogVHJhbnNwb3J0ZXJbJ3N0ZG91dFRyYW5zcG9ydCddIHwgVHJhbnNwb3J0ZXJbJ25vb3BUcmFuc3BvcnQnXTtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnNlbGVjdGVkVHJhbnNwb3J0ID0gdGhpcy5zdGRvdXRUcmFuc3BvcnQuYmluZCh0aGlzKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIHN0ZG91dFRyYW5zcG9ydChtZXNzYWdlOiBVaW50OEFycmF5KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGF3YWl0IHdyaXRlQWxsKERlbm8uc3Rkb3V0LCBtZXNzYWdlKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIG5vb3BUcmFuc3BvcnQoX21lc3NhZ2U6IFVpbnQ4QXJyYXkpOiBQcm9taXNlPHZvaWQ+IHt9XG5cbiAgICBwdWJsaWMgc2VsZWN0VHJhbnNwb3J0KHRyYW5zcG9ydDogJ3N0ZG91dCcgfCAnbm9vcCcpOiB2b2lkIHtcbiAgICAgICAgc3dpdGNoICh0cmFuc3BvcnQpIHtcbiAgICAgICAgICAgIGNhc2UgJ3N0ZG91dCc6XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFRyYW5zcG9ydCA9IHRoaXMuc3Rkb3V0VHJhbnNwb3J0LmJpbmQodGhpcyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdub29wJzpcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkVHJhbnNwb3J0ID0gdGhpcy5ub29wVHJhbnNwb3J0LmJpbmQodGhpcyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgc2VuZChtZXNzYWdlOiBVaW50OEFycmF5KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkVHJhbnNwb3J0KG1lc3NhZ2UpO1xuICAgIH1cbn0pKCk7XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZU1lc3NhZ2UobWVzc2FnZTogc3RyaW5nIHwgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pIHtcbiAgICBsZXQgcGFyc2VkOiBqc29ucnBjLklQYXJzZWRPYmplY3QgfCBqc29ucnBjLklQYXJzZWRPYmplY3RbXTtcblxuICAgIGlmICh0eXBlb2YgbWVzc2FnZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcGFyc2VkID0ganNvbnJwYy5wYXJzZShtZXNzYWdlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBwYXJzZWQgPSBqc29ucnBjLnBhcnNlT2JqZWN0KG1lc3NhZ2UpO1xuICAgIH1cblxuICAgIGlmIChBcnJheS5pc0FycmF5KHBhcnNlZCkpIHtcbiAgICAgICAgdGhyb3cganNvbnJwYy5lcnJvcihudWxsLCBqc29ucnBjLkpzb25ScGNFcnJvci5pbnZhbGlkUmVxdWVzdChudWxsKSk7XG4gICAgfVxuXG4gICAgaWYgKHBhcnNlZC50eXBlID09PSAnaW52YWxpZCcpIHtcbiAgICAgICAgdGhyb3cganNvbnJwYy5lcnJvcihudWxsLCBwYXJzZWQucGF5bG9hZCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHBhcnNlZDtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlbmRJbnZhbGlkUmVxdWVzdEVycm9yKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHJwYyA9IGpzb25ycGMuZXJyb3IobnVsbCwganNvbnJwYy5Kc29uUnBjRXJyb3IuaW52YWxpZFJlcXVlc3QobnVsbCkpO1xuXG4gICAgYXdhaXQgUXVldWUuZW5xdWV1ZShycGMpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZEludmFsaWRQYXJhbXNFcnJvcihpZDoganNvbnJwYy5JRCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHJwYyA9IGpzb25ycGMuZXJyb3IoaWQsIGpzb25ycGMuSnNvblJwY0Vycm9yLmludmFsaWRQYXJhbXMobnVsbCkpO1xuXG4gICAgYXdhaXQgUXVldWUuZW5xdWV1ZShycGMpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZFBhcnNlRXJyb3IoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgcnBjID0ganNvbnJwYy5lcnJvcihudWxsLCBqc29ucnBjLkpzb25ScGNFcnJvci5wYXJzZUVycm9yKG51bGwpKTtcblxuICAgIGF3YWl0IFF1ZXVlLmVucXVldWUocnBjKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlbmRNZXRob2ROb3RGb3VuZChpZDoganNvbnJwYy5JRCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHJwYyA9IGpzb25ycGMuZXJyb3IoaWQsIGpzb25ycGMuSnNvblJwY0Vycm9yLm1ldGhvZE5vdEZvdW5kKG51bGwpKTtcblxuICAgIGF3YWl0IFF1ZXVlLmVucXVldWUocnBjKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGVycm9yUmVzcG9uc2UoeyBlcnJvcjogeyBtZXNzYWdlLCBjb2RlID0gLTMyMDAwLCBkYXRhID0ge30gfSwgaWQgfTogRXJyb3JSZXNwb25zZURlc2NyaXB0b3IpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBsb2dnZXIgPSBBcHBPYmplY3RSZWdpc3RyeS5nZXQ8TG9nZ2VyPignbG9nZ2VyJyk7XG5cbiAgICBpZiAobG9nZ2VyPy5oYXNFbnRyaWVzKCkpIHtcbiAgICAgICAgZGF0YS5sb2dzID0gbG9nZ2VyLmdldExvZ3MoKTtcbiAgICB9XG5cbiAgICBjb25zdCBycGMgPSBqc29ucnBjLmVycm9yKGlkLCBuZXcganNvbnJwYy5Kc29uUnBjRXJyb3IobWVzc2FnZSwgY29kZSwgZGF0YSkpO1xuXG4gICAgYXdhaXQgUXVldWUuZW5xdWV1ZShycGMpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc3VjY2Vzc1Jlc3BvbnNlKHsgaWQsIHJlc3VsdCB9OiBTdWNjZXNzUmVzcG9uc2VEZXNjcmlwdG9yKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgcGF5bG9hZCA9IHsgdmFsdWU6IHJlc3VsdCB9IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgIGNvbnN0IGxvZ2dlciA9IEFwcE9iamVjdFJlZ2lzdHJ5LmdldDxMb2dnZXI+KCdsb2dnZXInKTtcblxuICAgIGlmIChsb2dnZXI/Lmhhc0VudHJpZXMoKSkge1xuICAgICAgICBwYXlsb2FkLmxvZ3MgPSBsb2dnZXIuZ2V0TG9ncygpO1xuICAgIH1cblxuICAgIGNvbnN0IHJwYyA9IGpzb25ycGMuc3VjY2VzcyhpZCwgcGF5bG9hZCk7XG5cbiAgICBhd2FpdCBRdWV1ZS5lbnF1ZXVlKHJwYyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwb25nUmVzcG9uc2UoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShRdWV1ZS5lbnF1ZXVlKENPTU1BTkRfUE9ORykpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZFJlcXVlc3QocmVxdWVzdERlc2NyaXB0b3I6IFJlcXVlc3REZXNjcmlwdG9yKTogUHJvbWlzZTxqc29ucnBjLlN1Y2Nlc3NPYmplY3Q+IHtcbiAgICBjb25zdCByZXF1ZXN0ID0ganNvbnJwYy5yZXF1ZXN0KE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIpLCByZXF1ZXN0RGVzY3JpcHRvci5tZXRob2QsIHJlcXVlc3REZXNjcmlwdG9yLnBhcmFtcyk7XG5cbiAgICAvLyBUT0RPOiBhZGQgdGltZW91dCB0byB0aGlzXG4gICAgY29uc3QgcmVzcG9uc2VQcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBjb25zdCBoYW5kbGVyID0gKGV2ZW50OiBFdmVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKGV2ZW50IGluc3RhbmNlb2YgRXJyb3JFdmVudCkge1xuICAgICAgICAgICAgICAgIHJlamVjdChldmVudC5lcnJvcik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChldmVudCBpbnN0YW5jZW9mIEN1c3RvbUV2ZW50KSB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShldmVudC5kZXRhaWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBSUENSZXNwb25zZU9ic2VydmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoYHJlc3BvbnNlOiR7cmVxdWVzdC5pZH1gLCBoYW5kbGVyKTtcbiAgICAgICAgfTtcblxuICAgICAgICBSUENSZXNwb25zZU9ic2VydmVyLmFkZEV2ZW50TGlzdGVuZXIoYHJlc3BvbnNlOiR7cmVxdWVzdC5pZH1gLCBoYW5kbGVyKTtcbiAgICB9KTtcblxuICAgIGF3YWl0IFF1ZXVlLmVucXVldWUocmVxdWVzdCk7XG5cbiAgICByZXR1cm4gcmVzcG9uc2VQcm9taXNlIGFzIFByb21pc2U8anNvbnJwYy5TdWNjZXNzT2JqZWN0Pjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNlbmROb3RpZmljYXRpb24oeyBtZXRob2QsIHBhcmFtcyB9OiBOb3RpZmljYXRpb25EZXNjcmlwdG9yKSB7XG4gICAgY29uc3QgcmVxdWVzdCA9IGpzb25ycGMubm90aWZpY2F0aW9uKG1ldGhvZCwgcGFyYW1zKTtcblxuICAgIFF1ZXVlLmVucXVldWUocmVxdWVzdCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2cocGFyYW1zOiBqc29ucnBjLlJwY1BhcmFtcykge1xuICAgIHNlbmROb3RpZmljYXRpb24oeyBtZXRob2Q6ICdsb2cnLCBwYXJhbXMgfSk7XG59XG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsU0FBUyxRQUFRLFFBQVEsZ0RBQWdEO0FBRXpFLFlBQVksYUFBYSxlQUFlO0FBRXhDLFNBQVMsaUJBQWlCLFFBQVEsMEJBQTBCO0FBRTVELFNBQVMsT0FBTyxRQUFRLGFBQWE7QUFhckMsT0FBTyxTQUFTLFVBQVUsT0FBOEI7RUFDcEQsT0FBTyxRQUFRLElBQUksS0FBSyxhQUFhLFFBQVEsSUFBSSxLQUFLO0FBQzFEO0FBRUEsT0FBTyxTQUFTLFdBQVcsT0FBOEI7RUFDckQsT0FBTyxRQUFRLElBQUksS0FBSyxhQUFhLFFBQVEsSUFBSSxLQUFLO0FBQzFEO0FBRUEsT0FBTyxTQUFTLGdCQUFnQixPQUF3QjtFQUNwRCxPQUFPLG1CQUFtQixRQUFRLFdBQVc7QUFDakQ7QUFFQSxNQUFNLGVBQWU7QUFFckIsT0FBTyxNQUFNLHNCQUFzQixJQUFJLGNBQWM7QUFFckQsT0FBTyxNQUFNLFFBQVEsSUFBSyxNQUFNO0VBQ3BCLFFBQXNCLEVBQUUsQ0FBQztFQUN6QixlQUFlLE1BQU07RUFFN0IsTUFBYyxlQUFlO0lBQ3pCLElBQUksSUFBSSxDQUFDLFlBQVksRUFBRTtNQUNuQjtJQUNKO0lBRUEsSUFBSSxDQUFDLFlBQVksR0FBRztJQUVwQixNQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFFO01BQ3RCLE1BQU0sVUFBVSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUs7TUFFaEMsSUFBSSxT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