import { JsonRpcError } from 'jsonrpc-lite';
import { AppObjectRegistry } from '../../AppObjectRegistry.ts';
import { MessageExtender } from '../../lib/accessors/extenders/MessageExtender.ts';
import { RoomExtender } from '../../lib/accessors/extenders/RoomExtender.ts';
import { MessageBuilder } from '../../lib/accessors/builders/MessageBuilder.ts';
import { RoomBuilder } from '../../lib/accessors/builders/RoomBuilder.ts';
import { AppAccessorsInstance } from '../../lib/accessors/mod.ts';
import { require } from '../../lib/require.ts';
import createRoom from '../../lib/roomFactory.ts';
import { Room } from "../../lib/room.ts";
const { AppsEngineException } = require('@rocket.chat/apps-engine/definition/exceptions/AppsEngineException.js');
export default async function handleListener(evtInterface, params) {
  const app = AppObjectRegistry.get('app');
  const eventExecutor = app?.[evtInterface];
  if (typeof eventExecutor !== 'function') {
    return JsonRpcError.methodNotFound({
      message: 'Invalid event interface called on app'
    });
  }
  if (!Array.isArray(params) || params.length < 1 || params.length > 2) {
    return JsonRpcError.invalidParams(null);
  }
  try {
    const args = parseArgs({
      AppAccessorsInstance
    }, evtInterface, params);
    return await eventExecutor.apply(app, args);
  } catch (e) {
    if (e instanceof JsonRpcError) {
      return e;
    }
    if (e instanceof AppsEngineException) {
      return new JsonRpcError(e.message, AppsEngineException.JSONRPC_ERROR_CODE, {
        name: e.name
      });
    }
    return JsonRpcError.internalError({
      message: e.message
    });
  }
}
export function parseArgs(deps, evtMethod, params) {
  const { AppAccessorsInstance } = deps;
  /**
     * param1 is the context for the event handler execution
     * param2 is an optional extra content that some hanlers require
     */ const [param1, param2] = params;
  if (!param1) {
    throw JsonRpcError.invalidParams(null);
  }
  let context = param1;
  if (evtMethod.includes('Message')) {
    context = hydrateMessageObjects(context);
  } else if (evtMethod.endsWith('RoomUserJoined') || evtMethod.endsWith('RoomUserLeave')) {
    context.room = createRoom(context.room, AppAccessorsInstance.getSenderFn());
  } else if (evtMethod.includes('PreRoom')) {
    context = createRoom(context, AppAccessorsInstance.getSenderFn());
  }
  const args = [
    context,
    AppAccessorsInstance.getReader(),
    AppAccessorsInstance.getHttp()
  ];
  // "check" events will only go this far - (context, reader, http)
  if (evtMethod.startsWith('check')) {
    // "checkPostMessageDeleted" has an extra param - (context, reader, http, extraContext)
    if (param2) {
      args.push(hydrateMessageObjects(param2));
    }
    return args;
  }
  // From this point on, all events will require (reader, http, persistence) injected
  args.push(AppAccessorsInstance.getPersistence());
  // "extend" events have an additional "Extender" param - (context, extender, reader, http, persistence)
  if (evtMethod.endsWith('Extend')) {
    if (evtMethod.includes('Message')) {
      args.splice(1, 0, new MessageExtender(param1));
    } else if (evtMethod.includes('Room')) {
      args.splice(1, 0, new RoomExtender(param1));
    }
    return args;
  }
  // "Modify" events have an additional "Builder" param - (context, builder, reader, http, persistence)
  if (evtMethod.endsWith('Modify')) {
    if (evtMethod.includes('Message')) {
      args.splice(1, 0, new MessageBuilder(param1));
    } else if (evtMethod.includes('Room')) {
      args.splice(1, 0, new RoomBuilder(param1));
    }
    return args;
  }
  // From this point on, all events will require (reader, http, persistence, modifier) injected
  args.push(AppAccessorsInstance.getModifier());
  // This guy gets an extra one
  if (evtMethod === 'executePostMessageDeleted') {
    if (!param2) {
      throw JsonRpcError.invalidParams(null);
    }
    args.push(hydrateMessageObjects(param2));
  }
  return args;
}
/**
 * Hydrate the context object with the correct IMessage
 *
 * Some information is lost upon serializing the data from listeners through the pipes,
 * so here we hydrate the complete object as necessary
 */ function hydrateMessageObjects(context) {
  if (objectIsRawMessage(context)) {
    context.room = createRoom(context.room, AppAccessorsInstance.getSenderFn());
  } else if (context?.message) {
    context.message = hydrateMessageObjects(context.message);
  }
  return context;
}
function objectIsRawMessage(value) {
  if (!value) return false;
  const { id, room, sender, createdAt } = value;
  // Check if we have the fields of a message and the room hasn't already been hydrated
  return !!(id && room && sender && createdAt) && !(room instanceof Room);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZpbGU6Ly8vVXNlcnMvYWJoaW5hdi9yb2NrZXQuY2hhdC9Sb2NrZXQuQ2hhdC9wYWNrYWdlcy9hcHBzLWVuZ2luZS9kZW5vLXJ1bnRpbWUvaGFuZGxlcnMvbGlzdGVuZXIvaGFuZGxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWZpbmVkLCBKc29uUnBjRXJyb3IgfSBmcm9tICdqc29ucnBjLWxpdGUnO1xuaW1wb3J0IHR5cGUgeyBBcHAgfSBmcm9tICdAcm9ja2V0LmNoYXQvYXBwcy1lbmdpbmUvZGVmaW5pdGlvbi9BcHAudHMnO1xuaW1wb3J0IHR5cGUgeyBJTWVzc2FnZSB9IGZyb20gJ0Byb2NrZXQuY2hhdC9hcHBzLWVuZ2luZS9kZWZpbml0aW9uL21lc3NhZ2VzL0lNZXNzYWdlLnRzJztcbmltcG9ydCB0eXBlIHsgSVJvb20gfSBmcm9tICdAcm9ja2V0LmNoYXQvYXBwcy1lbmdpbmUvZGVmaW5pdGlvbi9yb29tcy9JUm9vbS50cyc7XG5pbXBvcnQgdHlwZSB7IEFwcHNFbmdpbmVFeGNlcHRpb24gYXMgX0FwcHNFbmdpbmVFeGNlcHRpb24gfSBmcm9tICdAcm9ja2V0LmNoYXQvYXBwcy1lbmdpbmUvZGVmaW5pdGlvbi9leGNlcHRpb25zL0FwcHNFbmdpbmVFeGNlcHRpb24udHMnO1xuXG5pbXBvcnQgeyBBcHBPYmplY3RSZWdpc3RyeSB9IGZyb20gJy4uLy4uL0FwcE9iamVjdFJlZ2lzdHJ5LnRzJztcbmltcG9ydCB7IE1lc3NhZ2VFeHRlbmRlciB9IGZyb20gJy4uLy4uL2xpYi9hY2Nlc3NvcnMvZXh0ZW5kZXJzL01lc3NhZ2VFeHRlbmRlci50cyc7XG5pbXBvcnQgeyBSb29tRXh0ZW5kZXIgfSBmcm9tICcuLi8uLi9saWIvYWNjZXNzb3JzL2V4dGVuZGVycy9Sb29tRXh0ZW5kZXIudHMnO1xuaW1wb3J0IHsgTWVzc2FnZUJ1aWxkZXIgfSBmcm9tICcuLi8uLi9saWIvYWNjZXNzb3JzL2J1aWxkZXJzL01lc3NhZ2VCdWlsZGVyLnRzJztcbmltcG9ydCB7IFJvb21CdWlsZGVyIH0gZnJvbSAnLi4vLi4vbGliL2FjY2Vzc29ycy9idWlsZGVycy9Sb29tQnVpbGRlci50cyc7XG5pbXBvcnQgeyBBcHBBY2Nlc3NvcnMsIEFwcEFjY2Vzc29yc0luc3RhbmNlIH0gZnJvbSAnLi4vLi4vbGliL2FjY2Vzc29ycy9tb2QudHMnO1xuaW1wb3J0IHsgcmVxdWlyZSB9IGZyb20gJy4uLy4uL2xpYi9yZXF1aXJlLnRzJztcbmltcG9ydCBjcmVhdGVSb29tIGZyb20gJy4uLy4uL2xpYi9yb29tRmFjdG9yeS50cyc7XG5pbXBvcnQgeyBSb29tIH0gZnJvbSBcIi4uLy4uL2xpYi9yb29tLnRzXCI7XG5cbmNvbnN0IHsgQXBwc0VuZ2luZUV4Y2VwdGlvbiB9ID0gcmVxdWlyZSgnQHJvY2tldC5jaGF0L2FwcHMtZW5naW5lL2RlZmluaXRpb24vZXhjZXB0aW9ucy9BcHBzRW5naW5lRXhjZXB0aW9uLmpzJykgYXMge1xuICAgIEFwcHNFbmdpbmVFeGNlcHRpb246IHR5cGVvZiBfQXBwc0VuZ2luZUV4Y2VwdGlvbjtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUxpc3RlbmVyKGV2dEludGVyZmFjZTogc3RyaW5nLCBwYXJhbXM6IHVua25vd24pOiBQcm9taXNlPERlZmluZWQgfCBKc29uUnBjRXJyb3I+IHtcbiAgICBjb25zdCBhcHAgPSBBcHBPYmplY3RSZWdpc3RyeS5nZXQ8QXBwPignYXBwJyk7XG5cbiAgICBjb25zdCBldmVudEV4ZWN1dG9yID0gYXBwPy5bZXZ0SW50ZXJmYWNlIGFzIGtleW9mIEFwcF07XG5cbiAgICBpZiAodHlwZW9mIGV2ZW50RXhlY3V0b3IgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgcmV0dXJuIEpzb25ScGNFcnJvci5tZXRob2ROb3RGb3VuZCh7XG4gICAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBldmVudCBpbnRlcmZhY2UgY2FsbGVkIG9uIGFwcCcsXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmICghQXJyYXkuaXNBcnJheShwYXJhbXMpIHx8IHBhcmFtcy5sZW5ndGggPCAxIHx8IHBhcmFtcy5sZW5ndGggPiAyKSB7XG4gICAgICAgIHJldHVybiBKc29uUnBjRXJyb3IuaW52YWxpZFBhcmFtcyhudWxsKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhcmdzID0gcGFyc2VBcmdzKHsgQXBwQWNjZXNzb3JzSW5zdGFuY2UgfSwgZXZ0SW50ZXJmYWNlLCBwYXJhbXMpO1xuICAgICAgICByZXR1cm4gYXdhaXQgKGV2ZW50RXhlY3V0b3IgYXMgKC4uLmFyZ3M6IHVua25vd25bXSkgPT4gUHJvbWlzZTxEZWZpbmVkPikuYXBwbHkoYXBwLCBhcmdzKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgSnNvblJwY0Vycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgQXBwc0VuZ2luZUV4Y2VwdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBKc29uUnBjRXJyb3IoZS5tZXNzYWdlLCBBcHBzRW5naW5lRXhjZXB0aW9uLkpTT05SUENfRVJST1JfQ09ERSwgeyBuYW1lOiBlLm5hbWUgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gSnNvblJwY0Vycm9yLmludGVybmFsRXJyb3IoeyBtZXNzYWdlOiBlLm1lc3NhZ2UgfSk7XG4gICAgfVxuXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUFyZ3MoZGVwczogeyBBcHBBY2Nlc3NvcnNJbnN0YW5jZTogQXBwQWNjZXNzb3JzIH0sIGV2dE1ldGhvZDogc3RyaW5nLCBwYXJhbXM6IHVua25vd25bXSk6IHVua25vd25bXSB7XG4gICAgY29uc3QgeyBBcHBBY2Nlc3NvcnNJbnN0YW5jZSB9ID0gZGVwcztcbiAgICAvKipcbiAgICAgKiBwYXJhbTEgaXMgdGhlIGNvbnRleHQgZm9yIHRoZSBldmVudCBoYW5kbGVyIGV4ZWN1dGlvblxuICAgICAqIHBhcmFtMiBpcyBhbiBvcHRpb25hbCBleHRyYSBjb250ZW50IHRoYXQgc29tZSBoYW5sZXJzIHJlcXVpcmVcbiAgICAgKi9cbiAgICBjb25zdCBbcGFyYW0xLCBwYXJhbTJdID0gcGFyYW1zIGFzIFt1bmtub3duLCB1bmtub3duXTtcblxuICAgIGlmICghcGFyYW0xKSB7XG4gICAgICAgIHRocm93IEpzb25ScGNFcnJvci5pbnZhbGlkUGFyYW1zKG51bGwpO1xuICAgIH1cblxuICAgIGxldCBjb250ZXh0ID0gcGFyYW0xO1xuXG4gICAgaWYgKGV2dE1ldGhvZC5pbmNsdWRlcygnTWVzc2FnZScpKSB7XG4gICAgICAgIGNvbnRleHQgPSBoeWRyYXRlTWVzc2FnZU9iamVjdHMoY29udGV4dCkgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gICAgfSBlbHNlIGlmIChldnRNZXRob2QuZW5kc1dpdGgoJ1Jvb21Vc2VySm9pbmVkJykgfHwgZXZ0TWV0aG9kLmVuZHNXaXRoKCdSb29tVXNlckxlYXZlJykpIHtcbiAgICAgICAgKGNvbnRleHQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLnJvb20gPSBjcmVhdGVSb29tKChjb250ZXh0IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5yb29tIGFzIElSb29tLCBBcHBBY2Nlc3NvcnNJbnN0YW5jZS5nZXRTZW5kZXJGbigpKTtcbiAgICB9IGVsc2UgaWYgKGV2dE1ldGhvZC5pbmNsdWRlcygnUHJlUm9vbScpKSB7XG4gICAgICAgIGNvbnRleHQgPSBjcmVhdGVSb29tKGNvbnRleHQgYXMgSVJvb20sIEFwcEFjY2Vzc29yc0luc3RhbmNlLmdldFNlbmRlckZuKCkpO1xuICAgIH1cblxuICAgIGNvbnN0IGFyZ3M6IHVua25vd25bXSA9IFtjb250ZXh0LCBBcHBBY2Nlc3NvcnNJbnN0YW5jZS5nZXRSZWFkZXIoKSwgQXBwQWNjZXNzb3JzSW5zdGFuY2UuZ2V0SHR0cCgpXTtcblxuICAgIC8vIFwiY2hlY2tcIiBldmVudHMgd2lsbCBvbmx5IGdvIHRoaXMgZmFyIC0gKGNvbnRleHQsIHJlYWRlciwgaHR0cClcbiAgICBpZiAoZXZ0TWV0aG9kLnN0YXJ0c1dpdGgoJ2NoZWNrJykpIHtcbiAgICAgICAgLy8gXCJjaGVja1Bvc3RNZXNzYWdlRGVsZXRlZFwiIGhhcyBhbiBleHRyYSBwYXJhbSAtIChjb250ZXh0LCByZWFkZXIsIGh0dHAsIGV4dHJhQ29udGV4dClcbiAgICAgICAgaWYgKHBhcmFtMikge1xuICAgICAgICAgICAgYXJncy5wdXNoKGh5ZHJhdGVNZXNzYWdlT2JqZWN0cyhwYXJhbTIpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBhcmdzO1xuICAgIH1cblxuICAgIC8vIEZyb20gdGhpcyBwb2ludCBvbiwgYWxsIGV2ZW50cyB3aWxsIHJlcXVpcmUgKHJlYWRlciwgaHR0cCwgcGVyc2lzdGVuY2UpIGluamVjdGVkXG4gICAgYXJncy5wdXNoKEFwcEFjY2Vzc29yc0luc3RhbmNlLmdldFBlcnNpc3RlbmNlKCkpO1xuXG4gICAgLy8gXCJleHRlbmRcIiBldmVudHMgaGF2ZSBhbiBhZGRpdGlvbmFsIFwiRXh0ZW5kZXJcIiBwYXJhbSAtIChjb250ZXh0LCBleHRlbmRlciwgcmVhZGVyLCBodHRwLCBwZXJzaXN0ZW5jZSlcbiAgICBpZiAoZXZ0TWV0aG9kLmVuZHNXaXRoKCdFeHRlbmQnKSkge1xuICAgICAgICBpZiAoZXZ0TWV0aG9kLmluY2x1ZGVzKCdNZXNzYWdlJykpIHtcbiAgICAgICAgICAgIGFyZ3Muc3BsaWNlKDEsIDAsIG5ldyBNZXNzYWdlRXh0ZW5kZXIocGFyYW0xIGFzIElNZXNzYWdlKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoZXZ0TWV0aG9kLmluY2x1ZGVzKCdSb29tJykpIHtcbiAgICAgICAgICAgIGFyZ3Muc3BsaWNlKDEsIDAsIG5ldyBSb29tRXh0ZW5kZXIocGFyYW0xIGFzIElSb29tKSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYXJncztcbiAgICB9XG5cbiAgICAvLyBcIk1vZGlmeVwiIGV2ZW50cyBoYXZlIGFuIGFkZGl0aW9uYWwgXCJCdWlsZGVyXCIgcGFyYW0gLSAoY29udGV4dCwgYnVpbGRlciwgcmVhZGVyLCBodHRwLCBwZXJzaXN0ZW5jZSlcbiAgICBpZiAoZXZ0TWV0aG9kLmVuZHNXaXRoKCdNb2RpZnknKSkge1xuICAgICAgICBpZiAoZXZ0TWV0aG9kLmluY2x1ZGVzKCdNZXNzYWdlJykpIHtcbiAgICAgICAgICAgIGFyZ3Muc3BsaWNlKDEsIDAsIG5ldyBNZXNzYWdlQnVpbGRlcihwYXJhbTEgYXMgSU1lc3NhZ2UpKTtcbiAgICAgICAgfSBlbHNlIGlmIChldnRNZXRob2QuaW5jbHVkZXMoJ1Jvb20nKSkge1xuICAgICAgICAgICAgYXJncy5zcGxpY2UoMSwgMCwgbmV3IFJvb21CdWlsZGVyKHBhcmFtMSBhcyBJUm9vbSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGFyZ3M7XG4gICAgfVxuXG4gICAgLy8gRnJvbSB0aGlzIHBvaW50IG9uLCBhbGwgZXZlbnRzIHdpbGwgcmVxdWlyZSAocmVhZGVyLCBodHRwLCBwZXJzaXN0ZW5jZSwgbW9kaWZpZXIpIGluamVjdGVkXG4gICAgYXJncy5wdXNoKEFwcEFjY2Vzc29yc0luc3RhbmNlLmdldE1vZGlmaWVyKCkpO1xuXG4gICAgLy8gVGhpcyBndXkgZ2V0cyBhbiBleHRyYSBvbmVcbiAgICBpZiAoZXZ0TWV0aG9kID09PSAnZXhlY3V0ZVBvc3RNZXNzYWdlRGVsZXRlZCcpIHtcbiAgICAgICAgaWYgKCFwYXJhbTIpIHtcbiAgICAgICAgICAgIHRocm93IEpzb25ScGNFcnJvci5pbnZhbGlkUGFyYW1zKG51bGwpO1xuICAgICAgICB9XG5cbiAgICAgICAgYXJncy5wdXNoKGh5ZHJhdGVNZXNzYWdlT2JqZWN0cyhwYXJhbTIpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYXJncztcbn1cblxuLyoqXG4gKiBIeWRyYXRlIHRoZSBjb250ZXh0IG9iamVjdCB3aXRoIHRoZSBjb3JyZWN0IElNZXNzYWdlXG4gKlxuICogU29tZSBpbmZvcm1hdGlvbiBpcyBsb3N0IHVwb24gc2VyaWFsaXppbmcgdGhlIGRhdGEgZnJvbSBsaXN0ZW5lcnMgdGhyb3VnaCB0aGUgcGlwZXMsXG4gKiBzbyBoZXJlIHdlIGh5ZHJhdGUgdGhlIGNvbXBsZXRlIG9iamVjdCBhcyBuZWNlc3NhcnlcbiAqL1xuZnVuY3Rpb24gaHlkcmF0ZU1lc3NhZ2VPYmplY3RzKGNvbnRleHQ6IHVua25vd24pOiB1bmtub3duIHtcbiAgICBpZiAob2JqZWN0SXNSYXdNZXNzYWdlKGNvbnRleHQpKSB7XG4gICAgICAgIGNvbnRleHQucm9vbSA9IGNyZWF0ZVJvb20oY29udGV4dC5yb29tIGFzIElSb29tLCBBcHBBY2Nlc3NvcnNJbnN0YW5jZS5nZXRTZW5kZXJGbigpKTtcbiAgICB9IGVsc2UgaWYgKChjb250ZXh0IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8ubWVzc2FnZSkge1xuICAgICAgICAoY29udGV4dCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikubWVzc2FnZSA9IGh5ZHJhdGVNZXNzYWdlT2JqZWN0cygoY29udGV4dCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikubWVzc2FnZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNvbnRleHQ7XG59XG5cbmZ1bmN0aW9uIG9iamVjdElzUmF3TWVzc2FnZSh2YWx1ZTogdW5rbm93bik6IHZhbHVlIGlzIElNZXNzYWdlIHtcbiAgICBpZiAoIXZhbHVlKSByZXR1cm4gZmFsc2U7XG5cbiAgICBjb25zdCB7IGlkLCByb29tLCBzZW5kZXIsIGNyZWF0ZWRBdCB9ID0gdmFsdWUgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG5cbiAgICAvLyBDaGVjayBpZiB3ZSBoYXZlIHRoZSBmaWVsZHMgb2YgYSBtZXNzYWdlIGFuZCB0aGUgcm9vbSBoYXNuJ3QgYWxyZWFkeSBiZWVuIGh5ZHJhdGVkXG4gICAgcmV0dXJuICEhKGlkICYmIHJvb20gJiYgc2VuZGVyICYmIGNy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