import stackTrace from 'stack-trace';
import { AppObjectRegistry } from '../AppObjectRegistry.ts';
var LogMessageSeverity;
(function(LogMessageSeverity) {
  LogMessageSeverity["DEBUG"] = "debug";
  LogMessageSeverity["INFORMATION"] = "info";
  LogMessageSeverity["LOG"] = "log";
  LogMessageSeverity["WARNING"] = "warning";
  LogMessageSeverity["ERROR"] = "error";
  LogMessageSeverity["SUCCESS"] = "success";
})(LogMessageSeverity || (LogMessageSeverity = {}));
export class Logger {
  entries;
  start;
  method;
  constructor(method){
    this.method = method;
    this.entries = [];
    this.start = new Date();
  }
  debug(...args) {
    this.addEntry(LogMessageSeverity.DEBUG, this.getStack(stackTrace.get()), ...args);
  }
  info(...args) {
    this.addEntry(LogMessageSeverity.INFORMATION, this.getStack(stackTrace.get()), ...args);
  }
  log(...args) {
    this.addEntry(LogMessageSeverity.LOG, this.getStack(stackTrace.get()), ...args);
  }
  warn(...args) {
    this.addEntry(LogMessageSeverity.WARNING, this.getStack(stackTrace.get()), ...args);
  }
  error(...args) {
    this.addEntry(LogMessageSeverity.ERROR, this.getStack(stackTrace.get()), ...args);
  }
  success(...args) {
    this.addEntry(LogMessageSeverity.SUCCESS, this.getStack(stackTrace.get()), ...args);
  }
  addEntry(severity, caller, ...items) {
    const i = items.map((args)=>{
      if (args instanceof Error) {
        return JSON.stringify(args, Object.getOwnPropertyNames(args));
      }
      if (typeof args === 'object' && args !== null && 'stack' in args) {
        return JSON.stringify(args, Object.getOwnPropertyNames(args));
      }
      if (typeof args === 'object' && args !== null && 'message' in args) {
        return JSON.stringify(args, Object.getOwnPropertyNames(args));
      }
      const str = JSON.stringify(args, null, 2);
      return str ? JSON.parse(str) : str; // force call toJSON to prevent circular references
    });
    this.entries.push({
      caller,
      severity,
      method: this.method,
      timestamp: new Date(),
      args: i
    });
  }
  getStack(stack) {
    let func = 'anonymous';
    if (stack.length === 1) {
      return func;
    }
    const frame = stack[1];
    if (frame.getMethodName() === null) {
      func = 'anonymous OR constructor';
    } else {
      func = frame.getMethodName();
    }
    if (frame.getFunctionName() !== null) {
      func = `${func} -> ${frame.getFunctionName()}`;
    }
    return func;
  }
  getTotalTime() {
    return new Date().getTime() - this.start.getTime();
  }
  hasEntries() {
    return this.entries.length > 0;
  }
  getLogs() {
    return {
      appId: AppObjectRegistry.get('id'),
      method: this.method,
      entries: this.entries,
      startTime: this.start,
      endTime: new Date(),
      totalTime: this.getTotalTime(),
      _createdAt: new Date()
    };
  }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZpbGU6Ly8vVXNlcnMvYWJoaW5hdi9yb2NrZXQuY2hhdC9Sb2NrZXQuQ2hhdC9wYWNrYWdlcy9hcHBzLWVuZ2luZS9kZW5vLXJ1bnRpbWUvbGliL2xvZ2dlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgc3RhY2tUcmFjZSBmcm9tICdzdGFjay10cmFjZSc7XG5pbXBvcnQgeyBBcHBPYmplY3RSZWdpc3RyeSB9IGZyb20gJy4uL0FwcE9iamVjdFJlZ2lzdHJ5LnRzJztcblxuZXhwb3J0IGludGVyZmFjZSBTdGFja0ZyYW1lIHtcbiAgICBnZXRUeXBlTmFtZSgpOiBzdHJpbmc7XG4gICAgZ2V0RnVuY3Rpb25OYW1lKCk6IHN0cmluZztcbiAgICBnZXRNZXRob2ROYW1lKCk6IHN0cmluZztcbiAgICBnZXRGaWxlTmFtZSgpOiBzdHJpbmc7XG4gICAgZ2V0TGluZU51bWJlcigpOiBudW1iZXI7XG4gICAgZ2V0Q29sdW1uTnVtYmVyKCk6IG51bWJlcjtcbiAgICBpc05hdGl2ZSgpOiBib29sZWFuO1xuICAgIGlzQ29uc3RydWN0b3IoKTogYm9vbGVhbjtcbn1cblxuZW51bSBMb2dNZXNzYWdlU2V2ZXJpdHkge1xuICAgIERFQlVHID0gJ2RlYnVnJyxcbiAgICBJTkZPUk1BVElPTiA9ICdpbmZvJyxcbiAgICBMT0cgPSAnbG9nJyxcbiAgICBXQVJOSU5HID0gJ3dhcm5pbmcnLFxuICAgIEVSUk9SID0gJ2Vycm9yJyxcbiAgICBTVUNDRVNTID0gJ3N1Y2Nlc3MnLFxufVxuXG50eXBlIEVudHJ5ID0ge1xuICAgIGNhbGxlcjogc3RyaW5nO1xuICAgIHNldmVyaXR5OiBMb2dNZXNzYWdlU2V2ZXJpdHk7XG4gICAgbWV0aG9kOiBzdHJpbmc7XG4gICAgdGltZXN0YW1wOiBEYXRlO1xuICAgIGFyZ3M6IEFycmF5PHVua25vd24+O1xufTtcblxuaW50ZXJmYWNlIElMb2dnZXJTdG9yYWdlRW50cnkge1xuICAgIGFwcElkOiBzdHJpbmc7XG4gICAgbWV0aG9kOiBzdHJpbmc7XG4gICAgZW50cmllczogQXJyYXk8RW50cnk+O1xuICAgIHN0YXJ0VGltZTogRGF0ZTtcbiAgICBlbmRUaW1lOiBEYXRlO1xuICAgIHRvdGFsVGltZTogbnVtYmVyO1xuICAgIF9jcmVhdGVkQXQ6IERhdGU7XG59XG5cbmV4cG9ydCBjbGFzcyBMb2dnZXIge1xuICAgIHByaXZhdGUgZW50cmllczogQXJyYXk8RW50cnk+O1xuICAgIHByaXZhdGUgc3RhcnQ6IERhdGU7XG4gICAgcHJpdmF0ZSBtZXRob2Q6IHN0cmluZztcblxuICAgIGNvbnN0cnVjdG9yKG1ldGhvZDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMubWV0aG9kID0gbWV0aG9kO1xuICAgICAgICB0aGlzLmVudHJpZXMgPSBbXTtcbiAgICAgICAgdGhpcy5zdGFydCA9IG5ldyBEYXRlKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGRlYnVnKC4uLmFyZ3M6IEFycmF5PHVua25vd24+KTogdm9pZCB7XG4gICAgICAgIHRoaXMuYWRkRW50cnkoTG9nTWVzc2FnZVNldmVyaXR5LkRFQlVHLCB0aGlzLmdldFN0YWNrKHN0YWNrVHJhY2UuZ2V0KCkpLCAuLi5hcmdzKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgaW5mbyguLi5hcmdzOiBBcnJheTx1bmtub3duPik6IHZvaWQge1xuICAgICAgICB0aGlzLmFkZEVudHJ5KExvZ01lc3NhZ2VTZXZlcml0eS5JTkZPUk1BVElPTiwgdGhpcy5nZXRTdGFjayhzdGFja1RyYWNlLmdldCgpKSwgLi4uYXJncyk7XG4gICAgfVxuXG4gICAgcHVibGljIGxvZyguLi5hcmdzOiBBcnJheTx1bmtub3duPik6IHZvaWQge1xuICAgICAgICB0aGlzLmFkZEVudHJ5KExvZ01lc3NhZ2VTZXZlcml0eS5MT0csIHRoaXMuZ2V0U3RhY2soc3RhY2tUcmFjZS5nZXQoKSksIC4uLmFyZ3MpO1xuICAgIH1cblxuICAgIHB1YmxpYyB3YXJuKC4uLmFyZ3M6IEFycmF5PHVua25vd24+KTogdm9pZCB7XG4gICAgICAgIHRoaXMuYWRkRW50cnkoTG9nTWVzc2FnZVNldmVyaXR5LldBUk5JTkcsIHRoaXMuZ2V0U3RhY2soc3RhY2tUcmFjZS5nZXQoKSksIC4uLmFyZ3MpO1xuICAgIH1cblxuICAgIHB1YmxpYyBlcnJvciguLi5hcmdzOiBBcnJheTx1bmtub3duPik6IHZvaWQge1xuICAgICAgICB0aGlzLmFkZEVudHJ5KExvZ01lc3NhZ2VTZXZlcml0eS5FUlJPUiwgdGhpcy5nZXRTdGFjayhzdGFja1RyYWNlLmdldCgpKSwgLi4uYXJncyk7XG4gICAgfVxuXG4gICAgcHVibGljIHN1Y2Nlc3MoLi4uYXJnczogQXJyYXk8dW5rbm93bj4pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5hZGRFbnRyeShMb2dNZXNzYWdlU2V2ZXJpdHkuU1VDQ0VTUywgdGhpcy5nZXRTdGFjayhzdGFja1RyYWNlLmdldCgpKSwgLi4uYXJncyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhZGRFbnRyeShzZXZlcml0eTogTG9nTWVzc2FnZVNldmVyaXR5LCBjYWxsZXI6IHN0cmluZywgLi4uaXRlbXM6IEFycmF5PHVua25vd24+KTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGkgPSBpdGVtcy5tYXAoKGFyZ3MpID0+IHtcbiAgICAgICAgICAgIGlmIChhcmdzIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoYXJncywgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoYXJncykpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBhcmdzID09PSAnb2JqZWN0JyAmJiBhcmdzICE9PSBudWxsICYmICdzdGFjaycgaW4gYXJncykge1xuICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShhcmdzLCBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhhcmdzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIGFyZ3MgPT09ICdvYmplY3QnICYmIGFyZ3MgIT09IG51bGwgJiYgJ21lc3NhZ2UnIGluIGFyZ3MpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoYXJncywgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoYXJncykpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgc3RyID0gSlNPTi5zdHJpbmdpZnkoYXJncywgbnVsbCwgMik7XG4gICAgICAgICAgICByZXR1cm4gc3RyID8gSlNPTi5wYXJzZShzdHIpIDogc3RyOyAvLyBmb3JjZSBjYWxsIHRvSlNPTiB0byBwcmV2ZW50IGNpcmN1bGFyIHJlZmVyZW5jZXNcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5lbnRyaWVzLnB1c2goe1xuICAgICAgICAgICAgY2FsbGVyLFxuICAgICAgICAgICAgc2V2ZXJpdHksXG4gICAgICAgICAgICBtZXRob2Q6IHRoaXMubWV0aG9kLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgYXJnczogaSxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRTdGFjayhzdGFjazogQXJyYXk8U3RhY2tGcmFtZT4pOiBzdHJpbmcge1xuICAgICAgICBsZXQgZnVuYyA9ICdhbm9ueW1vdXMnO1xuXG4gICAgICAgIGlmIChzdGFjay5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZnJhbWUgPSBzdGFja1sxXTtcblxuICAgICAgICBpZiAoZnJhbWUuZ2V0TWV0aG9kTmFtZSgpID09PSBudWxsKSB7XG4gICAgICAgICAgICBmdW5jID0gJ2Fub255bW91cyBPUiBjb25zdHJ1Y3Rvcic7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmdW5jID0gZnJhbWUuZ2V0TWV0aG9kTmFtZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGZyYW1lLmdldEZ1bmN0aW9uTmFtZSgpICE9PSBudWxsKSB7XG4gICAgICAgICAgICBmdW5jID0gYCR7ZnVuY30gLT4gJHtmcmFtZS5nZXRGdW5jdGlvbk5hbWUoKX1gO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZ1bmM7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRUb3RhbFRpbWUoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gdGhpcy5zdGFydC5nZXRUaW1lKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGhhc0VudHJpZXMoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmVudHJpZXMubGVuZ3RoID4gMDtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0TG9ncygpOiBJTG9nZ2VyU3RvcmFnZUVudHJ5IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGFwcElkOiBBcHBPYmplY3RSZWdpc3RyeS5nZXQoJ2lkJykhLFxuICAgICAgICAgICAgbWV0aG9kOiB0aGlzLm1ldGhvZCxcbiAgICAgICAgICAgIGVudHJpZXM6IHRoaXMuZW50cmllcyxcbiAgICAgICAgICAgIHN0YXJ0VGltZTogdGhpcy5zdGFydCxcbiAgICAgICAgICAgIGVuZFRpbWU6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB0b3RhbFRpbWU6IHRoaXMuZ2V0VG90YWxUaW1lKCksXG4gICAgICAgICAgICBfY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9O1xuICAgIH1cbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLGdCQUFnQixjQUFjO0FBQ3JDLFNBQVMsaUJBQWlCLFFBQVEsMEJBQTBCOztVQWF2RDs7Ozs7OztHQUFBLHVCQUFBO0FBMkJMLE9BQU8sTUFBTTtFQUNELFFBQXNCO0VBQ3RCLE1BQVk7RUFDWixPQUFlO0VBRXZCLFlBQVksTUFBYyxDQUFFO0lBQ3hCLElBQUksQ0FBQyxNQUFNLEdBQUc7SUFDZCxJQUFJLENBQUMsT0FBTyxHQUFHLEVBQUU7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