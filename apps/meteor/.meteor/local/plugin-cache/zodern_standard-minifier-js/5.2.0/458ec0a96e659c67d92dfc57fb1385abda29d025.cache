{"code":"function module(e,t,i){var a,s,r,o,n,l,c;i.export({InviteUserAgentServer:function(){return g}}),i.link(\"../dialogs\",{Dialog:function(e){a=e},SessionDialog:function(e){s=e}},0),i.link(\"../exceptions\",{TransactionStateError:function(e){r=e}},1),i.link(\"../session\",{SignalingState:function(e){o=e}},2),i.link(\"../transactions\",{InviteServerTransaction:function(e){n=e}},3),i.link(\"../user-agent-core/allowed-methods\",{AllowedMethods:function(e){l=e}},4),i.link(\"./user-agent-server\",{UserAgentServer:function(e){c=e}},5);class g extends c{constructor(e,t,i){super(n,e,t,i),this.core=e}dispose(){this.earlyDialog&&this.earlyDialog.dispose(),super.dispose()}accept(e={statusCode:200}){if(!this.acceptable)throw new r(`${this.message.method} not acceptable in state ${this.transaction.state}.`);if(!this.confirmedDialog){if(this.earlyDialog)this.earlyDialog.confirm(),this.confirmedDialog=this.earlyDialog,this.earlyDialog=void 0;else{let e=this.transaction;if(!(e instanceof n))throw Error(\"Transaction not instance of InviteClientTransaction.\");let t=a.initialDialogStateForUserAgentServer(this.message,this.toTag);this.confirmedDialog=new s(e,this.core,t)}}let t=this.message.getHeaders(\"record-route\").map(e=>`Record-Route: ${e}`),i=`Contact: ${this.core.configuration.contact.toString()}`,c=\"Allow: \"+l.toString();if(!e.body){if(this.confirmedDialog.signalingState===o.Stable)e.body=this.confirmedDialog.answer;else if(this.confirmedDialog.signalingState===o.Initial||this.confirmedDialog.signalingState===o.HaveRemoteOffer)throw Error(\"Response must have a body.\")}e.statusCode=e.statusCode||200,e.extraHeaders=e.extraHeaders||[],e.extraHeaders=e.extraHeaders.concat(t),e.extraHeaders.push(c),e.extraHeaders.push(i);let g=super.accept(e),d=this.confirmedDialog,h=Object.assign(Object.assign({},g),{session:d});return e.body&&this.confirmedDialog.signalingState!==o.Stable&&this.confirmedDialog.signalingStateTransition(e.body),h}progress(e={statusCode:180}){if(!this.progressable)throw new r(`${this.message.method} not progressable in state ${this.transaction.state}.`);if(!this.earlyDialog){let e=this.transaction;if(!(e instanceof n))throw Error(\"Transaction not instance of InviteClientTransaction.\");let t=a.initialDialogStateForUserAgentServer(this.message,this.toTag,!0);this.earlyDialog=new s(e,this.core,t)}let t=this.message.getHeaders(\"record-route\").map(e=>`Record-Route: ${e}`),i=`Contact: ${this.core.configuration.contact}`;e.extraHeaders=e.extraHeaders||[],e.extraHeaders=e.extraHeaders.concat(t),e.extraHeaders.push(i);let l=super.progress(e),c=this.earlyDialog,g=Object.assign(Object.assign({},l),{session:c});return e.body&&this.earlyDialog.signalingState!==o.Stable&&this.earlyDialog.signalingStateTransition(e.body),g}redirect(e,t={statusCode:302}){return super.redirect(e,t)}reject(e={statusCode:486}){return super.reject(e)}}}","map":"{\"version\":3,\"sources\":[\"<anon>\"],\"names\":[],\"mappings\":\"\"}"}