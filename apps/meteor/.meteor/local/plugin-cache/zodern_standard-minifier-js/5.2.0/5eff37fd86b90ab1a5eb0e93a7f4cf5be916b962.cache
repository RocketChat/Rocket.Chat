{"code":"function module(t,e,o){let i,s;o.export({AudioRecorder:()=>r}),o.link(\"../../../../settings/client\",{settings(t){i=t}},0),o.link(\"./AudioEncoder\",{AudioEncoder(t){s=t}},1);class r{constructor(){this.audioContext=void 0,this.stream=void 0,this.encoder=void 0}isSupported(){var t;return!!(null===(t=navigator.mediaDevices)||void 0===t?void 0:t.getUserMedia)&&!!AudioContext}createAudioContext(){this.audioContext||(this.audioContext=new AudioContext)}destroyAudioContext(){this.audioContext&&(this.audioContext.close(),delete this.audioContext)}async createStream(){this.stream||(this.stream=await navigator.mediaDevices.getUserMedia({audio:!0}))}destroyStream(){this.stream&&(this.stream.getAudioTracks().forEach(t=>t.stop()),delete this.stream)}async createEncoder(){var t;if(this.encoder||!this.audioContext||!this.stream)return;let e=null===(t=this.audioContext)||void 0===t?void 0:t.createMediaStreamSource(this.stream);this.encoder=new s(e,{bitRate:i.get(\"Message_Audio_bitRate\")||32})}destroyEncoder(){this.encoder&&(this.encoder.close(),delete this.encoder)}async start(t){try{this.createAudioContext(),await this.createStream(),await this.createEncoder(),null==t||t.call(this,!0)}catch(e){throw console.error(e),this.destroyEncoder(),this.destroyStream(),this.destroyAudioContext(),null==t||t.call(this,!1),e}}stop(t){var e,o;null===(e=this.encoder)||void 0===e||e.on(\"encoded\",t),null===(o=this.encoder)||void 0===o||o.close(),this.destroyEncoder(),this.destroyStream(),this.destroyAudioContext()}}}","map":"{\"version\":3,\"sources\":[\"app/ui/client/lib/recorderjs/AudioRecorder.ts\",\"<anon>\"],\"sourcesContent\":[\"import { settings } from '../../../../settings/client';\\nimport { AudioEncoder } from './AudioEncoder';\\n\\nexport class AudioRecorder {\\n\\tprivate audioContext: AudioContext | undefined;\\n\\n\\tprivate stream: MediaStream | undefined;\\n\\n\\tprivate encoder: AudioEncoder | undefined;\\n\\n\\tisSupported() {\\n\\t\\treturn Boolean(navigator.mediaDevices?.getUserMedia) && Boolean(AudioContext);\\n\\t}\\n\\n\\tcreateAudioContext() {\\n\\t\\tif (this.audioContext) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tthis.audioContext = new AudioContext();\\n\\t}\\n\\n\\tdestroyAudioContext() {\\n\\t\\tif (!this.audioContext) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tvoid this.audioContext.close();\\n\\t\\tdelete this.audioContext;\\n\\t}\\n\\n\\tasync createStream() {\\n\\t\\tif (this.stream) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tthis.stream = await navigator.mediaDevices.getUserMedia({ audio: true });\\n\\t}\\n\\n\\tdestroyStream() {\\n\\t\\tif (!this.stream) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tthis.stream.getAudioTracks().forEach((track) => track.stop());\\n\\t\\tdelete this.stream;\\n\\t}\\n\\n\\tasync createEncoder() {\\n\\t\\tif (this.encoder || !this.audioContext || !this.stream) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tconst input = this.audioContext?.createMediaStreamSource(this.stream);\\n\\t\\tthis.encoder = new AudioEncoder(input, { bitRate: settings.get('Message_Audio_bitRate') || 32 });\\n\\t}\\n\\n\\tdestroyEncoder() {\\n\\t\\tif (!this.encoder) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tthis.encoder.close();\\n\\t\\tdelete this.encoder;\\n\\t}\\n\\n\\tasync start(cb?: (this: this, done: boolean) => void) {\\n\\t\\ttry {\\n\\t\\t\\tthis.createAudioContext();\\n\\t\\t\\tawait this.createStream();\\n\\t\\t\\tawait this.createEncoder();\\n\\t\\t\\tcb?.call(this, true);\\n\\t\\t} catch (error) {\\n\\t\\t\\tconsole.error(error);\\n\\t\\t\\tthis.destroyEncoder();\\n\\t\\t\\tthis.destroyStream();\\n\\t\\t\\tthis.destroyAudioContext();\\n\\t\\t\\tcb?.call(this, false);\\n\\t\\t\\tthrow error;\\n\\t\\t}\\n\\t}\\n\\n\\tstop(cb: (data: Blob) => void) {\\n\\t\\tthis.encoder?.on('encoded', cb);\\n\\t\\tthis.encoder?.close();\\n\\n\\t\\tthis.destroyEncoder();\\n\\t\\tthis.destroyStream();\\n\\t\\tthis.destroyAudioContext();\\n\\t}\\n}\\n\",null],\"names\":[\"settings\",\"AudioEncoder\",\"module\",\"export\",\"AudioRecorder\",\"link\",\"v\",\"constructor\",\"audioContext\",\"stream\",\"encoder\",\"isSupported\",\"_navigator$mediaDevic\",\"Boolean\",\"navigator\",\"mediaDevices\",\"getUserMedia\",\"AudioContext\",\"createAudioContext\",\"destroyAudioContext\",\"close\",\"createStream\",\"audio\",\"destroyStream\",\"getAudioTracks\",\"forEach\",\"track\",\"stop\",\"createEncoder\",\"_this$audioContext\",\"input\",\"createMediaStreamSource\",\"bitRate\",\"get\",\"destroyEncoder\",\"start\",\"cb\",\"call\",\"error\",\"console\",\"_this$encoder\",\"_this$encoder2\",\"on\"],\"mappings\":\"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\"}"}