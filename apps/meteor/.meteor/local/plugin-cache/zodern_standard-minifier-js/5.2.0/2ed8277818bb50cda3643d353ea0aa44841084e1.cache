{"code":"function module(t,e,r){\"use strict\";var n=t(\"bn.js\"),i=t(\"hmac-drbg\"),s=t(\"../utils\"),o=t(\"../curves\"),h=t(\"brorand\"),u=s.assert,c=t(\"./key\"),a=t(\"./signature\");function p(t){if(!(this instanceof p))return new p(t);\"string\"==typeof t&&(u(Object.prototype.hasOwnProperty.call(o,t),\"Unknown curve \"+t),t=o[t]),t instanceof o.PresetCurve&&(t={curve:t}),this.curve=t.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=t.curve.g,this.g.precompute(t.curve.n.bitLength()+1),this.hash=t.hash||t.curve.hash}r.exports=p,p.prototype.keyPair=function t(t){return new c(this,t)},p.prototype.keyFromPrivate=function t(t,e){return c.fromPrivate(this,t,e)},p.prototype.keyFromPublic=function t(t,e){return c.fromPublic(this,t,e)},p.prototype.genKeyPair=function t(t){t||(t={});for(var e=new i({hash:this.hash,pers:t.pers,persEnc:t.persEnc||\"utf8\",entropy:t.entropy||h(this.hash.hmacStrength),entropyEnc:t.entropy&&t.entropyEnc||\"utf8\",nonce:this.n.toArray()}),r=this.n.byteLength(),s=this.n.sub(new n(2));;){var o=new n(e.generate(r));if(!(o.cmp(s)>0))return o.iaddn(1),this.keyFromPrivate(o)}},p.prototype._truncateToN=function t(t,e){var r=8*t.byteLength()-this.n.bitLength();return(r>0&&(t=t.ushrn(r)),!e&&t.cmp(this.n)>=0)?t.sub(this.n):t},p.prototype.sign=function t(t,e,r,s){\"object\"==typeof r&&(s=r,r=null),s||(s={}),e=this.keyFromPrivate(e,r),t=this._truncateToN(new n(t,16));for(var o=this.n.byteLength(),h=e.getPrivate().toArray(\"be\",o),u=t.toArray(\"be\",o),c=new i({hash:this.hash,entropy:h,nonce:u,pers:s.pers,persEnc:s.persEnc||\"utf8\"}),p=this.n.sub(new n(1)),m=0;;m++){var v=s.k?s.k(m):new n(c.generate(this.n.byteLength()));if(!(0>=(v=this._truncateToN(v,!0)).cmpn(1)||v.cmp(p)>=0)){var y=this.g.mul(v);if(!y.isInfinity()){var f=y.getX(),g=f.umod(this.n);if(0!==g.cmpn(0)){var d=v.invm(this.n).mul(g.mul(e.getPrivate()).iadd(t));if(0!==(d=d.umod(this.n)).cmpn(0)){var l=(y.getY().isOdd()?1:0)|(0!==f.cmp(g)?2:0);return s.canonical&&d.cmp(this.nh)>0&&(d=this.n.sub(d),l^=1),new a({r:g,s:d,recoveryParam:l})}}}}}},p.prototype.verify=function t(t,e,r,i){t=this._truncateToN(new n(t,16)),r=this.keyFromPublic(r,i);var s,o=(e=new a(e,\"hex\")).r,h=e.s;if(0>o.cmpn(1)||o.cmp(this.n)>=0||0>h.cmpn(1)||h.cmp(this.n)>=0)return!1;var u=h.invm(this.n),c=u.mul(t).umod(this.n),p=u.mul(o).umod(this.n);return this.curve._maxwellTrick?!(s=this.g.jmulAdd(c,r.getPublic(),p)).isInfinity()&&s.eqXToP(o):!(s=this.g.mulAdd(c,r.getPublic(),p)).isInfinity()&&0===s.getX().umod(this.n).cmp(o)},p.prototype.recoverPubKey=function(t,e,r,i){u((3&r)===r,\"The recovery param is more than two bits\"),e=new a(e,i);var s=this.n,o=new n(t),h=e.r,c=e.s,p=1&r,m=r>>1;if(h.cmp(this.curve.p.umod(this.curve.n))>=0&&m)throw Error(\"Unable to find sencond key candinate\");h=m?this.curve.pointFromX(h.add(this.curve.n),p):this.curve.pointFromX(h,p);var v=e.r.invm(s),y=s.sub(o).mul(v).umod(s),f=c.mul(v).umod(s);return this.g.mulAdd(y,h,f)},p.prototype.getKeyRecoveryParam=function(t,e,r,n){if(null!==(e=new a(e,n)).recoveryParam)return e.recoveryParam;for(var i,s=0;s<4;s++){try{i=this.recoverPubKey(t,e,s)}catch(t){continue}if(i.eq(r))return s}throw Error(\"Unable to find valid recovery factor\")}}","map":"{\"version\":3,\"sources\":[\"<anon>\"],\"names\":[],\"mappings\":\"\"}"}