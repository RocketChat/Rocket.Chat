{"code":"function module(e,t,i){let s,a,r,o,n,l,g;i.export({InviteUserAgentServer:()=>c}),i.link(\"../dialogs\",{Dialog(e){s=e},SessionDialog(e){a=e}},0),i.link(\"../exceptions\",{TransactionStateError(e){r=e}},1),i.link(\"../session\",{SignalingState(e){o=e}},2),i.link(\"../transactions\",{InviteServerTransaction(e){n=e}},3),i.link(\"../user-agent-core/allowed-methods\",{AllowedMethods(e){l=e}},4),i.link(\"./user-agent-server\",{UserAgentServer(e){g=e}},5);class c extends g{constructor(e,t,i){super(n,e,t,i),this.core=e}dispose(){this.earlyDialog&&this.earlyDialog.dispose(),super.dispose()}accept(e={statusCode:200}){if(!this.acceptable)throw new r(`${this.message.method} not acceptable in state ${this.transaction.state}.`);if(!this.confirmedDialog){if(this.earlyDialog)this.earlyDialog.confirm(),this.confirmedDialog=this.earlyDialog,this.earlyDialog=void 0;else{let e=this.transaction;if(!(e instanceof n))throw Error(\"Transaction not instance of InviteClientTransaction.\");let t=s.initialDialogStateForUserAgentServer(this.message,this.toTag);this.confirmedDialog=new a(e,this.core,t)}}let t=this.message.getHeaders(\"record-route\").map(e=>`Record-Route: ${e}`),i=`Contact: ${this.core.configuration.contact.toString()}`,g=\"Allow: \"+l.toString();if(!e.body){if(this.confirmedDialog.signalingState===o.Stable)e.body=this.confirmedDialog.answer;else if(this.confirmedDialog.signalingState===o.Initial||this.confirmedDialog.signalingState===o.HaveRemoteOffer)throw Error(\"Response must have a body.\")}e.statusCode=e.statusCode||200,e.extraHeaders=e.extraHeaders||[],e.extraHeaders=e.extraHeaders.concat(t),e.extraHeaders.push(g),e.extraHeaders.push(i);let c=super.accept(e),d=this.confirmedDialog,h=Object.assign(Object.assign({},c),{session:d});return e.body&&this.confirmedDialog.signalingState!==o.Stable&&this.confirmedDialog.signalingStateTransition(e.body),h}progress(e={statusCode:180}){if(!this.progressable)throw new r(`${this.message.method} not progressable in state ${this.transaction.state}.`);if(!this.earlyDialog){let e=this.transaction;if(!(e instanceof n))throw Error(\"Transaction not instance of InviteClientTransaction.\");let t=s.initialDialogStateForUserAgentServer(this.message,this.toTag,!0);this.earlyDialog=new a(e,this.core,t)}let t=this.message.getHeaders(\"record-route\").map(e=>`Record-Route: ${e}`),i=`Contact: ${this.core.configuration.contact}`;e.extraHeaders=e.extraHeaders||[],e.extraHeaders=e.extraHeaders.concat(t),e.extraHeaders.push(i);let l=super.progress(e),g=this.earlyDialog,c=Object.assign(Object.assign({},l),{session:g});return e.body&&this.earlyDialog.signalingState!==o.Stable&&this.earlyDialog.signalingStateTransition(e.body),c}redirect(e,t={statusCode:302}){return super.redirect(e,t)}reject(e={statusCode:486}){return super.reject(e)}}}","map":"{\"version\":3,\"sources\":[\"<anon>\"],\"names\":[],\"mappings\":\"\"}"}