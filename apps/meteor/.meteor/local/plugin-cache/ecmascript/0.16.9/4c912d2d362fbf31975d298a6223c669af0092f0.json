{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/reload/reload.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"packages/reload/reload.js","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/reload/reload.js","targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/reload/reload.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/reload/reload.js"}},"code":"var _slicedToArray;\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 0);\nvar _typeof;\nmodule.link(\"@babel/runtime/helpers/typeof\", {\n  default: function (v) {\n    _typeof = v;\n  }\n}, 1);\nmodule.export({\n  Reload: function () {\n    return Reload;\n  }\n});\nvar Reload = {};\nvar reloadSettings = Meteor.settings && Meteor.settings.public && Meteor.settings.public.packages && Meteor.settings.public.packages.reload || {};\nfunction debug(message, context) {\n  if (!reloadSettings.debug) {\n    return;\n  }\n  // eslint-disable-next-line no-console\n  console.log(\"[reload] \" + message, JSON.stringify(context));\n}\nvar KEY_NAME = 'Meteor_Reload';\nvar old_data = {};\n// read in old data at startup.\nvar old_json;\n\n// This logic for sessionStorage detection is based on browserstate/history.js\nvar safeSessionStorage = null;\ntry {\n  // This throws a SecurityError on Chrome if cookies & localStorage are\n  // explicitly disabled\n  //\n  // On Firefox with dom.storage.enabled set to false, sessionStorage is null\n  //\n  // We can't even do (typeof sessionStorage) on Chrome, it throws.  So we rely\n  // on the throw if sessionStorage == null; the alternative is browser\n  // detection, but this seems better.\n  safeSessionStorage = window.sessionStorage;\n\n  // Check we can actually use it\n  if (safeSessionStorage) {\n    safeSessionStorage.setItem('__dummy__', '1');\n    safeSessionStorage.removeItem('__dummy__');\n  } else {\n    // Be consistently null, for safety\n    safeSessionStorage = null;\n  }\n} catch (e) {\n  // Expected on chrome with strict security, or if sessionStorage not supported\n  safeSessionStorage = null;\n}\n\n// Exported for test.\nReload._getData = function () {\n  return safeSessionStorage && safeSessionStorage.getItem(KEY_NAME);\n};\nif (safeSessionStorage) {\n  old_json = Reload._getData();\n  safeSessionStorage.removeItem(KEY_NAME);\n} else {\n  // Unsupported browser (IE 6,7) or locked down security settings.\n  // No session resumption.\n  // Meteor._debug(\"XXX UNSUPPORTED BROWSER/SETTINGS\");\n}\nif (!old_json) old_json = '{}';\nvar old_parsed = {};\ntry {\n  old_parsed = JSON.parse(old_json);\n  if (_typeof(old_parsed) !== 'object') {\n    Meteor._debug('Got bad data on reload. Ignoring.');\n    old_parsed = {};\n  }\n} catch (err) {\n  Meteor._debug('Got invalid JSON on reload. Ignoring.');\n}\nif (old_parsed.reload && _typeof(old_parsed.data) === 'object') {\n  // Meteor._debug(\"Restoring reload data.\");\n  old_data = old_parsed.data;\n}\nvar providers = [];\n\n////////// External API //////////\n\n// Packages that support migration should register themselves by calling\n// this function. When it's time to migrate, callback will be called\n// with one argument, the \"retry function,\" and an optional 'option'\n// argument (containing a key 'immediateMigration'). If the package\n// is ready to migrate, it should return [true, data], where data is\n// its migration data, an arbitrary JSON value (or [true] if it has\n// no migration data this time). If the package needs more time\n// before it is ready to migrate, it should return false. Then, once\n// it is ready to migrating again, it should call the retry\n// function. The retry function will return immediately, but will\n// schedule the migration to be retried, meaning that every package\n// will be polled once again for its migration data. If they are all\n// ready this time, then the migration will happen. name must be set if there\n// is migration data. If 'immediateMigration' is set in the options\n// argument, then it doesn't matter whether the package is ready to\n// migrate or not; the reload will happen immediately without waiting\n// (used for OAuth redirect login).\n//\nReload._onMigrate = function (name, callback) {\n  debug('_onMigrate', {\n    name: name\n  });\n  if (!callback) {\n    // name not provided, so first arg is callback.\n    callback = name;\n    name = undefined;\n    debug('_onMigrate no callback');\n  }\n  providers.push({\n    name: name,\n    callback: callback\n  });\n};\n\n// Called by packages when they start up.\n// Returns the object that was saved, or undefined if none saved.\n//\nReload._migrationData = function (name) {\n  debug('_migrationData', {\n    name: name\n  });\n  return old_data[name];\n};\n\n// Options are the same as for `Reload._migrate`.\nvar pollProviders = function (tryReload, options) {\n  debug('pollProviders', {\n    options: options\n  });\n  tryReload = tryReload || function () {};\n  options = options || {};\n  var _options = options,\n    immediateMigration = _options.immediateMigration;\n  debug(\"pollProviders is \" + (immediateMigration ? '' : 'NOT ') + \"immediateMigration\", {\n    options: options\n  });\n  var migrationData = {};\n  var allReady = true;\n  providers.forEach(function (p) {\n    var _ref = p || {},\n      callback = _ref.callback,\n      name = _ref.name;\n    var _ref2 = callback(tryReload, options) || [],\n      _ref3 = _slicedToArray(_ref2, 2),\n      ready = _ref3[0],\n      data = _ref3[1];\n    debug(\"pollProviders provider \" + (name || 'unknown') + \" is \" + (ready ? 'ready' : 'NOT ready'), {\n      options: options\n    });\n    if (!ready) {\n      allReady = false;\n    }\n    if (data !== undefined && name) {\n      migrationData[name] = data;\n    }\n  });\n  if (allReady) {\n    debug('pollProviders allReady', {\n      options: options,\n      migrationData: migrationData\n    });\n    return migrationData;\n  }\n  if (immediateMigration) {\n    debug('pollProviders immediateMigration', {\n      options: options,\n      migrationData: migrationData\n    });\n    return migrationData;\n  }\n  return null;\n};\n\n// Options are:\n//  - immediateMigration: true if the page will be reloaded immediately\n//    regardless of whether packages report that they are ready or not.\nReload._migrate = function (tryReload, options) {\n  debug('_migrate', {\n    options: options\n  });\n  // Make sure each package is ready to go, and collect their\n  // migration data\n  var migrationData = pollProviders(tryReload, options);\n  if (migrationData === null) {\n    return false; // not ready yet..\n  }\n  var json;\n  try {\n    // Persist the migration data\n    json = JSON.stringify({\n      data: migrationData,\n      reload: true\n    });\n  } catch (err) {\n    Meteor._debug(\"Couldn't serialize data for migration\", migrationData);\n    throw err;\n  }\n  if (safeSessionStorage) {\n    try {\n      safeSessionStorage.setItem(KEY_NAME, json);\n    } catch (err) {\n      // We should have already checked this, but just log - don't throw\n      Meteor._debug(\"Couldn't save data for migration to sessionStorage\", err);\n    }\n  } else {\n    Meteor._debug('Browser does not support sessionStorage. Not saving migration state.');\n  }\n  return true;\n};\n\n// Allows tests to isolate the list of providers.\nReload._withFreshProvidersForTest = function (f) {\n  var originalProviders = providers.slice(0);\n  providers = [];\n  try {\n    f();\n  } finally {\n    providers = originalProviders;\n  }\n};\n\n// Migrating reload: reload this page (presumably to pick up a new\n// version of the code or assets), but save the program state and\n// migrate it over. This function returns immediately. The reload\n// will happen at some point in the future once all of the packages\n// are ready to migrate.\n//\nvar reloading = false;\nReload._reload = function (options) {\n  debug('_reload', {\n    options: options\n  });\n  options = options || {};\n  if (reloading) {\n    debug('reloading in progress already', {\n      options: options\n    });\n    return;\n  }\n  reloading = true;\n  function tryReload() {\n    debug('tryReload');\n    setTimeout(reload, 1);\n  }\n  function forceBrowserReload() {\n    debug('forceBrowserReload');\n    // We'd like to make the browser reload the page using location.replace()\n    // instead of location.reload(), because this avoids validating assets\n    // with the server if we still have a valid cached copy. This doesn't work\n    // when the location contains a hash however, because that wouldn't reload\n    // the page and just scroll to the hash location instead.\n    if (window.location.hash || window.location.href.endsWith('#')) {\n      window.location.reload();\n      return;\n    }\n    window.location.replace(window.location.href);\n  }\n  function reload() {\n    debug('reload');\n    if (!Reload._migrate(tryReload, options)) {\n      return;\n    }\n    if (Meteor.isCordova) {\n      WebAppLocalServer.switchToPendingVersion(function () {\n        forceBrowserReload();\n      });\n      return;\n    }\n    forceBrowserReload();\n  }\n  tryReload();\n};","map":{"version":3,"names":["_slicedToArray","module","link","default","v","_typeof","export","Reload","reloadSettings","Meteor","settings","public","packages","reload","debug","message","context","console","log","JSON","stringify","KEY_NAME","old_data","old_json","safeSessionStorage","window","sessionStorage","setItem","removeItem","e","_getData","getItem","old_parsed","parse","_debug","err","data","providers","_onMigrate","name","callback","undefined","push","_migrationData","pollProviders","tryReload","options","_options","immediateMigration","migrationData","allReady","forEach","p","_ref","_ref2","_ref3","ready","_migrate","json","_withFreshProvidersForTest","f","originalProviders","slice","reloading","_reload","setTimeout","forceBrowserReload","location","hash","href","endsWith","replace","isCordova","WebAppLocalServer","switchToPendingVersion"],"sources":["packages/reload/reload.js"],"sourcesContent":["/**\n * This code does _NOT_ support hot (session-restoring) reloads on\n * IE6,7. It only works on browsers with sessionStorage support.\n *\n * There are a couple approaches to add IE6,7 support:\n *\n * - use IE's \"userData\" mechanism in combination with window.name.\n * This mostly works, however the problem is that it can not get to the\n * data until after DOMReady. This is a problem for us since this API\n * relies on the data being ready before API users run. We could\n * refactor using Meteor.startup in all API users, but that might slow\n * page loads as we couldn't start the stream until after DOMReady.\n * Here are some resources on this approach:\n * https://github.com/hugeinc/USTORE.js\n * http://thudjs.tumblr.com/post/419577524/localstorage-userdata\n * http://www.javascriptkit.com/javatutors/domstorage2.shtml\n *\n * - POST the data to the server, and have the server send it back on\n * page load. This is nice because it sidesteps all the local storage\n * compatibility issues, however it is kinda tricky. We can use a unique\n * token in the URL, then get rid of it with HTML5 pushstate, but that\n * only works on pushstate browsers.\n *\n * This will all need to be reworked entirely when we add server-side\n * HTML rendering. In that case, the server will need to have access to\n * the client's session to render properly.\n */\n\n// XXX when making this API public, also expose a flag for the app\n// developer to know whether a hot code push is happening. This is\n// useful for apps using `window.onbeforeunload`. See\n// https://github.com/meteor/meteor/pull/657\n\nexport const Reload = {};\n\nconst reloadSettings =\n  (Meteor.settings &&\n    Meteor.settings.public &&\n    Meteor.settings.public.packages &&\n    Meteor.settings.public.packages.reload) ||\n  {};\n\nfunction debug(message, context) {\n  if (!reloadSettings.debug) {\n    return;\n  }\n  // eslint-disable-next-line no-console\n  console.log(`[reload] ${message}`, JSON.stringify(context));\n}\n\nconst KEY_NAME = 'Meteor_Reload';\n\nlet old_data = {};\n// read in old data at startup.\nlet old_json;\n\n// This logic for sessionStorage detection is based on browserstate/history.js\nlet safeSessionStorage = null;\ntry {\n  // This throws a SecurityError on Chrome if cookies & localStorage are\n  // explicitly disabled\n  //\n  // On Firefox with dom.storage.enabled set to false, sessionStorage is null\n  //\n  // We can't even do (typeof sessionStorage) on Chrome, it throws.  So we rely\n  // on the throw if sessionStorage == null; the alternative is browser\n  // detection, but this seems better.\n  safeSessionStorage = window.sessionStorage;\n\n  // Check we can actually use it\n  if (safeSessionStorage) {\n    safeSessionStorage.setItem('__dummy__', '1');\n    safeSessionStorage.removeItem('__dummy__');\n  } else {\n    // Be consistently null, for safety\n    safeSessionStorage = null;\n  }\n} catch (e) {\n  // Expected on chrome with strict security, or if sessionStorage not supported\n  safeSessionStorage = null;\n}\n\n// Exported for test.\nReload._getData = function () {\n  return safeSessionStorage && safeSessionStorage.getItem(KEY_NAME);\n};\n\nif (safeSessionStorage) {\n  old_json = Reload._getData();\n  safeSessionStorage.removeItem(KEY_NAME);\n} else {\n  // Unsupported browser (IE 6,7) or locked down security settings.\n  // No session resumption.\n  // Meteor._debug(\"XXX UNSUPPORTED BROWSER/SETTINGS\");\n}\n\nif (!old_json) old_json = '{}';\nlet old_parsed = {};\ntry {\n  old_parsed = JSON.parse(old_json);\n  if (typeof old_parsed !== 'object') {\n    Meteor._debug('Got bad data on reload. Ignoring.');\n    old_parsed = {};\n  }\n} catch (err) {\n  Meteor._debug('Got invalid JSON on reload. Ignoring.');\n}\n\nif (old_parsed.reload && typeof old_parsed.data === 'object') {\n  // Meteor._debug(\"Restoring reload data.\");\n  old_data = old_parsed.data;\n}\n\nlet providers = [];\n\n////////// External API //////////\n\n// Packages that support migration should register themselves by calling\n// this function. When it's time to migrate, callback will be called\n// with one argument, the \"retry function,\" and an optional 'option'\n// argument (containing a key 'immediateMigration'). If the package\n// is ready to migrate, it should return [true, data], where data is\n// its migration data, an arbitrary JSON value (or [true] if it has\n// no migration data this time). If the package needs more time\n// before it is ready to migrate, it should return false. Then, once\n// it is ready to migrating again, it should call the retry\n// function. The retry function will return immediately, but will\n// schedule the migration to be retried, meaning that every package\n// will be polled once again for its migration data. If they are all\n// ready this time, then the migration will happen. name must be set if there\n// is migration data. If 'immediateMigration' is set in the options\n// argument, then it doesn't matter whether the package is ready to\n// migrate or not; the reload will happen immediately without waiting\n// (used for OAuth redirect login).\n//\nReload._onMigrate = function (name, callback) {\n  debug('_onMigrate', {name});\n  if (!callback) {\n    // name not provided, so first arg is callback.\n    callback = name;\n    name = undefined;\n    debug('_onMigrate no callback');\n  }\n\n  providers.push({name: name, callback: callback});\n};\n\n// Called by packages when they start up.\n// Returns the object that was saved, or undefined if none saved.\n//\nReload._migrationData = function (name) {\n  debug('_migrationData', {name});\n  return old_data[name];\n};\n\n// Options are the same as for `Reload._migrate`.\nconst pollProviders = function (tryReload, options) {\n  debug('pollProviders', {options});\n  tryReload = tryReload || function () {\n  };\n  options = options || {};\n\n  const {immediateMigration} = options;\n  debug(\n    `pollProviders is ${immediateMigration ? '' : 'NOT '}immediateMigration`,\n    {options}\n  );\n  const migrationData = {};\n  let allReady = true;\n  providers.forEach(p => {\n    const {callback, name} = p || {};\n    const [ready, data] = callback(tryReload, options) || [];\n\n    debug(\n      `pollProviders provider ${name || 'unknown'} is ${\n        ready ? 'ready' : 'NOT ready'\n      }`,\n      {options}\n    );\n    if (!ready) {\n      allReady = false;\n    }\n\n    if (data !== undefined && name) {\n      migrationData[name] = data;\n    }\n  });\n\n  if (allReady) {\n    debug('pollProviders allReady', {options, migrationData});\n    return migrationData;\n  }\n\n  if (immediateMigration) {\n    debug('pollProviders immediateMigration', {options, migrationData});\n    return migrationData;\n  }\n\n  return null;\n};\n\n// Options are:\n//  - immediateMigration: true if the page will be reloaded immediately\n//    regardless of whether packages report that they are ready or not.\nReload._migrate = function (tryReload, options) {\n  debug('_migrate', {options});\n  // Make sure each package is ready to go, and collect their\n  // migration data\n  const migrationData = pollProviders(tryReload, options);\n  if (migrationData === null) {\n    return false; // not ready yet..\n  }\n\n  let json;\n  try {\n    // Persist the migration data\n    json = JSON.stringify({\n      data: migrationData,\n      reload: true,\n    });\n  } catch (err) {\n    Meteor._debug(\"Couldn't serialize data for migration\", migrationData);\n    throw err;\n  }\n\n  if (safeSessionStorage) {\n    try {\n      safeSessionStorage.setItem(KEY_NAME, json);\n    } catch (err) {\n      // We should have already checked this, but just log - don't throw\n      Meteor._debug(\"Couldn't save data for migration to sessionStorage\", err);\n    }\n  } else {\n    Meteor._debug(\n      'Browser does not support sessionStorage. Not saving migration state.'\n    );\n  }\n\n  return true;\n};\n\n// Allows tests to isolate the list of providers.\nReload._withFreshProvidersForTest = function (f) {\n  const originalProviders = providers.slice(0);\n  providers = [];\n  try {\n    f();\n  } finally {\n    providers = originalProviders;\n  }\n};\n\n// Migrating reload: reload this page (presumably to pick up a new\n// version of the code or assets), but save the program state and\n// migrate it over. This function returns immediately. The reload\n// will happen at some point in the future once all of the packages\n// are ready to migrate.\n//\nlet reloading = false;\nReload._reload = function (options) {\n  debug('_reload', {options});\n  options = options || {};\n\n  if (reloading) {\n    debug('reloading in progress already', {options});\n    return;\n  }\n  reloading = true;\n\n  function tryReload() {\n    debug('tryReload');\n    setTimeout(reload, 1);\n  }\n\n  function forceBrowserReload() {\n    debug('forceBrowserReload');\n    // We'd like to make the browser reload the page using location.replace()\n    // instead of location.reload(), because this avoids validating assets\n    // with the server if we still have a valid cached copy. This doesn't work\n    // when the location contains a hash however, because that wouldn't reload\n    // the page and just scroll to the hash location instead.\n    if (window.location.hash || window.location.href.endsWith('#')) {\n      window.location.reload();\n      return;\n    }\n\n    window.location.replace(window.location.href);\n  }\n\n  function reload() {\n    debug('reload');\n    if (!Reload._migrate(tryReload, options)) {\n      return;\n    }\n\n    if (Meteor.isCordova) {\n      WebAppLocalServer.switchToPendingVersion(() => {\n        forceBrowserReload();\n      });\n      return;\n    }\n\n    forceBrowserReload();\n  }\n\n  tryReload();\n};\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"4c912d2d362fbf31975d298a6223c669af0092f0"}
