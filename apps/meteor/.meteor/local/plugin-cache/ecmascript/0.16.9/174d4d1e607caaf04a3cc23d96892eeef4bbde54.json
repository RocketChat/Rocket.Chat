{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/ddp-common/utils.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"packages/ddp-common/utils.js","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/ddp-common/utils.js","targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/ddp-common/utils.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/ddp-common/utils.js"}},"code":"\"use strict\";\n\nmodule.export({\n  hasOwn: () => hasOwn,\n  slice: () => slice,\n  keys: () => keys,\n  isEmpty: () => isEmpty,\n  last: () => last\n});\nconst hasOwn = Object.prototype.hasOwnProperty;\nconst slice = Array.prototype.slice;\nfunction keys(obj) {\n  return Object.keys(Object(obj));\n}\nfunction isEmpty(obj) {\n  if (obj == null) {\n    return true;\n  }\n  if (Array.isArray(obj) || typeof obj === \"string\") {\n    return obj.length === 0;\n  }\n  for (const key in obj) {\n    if (hasOwn.call(obj, key)) {\n      return false;\n    }\n  }\n  return true;\n}\nfunction last(array, n, guard) {\n  if (array == null) {\n    return;\n  }\n  if (n == null || guard) {\n    return array[array.length - 1];\n  }\n  return slice.call(array, Math.max(array.length - n, 0));\n}\nDDPCommon.SUPPORTED_DDP_VERSIONS = ['1', 'pre2', 'pre1'];\nDDPCommon.parseDDP = function (stringMessage) {\n  try {\n    var msg = JSON.parse(stringMessage);\n  } catch (e) {\n    Meteor._debug(\"Discarding message with invalid JSON\", stringMessage);\n    return null;\n  }\n  // DDP messages must be objects.\n  if (msg === null || typeof msg !== 'object') {\n    Meteor._debug(\"Discarding non-object DDP message\", stringMessage);\n    return null;\n  }\n\n  // massage msg to get it into \"abstract ddp\" rather than \"wire ddp\" format.\n\n  // switch between \"cleared\" rep of unsetting fields and \"undefined\"\n  // rep of same\n  if (hasOwn.call(msg, 'cleared')) {\n    if (!hasOwn.call(msg, 'fields')) {\n      msg.fields = {};\n    }\n    msg.cleared.forEach(clearKey => {\n      msg.fields[clearKey] = undefined;\n    });\n    delete msg.cleared;\n  }\n  ['fields', 'params', 'result'].forEach(field => {\n    if (hasOwn.call(msg, field)) {\n      msg[field] = EJSON._adjustTypesFromJSONValue(msg[field]);\n    }\n  });\n  return msg;\n};\nDDPCommon.stringifyDDP = function (msg) {\n  const copy = EJSON.clone(msg);\n\n  // swizzle 'changed' messages from 'fields undefined' rep to 'fields\n  // and cleared' rep\n  if (hasOwn.call(msg, 'fields')) {\n    const cleared = [];\n    Object.keys(msg.fields).forEach(key => {\n      const value = msg.fields[key];\n      if (typeof value === \"undefined\") {\n        cleared.push(key);\n        delete copy.fields[key];\n      }\n    });\n    if (!isEmpty(cleared)) {\n      copy.cleared = cleared;\n    }\n    if (isEmpty(copy.fields)) {\n      delete copy.fields;\n    }\n  }\n\n  // adjust types to basic\n  ['fields', 'params', 'result'].forEach(field => {\n    if (hasOwn.call(copy, field)) {\n      copy[field] = EJSON._adjustTypesToJSONValue(copy[field]);\n    }\n  });\n  if (msg.id && typeof msg.id !== 'string') {\n    throw new Error(\"Message id is not a string\");\n  }\n  return JSON.stringify(copy);\n};","map":{"version":3,"names":["module","export","hasOwn","slice","keys","isEmpty","last","Object","prototype","hasOwnProperty","Array","obj","isArray","length","key","call","array","n","guard","Math","max","DDPCommon","SUPPORTED_DDP_VERSIONS","parseDDP","stringMessage","msg","JSON","parse","e","Meteor","_debug","fields","cleared","forEach","clearKey","undefined","field","EJSON","_adjustTypesFromJSONValue","stringifyDDP","copy","clone","value","push","_adjustTypesToJSONValue","id","Error","stringify"],"sources":["packages/ddp-common/utils.js"],"sourcesContent":["\"use strict\";\n\nexport const hasOwn = Object.prototype.hasOwnProperty;\nexport const slice = Array.prototype.slice;\n\nexport function keys(obj) {\n  return Object.keys(Object(obj));\n}\n\nexport function isEmpty(obj) {\n  if (obj == null) {\n    return true;\n  }\n\n  if (Array.isArray(obj) ||\n      typeof obj === \"string\") {\n    return obj.length === 0;\n  }\n\n  for (const key in obj) {\n    if (hasOwn.call(obj, key)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nexport function last(array, n, guard) {\n  if (array == null) {\n    return;\n  }\n\n  if ((n == null) || guard) {\n    return array[array.length - 1];\n  }\n\n  return slice.call(array, Math.max(array.length - n, 0));\n}\n\nDDPCommon.SUPPORTED_DDP_VERSIONS = [ '1', 'pre2', 'pre1' ];\n\nDDPCommon.parseDDP = function (stringMessage) {\n  try {\n    var msg = JSON.parse(stringMessage);\n  } catch (e) {\n    Meteor._debug(\"Discarding message with invalid JSON\", stringMessage);\n    return null;\n  }\n  // DDP messages must be objects.\n  if (msg === null || typeof msg !== 'object') {\n    Meteor._debug(\"Discarding non-object DDP message\", stringMessage);\n    return null;\n  }\n\n  // massage msg to get it into \"abstract ddp\" rather than \"wire ddp\" format.\n\n  // switch between \"cleared\" rep of unsetting fields and \"undefined\"\n  // rep of same\n  if (hasOwn.call(msg, 'cleared')) {\n    if (! hasOwn.call(msg, 'fields')) {\n      msg.fields = {};\n    }\n    msg.cleared.forEach(clearKey => {\n      msg.fields[clearKey] = undefined;\n    });\n    delete msg.cleared;\n  }\n\n  ['fields', 'params', 'result'].forEach(field => {\n    if (hasOwn.call(msg, field)) {\n      msg[field] = EJSON._adjustTypesFromJSONValue(msg[field]);\n    }\n  });\n\n  return msg;\n};\n\nDDPCommon.stringifyDDP = function (msg) {\n  const copy = EJSON.clone(msg);\n\n  // swizzle 'changed' messages from 'fields undefined' rep to 'fields\n  // and cleared' rep\n  if (hasOwn.call(msg, 'fields')) {\n    const cleared = [];\n\n    Object.keys(msg.fields).forEach(key => {\n      const value = msg.fields[key];\n\n      if (typeof value === \"undefined\") {\n        cleared.push(key);\n        delete copy.fields[key];\n      }\n    });\n\n    if (! isEmpty(cleared)) {\n      copy.cleared = cleared;\n    }\n\n    if (isEmpty(copy.fields)) {\n      delete copy.fields;\n    }\n  }\n\n  // adjust types to basic\n  ['fields', 'params', 'result'].forEach(field => {\n    if (hasOwn.call(copy, field)) {\n      copy[field] = EJSON._adjustTypesToJSONValue(copy[field]);\n    }\n  });\n\n  if (msg.id && typeof msg.id !== 'string') {\n    throw new Error(\"Message id is not a string\");\n  }\n\n  return JSON.stringify(copy);\n};\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"174d4d1e607caaf04a3cc23d96892eeef4bbde54"}
