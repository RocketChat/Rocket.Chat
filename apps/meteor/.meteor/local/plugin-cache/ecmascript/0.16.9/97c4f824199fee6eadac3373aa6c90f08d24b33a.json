{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/callback-hook/hook.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"packages/callback-hook/hook.js","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/callback-hook/hook.js","targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/callback-hook/hook.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/callback-hook/hook.js"}},"code":"var _regeneratorRuntime;\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\nmodule.export({\n  Hook: function () {\n    return Hook;\n  }\n});\n// XXX This pattern is under development. Do not add more callsites\n// using this package for now. See:\n// https://meteor.hackpad.com/Design-proposal-Hooks-YxvgEW06q6f\n//\n// Encapsulates the pattern of registering callbacks on a hook.\n//\n// The `each` method of the hook calls its iterator function argument\n// with each registered callback.  This allows the hook to\n// conditionally decide not to call the callback (if, for example, the\n// observed object has been closed or terminated).\n//\n// By default, callbacks are bound with `Meteor.bindEnvironment`, so they will be\n// called with the Meteor environment of the calling code that\n// registered the callback. Override by passing { bindEnvironment: false }\n// to the constructor.\n//\n// Registering a callback returns an object with a single `stop`\n// method which unregisters the callback.\n//\n// The code is careful to allow a callback to be safely unregistered\n// while the callbacks are being iterated over.\n//\n// If the hook is configured with the `exceptionHandler` option, the\n// handler will be called if a called callback throws an exception.\n// By default (if the exception handler doesn't itself throw an\n// exception, or if the iterator function doesn't return a falsy value\n// to terminate the calling of callbacks), the remaining callbacks\n// will still be called.\n//\n// Alternatively, the `debugPrintExceptions` option can be specified\n// as string describing the callback.  On an exception the string and\n// the exception will be printed to the console log with\n// `Meteor._debug`, and the exception otherwise ignored.\n//\n// If an exception handler isn't specified, exceptions thrown in the\n// callback will propagate up to the iterator function, and will\n// terminate calling the remaining callbacks if not caught.\n\nvar hasOwn = Object.prototype.hasOwnProperty;\nvar Hook = /*#__PURE__*/function () {\n  function Hook(options) {\n    options = options || {};\n    this.nextCallbackId = 0;\n    this.callbacks = Object.create(null);\n    // Whether to wrap callbacks with Meteor.bindEnvironment\n    this.bindEnvironment = true;\n    if (options.bindEnvironment === false) {\n      this.bindEnvironment = false;\n    }\n    this.wrapAsync = true;\n    if (options.wrapAsync === false) {\n      this.wrapAsync = false;\n    }\n    if (options.exceptionHandler) {\n      this.exceptionHandler = options.exceptionHandler;\n    } else if (options.debugPrintExceptions) {\n      if (typeof options.debugPrintExceptions !== \"string\") {\n        throw new Error(\"Hook option debugPrintExceptions should be a string\");\n      }\n      this.exceptionHandler = options.debugPrintExceptions;\n    }\n  }\n  var _proto = Hook.prototype;\n  _proto.register = function () {\n    function register(callback) {\n      var _this2 = this;\n      var exceptionHandler = this.exceptionHandler || function (exception) {\n        // Note: this relies on the undocumented fact that if bindEnvironment's\n        // onException throws, and you are invoking the callback either in the\n        // browser or from within a Fiber in Node, the exception is propagated.\n        throw exception;\n      };\n      if (this.bindEnvironment) {\n        callback = Meteor.bindEnvironment(callback, exceptionHandler);\n      } else {\n        callback = dontBindEnvironment(callback, exceptionHandler);\n      }\n      if (this.wrapAsync) {\n        callback = Meteor.wrapFn(callback);\n      }\n      var id = this.nextCallbackId++;\n      this.callbacks[id] = callback;\n      return {\n        callback: callback,\n        stop: function () {\n          delete _this2.callbacks[id];\n        }\n      };\n    }\n    return register;\n  }();\n  _proto.clear = function () {\n    function clear() {\n      this.nextCallbackId = 0;\n      this.callbacks = [];\n    }\n    return clear;\n  }()\n  /**\n   * For each registered callback, call the passed iterator function with the callback.\n   *\n   * The iterator function can choose whether or not to call the\n   * callback.  (For example, it might not call the callback if the\n   * observed object has been closed or terminated).\n   * The iteration is stopped if the iterator function returns a falsy\n   * value or throws an exception.\n   *\n   * @param iterator\n   */\n  ;\n  _proto.forEach = function () {\n    function forEach(iterator) {\n      var ids = Object.keys(this.callbacks);\n      for (var i = 0; i < ids.length; ++i) {\n        var id = ids[i];\n        // check to see if the callback was removed during iteration\n        if (hasOwn.call(this.callbacks, id)) {\n          var callback = this.callbacks[id];\n          if (!iterator(callback)) {\n            break;\n          }\n        }\n      }\n    }\n    return forEach;\n  }();\n  _proto.forEachAsync = function () {\n    function forEachAsync(iterator) {\n      var ids, i, id, callback;\n      return _regeneratorRuntime.async(function () {\n        function forEachAsync$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              ids = Object.keys(this.callbacks);\n              i = 0;\n            case 2:\n              if (!(i < ids.length)) {\n                _context.next = 13;\n                break;\n              }\n              id = ids[i]; // check to see if the callback was removed during iteration\n              if (!hasOwn.call(this.callbacks, id)) {\n                _context.next = 10;\n                break;\n              }\n              callback = this.callbacks[id];\n              _context.next = 8;\n              return _regeneratorRuntime.awrap(iterator(callback));\n            case 8:\n              if (_context.sent) {\n                _context.next = 10;\n                break;\n              }\n              return _context.abrupt(\"break\", 13);\n            case 10:\n              ++i;\n              _context.next = 2;\n              break;\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n        return forEachAsync$;\n      }(), null, this, null, Promise);\n    }\n    return forEachAsync;\n  }()\n  /**\n   * For each registered callback, call the passed iterator function with the callback.\n   *\n   * it is a counterpart of forEach, but it is async and returns a promise\n   * @param iterator\n   * @return {Promise<void>}\n   * @see forEach\n   */\n  ;\n  _proto.forEachAsync = function () {\n    function forEachAsync(iterator) {\n      var ids, i, id, callback;\n      return _regeneratorRuntime.async(function () {\n        function forEachAsync$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              ids = Object.keys(this.callbacks);\n              i = 0;\n            case 2:\n              if (!(i < ids.length)) {\n                _context2.next = 13;\n                break;\n              }\n              id = ids[i]; // check to see if the callback was removed during iteration\n              if (!hasOwn.call(this.callbacks, id)) {\n                _context2.next = 10;\n                break;\n              }\n              callback = this.callbacks[id];\n              _context2.next = 8;\n              return _regeneratorRuntime.awrap(iterator(callback));\n            case 8:\n              if (_context2.sent) {\n                _context2.next = 10;\n                break;\n              }\n              return _context2.abrupt(\"break\", 13);\n            case 10:\n              ++i;\n              _context2.next = 2;\n              break;\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n        return forEachAsync$;\n      }(), null, this, null, Promise);\n    }\n    return forEachAsync;\n  }()\n  /**\n   * @deprecated use forEach\n   * @param iterator\n   */\n  ;\n  _proto.each = function () {\n    function each(iterator) {\n      return this.forEach(iterator);\n    }\n    return each;\n  }();\n  return Hook;\n}();\n// Copied from Meteor.bindEnvironment and removed all the env stuff.\nfunction dontBindEnvironment(func, onException, _this) {\n  if (!onException || typeof onException === 'string') {\n    var description = onException || \"callback of async function\";\n    onException = function (error) {\n      Meteor._debug(\"Exception in \" + description, error);\n    };\n  }\n  return function () {\n    var ret;\n    try {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      ret = func.apply(_this, args);\n    } catch (e) {\n      onException(e);\n    }\n    return ret;\n  };\n}","map":{"version":3,"names":["_regeneratorRuntime","module","link","default","v","export","Hook","hasOwn","Object","prototype","hasOwnProperty","options","nextCallbackId","callbacks","create","bindEnvironment","wrapAsync","exceptionHandler","debugPrintExceptions","Error","_proto","register","callback","_this2","exception","Meteor","dontBindEnvironment","wrapFn","id","stop","clear","forEach","iterator","ids","keys","i","length","call","forEachAsync","async","forEachAsync$","_context","prev","next","awrap","sent","abrupt","Promise","_context2","each","func","onException","_this","description","error","_debug","ret","_len","arguments","args","Array","_key","apply","e"],"sources":["packages/callback-hook/hook.js"],"sourcesContent":["// XXX This pattern is under development. Do not add more callsites\n// using this package for now. See:\n// https://meteor.hackpad.com/Design-proposal-Hooks-YxvgEW06q6f\n//\n// Encapsulates the pattern of registering callbacks on a hook.\n//\n// The `each` method of the hook calls its iterator function argument\n// with each registered callback.  This allows the hook to\n// conditionally decide not to call the callback (if, for example, the\n// observed object has been closed or terminated).\n//\n// By default, callbacks are bound with `Meteor.bindEnvironment`, so they will be\n// called with the Meteor environment of the calling code that\n// registered the callback. Override by passing { bindEnvironment: false }\n// to the constructor.\n//\n// Registering a callback returns an object with a single `stop`\n// method which unregisters the callback.\n//\n// The code is careful to allow a callback to be safely unregistered\n// while the callbacks are being iterated over.\n//\n// If the hook is configured with the `exceptionHandler` option, the\n// handler will be called if a called callback throws an exception.\n// By default (if the exception handler doesn't itself throw an\n// exception, or if the iterator function doesn't return a falsy value\n// to terminate the calling of callbacks), the remaining callbacks\n// will still be called.\n//\n// Alternatively, the `debugPrintExceptions` option can be specified\n// as string describing the callback.  On an exception the string and\n// the exception will be printed to the console log with\n// `Meteor._debug`, and the exception otherwise ignored.\n//\n// If an exception handler isn't specified, exceptions thrown in the\n// callback will propagate up to the iterator function, and will\n// terminate calling the remaining callbacks if not caught.\n\nconst hasOwn = Object.prototype.hasOwnProperty;\n\nexport class Hook {\n  constructor(options) {\n    options = options || {};\n    this.nextCallbackId = 0;\n    this.callbacks = Object.create(null);\n    // Whether to wrap callbacks with Meteor.bindEnvironment\n    this.bindEnvironment = true;\n    if (options.bindEnvironment === false) {\n      this.bindEnvironment = false;\n    }\n\n    this.wrapAsync = true;\n    if (options.wrapAsync === false) {\n      this.wrapAsync = false;\n    }\n\n    if (options.exceptionHandler) {\n      this.exceptionHandler = options.exceptionHandler;\n    } else if (options.debugPrintExceptions) {\n      if (typeof options.debugPrintExceptions !== \"string\") {\n        throw new Error(\"Hook option debugPrintExceptions should be a string\");\n      }\n      this.exceptionHandler = options.debugPrintExceptions;\n    }\n  }\n\n  register(callback) {\n    const exceptionHandler = this.exceptionHandler || function (exception) {\n      // Note: this relies on the undocumented fact that if bindEnvironment's\n      // onException throws, and you are invoking the callback either in the\n      // browser or from within a Fiber in Node, the exception is propagated.\n      throw exception;\n    };\n\n    if (this.bindEnvironment) {\n      callback = Meteor.bindEnvironment(callback, exceptionHandler);\n    } else {\n      callback = dontBindEnvironment(callback, exceptionHandler);\n    }\n\n    if (this.wrapAsync) {\n      callback = Meteor.wrapFn(callback);\n    }\n\n    const id = this.nextCallbackId++;\n    this.callbacks[id] = callback;\n\n    return {\n      callback,\n      stop: () => {\n        delete this.callbacks[id];\n      }\n    };\n  }\n\n  clear() {\n    this.nextCallbackId = 0;\n    this.callbacks = [];\n  }\n\n  /**\n   * For each registered callback, call the passed iterator function with the callback.\n   *\n   * The iterator function can choose whether or not to call the\n   * callback.  (For example, it might not call the callback if the\n   * observed object has been closed or terminated).\n   * The iteration is stopped if the iterator function returns a falsy\n   * value or throws an exception.\n   *\n   * @param iterator\n   */\n  forEach(iterator) {\n\n    const ids = Object.keys(this.callbacks);\n    for (let i = 0;  i < ids.length;  ++i) {\n      const id = ids[i];\n      // check to see if the callback was removed during iteration\n      if (hasOwn.call(this.callbacks, id)) {\n        const callback = this.callbacks[id];\n        if (! iterator(callback)) {\n          break;\n        }\n      }\n    }\n  }\n\n  async forEachAsync(iterator) {\n    const ids = Object.keys(this.callbacks);\n    for (let i = 0;  i < ids.length;  ++i) {\n      const id = ids[i];\n      // check to see if the callback was removed during iteration\n      if (hasOwn.call(this.callbacks, id)) {\n        const callback = this.callbacks[id];\n        if (!await iterator(callback)) {\n          break;\n        }\n      }\n    }\n  }\n\n  /**\n   * For each registered callback, call the passed iterator function with the callback.\n   *\n   * it is a counterpart of forEach, but it is async and returns a promise\n   * @param iterator\n   * @return {Promise<void>}\n   * @see forEach\n   */\n  async forEachAsync(iterator) {\n    const ids = Object.keys(this.callbacks);\n    for (let i = 0;  i < ids.length;  ++i) {\n      const id = ids[i];\n      // check to see if the callback was removed during iteration\n      if (hasOwn.call(this.callbacks, id)) {\n        const callback = this.callbacks[id];\n        if (!await iterator(callback)) {\n          break;\n        }\n      }\n    }\n  }\n\n  /**\n   * @deprecated use forEach\n   * @param iterator\n   */\n  each(iterator) {\n    return this.forEach(iterator);\n  }\n}\n\n// Copied from Meteor.bindEnvironment and removed all the env stuff.\nfunction dontBindEnvironment(func, onException, _this) {\n  if (!onException || typeof(onException) === 'string') {\n    const description = onException || \"callback of async function\";\n    onException = function (error) {\n      Meteor._debug(\n        \"Exception in \" + description,\n        error\n      );\n    };\n  }\n\n  return function (...args) {\n    let ret;\n    try {\n      ret = func.apply(_this, args);\n    } catch (e) {\n      onException(e);\n    }\n    return ret;\n  };\n}\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"97c4f824199fee6eadac3373aa6c90f08d24b33a"}
